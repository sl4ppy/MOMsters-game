(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();var Qt=(r=>(r[r.WEBGL_LEGACY=0]="WEBGL_LEGACY",r[r.WEBGL=1]="WEBGL",r[r.WEBGL2=2]="WEBGL2",r))(Qt||{}),Vh=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.WEBGL=1]="WEBGL",r[r.CANVAS=2]="CANVAS",r))(Vh||{}),Pn=(r=>(r[r.COLOR=16384]="COLOR",r[r.DEPTH=256]="DEPTH",r[r.STENCIL=1024]="STENCIL",r))(Pn||{}),oe=(r=>(r[r.NORMAL=0]="NORMAL",r[r.ADD=1]="ADD",r[r.MULTIPLY=2]="MULTIPLY",r[r.SCREEN=3]="SCREEN",r[r.OVERLAY=4]="OVERLAY",r[r.DARKEN=5]="DARKEN",r[r.LIGHTEN=6]="LIGHTEN",r[r.COLOR_DODGE=7]="COLOR_DODGE",r[r.COLOR_BURN=8]="COLOR_BURN",r[r.HARD_LIGHT=9]="HARD_LIGHT",r[r.SOFT_LIGHT=10]="SOFT_LIGHT",r[r.DIFFERENCE=11]="DIFFERENCE",r[r.EXCLUSION=12]="EXCLUSION",r[r.HUE=13]="HUE",r[r.SATURATION=14]="SATURATION",r[r.COLOR=15]="COLOR",r[r.LUMINOSITY=16]="LUMINOSITY",r[r.NORMAL_NPM=17]="NORMAL_NPM",r[r.ADD_NPM=18]="ADD_NPM",r[r.SCREEN_NPM=19]="SCREEN_NPM",r[r.NONE=20]="NONE",r[r.SRC_OVER=0]="SRC_OVER",r[r.SRC_IN=21]="SRC_IN",r[r.SRC_OUT=22]="SRC_OUT",r[r.SRC_ATOP=23]="SRC_ATOP",r[r.DST_OVER=24]="DST_OVER",r[r.DST_IN=25]="DST_IN",r[r.DST_OUT=26]="DST_OUT",r[r.DST_ATOP=27]="DST_ATOP",r[r.ERASE=26]="ERASE",r[r.SUBTRACT=28]="SUBTRACT",r[r.XOR=29]="XOR",r))(oe||{}),ht=(r=>(r[r.POINTS=0]="POINTS",r[r.LINES=1]="LINES",r[r.LINE_LOOP=2]="LINE_LOOP",r[r.LINE_STRIP=3]="LINE_STRIP",r[r.TRIANGLES=4]="TRIANGLES",r[r.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",r[r.TRIANGLE_FAN=6]="TRIANGLE_FAN",r))(ht||{}),W=(r=>(r[r.RGBA=6408]="RGBA",r[r.RGB=6407]="RGB",r[r.RG=33319]="RG",r[r.RED=6403]="RED",r[r.RGBA_INTEGER=36249]="RGBA_INTEGER",r[r.RGB_INTEGER=36248]="RGB_INTEGER",r[r.RG_INTEGER=33320]="RG_INTEGER",r[r.RED_INTEGER=36244]="RED_INTEGER",r[r.ALPHA=6406]="ALPHA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",r[r.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",r[r.DEPTH_STENCIL=34041]="DEPTH_STENCIL",r))(W||{}),gi=(r=>(r[r.TEXTURE_2D=3553]="TEXTURE_2D",r[r.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",r[r.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",r[r.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",r[r.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",r[r.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",r[r.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",r[r.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",r))(gi||{}),ae=(r=>(r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",r[r.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",r[r.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",r[r.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",r[r.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",r[r.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",r[r.BYTE=5120]="BYTE",r[r.SHORT=5122]="SHORT",r[r.INT=5124]="INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",r[r.HALF_FLOAT=36193]="HALF_FLOAT",r))(ae||{}),X=(r=>(r[r.FLOAT=0]="FLOAT",r[r.INT=1]="INT",r[r.UINT=2]="UINT",r))(X||{}),gt=(r=>(r[r.NEAREST=0]="NEAREST",r[r.LINEAR=1]="LINEAR",r))(gt||{}),Dt=(r=>(r[r.CLAMP=33071]="CLAMP",r[r.REPEAT=10497]="REPEAT",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r))(Dt||{}),ut=(r=>(r[r.OFF=0]="OFF",r[r.POW2=1]="POW2",r[r.ON=2]="ON",r[r.ON_MANUAL=3]="ON_MANUAL",r))(ut||{}),Ue=(r=>(r[r.NPM=0]="NPM",r[r.UNPACK=1]="UNPACK",r[r.PMA=2]="PMA",r[r.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",r[r.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",r[r.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",r))(Ue||{}),ot=(r=>(r[r.NO=0]="NO",r[r.YES=1]="YES",r[r.AUTO=2]="AUTO",r[r.BLEND=0]="BLEND",r[r.CLEAR=1]="CLEAR",r[r.BLIT=2]="BLIT",r))(ot||{}),fa=(r=>(r[r.AUTO=0]="AUTO",r[r.MANUAL=1]="MANUAL",r))(fa||{}),Ve=(r=>(r.LOW="lowp",r.MEDIUM="mediump",r.HIGH="highp",r))(Ve||{}),Pe=(r=>(r[r.NONE=0]="NONE",r[r.SCISSOR=1]="SCISSOR",r[r.STENCIL=2]="STENCIL",r[r.SPRITE=3]="SPRITE",r[r.COLOR=4]="COLOR",r))(Pe||{}),Mc=(r=>(r[r.RED=1]="RED",r[r.GREEN=2]="GREEN",r[r.BLUE=4]="BLUE",r[r.ALPHA=8]="ALPHA",r))(Mc||{}),Me=(r=>(r[r.NONE=0]="NONE",r[r.LOW=2]="LOW",r[r.MEDIUM=4]="MEDIUM",r[r.HIGH=8]="HIGH",r))(Me||{}),lt=(r=>(r[r.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",r[r.ARRAY_BUFFER=34962]="ARRAY_BUFFER",r[r.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",r))(lt||{});const Rc={createCanvas:(r,e)=>{const t=document.createElement("canvas");return t.width=r,t.height=e,t},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(r,e)=>fetch(r,e),parseXML:r=>new DOMParser().parseFromString(r,"text/xml")},j={ADAPTER:Rc,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var hr=/iPhone/i,La=/iPod/i,Oa=/iPad/i,ka=/\biOS-universal(?:.+)Mac\b/i,lr=/\bAndroid(?:.+)Mobile\b/i,Na=/Android/i,oi=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ki=/Silk/i,pt=/Windows Phone/i,Ua=/\bWindows(?:.+)ARM\b/i,Ga=/BlackBerry/i,Ha=/BB10/i,Wa=/Opera Mini/i,za=/\b(CriOS|Chrome)(?:.+)Mobile/i,$a=/Mobile(?:.+)Firefox\b/i,Va=function(r){return typeof r<"u"&&r.platform==="MacIntel"&&typeof r.maxTouchPoints=="number"&&r.maxTouchPoints>1&&typeof MSStream>"u"};function Pc(r){return function(e){return e.test(r)}}function Xa(r){var e={userAgent:"",platform:"",maxTouchPoints:0};!r&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof r=="string"?e.userAgent=r:r&&r.userAgent&&(e={userAgent:r.userAgent,platform:r.platform,maxTouchPoints:r.maxTouchPoints||0});var t=e.userAgent,i=t.split("[FBAN");typeof i[1]<"u"&&(t=i[0]),i=t.split("Twitter"),typeof i[1]<"u"&&(t=i[0]);var s=Pc(t),n={apple:{phone:s(hr)&&!s(pt),ipod:s(La),tablet:!s(hr)&&(s(Oa)||Va(e))&&!s(pt),universal:s(ka),device:(s(hr)||s(La)||s(Oa)||s(ka)||Va(e))&&!s(pt)},amazon:{phone:s(oi),tablet:!s(oi)&&s(Ki),device:s(oi)||s(Ki)},android:{phone:!s(pt)&&s(oi)||!s(pt)&&s(lr),tablet:!s(pt)&&!s(oi)&&!s(lr)&&(s(Ki)||s(Na)),device:!s(pt)&&(s(oi)||s(Ki)||s(lr)||s(Na))||s(/\bokhttp\b/i)},windows:{phone:s(pt),tablet:s(Ua),device:s(pt)||s(Ua)},other:{blackberry:s(Ga),blackberry10:s(Ha),opera:s(Wa),firefox:s($a),chrome:s(za),device:s(Ga)||s(Ha)||s(Wa)||s($a)||s(za)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}const Ic=Xa.default??Xa,yt=Ic(globalThis.navigator);j.RETINA_PREFIX=/@([0-9\.]+)x/;j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Cs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xh(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Bc(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function i(){var s=!1;try{s=this instanceof i}catch{}return s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(i){var s=Object.getOwnPropertyDescriptor(r,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return r[i]}})}),t}var cr={exports:{}},ja;function Dc(){return ja||(ja=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function s(h,l,c){this.fn=h,this.context=l,this.once=c||!1}function n(h,l,c,u,d){if(typeof c!="function")throw new TypeError("The listener must be a function");var p=new s(c,u||h,d),f=t?t+l:l;return h._events[f]?h._events[f].fn?h._events[f]=[h._events[f],p]:h._events[f].push(p):(h._events[f]=p,h._eventsCount++),h}function a(h,l){--h._eventsCount===0?h._events=new i:delete h._events[l]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)e.call(c,u)&&l.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=t?t+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,p=u.length,f=new Array(p);d<p;d++)f[d]=u[d].fn;return f},o.prototype.listenerCount=function(l){var c=t?t+l:l,u=this._events[c];return u?u.fn?1:u.length:0},o.prototype.emit=function(l,c,u,d,p,f){var g=t?t+l:l;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,S,_;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,c),!0;case 3:return m.fn.call(m.context,c,u),!0;case 4:return m.fn.call(m.context,c,u,d),!0;case 5:return m.fn.call(m.context,c,u,d,p),!0;case 6:return m.fn.call(m.context,c,u,d,p,f),!0}for(_=1,S=new Array(y-1);_<y;_++)S[_-1]=arguments[_];m.fn.apply(m.context,S)}else{var E=m.length,w;for(_=0;_<E;_++)switch(m[_].once&&this.removeListener(l,m[_].fn,void 0,!0),y){case 1:m[_].fn.call(m[_].context);break;case 2:m[_].fn.call(m[_].context,c);break;case 3:m[_].fn.call(m[_].context,c,u);break;case 4:m[_].fn.call(m[_].context,c,u,d);break;default:if(!S)for(w=1,S=new Array(y-1);w<y;w++)S[w-1]=arguments[w];m[_].fn.apply(m[_].context,S)}}return!0},o.prototype.on=function(l,c,u){return n(this,l,c,u,!1)},o.prototype.once=function(l,c,u){return n(this,l,c,u,!0)},o.prototype.removeListener=function(l,c,u,d){var p=t?t+l:l;if(!this._events[p])return this;if(!c)return a(this,p),this;var f=this._events[p];if(f.fn)f.fn===c&&(!d||f.once)&&(!u||f.context===u)&&a(this,p);else{for(var g=0,m=[],y=f.length;g<y;g++)(f[g].fn!==c||d&&!f[g].once||u&&f[g].context!==u)&&m.push(f[g]);m.length?this._events[p]=m.length===1?m[0]:m:a(this,p)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&a(this,c)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,r.exports=o}(cr)),cr.exports}var Fc=Dc();const $i=Xh(Fc);var Ji={exports:{}},Ya;function Lc(){if(Ya)return Ji.exports;Ya=1,Ji.exports=r,Ji.exports.default=r;function r(b,T,x){x=x||2;var R=T&&T.length,A=R?T[0]*x:b.length,C=e(b,0,A,x,!0),D=[];if(!C||C.next===C.prev)return D;var I,H,z,Y,q,Q,se;if(R&&(C=h(b,T,C,x)),b.length>80*x){I=z=b[0],H=Y=b[1];for(var $=x;$<A;$+=x)q=b[$],Q=b[$+1],q<I&&(I=q),Q<H&&(H=Q),q>z&&(z=q),Q>Y&&(Y=Q);se=Math.max(z-I,Y-H),se=se!==0?32767/se:0}return i(C,D,x,I,H,se,0),D}function e(b,T,x,R,A){var C,D;if(A===J(b,T,x,R)>0)for(C=T;C<x;C+=R)D=M(C,b[C],b[C+1],D);else for(C=x-R;C>=T;C-=R)D=M(C,b[C],b[C+1],D);return D&&E(D,D.next)&&(O(D),D=D.next),D}function t(b,T){if(!b)return b;T||(T=b);var x=b,R;do if(R=!1,!x.steiner&&(E(x,x.next)||_(x.prev,x,x.next)===0)){if(O(x),x=T=x.prev,x===x.next)break;R=!0}else x=x.next;while(R||x!==T);return T}function i(b,T,x,R,A,C,D){if(b){!D&&C&&p(b,R,A,C);for(var I=b,H,z;b.prev!==b.next;){if(H=b.prev,z=b.next,C?n(b,R,A,C):s(b)){T.push(H.i/x|0),T.push(b.i/x|0),T.push(z.i/x|0),O(b),b=z.next,I=z.next;continue}if(b=z,b===I){D?D===1?(b=a(t(b),T,x),i(b,T,x,R,A,C,2)):D===2&&o(b,T,x,R,A,C):i(t(b),T,x,R,A,C,1);break}}}}function s(b){var T=b.prev,x=b,R=b.next;if(_(T,x,R)>=0)return!1;for(var A=T.x,C=x.x,D=R.x,I=T.y,H=x.y,z=R.y,Y=A<C?A<D?A:D:C<D?C:D,q=I<H?I<z?I:z:H<z?H:z,Q=A>C?A>D?A:D:C>D?C:D,se=I>H?I>z?I:z:H>z?H:z,$=R.next;$!==T;){if($.x>=Y&&$.x<=Q&&$.y>=q&&$.y<=se&&y(A,I,C,H,D,z,$.x,$.y)&&_($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function n(b,T,x,R){var A=b.prev,C=b,D=b.next;if(_(A,C,D)>=0)return!1;for(var I=A.x,H=C.x,z=D.x,Y=A.y,q=C.y,Q=D.y,se=I<H?I<z?I:z:H<z?H:z,$=Y<q?Y<Q?Y:Q:q<Q?q:Q,te=I>H?I>z?I:z:H>z?H:z,re=Y>q?Y>Q?Y:Q:q>Q?q:Q,ue=g(se,$,T,x,R),ge=g(te,re,T,x,R),ie=b.prevZ,ne=b.nextZ;ie&&ie.z>=ue&&ne&&ne.z<=ge;){if(ie.x>=se&&ie.x<=te&&ie.y>=$&&ie.y<=re&&ie!==A&&ie!==D&&y(I,Y,H,q,z,Q,ie.x,ie.y)&&_(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,ne.x>=se&&ne.x<=te&&ne.y>=$&&ne.y<=re&&ne!==A&&ne!==D&&y(I,Y,H,q,z,Q,ne.x,ne.y)&&_(ne.prev,ne,ne.next)>=0))return!1;ne=ne.nextZ}for(;ie&&ie.z>=ue;){if(ie.x>=se&&ie.x<=te&&ie.y>=$&&ie.y<=re&&ie!==A&&ie!==D&&y(I,Y,H,q,z,Q,ie.x,ie.y)&&_(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;ne&&ne.z<=ge;){if(ne.x>=se&&ne.x<=te&&ne.y>=$&&ne.y<=re&&ne!==A&&ne!==D&&y(I,Y,H,q,z,Q,ne.x,ne.y)&&_(ne.prev,ne,ne.next)>=0)return!1;ne=ne.nextZ}return!0}function a(b,T,x){var R=b;do{var A=R.prev,C=R.next.next;!E(A,C)&&w(A,R,R.next,C)&&U(A,C)&&U(C,A)&&(T.push(A.i/x|0),T.push(R.i/x|0),T.push(C.i/x|0),O(R),O(R.next),R=b=C),R=R.next}while(R!==b);return t(R)}function o(b,T,x,R,A,C){var D=b;do{for(var I=D.next.next;I!==D.prev;){if(D.i!==I.i&&S(D,I)){var H=N(D,I);D=t(D,D.next),H=t(H,H.next),i(D,T,x,R,A,C,0),i(H,T,x,R,A,C,0);return}I=I.next}D=D.next}while(D!==b)}function h(b,T,x,R){var A=[],C,D,I,H,z;for(C=0,D=T.length;C<D;C++)I=T[C]*R,H=C<D-1?T[C+1]*R:b.length,z=e(b,I,H,R,!1),z===z.next&&(z.steiner=!0),A.push(m(z));for(A.sort(l),C=0;C<A.length;C++)x=c(A[C],x);return x}function l(b,T){return b.x-T.x}function c(b,T){var x=u(b,T);if(!x)return T;var R=N(x,b);return t(R,R.next),t(x,x.next)}function u(b,T){var x=T,R=b.x,A=b.y,C=-1/0,D;do{if(A<=x.y&&A>=x.next.y&&x.next.y!==x.y){var I=x.x+(A-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(I<=R&&I>C&&(C=I,D=x.x<x.next.x?x:x.next,I===R))return D}x=x.next}while(x!==T);if(!D)return null;var H=D,z=D.x,Y=D.y,q=1/0,Q;x=D;do R>=x.x&&x.x>=z&&R!==x.x&&y(A<Y?R:C,A,z,Y,A<Y?C:R,A,x.x,x.y)&&(Q=Math.abs(A-x.y)/(R-x.x),U(x,b)&&(Q<q||Q===q&&(x.x>D.x||x.x===D.x&&d(D,x)))&&(D=x,q=Q)),x=x.next;while(x!==H);return D}function d(b,T){return _(b.prev,b,T.prev)<0&&_(T.next,b,b.next)<0}function p(b,T,x,R){var A=b;do A.z===0&&(A.z=g(A.x,A.y,T,x,R)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==b);A.prevZ.nextZ=null,A.prevZ=null,f(A)}function f(b){var T,x,R,A,C,D,I,H,z=1;do{for(x=b,b=null,C=null,D=0;x;){for(D++,R=x,I=0,T=0;T<z&&(I++,R=R.nextZ,!!R);T++);for(H=z;I>0||H>0&&R;)I!==0&&(H===0||!R||x.z<=R.z)?(A=x,x=x.nextZ,I--):(A=R,R=R.nextZ,H--),C?C.nextZ=A:b=A,A.prevZ=C,C=A;x=R}C.nextZ=null,z*=2}while(D>1);return b}function g(b,T,x,R,A){return b=(b-x)*A|0,T=(T-R)*A|0,b=(b|b<<8)&16711935,b=(b|b<<4)&252645135,b=(b|b<<2)&858993459,b=(b|b<<1)&1431655765,T=(T|T<<8)&16711935,T=(T|T<<4)&252645135,T=(T|T<<2)&858993459,T=(T|T<<1)&1431655765,b|T<<1}function m(b){var T=b,x=b;do(T.x<x.x||T.x===x.x&&T.y<x.y)&&(x=T),T=T.next;while(T!==b);return x}function y(b,T,x,R,A,C,D,I){return(A-D)*(T-I)>=(b-D)*(C-I)&&(b-D)*(R-I)>=(x-D)*(T-I)&&(x-D)*(C-I)>=(A-D)*(R-I)}function S(b,T){return b.next.i!==T.i&&b.prev.i!==T.i&&!F(b,T)&&(U(b,T)&&U(T,b)&&G(b,T)&&(_(b.prev,b,T.prev)||_(b,T.prev,T))||E(b,T)&&_(b.prev,b,b.next)>0&&_(T.prev,T,T.next)>0)}function _(b,T,x){return(T.y-b.y)*(x.x-T.x)-(T.x-b.x)*(x.y-T.y)}function E(b,T){return b.x===T.x&&b.y===T.y}function w(b,T,x,R){var A=v(_(b,T,x)),C=v(_(b,T,R)),D=v(_(x,R,b)),I=v(_(x,R,T));return!!(A!==C&&D!==I||A===0&&B(b,x,T)||C===0&&B(b,R,T)||D===0&&B(x,b,R)||I===0&&B(x,T,R))}function B(b,T,x){return T.x<=Math.max(b.x,x.x)&&T.x>=Math.min(b.x,x.x)&&T.y<=Math.max(b.y,x.y)&&T.y>=Math.min(b.y,x.y)}function v(b){return b>0?1:b<0?-1:0}function F(b,T){var x=b;do{if(x.i!==b.i&&x.next.i!==b.i&&x.i!==T.i&&x.next.i!==T.i&&w(x,x.next,b,T))return!0;x=x.next}while(x!==b);return!1}function U(b,T){return _(b.prev,b,b.next)<0?_(b,T,b.next)>=0&&_(b,b.prev,T)>=0:_(b,T,b.prev)<0||_(b,b.next,T)<0}function G(b,T){var x=b,R=!1,A=(b.x+T.x)/2,C=(b.y+T.y)/2;do x.y>C!=x.next.y>C&&x.next.y!==x.y&&A<(x.next.x-x.x)*(C-x.y)/(x.next.y-x.y)+x.x&&(R=!R),x=x.next;while(x!==b);return R}function N(b,T){var x=new k(b.i,b.x,b.y),R=new k(T.i,T.x,T.y),A=b.next,C=T.prev;return b.next=T,T.prev=b,x.next=A,A.prev=x,R.next=x,x.prev=R,C.next=R,R.prev=C,R}function M(b,T,x,R){var A=new k(b,T,x);return R?(A.next=R.next,A.prev=R,R.next.prev=A,R.next=A):(A.prev=A,A.next=A),A}function O(b){b.next.prev=b.prev,b.prev.next=b.next,b.prevZ&&(b.prevZ.nextZ=b.nextZ),b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function k(b,T,x){this.i=b,this.x=T,this.y=x,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}r.deviation=function(b,T,x,R){var A=T&&T.length,C=A?T[0]*x:b.length,D=Math.abs(J(b,0,C,x));if(A)for(var I=0,H=T.length;I<H;I++){var z=T[I]*x,Y=I<H-1?T[I+1]*x:b.length;D-=Math.abs(J(b,z,Y,x))}var q=0;for(I=0;I<R.length;I+=3){var Q=R[I]*x,se=R[I+1]*x,$=R[I+2]*x;q+=Math.abs((b[Q]-b[$])*(b[se+1]-b[Q+1])-(b[Q]-b[se])*(b[$+1]-b[Q+1]))}return D===0&&q===0?0:Math.abs((q-D)/D)};function J(b,T,x,R){for(var A=0,C=T,D=x-R;C<x;C+=R)A+=(b[D]-b[C])*(b[C+1]+b[D+1]),D=C;return A}return r.flatten=function(b){for(var T=b[0][0].length,x={vertices:[],holes:[],dimensions:T},R=0,A=0;A<b.length;A++){for(var C=0;C<b[A].length;C++)for(var D=0;D<T;D++)x.vertices.push(b[A][C][D]);A>0&&(R+=b[A-1].length,x.holes.push(R))}return x},Ji.exports}var Oc=Lc();const kc=Xh(Oc);var kt={},Bi={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var Nc=Bi.exports,qa;function Uc(){return qa||(qa=1,function(r,e){(function(t){var i=e&&!e.nodeType&&e,s=r&&!r.nodeType&&r,n=typeof Cs=="object"&&Cs;(n.global===n||n.window===n||n.self===n)&&(t=n);var a,o=2147483647,h=36,l=1,c=26,u=38,d=700,p=72,f=128,g="-",m=/^xn--/,y=/[^\x20-\x7E]/,S=/[\x2E\u3002\uFF0E\uFF61]/g,_={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},E=h-l,w=Math.floor,B=String.fromCharCode,v;function F(A){throw new RangeError(_[A])}function U(A,C){for(var D=A.length,I=[];D--;)I[D]=C(A[D]);return I}function G(A,C){var D=A.split("@"),I="";D.length>1&&(I=D[0]+"@",A=D[1]),A=A.replace(S,".");var H=A.split("."),z=U(H,C).join(".");return I+z}function N(A){for(var C=[],D=0,I=A.length,H,z;D<I;)H=A.charCodeAt(D++),H>=55296&&H<=56319&&D<I?(z=A.charCodeAt(D++),(z&64512)==56320?C.push(((H&1023)<<10)+(z&1023)+65536):(C.push(H),D--)):C.push(H);return C}function M(A){return U(A,function(C){var D="";return C>65535&&(C-=65536,D+=B(C>>>10&1023|55296),C=56320|C&1023),D+=B(C),D}).join("")}function O(A){return A-48<10?A-22:A-65<26?A-65:A-97<26?A-97:h}function k(A,C){return A+22+75*(A<26)-((C!=0)<<5)}function J(A,C,D){var I=0;for(A=D?w(A/d):A>>1,A+=w(A/C);A>E*c>>1;I+=h)A=w(A/E);return w(I+(E+1)*A/(A+u))}function b(A){var C=[],D=A.length,I,H=0,z=f,Y=p,q,Q,se,$,te,re,ue,ge,ie;for(q=A.lastIndexOf(g),q<0&&(q=0),Q=0;Q<q;++Q)A.charCodeAt(Q)>=128&&F("not-basic"),C.push(A.charCodeAt(Q));for(se=q>0?q+1:0;se<D;){for($=H,te=1,re=h;se>=D&&F("invalid-input"),ue=O(A.charCodeAt(se++)),(ue>=h||ue>w((o-H)/te))&&F("overflow"),H+=ue*te,ge=re<=Y?l:re>=Y+c?c:re-Y,!(ue<ge);re+=h)ie=h-ge,te>w(o/ie)&&F("overflow"),te*=ie;I=C.length+1,Y=J(H-$,I,$==0),w(H/I)>o-z&&F("overflow"),z+=w(H/I),H%=I,C.splice(H++,0,z)}return M(C)}function T(A){var C,D,I,H,z,Y,q,Q,se,$,te,re=[],ue,ge,ie,ne;for(A=N(A),ue=A.length,C=f,D=0,z=p,Y=0;Y<ue;++Y)te=A[Y],te<128&&re.push(B(te));for(I=H=re.length,H&&re.push(g);I<ue;){for(q=o,Y=0;Y<ue;++Y)te=A[Y],te>=C&&te<q&&(q=te);for(ge=I+1,q-C>w((o-D)/ge)&&F("overflow"),D+=(q-C)*ge,C=q,Y=0;Y<ue;++Y)if(te=A[Y],te<C&&++D>o&&F("overflow"),te==C){for(Q=D,se=h;$=se<=z?l:se>=z+c?c:se-z,!(Q<$);se+=h)ne=Q-$,ie=h-$,re.push(B(k($+ne%ie,0))),Q=w(ne/ie);re.push(B(k(Q,0))),z=J(D,ge,I==H),D=0,++I}++D,++C}return re.join("")}function x(A){return G(A,function(C){return m.test(C)?b(C.slice(4).toLowerCase()):C})}function R(A){return G(A,function(C){return y.test(C)?"xn--"+T(C):C})}if(a={version:"1.4.1",ucs2:{decode:N,encode:M},decode:b,encode:T,toASCII:R,toUnicode:x},i&&s)if(r.exports==i)s.exports=a;else for(v in a)a.hasOwnProperty(v)&&(i[v]=a[v]);else t.punycode=a})(Nc)}(Bi,Bi.exports)),Bi.exports}var ur,Ka;function wi(){return Ka||(Ka=1,ur=TypeError),ur}const Gc={},Hc=Object.freeze(Object.defineProperty({__proto__:null,default:Gc},Symbol.toStringTag,{value:"Module"})),Wc=Bc(Hc);var dr,Ja;function Ws(){if(Ja)return dr;Ja=1;var r=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&r?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=r&&e&&typeof e.get=="function"?e.get:null,i=r&&Map.prototype.forEach,s=typeof Set=="function"&&Set.prototype,n=Object.getOwnPropertyDescriptor&&s?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,a=s&&n&&typeof n.get=="function"?n.get:null,o=s&&Set.prototype.forEach,h=typeof WeakMap=="function"&&WeakMap.prototype,l=h?WeakMap.prototype.has:null,c=typeof WeakSet=="function"&&WeakSet.prototype,u=c?WeakSet.prototype.has:null,d=typeof WeakRef=="function"&&WeakRef.prototype,p=d?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,g=Object.prototype.toString,m=Function.prototype.toString,y=String.prototype.match,S=String.prototype.slice,_=String.prototype.replace,E=String.prototype.toUpperCase,w=String.prototype.toLowerCase,B=RegExp.prototype.test,v=Array.prototype.concat,F=Array.prototype.join,U=Array.prototype.slice,G=Math.floor,N=typeof BigInt=="function"?BigInt.prototype.valueOf:null,M=Object.getOwnPropertySymbols,O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,k=typeof Symbol=="function"&&typeof Symbol.iterator=="object",J=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===k||!0)?Symbol.toStringTag:null,b=Object.prototype.propertyIsEnumerable,T=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(P){return P.__proto__}:null);function x(P,L){if(P===1/0||P===-1/0||P!==P||P&&P>-1e3&&P<1e3||B.call(/e/,L))return L;var xe=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof P=="number"){var be=P<0?-G(-P):G(P);if(be!==P){var we=String(be),pe=S.call(L,we.length+1);return _.call(we,xe,"$&_")+"."+_.call(_.call(pe,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _.call(L,xe,"$&_")}var R=Wc,A=R.custom,C=ge(A)?A:null,D={__proto__:null,double:'"',single:"'"},I={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};dr=function P(L,xe,be,we){var pe=xe||{};if(Ae(pe,"quoteStyle")&&!Ae(D,pe.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Ae(pe,"maxStringLength")&&(typeof pe.maxStringLength=="number"?pe.maxStringLength<0&&pe.maxStringLength!==1/0:pe.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Et=Ae(pe,"customInspect")?pe.customInspect:!0;if(typeof Et!="boolean"&&Et!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Ae(pe,"indent")&&pe.indent!==null&&pe.indent!=="	"&&!(parseInt(pe.indent,10)===pe.indent&&pe.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Ae(pe,"numericSeparator")&&typeof pe.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var Ot=pe.numericSeparator;if(typeof L>"u")return"undefined";if(L===null)return"null";if(typeof L=="boolean")return L?"true":"false";if(typeof L=="string")return Ea(L,pe);if(typeof L=="number"){if(L===0)return 1/0/L>0?"0":"-0";var Ge=String(L);return Ot?x(L,Ge):Ge}if(typeof L=="bigint"){var At=String(L)+"n";return Ot?x(L,At):At}var tr=typeof pe.depth>"u"?5:pe.depth;if(typeof be>"u"&&(be=0),be>=tr&&tr>0&&typeof L=="object")return q(L)?"[Array]":"[Object]";var ni=Ec(pe,be);if(typeof we>"u")we=[];else if(St(we,L)>=0)return"[Circular]";function Ye(ai,qi,Cc){if(qi&&(we=U.call(we),we.push(qi)),Cc){var Fa={depth:pe.depth};return Ae(pe,"quoteStyle")&&(Fa.quoteStyle=pe.quoteStyle),P(ai,Fa,be+1,we)}return P(ai,pe,be+1,we)}if(typeof L=="function"&&!se(L)){var Ca=ti(L),Ma=ji(L,Ye);return"[Function"+(Ca?": "+Ca:" (anonymous)")+"]"+(Ma.length>0?" { "+F.call(Ma,", ")+" }":"")}if(ge(L)){var Ra=k?_.call(String(L),/^(Symbol\(.*\))_[^)]*$/,"$1"):O.call(L);return typeof L=="object"&&!k?Si(Ra):Ra}if(wc(L)){for(var Ei="<"+w.call(String(L.nodeName)),ir=L.attributes||[],Yi=0;Yi<ir.length;Yi++)Ei+=" "+ir[Yi].name+"="+H(z(ir[Yi].value),"double",pe);return Ei+=">",L.childNodes&&L.childNodes.length&&(Ei+="..."),Ei+="</"+w.call(String(L.nodeName))+">",Ei}if(q(L)){if(L.length===0)return"[]";var sr=ji(L,Ye);return ni&&!Sc(sr)?"["+er(sr,ni)+"]":"[ "+F.call(sr,", ")+" ]"}if($(L)){var rr=ji(L,Ye);return!("cause"in Error.prototype)&&"cause"in L&&!b.call(L,"cause")?"{ ["+String(L)+"] "+F.call(v.call("[cause]: "+Ye(L.cause),rr),", ")+" }":rr.length===0?"["+String(L)+"]":"{ ["+String(L)+"] "+F.call(rr,", ")+" }"}if(typeof L=="object"&&Et){if(C&&typeof L[C]=="function"&&R)return R(L,{depth:tr-be});if(Et!=="symbol"&&typeof L.inspect=="function")return L.inspect()}if(je(L)){var Pa=[];return i&&i.call(L,function(ai,qi){Pa.push(Ye(qi,L,!0)+" => "+Ye(ai,L))}),Aa("Map",t.call(L),Pa,ni)}if(ri(L)){var Ia=[];return o&&o.call(L,function(ai){Ia.push(Ye(ai,L))}),Aa("Set",a.call(L),Ia,ni)}if(ii(L))return Qs("WeakMap");if(bc(L))return Qs("WeakSet");if(si(L))return Qs("WeakRef");if(re(L))return Si(Ye(Number(L)));if(ie(L))return Si(Ye(N.call(L)));if(ue(L))return Si(f.call(L));if(te(L))return Si(Ye(String(L)));if(typeof window<"u"&&L===window)return"{ [object Window] }";if(typeof globalThis<"u"&&L===globalThis||typeof Cs<"u"&&L===Cs)return"{ [object globalThis] }";if(!Q(L)&&!se(L)){var nr=ji(L,Ye),Ba=T?T(L)===Object.prototype:L instanceof Object||L.constructor===Object,ar=L instanceof Object?"":"null prototype",Da=!Ba&&J&&Object(L)===L&&J in L?S.call(Re(L),8,-1):ar?"Object":"",Ac=Ba||typeof L.constructor!="function"?"":L.constructor.name?L.constructor.name+" ":"",or=Ac+(Da||ar?"["+F.call(v.call([],Da||[],ar||[]),": ")+"] ":"");return nr.length===0?or+"{}":ni?or+"{"+er(nr,ni)+"}":or+"{ "+F.call(nr,", ")+" }"}return String(L)};function H(P,L,xe){var be=xe.quoteStyle||L,we=D[be];return we+P+we}function z(P){return _.call(String(P),/"/g,"&quot;")}function Y(P){return!J||!(typeof P=="object"&&(J in P||typeof P[J]<"u"))}function q(P){return Re(P)==="[object Array]"&&Y(P)}function Q(P){return Re(P)==="[object Date]"&&Y(P)}function se(P){return Re(P)==="[object RegExp]"&&Y(P)}function $(P){return Re(P)==="[object Error]"&&Y(P)}function te(P){return Re(P)==="[object String]"&&Y(P)}function re(P){return Re(P)==="[object Number]"&&Y(P)}function ue(P){return Re(P)==="[object Boolean]"&&Y(P)}function ge(P){if(k)return P&&typeof P=="object"&&P instanceof Symbol;if(typeof P=="symbol")return!0;if(!P||typeof P!="object"||!O)return!1;try{return O.call(P),!0}catch{}return!1}function ie(P){if(!P||typeof P!="object"||!N)return!1;try{return N.call(P),!0}catch{}return!1}var ne=Object.prototype.hasOwnProperty||function(P){return P in this};function Ae(P,L){return ne.call(P,L)}function Re(P){return g.call(P)}function ti(P){if(P.name)return P.name;var L=y.call(m.call(P),/^function\s*([\w$]+)/);return L?L[1]:null}function St(P,L){if(P.indexOf)return P.indexOf(L);for(var xe=0,be=P.length;xe<be;xe++)if(P[xe]===L)return xe;return-1}function je(P){if(!t||!P||typeof P!="object")return!1;try{t.call(P);try{a.call(P)}catch{return!0}return P instanceof Map}catch{}return!1}function ii(P){if(!l||!P||typeof P!="object")return!1;try{l.call(P,l);try{u.call(P,u)}catch{return!0}return P instanceof WeakMap}catch{}return!1}function si(P){if(!p||!P||typeof P!="object")return!1;try{return p.call(P),!0}catch{}return!1}function ri(P){if(!a||!P||typeof P!="object")return!1;try{a.call(P);try{t.call(P)}catch{return!0}return P instanceof Set}catch{}return!1}function bc(P){if(!u||!P||typeof P!="object")return!1;try{u.call(P,u);try{l.call(P,l)}catch{return!0}return P instanceof WeakSet}catch{}return!1}function wc(P){return!P||typeof P!="object"?!1:typeof HTMLElement<"u"&&P instanceof HTMLElement?!0:typeof P.nodeName=="string"&&typeof P.getAttribute=="function"}function Ea(P,L){if(P.length>L.maxStringLength){var xe=P.length-L.maxStringLength,be="... "+xe+" more character"+(xe>1?"s":"");return Ea(S.call(P,0,L.maxStringLength),L)+be}var we=I[L.quoteStyle||"single"];we.lastIndex=0;var pe=_.call(_.call(P,we,"\\$1"),/[\x00-\x1f]/g,Tc);return H(pe,"single",L)}function Tc(P){var L=P.charCodeAt(0),xe={8:"b",9:"t",10:"n",12:"f",13:"r"}[L];return xe?"\\"+xe:"\\x"+(L<16?"0":"")+E.call(L.toString(16))}function Si(P){return"Object("+P+")"}function Qs(P){return P+" { ? }"}function Aa(P,L,xe,be){var we=be?er(xe,be):F.call(xe,", ");return P+" ("+L+") {"+we+"}"}function Sc(P){for(var L=0;L<P.length;L++)if(St(P[L],`
`)>=0)return!1;return!0}function Ec(P,L){var xe;if(P.indent==="	")xe="	";else if(typeof P.indent=="number"&&P.indent>0)xe=F.call(Array(P.indent+1)," ");else return null;return{base:xe,prev:F.call(Array(L+1),xe)}}function er(P,L){if(P.length===0)return"";var xe=`
`+L.prev+L.base;return xe+F.call(P,","+xe)+`
`+L.prev}function ji(P,L){var xe=q(P),be=[];if(xe){be.length=P.length;for(var we=0;we<P.length;we++)be[we]=Ae(P,we)?L(P[we],P):""}var pe=typeof M=="function"?M(P):[],Et;if(k){Et={};for(var Ot=0;Ot<pe.length;Ot++)Et["$"+pe[Ot]]=pe[Ot]}for(var Ge in P)Ae(P,Ge)&&(xe&&String(Number(Ge))===Ge&&Ge<P.length||k&&Et["$"+Ge]instanceof Symbol||(B.call(/[^\w$]/,Ge)?be.push(L(Ge,P)+": "+L(P[Ge],P)):be.push(Ge+": "+L(P[Ge],P))));if(typeof M=="function")for(var At=0;At<pe.length;At++)b.call(P,pe[At])&&be.push("["+L(pe[At])+"]: "+L(P[pe[At]],P));return be}return dr}var pr,Za;function zc(){if(Za)return pr;Za=1;var r=Ws(),e=wi(),t=function(o,h,l){for(var c=o,u;(u=c.next)!=null;c=u)if(u.key===h)return c.next=u.next,l||(u.next=o.next,o.next=u),u},i=function(o,h){if(o){var l=t(o,h);return l&&l.value}},s=function(o,h,l){var c=t(o,h);c?c.value=l:o.next={key:h,next:o.next,value:l}},n=function(o,h){return o?!!t(o,h):!1},a=function(o,h){if(o)return t(o,h,!0)};return pr=function(){var h,l={assert:function(c){if(!l.has(c))throw new e("Side channel does not contain "+r(c))},delete:function(c){var u=h&&h.next,d=a(h,c);return d&&u&&u===d&&(h=void 0),!!d},get:function(c){return i(h,c)},has:function(c){return n(h,c)},set:function(c,u){h||(h={next:void 0}),s(h,c,u)}};return l},pr}var fr,Qa;function jh(){return Qa||(Qa=1,fr=Object),fr}var mr,eo;function $c(){return eo||(eo=1,mr=Error),mr}var gr,to;function Vc(){return to||(to=1,gr=EvalError),gr}var yr,io;function Xc(){return io||(io=1,yr=RangeError),yr}var vr,so;function jc(){return so||(so=1,vr=ReferenceError),vr}var xr,ro;function Yc(){return ro||(ro=1,xr=SyntaxError),xr}var _r,no;function qc(){return no||(no=1,_r=URIError),_r}var br,ao;function Kc(){return ao||(ao=1,br=Math.abs),br}var wr,oo;function Jc(){return oo||(oo=1,wr=Math.floor),wr}var Tr,ho;function Zc(){return ho||(ho=1,Tr=Math.max),Tr}var Sr,lo;function Qc(){return lo||(lo=1,Sr=Math.min),Sr}var Er,co;function eu(){return co||(co=1,Er=Math.pow),Er}var Ar,uo;function tu(){return uo||(uo=1,Ar=Math.round),Ar}var Cr,po;function iu(){return po||(po=1,Cr=Number.isNaN||function(e){return e!==e}),Cr}var Mr,fo;function su(){if(fo)return Mr;fo=1;var r=iu();return Mr=function(t){return r(t)||t===0?t:t<0?-1:1},Mr}var Rr,mo;function ru(){return mo||(mo=1,Rr=Object.getOwnPropertyDescriptor),Rr}var Pr,go;function Yh(){if(go)return Pr;go=1;var r=ru();if(r)try{r([],"length")}catch{r=null}return Pr=r,Pr}var Ir,yo;function nu(){if(yo)return Ir;yo=1;var r=Object.defineProperty||!1;if(r)try{r({},"a",{value:1})}catch{r=!1}return Ir=r,Ir}var Br,vo;function au(){return vo||(vo=1,Br=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var s=42;e[t]=s;for(var n in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var a=Object.getOwnPropertySymbols(e);if(a.length!==1||a[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==s||o.enumerable!==!0)return!1}return!0}),Br}var Dr,xo;function ou(){if(xo)return Dr;xo=1;var r=typeof Symbol<"u"&&Symbol,e=au();return Dr=function(){return typeof r!="function"||typeof Symbol!="function"||typeof r("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Dr}var Fr,_o;function qh(){return _o||(_o=1,Fr=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Fr}var Lr,bo;function Kh(){if(bo)return Lr;bo=1;var r=jh();return Lr=r.getPrototypeOf||null,Lr}var Or,wo;function hu(){if(wo)return Or;wo=1;var r="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,i="[object Function]",s=function(h,l){for(var c=[],u=0;u<h.length;u+=1)c[u]=h[u];for(var d=0;d<l.length;d+=1)c[d+h.length]=l[d];return c},n=function(h,l){for(var c=[],u=l,d=0;u<h.length;u+=1,d+=1)c[d]=h[u];return c},a=function(o,h){for(var l="",c=0;c<o.length;c+=1)l+=o[c],c+1<o.length&&(l+=h);return l};return Or=function(h){var l=this;if(typeof l!="function"||e.apply(l)!==i)throw new TypeError(r+l);for(var c=n(arguments,1),u,d=function(){if(this instanceof u){var y=l.apply(this,s(c,arguments));return Object(y)===y?y:this}return l.apply(h,s(c,arguments))},p=t(0,l.length-c.length),f=[],g=0;g<p;g++)f[g]="$"+g;if(u=Function("binder","return function ("+a(f,",")+"){ return binder.apply(this,arguments); }")(d),l.prototype){var m=function(){};m.prototype=l.prototype,u.prototype=new m,m.prototype=null}return u},Or}var kr,To;function zs(){if(To)return kr;To=1;var r=hu();return kr=Function.prototype.bind||r,kr}var Nr,So;function ma(){return So||(So=1,Nr=Function.prototype.call),Nr}var Ur,Eo;function Jh(){return Eo||(Eo=1,Ur=Function.prototype.apply),Ur}var Gr,Ao;function lu(){return Ao||(Ao=1,Gr=typeof Reflect<"u"&&Reflect&&Reflect.apply),Gr}var Hr,Co;function cu(){if(Co)return Hr;Co=1;var r=zs(),e=Jh(),t=ma(),i=lu();return Hr=i||r.call(t,e),Hr}var Wr,Mo;function Zh(){if(Mo)return Wr;Mo=1;var r=zs(),e=wi(),t=ma(),i=cu();return Wr=function(n){if(n.length<1||typeof n[0]!="function")throw new e("a function is required");return i(r,t,n)},Wr}var zr,Ro;function uu(){if(Ro)return zr;Ro=1;var r=Zh(),e=Yh(),t;try{t=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var i=!!t&&e&&e(Object.prototype,"__proto__"),s=Object,n=s.getPrototypeOf;return zr=i&&typeof i.get=="function"?r([i.get]):typeof n=="function"?function(o){return n(o==null?o:s(o))}:!1,zr}var $r,Po;function du(){if(Po)return $r;Po=1;var r=qh(),e=Kh(),t=uu();return $r=r?function(s){return r(s)}:e?function(s){if(!s||typeof s!="object"&&typeof s!="function")throw new TypeError("getProto: not an object");return e(s)}:t?function(s){return t(s)}:null,$r}var Vr,Io;function pu(){if(Io)return Vr;Io=1;var r=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=zs();return Vr=t.call(r,e),Vr}var Xr,Bo;function ga(){if(Bo)return Xr;Bo=1;var r,e=jh(),t=$c(),i=Vc(),s=Xc(),n=jc(),a=Yc(),o=wi(),h=qc(),l=Kc(),c=Jc(),u=Zc(),d=Qc(),p=eu(),f=tu(),g=su(),m=Function,y=function(se){try{return m('"use strict"; return ('+se+").constructor;")()}catch{}},S=Yh(),_=nu(),E=function(){throw new o},w=S?function(){try{return arguments.callee,E}catch{try{return S(arguments,"callee").get}catch{return E}}}():E,B=ou()(),v=du(),F=Kh(),U=qh(),G=Jh(),N=ma(),M={},O=typeof Uint8Array>"u"||!v?r:v(Uint8Array),k={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?r:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?r:ArrayBuffer,"%ArrayIteratorPrototype%":B&&v?v([][Symbol.iterator]()):r,"%AsyncFromSyncIteratorPrototype%":r,"%AsyncFunction%":M,"%AsyncGenerator%":M,"%AsyncGeneratorFunction%":M,"%AsyncIteratorPrototype%":M,"%Atomics%":typeof Atomics>"u"?r:Atomics,"%BigInt%":typeof BigInt>"u"?r:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?r:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?r:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?r:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":i,"%Float16Array%":typeof Float16Array>"u"?r:Float16Array,"%Float32Array%":typeof Float32Array>"u"?r:Float32Array,"%Float64Array%":typeof Float64Array>"u"?r:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?r:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":M,"%Int8Array%":typeof Int8Array>"u"?r:Int8Array,"%Int16Array%":typeof Int16Array>"u"?r:Int16Array,"%Int32Array%":typeof Int32Array>"u"?r:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":B&&v?v(v([][Symbol.iterator]())):r,"%JSON%":typeof JSON=="object"?JSON:r,"%Map%":typeof Map>"u"?r:Map,"%MapIteratorPrototype%":typeof Map>"u"||!B||!v?r:v(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":S,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?r:Promise,"%Proxy%":typeof Proxy>"u"?r:Proxy,"%RangeError%":s,"%ReferenceError%":n,"%Reflect%":typeof Reflect>"u"?r:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?r:Set,"%SetIteratorPrototype%":typeof Set>"u"||!B||!v?r:v(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?r:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":B&&v?v(""[Symbol.iterator]()):r,"%Symbol%":B?Symbol:r,"%SyntaxError%":a,"%ThrowTypeError%":w,"%TypedArray%":O,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?r:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?r:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?r:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?r:Uint32Array,"%URIError%":h,"%WeakMap%":typeof WeakMap>"u"?r:WeakMap,"%WeakRef%":typeof WeakRef>"u"?r:WeakRef,"%WeakSet%":typeof WeakSet>"u"?r:WeakSet,"%Function.prototype.call%":N,"%Function.prototype.apply%":G,"%Object.defineProperty%":_,"%Object.getPrototypeOf%":F,"%Math.abs%":l,"%Math.floor%":c,"%Math.max%":u,"%Math.min%":d,"%Math.pow%":p,"%Math.round%":f,"%Math.sign%":g,"%Reflect.getPrototypeOf%":U};if(v)try{null.error}catch(se){var J=v(v(se));k["%Error.prototype%"]=J}var b=function se($){var te;if($==="%AsyncFunction%")te=y("async function () {}");else if($==="%GeneratorFunction%")te=y("function* () {}");else if($==="%AsyncGeneratorFunction%")te=y("async function* () {}");else if($==="%AsyncGenerator%"){var re=se("%AsyncGeneratorFunction%");re&&(te=re.prototype)}else if($==="%AsyncIteratorPrototype%"){var ue=se("%AsyncGenerator%");ue&&v&&(te=v(ue.prototype))}return k[$]=te,te},T={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},x=zs(),R=pu(),A=x.call(N,Array.prototype.concat),C=x.call(G,Array.prototype.splice),D=x.call(N,String.prototype.replace),I=x.call(N,String.prototype.slice),H=x.call(N,RegExp.prototype.exec),z=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Y=/\\(\\)?/g,q=function($){var te=I($,0,1),re=I($,-1);if(te==="%"&&re!=="%")throw new a("invalid intrinsic syntax, expected closing `%`");if(re==="%"&&te!=="%")throw new a("invalid intrinsic syntax, expected opening `%`");var ue=[];return D($,z,function(ge,ie,ne,Ae){ue[ue.length]=ne?D(Ae,Y,"$1"):ie||ge}),ue},Q=function($,te){var re=$,ue;if(R(T,re)&&(ue=T[re],re="%"+ue[0]+"%"),R(k,re)){var ge=k[re];if(ge===M&&(ge=b(re)),typeof ge>"u"&&!te)throw new o("intrinsic "+$+" exists, but is not available. Please file an issue!");return{alias:ue,name:re,value:ge}}throw new a("intrinsic "+$+" does not exist!")};return Xr=function($,te){if(typeof $!="string"||$.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof te!="boolean")throw new o('"allowMissing" argument must be a boolean');if(H(/^%?[^%]*%?$/,$)===null)throw new a("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var re=q($),ue=re.length>0?re[0]:"",ge=Q("%"+ue+"%",te),ie=ge.name,ne=ge.value,Ae=!1,Re=ge.alias;Re&&(ue=Re[0],C(re,A([0,1],Re)));for(var ti=1,St=!0;ti<re.length;ti+=1){var je=re[ti],ii=I(je,0,1),si=I(je,-1);if((ii==='"'||ii==="'"||ii==="`"||si==='"'||si==="'"||si==="`")&&ii!==si)throw new a("property names with quotes must have matching quotes");if((je==="constructor"||!St)&&(Ae=!0),ue+="."+je,ie="%"+ue+"%",R(k,ie))ne=k[ie];else if(ne!=null){if(!(je in ne)){if(!te)throw new o("base intrinsic for "+$+" exists, but the property is not available.");return}if(S&&ti+1>=re.length){var ri=S(ne,je);St=!!ri,St&&"get"in ri&&!("originalValue"in ri.get)?ne=ri.get:ne=ne[je]}else St=R(ne,je),ne=ne[je];St&&!Ae&&(k[ie]=ne)}}return ne},Xr}var jr,Do;function Qh(){if(Do)return jr;Do=1;var r=ga(),e=Zh(),t=e([r("%String.prototype.indexOf%")]);return jr=function(s,n){var a=r(s,!!n);return typeof a=="function"&&t(s,".prototype.")>-1?e([a]):a},jr}var Yr,Fo;function el(){if(Fo)return Yr;Fo=1;var r=ga(),e=Qh(),t=Ws(),i=wi(),s=r("%Map%",!0),n=e("Map.prototype.get",!0),a=e("Map.prototype.set",!0),o=e("Map.prototype.has",!0),h=e("Map.prototype.delete",!0),l=e("Map.prototype.size",!0);return Yr=!!s&&function(){var u,d={assert:function(p){if(!d.has(p))throw new i("Side channel does not contain "+t(p))},delete:function(p){if(u){var f=h(u,p);return l(u)===0&&(u=void 0),f}return!1},get:function(p){if(u)return n(u,p)},has:function(p){return u?o(u,p):!1},set:function(p,f){u||(u=new s),a(u,p,f)}};return d},Yr}var qr,Lo;function fu(){if(Lo)return qr;Lo=1;var r=ga(),e=Qh(),t=Ws(),i=el(),s=wi(),n=r("%WeakMap%",!0),a=e("WeakMap.prototype.get",!0),o=e("WeakMap.prototype.set",!0),h=e("WeakMap.prototype.has",!0),l=e("WeakMap.prototype.delete",!0);return qr=n?function(){var u,d,p={assert:function(f){if(!p.has(f))throw new s("Side channel does not contain "+t(f))},delete:function(f){if(n&&f&&(typeof f=="object"||typeof f=="function")){if(u)return l(u,f)}else if(i&&d)return d.delete(f);return!1},get:function(f){return n&&f&&(typeof f=="object"||typeof f=="function")&&u?a(u,f):d&&d.get(f)},has:function(f){return n&&f&&(typeof f=="object"||typeof f=="function")&&u?h(u,f):!!d&&d.has(f)},set:function(f,g){n&&f&&(typeof f=="object"||typeof f=="function")?(u||(u=new n),o(u,f,g)):i&&(d||(d=i()),d.set(f,g))}};return p}:i,qr}var Kr,Oo;function mu(){if(Oo)return Kr;Oo=1;var r=wi(),e=Ws(),t=zc(),i=el(),s=fu(),n=s||i||t;return Kr=function(){var o,h={assert:function(l){if(!h.has(l))throw new r("Side channel does not contain "+e(l))},delete:function(l){return!!o&&o.delete(l)},get:function(l){return o&&o.get(l)},has:function(l){return!!o&&o.has(l)},set:function(l,c){o||(o=n()),o.set(l,c)}};return h},Kr}var Jr,ko;function ya(){if(ko)return Jr;ko=1;var r=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Jr={default:t.RFC3986,formatters:{RFC1738:function(i){return r.call(i,e,"+")},RFC3986:function(i){return String(i)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},Jr}var Zr,No;function tl(){if(No)return Zr;No=1;var r=ya(),e=Object.prototype.hasOwnProperty,t=Array.isArray,i=function(){for(var m=[],y=0;y<256;++y)m.push("%"+((y<16?"0":"")+y.toString(16)).toUpperCase());return m}(),s=function(y){for(;y.length>1;){var S=y.pop(),_=S.obj[S.prop];if(t(_)){for(var E=[],w=0;w<_.length;++w)typeof _[w]<"u"&&E.push(_[w]);S.obj[S.prop]=E}}},n=function(y,S){for(var _=S&&S.plainObjects?{__proto__:null}:{},E=0;E<y.length;++E)typeof y[E]<"u"&&(_[E]=y[E]);return _},a=function m(y,S,_){if(!S)return y;if(typeof S!="object"&&typeof S!="function"){if(t(y))y.push(S);else if(y&&typeof y=="object")(_&&(_.plainObjects||_.allowPrototypes)||!e.call(Object.prototype,S))&&(y[S]=!0);else return[y,S];return y}if(!y||typeof y!="object")return[y].concat(S);var E=y;return t(y)&&!t(S)&&(E=n(y,_)),t(y)&&t(S)?(S.forEach(function(w,B){if(e.call(y,B)){var v=y[B];v&&typeof v=="object"&&w&&typeof w=="object"?y[B]=m(v,w,_):y.push(w)}else y[B]=w}),y):Object.keys(S).reduce(function(w,B){var v=S[B];return e.call(w,B)?w[B]=m(w[B],v,_):w[B]=v,w},E)},o=function(y,S){return Object.keys(S).reduce(function(_,E){return _[E]=S[E],_},y)},h=function(m,y,S){var _=m.replace(/\+/g," ");if(S==="iso-8859-1")return _.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(_)}catch{return _}},l=1024,c=function(y,S,_,E,w){if(y.length===0)return y;var B=y;if(typeof y=="symbol"?B=Symbol.prototype.toString.call(y):typeof y!="string"&&(B=String(y)),_==="iso-8859-1")return escape(B).replace(/%u[0-9a-f]{4}/gi,function(O){return"%26%23"+parseInt(O.slice(2),16)+"%3B"});for(var v="",F=0;F<B.length;F+=l){for(var U=B.length>=l?B.slice(F,F+l):B,G=[],N=0;N<U.length;++N){var M=U.charCodeAt(N);if(M===45||M===46||M===95||M===126||M>=48&&M<=57||M>=65&&M<=90||M>=97&&M<=122||w===r.RFC1738&&(M===40||M===41)){G[G.length]=U.charAt(N);continue}if(M<128){G[G.length]=i[M];continue}if(M<2048){G[G.length]=i[192|M>>6]+i[128|M&63];continue}if(M<55296||M>=57344){G[G.length]=i[224|M>>12]+i[128|M>>6&63]+i[128|M&63];continue}N+=1,M=65536+((M&1023)<<10|U.charCodeAt(N)&1023),G[G.length]=i[240|M>>18]+i[128|M>>12&63]+i[128|M>>6&63]+i[128|M&63]}v+=G.join("")}return v},u=function(y){for(var S=[{obj:{o:y},prop:"o"}],_=[],E=0;E<S.length;++E)for(var w=S[E],B=w.obj[w.prop],v=Object.keys(B),F=0;F<v.length;++F){var U=v[F],G=B[U];typeof G=="object"&&G!==null&&_.indexOf(G)===-1&&(S.push({obj:B,prop:U}),_.push(G))}return s(S),y},d=function(y){return Object.prototype.toString.call(y)==="[object RegExp]"},p=function(y){return!y||typeof y!="object"?!1:!!(y.constructor&&y.constructor.isBuffer&&y.constructor.isBuffer(y))},f=function(y,S){return[].concat(y,S)},g=function(y,S){if(t(y)){for(var _=[],E=0;E<y.length;E+=1)_.push(S(y[E]));return _}return S(y)};return Zr={arrayToObject:n,assign:o,combine:f,compact:u,decode:h,encode:c,isBuffer:p,isRegExp:d,maybeMap:g,merge:a},Zr}var Qr,Uo;function gu(){if(Uo)return Qr;Uo=1;var r=mu(),e=tl(),t=ya(),i=Object.prototype.hasOwnProperty,s={brackets:function(m){return m+"[]"},comma:"comma",indices:function(m,y){return m+"["+y+"]"},repeat:function(m){return m}},n=Array.isArray,a=Array.prototype.push,o=function(g,m){a.apply(g,n(m)?m:[m])},h=Date.prototype.toISOString,l=t.default,c={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:l,formatter:t.formatters[l],indices:!1,serializeDate:function(m){return h.call(m)},skipNulls:!1,strictNullHandling:!1},u=function(m){return typeof m=="string"||typeof m=="number"||typeof m=="boolean"||typeof m=="symbol"||typeof m=="bigint"},d={},p=function g(m,y,S,_,E,w,B,v,F,U,G,N,M,O,k,J,b,T){for(var x=m,R=T,A=0,C=!1;(R=R.get(d))!==void 0&&!C;){var D=R.get(m);if(A+=1,typeof D<"u"){if(D===A)throw new RangeError("Cyclic object value");C=!0}typeof R.get(d)>"u"&&(A=0)}if(typeof U=="function"?x=U(y,x):x instanceof Date?x=M(x):S==="comma"&&n(x)&&(x=e.maybeMap(x,function(ie){return ie instanceof Date?M(ie):ie})),x===null){if(w)return F&&!J?F(y,c.encoder,b,"key",O):y;x=""}if(u(x)||e.isBuffer(x)){if(F){var I=J?y:F(y,c.encoder,b,"key",O);return[k(I)+"="+k(F(x,c.encoder,b,"value",O))]}return[k(y)+"="+k(String(x))]}var H=[];if(typeof x>"u")return H;var z;if(S==="comma"&&n(x))J&&F&&(x=e.maybeMap(x,F)),z=[{value:x.length>0?x.join(",")||null:void 0}];else if(n(U))z=U;else{var Y=Object.keys(x);z=G?Y.sort(G):Y}var q=v?String(y).replace(/\./g,"%2E"):String(y),Q=_&&n(x)&&x.length===1?q+"[]":q;if(E&&n(x)&&x.length===0)return Q+"[]";for(var se=0;se<z.length;++se){var $=z[se],te=typeof $=="object"&&$&&typeof $.value<"u"?$.value:x[$];if(!(B&&te===null)){var re=N&&v?String($).replace(/\./g,"%2E"):String($),ue=n(x)?typeof S=="function"?S(Q,re):Q:Q+(N?"."+re:"["+re+"]");T.set(m,A);var ge=r();ge.set(d,T),o(H,g(te,ue,S,_,E,w,B,v,S==="comma"&&J&&n(x)?null:F,U,G,N,M,O,k,J,b,ge))}}return H},f=function(m){if(!m)return c;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.encodeDotInKeys<"u"&&typeof m.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(m.encoder!==null&&typeof m.encoder<"u"&&typeof m.encoder!="function")throw new TypeError("Encoder has to be a function.");var y=m.charset||c.charset;if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var S=t.default;if(typeof m.format<"u"){if(!i.call(t.formatters,m.format))throw new TypeError("Unknown format option provided.");S=m.format}var _=t.formatters[S],E=c.filter;(typeof m.filter=="function"||n(m.filter))&&(E=m.filter);var w;if(m.arrayFormat in s?w=m.arrayFormat:"indices"in m?w=m.indices?"indices":"repeat":w=c.arrayFormat,"commaRoundTrip"in m&&typeof m.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var B=typeof m.allowDots>"u"?m.encodeDotInKeys===!0?!0:c.allowDots:!!m.allowDots;return{addQueryPrefix:typeof m.addQueryPrefix=="boolean"?m.addQueryPrefix:c.addQueryPrefix,allowDots:B,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:c.allowEmptyArrays,arrayFormat:w,charset:y,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:c.charsetSentinel,commaRoundTrip:!!m.commaRoundTrip,delimiter:typeof m.delimiter>"u"?c.delimiter:m.delimiter,encode:typeof m.encode=="boolean"?m.encode:c.encode,encodeDotInKeys:typeof m.encodeDotInKeys=="boolean"?m.encodeDotInKeys:c.encodeDotInKeys,encoder:typeof m.encoder=="function"?m.encoder:c.encoder,encodeValuesOnly:typeof m.encodeValuesOnly=="boolean"?m.encodeValuesOnly:c.encodeValuesOnly,filter:E,format:S,formatter:_,serializeDate:typeof m.serializeDate=="function"?m.serializeDate:c.serializeDate,skipNulls:typeof m.skipNulls=="boolean"?m.skipNulls:c.skipNulls,sort:typeof m.sort=="function"?m.sort:null,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:c.strictNullHandling}};return Qr=function(g,m){var y=g,S=f(m),_,E;typeof S.filter=="function"?(E=S.filter,y=E("",y)):n(S.filter)&&(E=S.filter,_=E);var w=[];if(typeof y!="object"||y===null)return"";var B=s[S.arrayFormat],v=B==="comma"&&S.commaRoundTrip;_||(_=Object.keys(y)),S.sort&&_.sort(S.sort);for(var F=r(),U=0;U<_.length;++U){var G=_[U],N=y[G];S.skipNulls&&N===null||o(w,p(N,G,B,v,S.allowEmptyArrays,S.strictNullHandling,S.skipNulls,S.encodeDotInKeys,S.encode?S.encoder:null,S.filter,S.sort,S.allowDots,S.serializeDate,S.format,S.formatter,S.encodeValuesOnly,S.charset,F))}var M=w.join(S.delimiter),O=S.addQueryPrefix===!0?"?":"";return S.charsetSentinel&&(S.charset==="iso-8859-1"?O+="utf8=%26%2310003%3B&":O+="utf8=%E2%9C%93&"),M.length>0?O+M:""},Qr}var en,Go;function yu(){if(Go)return en;Go=1;var r=tl(),e=Object.prototype.hasOwnProperty,t=Array.isArray,i={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:r.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},s=function(d){return d.replace(/&#(\d+);/g,function(p,f){return String.fromCharCode(parseInt(f,10))})},n=function(d,p,f){if(d&&typeof d=="string"&&p.comma&&d.indexOf(",")>-1)return d.split(",");if(p.throwOnLimitExceeded&&f>=p.arrayLimit)throw new RangeError("Array limit exceeded. Only "+p.arrayLimit+" element"+(p.arrayLimit===1?"":"s")+" allowed in an array.");return d},a="utf8=%26%2310003%3B",o="utf8=%E2%9C%93",h=function(p,f){var g={__proto__:null},m=f.ignoreQueryPrefix?p.replace(/^\?/,""):p;m=m.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var y=f.parameterLimit===1/0?void 0:f.parameterLimit,S=m.split(f.delimiter,f.throwOnLimitExceeded?y+1:y);if(f.throwOnLimitExceeded&&S.length>y)throw new RangeError("Parameter limit exceeded. Only "+y+" parameter"+(y===1?"":"s")+" allowed.");var _=-1,E,w=f.charset;if(f.charsetSentinel)for(E=0;E<S.length;++E)S[E].indexOf("utf8=")===0&&(S[E]===o?w="utf-8":S[E]===a&&(w="iso-8859-1"),_=E,E=S.length);for(E=0;E<S.length;++E)if(E!==_){var B=S[E],v=B.indexOf("]="),F=v===-1?B.indexOf("="):v+1,U,G;F===-1?(U=f.decoder(B,i.decoder,w,"key"),G=f.strictNullHandling?null:""):(U=f.decoder(B.slice(0,F),i.decoder,w,"key"),G=r.maybeMap(n(B.slice(F+1),f,t(g[U])?g[U].length:0),function(M){return f.decoder(M,i.decoder,w,"value")})),G&&f.interpretNumericEntities&&w==="iso-8859-1"&&(G=s(String(G))),B.indexOf("[]=")>-1&&(G=t(G)?[G]:G);var N=e.call(g,U);N&&f.duplicates==="combine"?g[U]=r.combine(g[U],G):(!N||f.duplicates==="last")&&(g[U]=G)}return g},l=function(d,p,f,g){var m=0;if(d.length>0&&d[d.length-1]==="[]"){var y=d.slice(0,-1).join("");m=Array.isArray(p)&&p[y]?p[y].length:0}for(var S=g?p:n(p,f,m),_=d.length-1;_>=0;--_){var E,w=d[_];if(w==="[]"&&f.parseArrays)E=f.allowEmptyArrays&&(S===""||f.strictNullHandling&&S===null)?[]:r.combine([],S);else{E=f.plainObjects?{__proto__:null}:{};var B=w.charAt(0)==="["&&w.charAt(w.length-1)==="]"?w.slice(1,-1):w,v=f.decodeDotInKeys?B.replace(/%2E/g,"."):B,F=parseInt(v,10);!f.parseArrays&&v===""?E={0:S}:!isNaN(F)&&w!==v&&String(F)===v&&F>=0&&f.parseArrays&&F<=f.arrayLimit?(E=[],E[F]=S):v!=="__proto__"&&(E[v]=S)}S=E}return S},c=function(p,f,g,m){if(p){var y=g.allowDots?p.replace(/\.([^.[]+)/g,"[$1]"):p,S=/(\[[^[\]]*])/,_=/(\[[^[\]]*])/g,E=g.depth>0&&S.exec(y),w=E?y.slice(0,E.index):y,B=[];if(w){if(!g.plainObjects&&e.call(Object.prototype,w)&&!g.allowPrototypes)return;B.push(w)}for(var v=0;g.depth>0&&(E=_.exec(y))!==null&&v<g.depth;){if(v+=1,!g.plainObjects&&e.call(Object.prototype,E[1].slice(1,-1))&&!g.allowPrototypes)return;B.push(E[1])}if(E){if(g.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+g.depth+" and strictDepth is true");B.push("["+y.slice(E.index)+"]")}return l(B,f,g,m)}},u=function(p){if(!p)return i;if(typeof p.allowEmptyArrays<"u"&&typeof p.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof p.decodeDotInKeys<"u"&&typeof p.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(p.decoder!==null&&typeof p.decoder<"u"&&typeof p.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof p.charset<"u"&&p.charset!=="utf-8"&&p.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof p.throwOnLimitExceeded<"u"&&typeof p.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var f=typeof p.charset>"u"?i.charset:p.charset,g=typeof p.duplicates>"u"?i.duplicates:p.duplicates;if(g!=="combine"&&g!=="first"&&g!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var m=typeof p.allowDots>"u"?p.decodeDotInKeys===!0?!0:i.allowDots:!!p.allowDots;return{allowDots:m,allowEmptyArrays:typeof p.allowEmptyArrays=="boolean"?!!p.allowEmptyArrays:i.allowEmptyArrays,allowPrototypes:typeof p.allowPrototypes=="boolean"?p.allowPrototypes:i.allowPrototypes,allowSparse:typeof p.allowSparse=="boolean"?p.allowSparse:i.allowSparse,arrayLimit:typeof p.arrayLimit=="number"?p.arrayLimit:i.arrayLimit,charset:f,charsetSentinel:typeof p.charsetSentinel=="boolean"?p.charsetSentinel:i.charsetSentinel,comma:typeof p.comma=="boolean"?p.comma:i.comma,decodeDotInKeys:typeof p.decodeDotInKeys=="boolean"?p.decodeDotInKeys:i.decodeDotInKeys,decoder:typeof p.decoder=="function"?p.decoder:i.decoder,delimiter:typeof p.delimiter=="string"||r.isRegExp(p.delimiter)?p.delimiter:i.delimiter,depth:typeof p.depth=="number"||p.depth===!1?+p.depth:i.depth,duplicates:g,ignoreQueryPrefix:p.ignoreQueryPrefix===!0,interpretNumericEntities:typeof p.interpretNumericEntities=="boolean"?p.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:typeof p.parameterLimit=="number"?p.parameterLimit:i.parameterLimit,parseArrays:p.parseArrays!==!1,plainObjects:typeof p.plainObjects=="boolean"?p.plainObjects:i.plainObjects,strictDepth:typeof p.strictDepth=="boolean"?!!p.strictDepth:i.strictDepth,strictNullHandling:typeof p.strictNullHandling=="boolean"?p.strictNullHandling:i.strictNullHandling,throwOnLimitExceeded:typeof p.throwOnLimitExceeded=="boolean"?p.throwOnLimitExceeded:!1}};return en=function(d,p){var f=u(p);if(d===""||d===null||typeof d>"u")return f.plainObjects?{__proto__:null}:{};for(var g=typeof d=="string"?h(d,f):d,m=f.plainObjects?{__proto__:null}:{},y=Object.keys(g),S=0;S<y.length;++S){var _=y[S],E=c(_,g[_],f,typeof d=="string");m=r.merge(m,E,f)}return f.allowSparse===!0?m:r.compact(m)},en}var tn,Ho;function vu(){if(Ho)return tn;Ho=1;var r=gu(),e=yu(),t=ya();return tn={formats:t,parse:e,stringify:r},tn}var Wo;function xu(){if(Wo)return kt;Wo=1;var r=Uc();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,i=/:[0-9]*$/,s=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,n=["<",">",'"',"`"," ","\r",`
`,"	"],a=["{","}","|","\\","^","`"].concat(n),o=["'"].concat(a),h=["%","/","?",";","#"].concat(o),l=["/","?","#"],c=255,u=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=vu();function y(w,B,v){if(w&&typeof w=="object"&&w instanceof e)return w;var F=new e;return F.parse(w,B,v),F}e.prototype.parse=function(w,B,v){if(typeof w!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof w);var F=w.indexOf("?"),U=F!==-1&&F<w.indexOf("#")?"?":"#",G=w.split(U),N=/\\/g;G[0]=G[0].replace(N,"/"),w=G.join(U);var M=w;if(M=M.trim(),!v&&w.split("#").length===1){var O=s.exec(M);if(O)return this.path=M,this.href=M,this.pathname=O[1],O[2]?(this.search=O[2],B?this.query=m.parse(this.search.substr(1)):this.query=this.search.substr(1)):B&&(this.search="",this.query={}),this}var k=t.exec(M);if(k){k=k[0];var J=k.toLowerCase();this.protocol=J,M=M.substr(k.length)}if(v||k||M.match(/^\/\/[^@/]+@[^@/]+/)){var b=M.substr(0,2)==="//";b&&!(k&&f[k])&&(M=M.substr(2),this.slashes=!0)}if(!f[k]&&(b||k&&!g[k])){for(var T=-1,x=0;x<l.length;x++){var R=M.indexOf(l[x]);R!==-1&&(T===-1||R<T)&&(T=R)}var A,C;T===-1?C=M.lastIndexOf("@"):C=M.lastIndexOf("@",T),C!==-1&&(A=M.slice(0,C),M=M.slice(C+1),this.auth=decodeURIComponent(A)),T=-1;for(var x=0;x<h.length;x++){var R=M.indexOf(h[x]);R!==-1&&(T===-1||R<T)&&(T=R)}T===-1&&(T=M.length),this.host=M.slice(0,T),M=M.slice(T),this.parseHost(),this.hostname=this.hostname||"";var D=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!D)for(var I=this.hostname.split(/\./),x=0,H=I.length;x<H;x++){var z=I[x];if(z&&!z.match(u)){for(var Y="",q=0,Q=z.length;q<Q;q++)z.charCodeAt(q)>127?Y+="x":Y+=z[q];if(!Y.match(u)){var se=I.slice(0,x),$=I.slice(x+1),te=z.match(d);te&&(se.push(te[1]),$.unshift(te[2])),$.length&&(M="/"+$.join(".")+M),this.hostname=se.join(".");break}}}this.hostname.length>c?this.hostname="":this.hostname=this.hostname.toLowerCase(),D||(this.hostname=r.toASCII(this.hostname));var re=this.port?":"+this.port:"",ue=this.hostname||"";this.host=ue+re,this.href+=this.host,D&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),M[0]!=="/"&&(M="/"+M))}if(!p[J])for(var x=0,H=o.length;x<H;x++){var ge=o[x];if(M.indexOf(ge)!==-1){var ie=encodeURIComponent(ge);ie===ge&&(ie=escape(ge)),M=M.split(ge).join(ie)}}var ne=M.indexOf("#");ne!==-1&&(this.hash=M.substr(ne),M=M.slice(0,ne));var Ae=M.indexOf("?");if(Ae!==-1?(this.search=M.substr(Ae),this.query=M.substr(Ae+1),B&&(this.query=m.parse(this.query)),M=M.slice(0,Ae)):B&&(this.search="",this.query={}),M&&(this.pathname=M),g[J]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var re=this.pathname||"",Re=this.search||"";this.path=re+Re}return this.href=this.format(),this};function S(w){return typeof w=="string"&&(w=y(w)),w instanceof e?w.format():e.prototype.format.call(w)}e.prototype.format=function(){var w=this.auth||"";w&&(w=encodeURIComponent(w),w=w.replace(/%3A/i,":"),w+="@");var B=this.protocol||"",v=this.pathname||"",F=this.hash||"",U=!1,G="";this.host?U=w+this.host:this.hostname&&(U=w+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(U+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(G=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var N=this.search||G&&"?"+G||"";return B&&B.substr(-1)!==":"&&(B+=":"),this.slashes||(!B||g[B])&&U!==!1?(U="//"+(U||""),v&&v.charAt(0)!=="/"&&(v="/"+v)):U||(U=""),F&&F.charAt(0)!=="#"&&(F="#"+F),N&&N.charAt(0)!=="?"&&(N="?"+N),v=v.replace(/[?#]/g,function(M){return encodeURIComponent(M)}),N=N.replace("#","%23"),B+U+v+N+F};function _(w,B){return y(w,!1,!0).resolve(B)}e.prototype.resolve=function(w){return this.resolveObject(y(w,!1,!0)).format()};function E(w,B){return w?y(w,!1,!0).resolveObject(B):B}return e.prototype.resolveObject=function(w){if(typeof w=="string"){var B=new e;B.parse(w,!1,!0),w=B}for(var v=new e,F=Object.keys(this),U=0;U<F.length;U++){var G=F[U];v[G]=this[G]}if(v.hash=w.hash,w.href==="")return v.href=v.format(),v;if(w.slashes&&!w.protocol){for(var N=Object.keys(w),M=0;M<N.length;M++){var O=N[M];O!=="protocol"&&(v[O]=w[O])}return g[v.protocol]&&v.hostname&&!v.pathname&&(v.pathname="/",v.path=v.pathname),v.href=v.format(),v}if(w.protocol&&w.protocol!==v.protocol){if(!g[w.protocol]){for(var k=Object.keys(w),J=0;J<k.length;J++){var b=k[J];v[b]=w[b]}return v.href=v.format(),v}if(v.protocol=w.protocol,!w.host&&!f[w.protocol]){for(var H=(w.pathname||"").split("/");H.length&&!(w.host=H.shift()););w.host||(w.host=""),w.hostname||(w.hostname=""),H[0]!==""&&H.unshift(""),H.length<2&&H.unshift(""),v.pathname=H.join("/")}else v.pathname=w.pathname;if(v.search=w.search,v.query=w.query,v.host=w.host||"",v.auth=w.auth,v.hostname=w.hostname||w.host,v.port=w.port,v.pathname||v.search){var T=v.pathname||"",x=v.search||"";v.path=T+x}return v.slashes=v.slashes||w.slashes,v.href=v.format(),v}var R=v.pathname&&v.pathname.charAt(0)==="/",A=w.host||w.pathname&&w.pathname.charAt(0)==="/",C=A||R||v.host&&w.pathname,D=C,I=v.pathname&&v.pathname.split("/")||[],H=w.pathname&&w.pathname.split("/")||[],z=v.protocol&&!g[v.protocol];if(z&&(v.hostname="",v.port=null,v.host&&(I[0]===""?I[0]=v.host:I.unshift(v.host)),v.host="",w.protocol&&(w.hostname=null,w.port=null,w.host&&(H[0]===""?H[0]=w.host:H.unshift(w.host)),w.host=null),C=C&&(H[0]===""||I[0]==="")),A)v.host=w.host||w.host===""?w.host:v.host,v.hostname=w.hostname||w.hostname===""?w.hostname:v.hostname,v.search=w.search,v.query=w.query,I=H;else if(H.length)I||(I=[]),I.pop(),I=I.concat(H),v.search=w.search,v.query=w.query;else if(w.search!=null){if(z){v.host=I.shift(),v.hostname=v.host;var Y=v.host&&v.host.indexOf("@")>0?v.host.split("@"):!1;Y&&(v.auth=Y.shift(),v.hostname=Y.shift(),v.host=v.hostname)}return v.search=w.search,v.query=w.query,(v.pathname!==null||v.search!==null)&&(v.path=(v.pathname?v.pathname:"")+(v.search?v.search:"")),v.href=v.format(),v}if(!I.length)return v.pathname=null,v.search?v.path="/"+v.search:v.path=null,v.href=v.format(),v;for(var q=I.slice(-1)[0],Q=(v.host||w.host||I.length>1)&&(q==="."||q==="..")||q==="",se=0,$=I.length;$>=0;$--)q=I[$],q==="."?I.splice($,1):q===".."?(I.splice($,1),se++):se&&(I.splice($,1),se--);if(!C&&!D)for(;se--;se)I.unshift("..");C&&I[0]!==""&&(!I[0]||I[0].charAt(0)!=="/")&&I.unshift(""),Q&&I.join("/").substr(-1)!=="/"&&I.push("");var te=I[0]===""||I[0]&&I[0].charAt(0)==="/";if(z){v.hostname=te?"":I.length?I.shift():"",v.host=v.hostname;var Y=v.host&&v.host.indexOf("@")>0?v.host.split("@"):!1;Y&&(v.auth=Y.shift(),v.hostname=Y.shift(),v.host=v.hostname)}return C=C||v.host&&I.length,C&&!te&&I.unshift(""),I.length>0?v.pathname=I.join("/"):(v.pathname=null,v.path=null),(v.pathname!==null||v.search!==null)&&(v.path=(v.pathname?v.pathname:"")+(v.search?v.search:"")),v.auth=w.auth||v.auth,v.slashes=v.slashes||w.slashes,v.href=v.format(),v},e.prototype.parseHost=function(){var w=this.host,B=i.exec(w);B&&(B=B[0],B!==":"&&(this.port=B.substr(1)),w=w.substr(0,w.length-B.length)),w&&(this.hostname=w)},kt.parse=y,kt.resolve=_,kt.resolveObject=E,kt.format=S,kt.Url=e,kt}var Hg=xu();const zo={};function de(r,e,t=3){if(zo[e])return;let i=new Error().stack;typeof i>"u"?console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`):(i=i.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}
Deprecated since v${r}`),console.warn(i),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}
Deprecated since v${r}`),console.warn(i))),zo[e]=!0}function qe(r){if(typeof r!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(r)}`)}function Ai(r){return r.split("?")[0].split("#")[0]}function _u(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function bu(r,e,t){return r.replace(new RegExp(_u(e),"g"),t)}function wu(r,e){let t="",i=0,s=-1,n=0,a=-1;for(let o=0;o<=r.length;++o){if(o<r.length)a=r.charCodeAt(o);else{if(a===47)break;a=47}if(a===47){if(!(s===o-1||n===1))if(s!==o-1&&n===2){if(t.length<2||i!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){const h=t.lastIndexOf("/");if(h!==t.length-1){h===-1?(t="",i=0):(t=t.slice(0,h),i=t.length-1-t.lastIndexOf("/")),s=o,n=0;continue}}else if(t.length===2||t.length===1){t="",i=0,s=o,n=0;continue}}}else t.length>0?t+=`/${r.slice(s+1,o)}`:t=r.slice(s+1,o),i=o-s-1;s=o,n=0}else a===46&&n!==-1?++n:n=-1}return t}const De={toPosix(r){return bu(r,"\\","/")},isUrl(r){return/^https?:/.test(this.toPosix(r))},isDataUrl(r){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(r)},isBlobUrl(r){return r.startsWith("blob:")},hasProtocol(r){return/^[^/:]+:/.test(this.toPosix(r))},getProtocol(r){qe(r),r=this.toPosix(r);const e=/^file:\/\/\//.exec(r);if(e)return e[0];const t=/^[^/:]+:\/{0,2}/.exec(r);return t?t[0]:""},toAbsolute(r,e,t){if(qe(r),this.isDataUrl(r)||this.isBlobUrl(r))return r;const i=Ai(this.toPosix(e??j.ADAPTER.getBaseUrl())),s=Ai(this.toPosix(t??this.rootname(i)));return r=this.toPosix(r),r.startsWith("/")?De.join(s,r.slice(1)):this.isAbsolute(r)?r:this.join(i,r)},normalize(r){if(qe(r),r.length===0)return".";if(this.isDataUrl(r)||this.isBlobUrl(r))return r;r=this.toPosix(r);let e="";const t=r.startsWith("/");this.hasProtocol(r)&&(e=this.rootname(r),r=r.slice(e.length));const i=r.endsWith("/");return r=wu(r),r.length>0&&i&&(r+="/"),t?`/${r}`:e+r},isAbsolute(r){return qe(r),r=this.toPosix(r),this.hasProtocol(r)?!0:r.startsWith("/")},join(...r){if(r.length===0)return".";let e;for(let t=0;t<r.length;++t){const i=r[t];if(qe(i),i.length>0)if(e===void 0)e=i;else{const s=r[t-1]??"";this.joinExtensions.includes(this.extname(s).toLowerCase())?e+=`/../${i}`:e+=`/${i}`}}return e===void 0?".":this.normalize(e)},dirname(r){if(qe(r),r.length===0)return".";r=this.toPosix(r);let e=r.charCodeAt(0);const t=e===47;let i=-1,s=!0;const n=this.getProtocol(r),a=r;r=r.slice(n.length);for(let o=r.length-1;o>=1;--o)if(e=r.charCodeAt(o),e===47){if(!s){i=o;break}}else s=!1;return i===-1?t?"/":this.isUrl(a)?n+r:n:t&&i===1?"//":n+r.slice(0,i)},rootname(r){qe(r),r=this.toPosix(r);let e="";if(r.startsWith("/")?e="/":e=this.getProtocol(r),this.isUrl(r)){const t=r.indexOf("/",e.length);t!==-1?e=r.slice(0,t):e=r,e.endsWith("/")||(e+="/")}return e},basename(r,e){qe(r),e&&qe(e),r=Ai(this.toPosix(r));let t=0,i=-1,s=!0,n;if(e!==void 0&&e.length>0&&e.length<=r.length){if(e.length===r.length&&e===r)return"";let a=e.length-1,o=-1;for(n=r.length-1;n>=0;--n){const h=r.charCodeAt(n);if(h===47){if(!s){t=n+1;break}}else o===-1&&(s=!1,o=n+1),a>=0&&(h===e.charCodeAt(a)?--a===-1&&(i=n):(a=-1,i=o))}return t===i?i=o:i===-1&&(i=r.length),r.slice(t,i)}for(n=r.length-1;n>=0;--n)if(r.charCodeAt(n)===47){if(!s){t=n+1;break}}else i===-1&&(s=!1,i=n+1);return i===-1?"":r.slice(t,i)},extname(r){qe(r),r=Ai(this.toPosix(r));let e=-1,t=0,i=-1,s=!0,n=0;for(let a=r.length-1;a>=0;--a){const o=r.charCodeAt(a);if(o===47){if(!s){t=a+1;break}continue}i===-1&&(s=!1,i=a+1),o===46?e===-1?e=a:n!==1&&(n=1):e!==-1&&(n=-1)}return e===-1||i===-1||n===0||n===1&&e===i-1&&e===t+1?"":r.slice(e,i)},parse(r){qe(r);const e={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return e;r=Ai(this.toPosix(r));let t=r.charCodeAt(0);const i=this.isAbsolute(r);let s;e.root=this.rootname(r),i||this.hasProtocol(r)?s=1:s=0;let n=-1,a=0,o=-1,h=!0,l=r.length-1,c=0;for(;l>=s;--l){if(t=r.charCodeAt(l),t===47){if(!h){a=l+1;break}continue}o===-1&&(h=!1,o=l+1),t===46?n===-1?n=l:c!==1&&(c=1):n!==-1&&(c=-1)}return n===-1||o===-1||c===0||c===1&&n===o-1&&n===a+1?o!==-1&&(a===0&&i?e.base=e.name=r.slice(1,o):e.base=e.name=r.slice(a,o)):(a===0&&i?(e.name=r.slice(1,n),e.base=r.slice(1,o)):(e.name=r.slice(a,n),e.base=r.slice(a,o)),e.ext=r.slice(n,o)),e.dir=this.dirname(r),e},sep:"/",delimiter:":",joinExtensions:[".html"]};let sn;async function Tu(){return sn??(sn=(async()=>{const r=document.createElement("canvas").getContext("webgl");if(!r)return Ue.UNPACK;const e=await new Promise(n=>{const a=document.createElement("video");a.onloadeddata=()=>n(a),a.onerror=()=>n(null),a.autoplay=!1,a.crossOrigin="anonymous",a.preload="auto",a.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",a.load()});if(!e)return Ue.UNPACK;const t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);const i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e);const s=new Uint8Array(4);return r.readPixels(0,0,1,1,r.RGBA,r.UNSIGNED_BYTE,s),r.deleteFramebuffer(i),r.deleteTexture(t),r.getExtension("WEBGL_lose_context")?.loseContext(),s[0]<=s[3]?Ue.PMA:Ue.UNPACK})()),sn}let rn;function Su(){return typeof rn>"u"&&(rn=function(){const r={stencil:!0,failIfMajorPerformanceCaveat:j.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!j.ADAPTER.getWebGLRenderingContext())return!1;const e=j.ADAPTER.createCanvas();let t=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);const i=!!t?.getContextAttributes()?.stencil;if(t){const s=t.getExtension("WEBGL_lose_context");s&&s.loseContext()}return t=null,i}catch{return!1}}()),rn}var Eu={grad:.9,turn:360,rad:360/(2*Math.PI)},ft=function(r){return typeof r=="string"?r.length>0:typeof r=="number"},Be=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=Math.pow(10,e)),Math.round(t*r)/t+0},Xe=function(r,e,t){return e===void 0&&(e=0),t===void 0&&(t=1),r>t?t:r>e?r:e},il=function(r){return(r=isFinite(r)?r%360:0)>0?r:r+360},$o=function(r){return{r:Xe(r.r,0,255),g:Xe(r.g,0,255),b:Xe(r.b,0,255),a:Xe(r.a)}},nn=function(r){return{r:Be(r.r),g:Be(r.g),b:Be(r.b),a:Be(r.a,3)}},Au=/^#([0-9a-f]{3,8})$/i,Zi=function(r){var e=r.toString(16);return e.length<2?"0"+e:e},sl=function(r){var e=r.r,t=r.g,i=r.b,s=r.a,n=Math.max(e,t,i),a=n-Math.min(e,t,i),o=a?n===e?(t-i)/a:n===t?2+(i-e)/a:4+(e-t)/a:0;return{h:60*(o<0?o+6:o),s:n?a/n*100:0,v:n/255*100,a:s}},rl=function(r){var e=r.h,t=r.s,i=r.v,s=r.a;e=e/360*6,t/=100,i/=100;var n=Math.floor(e),a=i*(1-t),o=i*(1-(e-n)*t),h=i*(1-(1-e+n)*t),l=n%6;return{r:255*[i,o,a,a,h,i][l],g:255*[h,i,i,o,a,a][l],b:255*[a,a,h,i,i,o][l],a:s}},Vo=function(r){return{h:il(r.h),s:Xe(r.s,0,100),l:Xe(r.l,0,100),a:Xe(r.a)}},Xo=function(r){return{h:Be(r.h),s:Be(r.s),l:Be(r.l),a:Be(r.a,3)}},jo=function(r){return rl((t=(e=r).s,{h:e.h,s:(t*=((i=e.l)<50?i:100-i)/100)>0?2*t/(i+t)*100:0,v:i+t,a:e.a}));var e,t,i},Wi=function(r){return{h:(e=sl(r)).h,s:(s=(200-(t=e.s))*(i=e.v)/100)>0&&s<200?t*i/100/(s<=100?s:200-s)*100:0,l:s/2,a:e.a};var e,t,i,s},Cu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Mu=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ru=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Pu=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,In={string:[[function(r){var e=Au.exec(r);return e?(r=e[1]).length<=4?{r:parseInt(r[0]+r[0],16),g:parseInt(r[1]+r[1],16),b:parseInt(r[2]+r[2],16),a:r.length===4?Be(parseInt(r[3]+r[3],16)/255,2):1}:r.length===6||r.length===8?{r:parseInt(r.substr(0,2),16),g:parseInt(r.substr(2,2),16),b:parseInt(r.substr(4,2),16),a:r.length===8?Be(parseInt(r.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(r){var e=Ru.exec(r)||Pu.exec(r);return e?e[2]!==e[4]||e[4]!==e[6]?null:$o({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(r){var e=Cu.exec(r)||Mu.exec(r);if(!e)return null;var t,i,s=Vo({h:(t=e[1],i=e[2],i===void 0&&(i="deg"),Number(t)*(Eu[i]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return jo(s)},"hsl"]],object:[[function(r){var e=r.r,t=r.g,i=r.b,s=r.a,n=s===void 0?1:s;return ft(e)&&ft(t)&&ft(i)?$o({r:Number(e),g:Number(t),b:Number(i),a:Number(n)}):null},"rgb"],[function(r){var e=r.h,t=r.s,i=r.l,s=r.a,n=s===void 0?1:s;if(!ft(e)||!ft(t)||!ft(i))return null;var a=Vo({h:Number(e),s:Number(t),l:Number(i),a:Number(n)});return jo(a)},"hsl"],[function(r){var e=r.h,t=r.s,i=r.v,s=r.a,n=s===void 0?1:s;if(!ft(e)||!ft(t)||!ft(i))return null;var a=function(o){return{h:il(o.h),s:Xe(o.s,0,100),v:Xe(o.v,0,100),a:Xe(o.a)}}({h:Number(e),s:Number(t),v:Number(i),a:Number(n)});return rl(a)},"hsv"]]},Yo=function(r,e){for(var t=0;t<e.length;t++){var i=e[t][0](r);if(i)return[i,e[t][1]]}return[null,void 0]},Iu=function(r){return typeof r=="string"?Yo(r.trim(),In.string):typeof r=="object"&&r!==null?Yo(r,In.object):[null,void 0]},an=function(r,e){var t=Wi(r);return{h:t.h,s:Xe(t.s+100*e,0,100),l:t.l,a:t.a}},on=function(r){return(299*r.r+587*r.g+114*r.b)/1e3/255},qo=function(r,e){var t=Wi(r);return{h:t.h,s:t.s,l:Xe(t.l+100*e,0,100),a:t.a}},Bn=function(){function r(e){this.parsed=Iu(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return r.prototype.isValid=function(){return this.parsed!==null},r.prototype.brightness=function(){return Be(on(this.rgba),2)},r.prototype.isDark=function(){return on(this.rgba)<.5},r.prototype.isLight=function(){return on(this.rgba)>=.5},r.prototype.toHex=function(){return e=nn(this.rgba),t=e.r,i=e.g,s=e.b,a=(n=e.a)<1?Zi(Be(255*n)):"","#"+Zi(t)+Zi(i)+Zi(s)+a;var e,t,i,s,n,a},r.prototype.toRgb=function(){return nn(this.rgba)},r.prototype.toRgbString=function(){return e=nn(this.rgba),t=e.r,i=e.g,s=e.b,(n=e.a)<1?"rgba("+t+", "+i+", "+s+", "+n+")":"rgb("+t+", "+i+", "+s+")";var e,t,i,s,n},r.prototype.toHsl=function(){return Xo(Wi(this.rgba))},r.prototype.toHslString=function(){return e=Xo(Wi(this.rgba)),t=e.h,i=e.s,s=e.l,(n=e.a)<1?"hsla("+t+", "+i+"%, "+s+"%, "+n+")":"hsl("+t+", "+i+"%, "+s+"%)";var e,t,i,s,n},r.prototype.toHsv=function(){return e=sl(this.rgba),{h:Be(e.h),s:Be(e.s),v:Be(e.v),a:Be(e.a,3)};var e},r.prototype.invert=function(){return st({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},r.prototype.saturate=function(e){return e===void 0&&(e=.1),st(an(this.rgba,e))},r.prototype.desaturate=function(e){return e===void 0&&(e=.1),st(an(this.rgba,-e))},r.prototype.grayscale=function(){return st(an(this.rgba,-1))},r.prototype.lighten=function(e){return e===void 0&&(e=.1),st(qo(this.rgba,e))},r.prototype.darken=function(e){return e===void 0&&(e=.1),st(qo(this.rgba,-e))},r.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},r.prototype.alpha=function(e){return typeof e=="number"?st({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):Be(this.rgba.a,3);var t},r.prototype.hue=function(e){var t=Wi(this.rgba);return typeof e=="number"?st({h:e,s:t.s,l:t.l,a:t.a}):Be(t.h)},r.prototype.isEqual=function(e){return this.toHex()===st(e).toHex()},r}(),st=function(r){return r instanceof Bn?r:new Bn(r)},Ko=[],Bu=function(r){r.forEach(function(e){Ko.indexOf(e)<0&&(e(Bn,In),Ko.push(e))})};function Du(r,e){var t={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},i={};for(var s in t)i[t[s]]=s;var n={};r.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var o,h,l=i[this.toHex()];if(l)return l;if(a?.closest){var c=this.toRgb(),u=1/0,d="black";if(!n.length)for(var p in t)n[p]=new r(t[p]).toRgb();for(var f in t){var g=(o=c,h=n[f],Math.pow(o.r-h.r,2)+Math.pow(o.g-h.g,2)+Math.pow(o.b-h.b,2));g<u&&(u=g,d=f)}return d}},e.string.push([function(a){var o=a.toLowerCase(),h=o==="transparent"?"#0000":t[o];return h?new r(h).toRgb():null},"name"])}Bu([Du]);const li=class xs{constructor(e=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=e}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(e){return this.value=e,this}set value(e){if(e instanceof xs)this._value=this.cloneSource(e._value),this._int=e._int,this._components.set(e._components);else{if(e===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,e))&&(this.normalize(e),this._value=this.cloneSource(e))}}get value(){return this._value}cloneSource(e){return typeof e=="string"||typeof e=="number"||e instanceof Number||e===null?e:Array.isArray(e)||ArrayBuffer.isView(e)?e.slice(0):typeof e=="object"&&e!==null?{...e}:e}isSourceEqual(e,t){const i=typeof e;if(i!==typeof t)return!1;if(i==="number"||i==="string"||e instanceof Number)return e===t;if(Array.isArray(e)&&Array.isArray(t)||ArrayBuffer.isView(e)&&ArrayBuffer.isView(t))return e.length!==t.length?!1:e.every((s,n)=>s===t[n]);if(e!==null&&t!==null){const s=Object.keys(e),n=Object.keys(t);return s.length!==n.length?!1:s.every(a=>e[a]===t[a])}return e===t}toRgba(){const[e,t,i,s]=this._components;return{r:e,g:t,b:i,a:s}}toRgb(){const[e,t,i]=this._components;return{r:e,g:t,b:i}}toRgbaString(){const[e,t,i]=this.toUint8RgbArray();return`rgba(${e},${t},${i},${this.alpha})`}toUint8RgbArray(e){const[t,i,s]=this._components;return e=e??[],e[0]=Math.round(t*255),e[1]=Math.round(i*255),e[2]=Math.round(s*255),e}toRgbArray(e){e=e??[];const[t,i,s]=this._components;return e[0]=t,e[1]=i,e[2]=s,e}toNumber(){return this._int}toLittleEndianNumber(){const e=this._int;return(e>>16)+(e&65280)+((e&255)<<16)}multiply(e){const[t,i,s,n]=xs.temp.setValue(e)._components;return this._components[0]*=t,this._components[1]*=i,this._components[2]*=s,this._components[3]*=n,this.refreshInt(),this._value=null,this}premultiply(e,t=!0){return t&&(this._components[0]*=e,this._components[1]*=e,this._components[2]*=e),this._components[3]=e,this.refreshInt(),this._value=null,this}toPremultiplied(e,t=!0){if(e===1)return(255<<24)+this._int;if(e===0)return t?0:this._int;let i=this._int>>16&255,s=this._int>>8&255,n=this._int&255;return t&&(i=i*e+.5|0,s=s*e+.5|0,n=n*e+.5|0),(e*255<<24)+(i<<16)+(s<<8)+n}toHex(){const e=this._int.toString(16);return`#${"000000".substring(0,6-e.length)+e}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(e){return this._components[3]=this._clamp(e),this}round(e){const[t,i,s]=this._components;return this._components[0]=Math.round(t*e)/e,this._components[1]=Math.round(i*e)/e,this._components[2]=Math.round(s*e)/e,this.refreshInt(),this._value=null,this}toArray(e){e=e??[];const[t,i,s,n]=this._components;return e[0]=t,e[1]=i,e[2]=s,e[3]=n,e}normalize(e){let t,i,s,n;if((typeof e=="number"||e instanceof Number)&&e>=0&&e<=16777215){const a=e;t=(a>>16&255)/255,i=(a>>8&255)/255,s=(a&255)/255,n=1}else if((Array.isArray(e)||e instanceof Float32Array)&&e.length>=3&&e.length<=4)e=this._clamp(e),[t,i,s,n=1]=e;else if((e instanceof Uint8Array||e instanceof Uint8ClampedArray)&&e.length>=3&&e.length<=4)e=this._clamp(e,0,255),[t,i,s,n=255]=e,t/=255,i/=255,s/=255,n/=255;else if(typeof e=="string"||typeof e=="object"){if(typeof e=="string"){const o=xs.HEX_PATTERN.exec(e);o&&(e=`#${o[2]}`)}const a=st(e);a.isValid()&&({r:t,g:i,b:s,a:n}=a.rgba,t/=255,i/=255,s/=255)}if(t!==void 0)this._components[0]=t,this._components[1]=i,this._components[2]=s,this._components[3]=n,this.refreshInt();else throw new Error(`Unable to convert color ${e}`)}refreshInt(){this._clamp(this._components);const[e,t,i]=this._components;this._int=(e*255<<16)+(t*255<<8)+(i*255|0)}_clamp(e,t=0,i=1){return typeof e=="number"?Math.min(Math.max(e,t),i):(e.forEach((s,n)=>{e[n]=Math.min(Math.max(s,t),i)}),e)}};li.shared=new li,li.temp=new li,li.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let _e=li;function Wg(r,e=[]){return de("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),_e.shared.setValue(r).toRgbArray(e)}function Fu(r){return de("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),_e.shared.setValue(r).toHex()}function zg(r){return de("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),_e.shared.setValue(r).toNumber()}function Lu(r){return de("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),_e.shared.setValue(r).toNumber()}function Ou(){const r=[],e=[];for(let i=0;i<32;i++)r[i]=i,e[i]=i;r[oe.NORMAL_NPM]=oe.NORMAL,r[oe.ADD_NPM]=oe.ADD,r[oe.SCREEN_NPM]=oe.SCREEN,e[oe.NORMAL]=oe.NORMAL_NPM,e[oe.ADD]=oe.ADD_NPM,e[oe.SCREEN]=oe.SCREEN_NPM;const t=[];return t.push(e),t.push(r),t}const nl=Ou();function al(r,e){return nl[e?1:0][r]}function $g(r,e,t,i=!0){return de("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),_e.shared.setValue(r).premultiply(e,i).toArray(t??new Float32Array(4))}function Vg(r,e){return de("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),_e.shared.setValue(r).toPremultiplied(e)}function Xg(r,e,t,i=!0){return de("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),_e.shared.setValue(r).premultiply(e,i).toArray(t??new Float32Array(4))}function ku(r,e=null){const t=r*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${t}`);for(let i=0,s=0;i<t;i+=6,s+=4)e[i+0]=s+0,e[i+1]=s+1,e[i+2]=s+2,e[i+3]=s+0,e[i+4]=s+2,e[i+5]=s+3;return e}function ol(r){if(r.BYTES_PER_ELEMENT===4)return r instanceof Float32Array?"Float32Array":r instanceof Uint32Array?"Uint32Array":"Int32Array";if(r.BYTES_PER_ELEMENT===2){if(r instanceof Uint16Array)return"Uint16Array"}else if(r.BYTES_PER_ELEMENT===1&&r instanceof Uint8Array)return"Uint8Array";return null}function Ms(r){return r+=r===0?1:0,--r,r|=r>>>1,r|=r>>>2,r|=r>>>4,r|=r>>>8,r|=r>>>16,r+1}function Jo(r){return!(r&r-1)&&!!r}function Zo(r){let e=(r>65535?1:0)<<4;r>>>=e;let t=(r>255?1:0)<<3;return r>>>=t,e|=t,t=(r>15?1:0)<<2,r>>>=t,e|=t,t=(r>3?1:0)<<1,r>>>=t,e|=t,e|r>>1}function yi(r,e,t){const i=r.length;let s;if(e>=i||t===0)return;t=e+t>i?i-e:t;const n=i-t;for(s=e;s<n;++s)r[s]=r[s+t];r.length=n}function It(r){return r===0?0:r<0?-1:1}let Nu=0;function Kt(){return++Nu}const Dn=class{constructor(r,e,t,i){this.left=r,this.top=e,this.right=t,this.bottom=i}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Dn.EMPTY=new Dn(0,0,0,0);let Qo=Dn;const eh={},Ne=Object.create(null),ze=Object.create(null);function jg(){let r;for(r in Ne)Ne[r].destroy();for(r in ze)ze[r].destroy()}function Yg(){let r;for(r in Ne)delete Ne[r];for(r in ze)delete ze[r]}class Uu{constructor(e,t,i){this._canvas=j.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=i||j.RESOLUTION,this.resize(e,t)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(e,t){this._checkDestroyed(),this._canvas.width=Math.round(e*this.resolution),this._canvas.height=Math.round(t*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(e){this._checkDestroyed(),this._canvas.width=Math.round(e)}get height(){return this._checkDestroyed(),this._canvas.height}set height(e){this._checkDestroyed(),this._canvas.height=Math.round(e)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function th(r,e,t){for(let i=0,s=4*t*e;i<e;++i,s+=4)if(r[s+3]!==0)return!1;return!0}function ih(r,e,t,i,s){const n=4*e;for(let a=i,o=i*n+4*t;a<=s;++a,o+=n)if(r[o+3]!==0)return!1;return!0}function Gu(r){const{width:e,height:t}=r,i=r.getContext("2d",{willReadFrequently:!0});if(i===null)throw new TypeError("Failed to get canvas 2D context");const s=i.getImageData(0,0,e,t).data;let n=0,a=0,o=e-1,h=t-1;for(;a<t&&th(s,e,a);)++a;if(a===t)return Qo.EMPTY;for(;th(s,e,h);)--h;for(;ih(s,e,n,a,h);)++n;for(;ih(s,e,o,a,h);)--o;return++o,++h,new Qo(n,a,o,h)}function Hu(r){const e=Gu(r),{width:t,height:i}=e;let s=null;if(!e.isEmpty()){const n=r.getContext("2d");if(n===null)throw new TypeError("Failed to get canvas 2D context");s=n.getImageData(e.left,e.top,t,i)}return{width:t,height:i,data:s}}function Wu(r,e=globalThis.location){if(r.startsWith("data:"))return"";e=e||globalThis.location;const t=new URL(r,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function bt(r,e=1){const t=j.RETINA_PREFIX?.exec(r);return t?parseFloat(t[1]):e}var V=(r=>(r.Renderer="renderer",r.Application="application",r.RendererSystem="renderer-webgl-system",r.RendererPlugin="renderer-webgl-plugin",r.CanvasRendererSystem="renderer-canvas-system",r.CanvasRendererPlugin="renderer-canvas-plugin",r.Asset="asset",r.LoadParser="load-parser",r.ResolveParser="resolve-parser",r.CacheParser="cache-parser",r.DetectionParser="detection-parser",r))(V||{});const Fn=r=>{if(typeof r=="function"||typeof r=="object"&&r.extension){if(!r.extension)throw new Error("Extension class must have an extension object");r={...typeof r.extension!="object"?{type:r.extension}:r.extension,ref:r}}if(typeof r=="object")r={...r};else throw new Error("Invalid extension type");return typeof r.type=="string"&&(r.type=[r.type]),r},sh=(r,e)=>Fn(r).priority??e,Z={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...r){return r.map(Fn).forEach(e=>{e.type.forEach(t=>this._removeHandlers[t]?.(e))}),this},add(...r){return r.map(Fn).forEach(e=>{e.type.forEach(t=>{const i=this._addHandlers,s=this._queue;i[t]?i[t]?.(e):(s[t]=s[t]||[],s[t]?.push(e))})}),this},handle(r,e,t){const i=this._addHandlers,s=this._removeHandlers;if(i[r]||s[r])throw new Error(`Extension type ${r} already has a handler`);i[r]=e,s[r]=t;const n=this._queue;return n[r]&&(n[r]?.forEach(a=>e(a)),delete n[r]),this},handleByMap(r,e){return this.handle(r,t=>{t.name&&(e[t.name]=t.ref)},t=>{t.name&&delete e[t.name]})},handleByList(r,e,t=-1){return this.handle(r,i=>{e.includes(i.ref)||(e.push(i.ref),e.sort((s,n)=>sh(n,t)-sh(s,t)))},i=>{const s=e.indexOf(i.ref);s!==-1&&e.splice(s,1)})}};class Ln{constructor(e){typeof e=="number"?this.rawBinaryData=new ArrayBuffer(e):e instanceof Uint8Array?this.rawBinaryData=e.buffer:this.rawBinaryData=e,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(e){return this[`${e}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${e} isn't a valid view type`)}}}const zu=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function $u(r){let e="";for(let t=0;t<r;++t)t>0&&(e+=`
else `),t<r-1&&(e+=`if(test == ${t}.0){}`);return e}function Vu(r,e){if(r===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const t=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=zu.replace(/%forloop%/gi,$u(r));if(e.shaderSource(t,i),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))r=r/2|0;else break}return r}const hn=0,ln=1,cn=2,un=3,dn=4,pn=5;class dt{constructor(){this.data=0,this.blendMode=oe.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<hn)}set blend(e){!!(this.data&1<<hn)!==e&&(this.data^=1<<hn)}get offsets(){return!!(this.data&1<<ln)}set offsets(e){!!(this.data&1<<ln)!==e&&(this.data^=1<<ln)}get culling(){return!!(this.data&1<<cn)}set culling(e){!!(this.data&1<<cn)!==e&&(this.data^=1<<cn)}get depthTest(){return!!(this.data&1<<un)}set depthTest(e){!!(this.data&1<<un)!==e&&(this.data^=1<<un)}get depthMask(){return!!(this.data&1<<pn)}set depthMask(e){!!(this.data&1<<pn)!==e&&(this.data^=1<<pn)}get clockwiseFrontFace(){return!!(this.data&1<<dn)}set clockwiseFrontFace(e){!!(this.data&1<<dn)!==e&&(this.data^=1<<dn)}get blendMode(){return this._blendMode}set blendMode(e){this.blend=e!==oe.NONE,this._blendMode=e}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){this.offsets=!!e,this._polygonOffset=e}static for2d(){const e=new dt;return e.depthTest=!1,e.blend=!0,e}}dt.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const On=[];function hl(r,e){if(!r)return null;let t="";if(typeof r=="string"){const i=/\.(\w{3,4})(?:$|\?|#)/i.exec(r);i&&(t=i[1].toLowerCase())}for(let i=On.length-1;i>=0;--i){const s=On[i];if(s.test&&s.test(r,t))return new s(r,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class et{constructor(e){this.items=[],this._name=e,this._aliasCount=0}emit(e,t,i,s,n,a,o,h){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let u=0,d=c.length;u<d;u++)c[u][l](e,t,i,s,n,a,o,h);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this}remove(e){const t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this}contains(e){return this.items.includes(e)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(et.prototype,{dispatch:{value:et.prototype.emit},run:{value:et.prototype.emit}});class zi{constructor(e=0,t=0){this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new et("setRealSize"),this.onUpdate=new et("update"),this.onError=new et("onError")}bind(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)}resize(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(e,t,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(e,t){return!1}}class $s extends zi{constructor(e,t){const{width:i,height:s}=t||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=e,this.unpackAlignment=t.unpackAlignment??4}upload(e,t,i){const s=e.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Ue.UNPACK);const n=t.realWidth,a=t.realHeight;return i.width===n&&i.height===a?s.texSubImage2D(t.target,0,0,0,n,a,t.format,i.type,this.data):(i.width=n,i.height=a,s.texImage2D(t.target,0,i.internalFormat,n,a,0,t.format,i.type,this.data)),!0}dispose(){this.data=null}static test(e){return e===null||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array}}const Xu={scaleMode:gt.NEAREST,alphaMode:Ue.NPM},kn=class ci extends $i{constructor(e=null,t=null){super(),t=Object.assign({},ci.defaultOptions,t);const{alphaMode:i,mipmap:s,anisotropicLevel:n,scaleMode:a,width:o,height:h,wrapMode:l,format:c,type:u,target:d,resolution:p,resourceOptions:f}=t;e&&!(e instanceof zi)&&(e=hl(e,f),e.internal=!0),this.resolution=p||j.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((h||0)*this.resolution)/this.resolution,this._mipmap=s,this.anisotropicLevel=n,this._wrapMode=l,this._scaleMode=a,this.format=c,this.type=u,this.target=d,this.alphaMode=i,this.uid=Kt(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&h>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(e)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(e){this._mipmap!==e&&(this._mipmap=e,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(e){this._scaleMode!==e&&(this._scaleMode=e,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(e){this._wrapMode!==e&&(this._wrapMode=e,this.dirtyStyleId++)}setStyle(e,t){let i;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,i=!0),t!==void 0&&t!==this.mipmap&&(this.mipmap=t,i=!0),i&&this.dirtyStyleId++,this}setSize(e,t,i){return i=i||this.resolution,this.setRealSize(e*i,t*i,i)}setRealSize(e,t,i){return this.resolution=i||this.resolution,this.width=Math.round(e)/this.resolution,this.height=Math.round(t)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Jo(this.realWidth)&&Jo(this.realHeight)}setResolution(e){const t=this.resolution;return t===e?this:(this.resolution=e,this.valid&&(this.width=Math.round(this.width*t)/e,this.height=Math.round(this.height*t)/e,this.emit("update",this)),this._refreshPOT(),this)}setResource(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(e){this.emit("error",this,e)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete ze[this.cacheId],delete Ne[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),ci.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(e,t,i=j.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let n=null;if(s)n=e;else{if(!e._pixiId){const o=t?.pixiIdPrefix||"pixiid";e._pixiId=`${o}_${Kt()}`}n=e._pixiId}let a=ze[n];if(s&&i&&!a)throw new Error(`The cacheId "${n}" does not exist in BaseTextureCache.`);return a||(a=new ci(e,t),a.cacheId=n,ci.addToCache(a,n)),a}static fromBuffer(e,t,i,s){e=e||new Float32Array(t*i*4);const n=new $s(e,{width:t,height:i,...s?.resourceOptions});let a,o;return e instanceof Float32Array?(a=W.RGBA,o=ae.FLOAT):e instanceof Int32Array?(a=W.RGBA_INTEGER,o=ae.INT):e instanceof Uint32Array?(a=W.RGBA_INTEGER,o=ae.UNSIGNED_INT):e instanceof Int16Array?(a=W.RGBA_INTEGER,o=ae.SHORT):e instanceof Uint16Array?(a=W.RGBA_INTEGER,o=ae.UNSIGNED_SHORT):e instanceof Int8Array?(a=W.RGBA,o=ae.BYTE):(a=W.RGBA,o=ae.UNSIGNED_BYTE),n.internal=!0,new ci(n,Object.assign({},Xu,{type:o,format:a},s))}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),ze[t]&&ze[t]!==e&&console.warn(`BaseTexture added to the cache with an id [${t}] that already had an entry`),ze[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=ze[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete ze[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)delete ze[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}};kn.defaultOptions={mipmap:ut.POW2,anisotropicLevel:0,scaleMode:gt.LINEAR,wrapMode:Dt.CLAMP,alphaMode:Ue.UNPACK,target:gi.TEXTURE_2D,format:W.RGBA,type:ae.UNSIGNED_BYTE},kn._globalBatch=0;let ce=kn;class Nn{constructor(){this.texArray=null,this.blend=0,this.type=ht.TRIANGLES,this.start=0,this.size=0,this.data=null}}let ju=0;class Ce{constructor(e,t=!0,i=!1){this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=t,this.id=ju++,this.disposeRunner=new et("disposeBuffer")}update(e){e instanceof Array&&(e=new Float32Array(e)),this.data=e||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(e){this.type=e?lt.ELEMENT_ARRAY_BUFFER:lt.ARRAY_BUFFER}get index(){return this.type===lt.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new Ce(e)}}class Rs{constructor(e,t=0,i=!1,s=ae.FLOAT,n,a,o,h=1){this.buffer=e,this.size=t,this.normalized=i,this.type=s,this.stride=n,this.start=a,this.instance=o,this.divisor=h}destroy(){this.buffer=null}static from(e,t,i,s,n){return new Rs(e,t,i,s,n)}}const Yu={Float32Array,Uint32Array,Int32Array,Uint8Array};function qu(r,e){let t=0,i=0;const s={};for(let h=0;h<r.length;h++)i+=e[h],t+=r[h].length;const n=new ArrayBuffer(t*4);let a=null,o=0;for(let h=0;h<r.length;h++){const l=e[h],c=r[h],u=ol(c);s[u]||(s[u]=new Yu[u](n)),a=s[u];for(let d=0;d<c.length;d++){const p=(d/l|0)*i+o,f=d%l;a[p+f]=c[d]}o+=l}return new Float32Array(n)}const rh={5126:4,5123:2,5121:1};let Ku=0;const Ju={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ft{constructor(e=[],t={}){this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Ku++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new et("disposeGeometry"),this.refCount=0}addAttribute(e,t,i=0,s=!1,n,a,o,h=!1){if(!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Ce||(t instanceof Array&&(t=new Float32Array(t)),t=new Ce(t));const l=e.split("|");if(l.length>1){for(let u=0;u<l.length;u++)this.addAttribute(l[u],t,i,s,n);return this}let c=this.buffers.indexOf(t);return c===-1&&(this.buffers.push(t),c=this.buffers.length-1),this.attributes[e]=new Rs(c,i,s,n,a,o,h),this.instanced=this.instanced||h,this}getAttribute(e){return this.attributes[e]}getBuffer(e){return this.buffers[this.getAttribute(e).buffer]}addIndex(e){return e instanceof Ce||(e instanceof Array&&(e=new Uint16Array(e)),e=new Ce(e)),e.type=lt.ELEMENT_ARRAY_BUFFER,this.indexBuffer=e,this.buffers.includes(e)||this.buffers.push(e),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const e=[],t=[],i=new Ce;let s;for(s in this.attributes){const n=this.attributes[s],a=this.buffers[n.buffer];e.push(a.data),t.push(n.size*rh[n.type]/4),n.buffer=0}for(i.data=qu(e,t),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const e in this.attributes){const t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const e=new Ft;for(let t=0;t<this.buffers.length;t++)e.buffers[t]=new Ce(this.buffers[t].data.slice(0));for(const t in this.attributes){const i=this.attributes[t];e.attributes[t]=new Rs(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.type=lt.ELEMENT_ARRAY_BUFFER),e}static merge(e){const t=new Ft,i=[],s=[],n=[];let a;for(let o=0;o<e.length;o++){a=e[o];for(let h=0;h<a.buffers.length;h++)s[h]=s[h]||0,s[h]+=a.buffers[h].data.length,n[h]=0}for(let o=0;o<a.buffers.length;o++)i[o]=new Ju[ol(a.buffers[o].data)](s[o]),t.buffers[o]=new Ce(i[o]);for(let o=0;o<e.length;o++){a=e[o];for(let h=0;h<a.buffers.length;h++)i[h].set(a.buffers[h].data,n[h]),n[h]+=a.buffers[h].data.length}if(t.attributes=a.attributes,a.indexBuffer){t.indexBuffer=t.buffers[a.buffers.indexOf(a.indexBuffer)],t.indexBuffer.type=lt.ELEMENT_ARRAY_BUFFER;let o=0,h=0,l=0,c=0;for(let u=0;u<a.buffers.length;u++)if(a.buffers[u]!==a.indexBuffer){c=u;break}for(const u in a.attributes){const d=a.attributes[u];(d.buffer|0)===c&&(h+=d.size*rh[d.type]/4)}for(let u=0;u<e.length;u++){const d=e[u].indexBuffer.data;for(let p=0;p<d.length;p++)t.indexBuffer.data[p+l]+=o;o+=e[u].buffers[c].data.length/h,l+=d.length}}return t}}class ll extends Ft{constructor(e=!1){super(),this._buffer=new Ce(null,e,!1),this._indexBuffer=new Ce(null,e,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,ae.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,ae.FLOAT).addAttribute("aColor",this._buffer,4,!0,ae.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,ae.FLOAT).addIndex(this._indexBuffer)}}const Ps=Math.PI*2,Zu=180/Math.PI,Qu=Math.PI/180;var Le=(r=>(r[r.POLY=0]="POLY",r[r.RECT=1]="RECT",r[r.CIRC=2]="CIRC",r[r.ELIP=3]="ELIP",r[r.RREC=4]="RREC",r))(Le||{});class ye{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}clone(){return new ye(this.x,this.y)}copyFrom(e){return this.set(e.x,e.y),this}copyTo(e){return e.set(this.x,this.y),e}equals(e){return e.x===this.x&&e.y===this.y}set(e=0,t=e){return this.x=e,this.y=t,this}}ye.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Qi=[new ye,new ye,new ye,new ye];class le{constructor(e=0,t=0,i=0,s=0){this.x=Number(e),this.y=Number(t),this.width=Number(i),this.height=Number(s),this.type=Le.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new le(0,0,0,0)}clone(){return new le(this.x,this.y,this.width,this.height)}copyFrom(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this}copyTo(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e}contains(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height}intersects(e,t){if(!t){const F=this.x<e.x?e.x:this.x;if((this.right>e.right?e.right:this.right)<=F)return!1;const U=this.y<e.y?e.y:this.y;return(this.bottom>e.bottom?e.bottom:this.bottom)>U}const i=this.left,s=this.right,n=this.top,a=this.bottom;if(s<=i||a<=n)return!1;const o=Qi[0].set(e.left,e.top),h=Qi[1].set(e.left,e.bottom),l=Qi[2].set(e.right,e.top),c=Qi[3].set(e.right,e.bottom);if(l.x<=o.x||h.y<=o.y)return!1;const u=Math.sign(t.a*t.d-t.b*t.c);if(u===0||(t.apply(o,o),t.apply(h,h),t.apply(l,l),t.apply(c,c),Math.max(o.x,h.x,l.x,c.x)<=i||Math.min(o.x,h.x,l.x,c.x)>=s||Math.max(o.y,h.y,l.y,c.y)<=n||Math.min(o.y,h.y,l.y,c.y)>=a))return!1;const d=u*(h.y-o.y),p=u*(o.x-h.x),f=d*i+p*n,g=d*s+p*n,m=d*i+p*a,y=d*s+p*a;if(Math.max(f,g,m,y)<=d*o.x+p*o.y||Math.min(f,g,m,y)>=d*c.x+p*c.y)return!1;const S=u*(o.y-l.y),_=u*(l.x-o.x),E=S*i+_*n,w=S*s+_*n,B=S*i+_*a,v=S*s+_*a;return!(Math.max(E,w,B,v)<=S*o.x+_*o.y||Math.min(E,w,B,v)>=S*c.x+_*c.y)}pad(e=0,t=e){return this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this}fit(e){const t=Math.max(this.x,e.x),i=Math.min(this.x+this.width,e.x+e.width),s=Math.max(this.y,e.y),n=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(i-t,0),this.y=s,this.height=Math.max(n-s,0),this}ceil(e=1,t=.001){const i=Math.ceil((this.x+this.width-t)*e)/e,s=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=i-this.x,this.height=s-this.y,this}enlarge(e){const t=Math.min(this.x,e.x),i=Math.max(this.x+this.width,e.x+e.width),s=Math.min(this.y,e.y),n=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=i-t,this.y=s,this.height=n-s,this}}le.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Vs{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.radius=i,this.type=Le.CIRC}clone(){return new Vs(this.x,this.y,this.radius)}contains(e,t){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-e,n=this.y-t;return s*=s,n*=n,s+n<=i}getBounds(){return new le(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}Vs.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class Xs{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.width=i,this.height=s,this.type=Le.ELIP}clone(){return new Xs(this.x,this.y,this.width,this.height)}contains(e,t){if(this.width<=0||this.height<=0)return!1;let i=(e-this.x)/this.width,s=(t-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new le(this.x-this.width,this.y-this.height,this.width,this.height)}}Xs.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class Yt{constructor(...e){let t=Array.isArray(e[0])?e[0]:e;if(typeof t[0]!="number"){const i=[];for(let s=0,n=t.length;s<n;s++)i.push(t[s].x,t[s].y);t=i}this.points=t,this.type=Le.POLY,this.closeStroke=!0}clone(){const e=this.points.slice(),t=new Yt(e);return t.closeStroke=this.closeStroke,t}contains(e,t){let i=!1;const s=this.points.length/2;for(let n=0,a=s-1;n<s;a=n++){const o=this.points[n*2],h=this.points[n*2+1],l=this.points[a*2],c=this.points[a*2+1];h>t!=c>t&&e<(l-o)*((t-h)/(c-h))+o&&(i=!i)}return i}}Yt.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((r,e)=>`${r}, ${e}`,"")}]`};class js{constructor(e=0,t=0,i=0,s=0,n=20){this.x=e,this.y=t,this.width=i,this.height=s,this.radius=n,this.type=Le.RREC}clone(){return new js(this.x,this.y,this.width,this.height,this.radius)}contains(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(t>=this.y+i&&t<=this.y+this.height-i||e>=this.x+i&&e<=this.x+this.width-i)return!0;let s=e-(this.x+i),n=t-(this.y+i);const a=i*i;if(s*s+n*n<=a||(s=e-(this.x+this.width-i),s*s+n*n<=a)||(n=t-(this.y+this.height-i),s*s+n*n<=a)||(s=e-(this.x+i),s*s+n*n<=a))return!0}return!1}}js.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class Te{constructor(e=1,t=0,i=0,s=1,n=0,a=0){this.array=null,this.a=e,this.b=t,this.c=i,this.d=s,this.tx=n,this.ty=a}fromArray(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]}set(e,t,i,s,n,a){return this.a=e,this.b=t,this.c=i,this.d=s,this.tx=n,this.ty=a,this}toArray(e,t){this.array||(this.array=new Float32Array(9));const i=t||this.array;return e?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(e,t){t=t||new ye;const i=e.x,s=e.y;return t.x=this.a*i+this.c*s+this.tx,t.y=this.b*i+this.d*s+this.ty,t}applyInverse(e,t){t=t||new ye;const i=1/(this.a*this.d+this.c*-this.b),s=e.x,n=e.y;return t.x=this.d*i*s+-this.c*i*n+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*i*n+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,t}translate(e,t){return this.tx+=e,this.ty+=t,this}scale(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),s=this.a,n=this.c,a=this.tx;return this.a=s*t-this.b*i,this.b=s*i+this.b*t,this.c=n*t-this.d*i,this.d=n*i+this.d*t,this.tx=a*t-this.ty*i,this.ty=a*i+this.ty*t,this}append(e){const t=this.a,i=this.b,s=this.c,n=this.d;return this.a=e.a*t+e.b*s,this.b=e.a*i+e.b*n,this.c=e.c*t+e.d*s,this.d=e.c*i+e.d*n,this.tx=e.tx*t+e.ty*s+this.tx,this.ty=e.tx*i+e.ty*n+this.ty,this}setTransform(e,t,i,s,n,a,o,h,l){return this.a=Math.cos(o+l)*n,this.b=Math.sin(o+l)*n,this.c=-Math.sin(o-h)*a,this.d=Math.cos(o-h)*a,this.tx=e-(i*this.a+s*this.c),this.ty=t-(i*this.b+s*this.d),this}prepend(e){const t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){const i=this.a,s=this.c;this.a=i*e.a+this.b*e.c,this.b=i*e.b+this.b*e.d,this.c=s*e.a+this.d*e.c,this.d=s*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this}decompose(e){const t=this.a,i=this.b,s=this.c,n=this.d,a=e.pivot,o=-Math.atan2(-s,n),h=Math.atan2(i,t),l=Math.abs(o+h);return l<1e-5||Math.abs(Ps-l)<1e-5?(e.rotation=h,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=h),e.scale.x=Math.sqrt(t*t+i*i),e.scale.y=Math.sqrt(s*s+n*n),e.position.x=this.tx+(a.x*t+a.y*s),e.position.y=this.ty+(a.x*i+a.y*n),e}invert(){const e=this.a,t=this.b,i=this.c,s=this.d,n=this.tx,a=e*s-t*i;return this.a=s/a,this.b=-t/a,this.c=-i/a,this.d=e/a,this.tx=(i*this.ty-s*n)/a,this.ty=-(e*this.ty-t*n)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const e=new Te;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyTo(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e}copyFrom(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this}static get IDENTITY(){return new Te}static get TEMP_MATRIX(){return new Te}}Te.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Ht=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Wt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],zt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],$t=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Un=[],cl=[],es=Math.sign;function ed(){for(let r=0;r<16;r++){const e=[];Un.push(e);for(let t=0;t<16;t++){const i=es(Ht[r]*Ht[t]+zt[r]*Wt[t]),s=es(Wt[r]*Ht[t]+$t[r]*Wt[t]),n=es(Ht[r]*zt[t]+zt[r]*$t[t]),a=es(Wt[r]*zt[t]+$t[r]*$t[t]);for(let o=0;o<16;o++)if(Ht[o]===i&&Wt[o]===s&&zt[o]===n&&$t[o]===a){e.push(o);break}}}for(let r=0;r<16;r++){const e=new Te;e.set(Ht[r],Wt[r],zt[r],$t[r],0,0),cl.push(e)}}ed();const Se={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:r=>Ht[r],uY:r=>Wt[r],vX:r=>zt[r],vY:r=>$t[r],inv:r=>r&8?r&15:-r&7,add:(r,e)=>Un[r][e],sub:(r,e)=>Un[r][Se.inv(e)],rotate180:r=>r^4,isVertical:r=>(r&3)===2,byDirection:(r,e)=>Math.abs(r)*2<=Math.abs(e)?e>=0?Se.S:Se.N:Math.abs(e)*2<=Math.abs(r)?r>0?Se.E:Se.W:e>0?r>0?Se.SE:Se.SW:r>0?Se.NE:Se.NW,matrixAppendRotationInv:(r,e,t=0,i=0)=>{const s=cl[Se.inv(e)];s.tx=t,s.ty=i,r.append(s)}};class vt{constructor(e,t,i=0,s=0){this._x=i,this._y=s,this.cb=e,this.scope=t}clone(e=this.cb,t=this.scope){return new vt(e,t,this._x,this._y)}set(e=0,t=e){return(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this}copyFrom(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this}copyTo(e){return e.set(this._x,this._y),e}equals(e){return e.x===this._x&&e.y===this._y}get x(){return this._x}set x(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))}get y(){return this._y}set y(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))}}vt.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Gn=class{constructor(){this.worldTransform=new Te,this.localTransform=new Te,this.position=new vt(this.onChange,this,0,0),this.scale=new vt(this.onChange,this,1,1),this.pivot=new vt(this.onChange,this,0,0),this.skew=new vt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const r=this.localTransform;this._localID!==this._currentLocalID&&(r.a=this._cx*this.scale.x,r.b=this._sx*this.scale.x,r.c=this._cy*this.scale.y,r.d=this._sy*this.scale.y,r.tx=this.position.x-(this.pivot.x*r.a+this.pivot.y*r.c),r.ty=this.position.y-(this.pivot.x*r.b+this.pivot.y*r.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(r){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==r._worldID){const t=r.worldTransform,i=this.worldTransform;i.a=e.a*t.a+e.b*t.c,i.b=e.a*t.b+e.b*t.d,i.c=e.c*t.a+e.d*t.c,i.d=e.c*t.b+e.d*t.d,i.tx=e.tx*t.a+e.ty*t.c+t.tx,i.ty=e.tx*t.b+e.ty*t.d+t.ty,this._parentID=r._worldID,this._worldID++}}setFromMatrix(r){r.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(r){this._rotation!==r&&(this._rotation=r,this.updateSkew())}};Gn.IDENTITY=new Gn;let va=Gn;va.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var td=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,id=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function nh(r,e,t){const i=r.createShader(e);return r.shaderSource(i,t),r.compileShader(i),i}function fn(r){const e=new Array(r);for(let t=0;t<e.length;t++)e[t]=!1;return e}function ul(r,e){switch(r){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return fn(2*e);case"bvec3":return fn(3*e);case"bvec4":return fn(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const vi=[{test:r=>r.type==="float"&&r.size===1&&!r.isArray,code:r=>`
            if(uv["${r}"] !== ud["${r}"].value)
            {
                ud["${r}"].value = uv["${r}"]
                gl.uniform1f(ud["${r}"].location, uv["${r}"])
            }
            `},{test:(r,e)=>(r.type==="sampler2D"||r.type==="samplerCube"||r.type==="sampler2DArray")&&r.size===1&&!r.isArray&&(e==null||e.castToBaseTexture!==void 0),code:r=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${r}"], t);

            if(ud["${r}"].value !== t)
            {
                ud["${r}"].value = t;
                gl.uniform1i(ud["${r}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(r,e)=>r.type==="mat3"&&r.size===1&&!r.isArray&&e.a!==void 0,code:r=>`
            gl.uniformMatrix3fv(ud["${r}"].location, false, uv["${r}"].toArray(true));
            `,codeUbo:r=>`
                var ${r}_matrix = uv.${r}.toArray(true);

                data[offset] = ${r}_matrix[0];
                data[offset+1] = ${r}_matrix[1];
                data[offset+2] = ${r}_matrix[2];
        
                data[offset + 4] = ${r}_matrix[3];
                data[offset + 5] = ${r}_matrix[4];
                data[offset + 6] = ${r}_matrix[5];
        
                data[offset + 8] = ${r}_matrix[6];
                data[offset + 9] = ${r}_matrix[7];
                data[offset + 10] = ${r}_matrix[8];
            `},{test:(r,e)=>r.type==="vec2"&&r.size===1&&!r.isArray&&e.x!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${r}"].location, v.x, v.y);
                }`,codeUbo:r=>`
                v = uv.${r};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:r=>r.type==="vec2"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${r}"].location, v[0], v[1]);
                }
            `},{test:(r,e)=>r.type==="vec4"&&r.size===1&&!r.isArray&&e.width!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${r}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(r,e)=>r.type==="vec4"&&r.size===1&&!r.isArray&&e.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${r}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(r,e)=>r.type==="vec3"&&r.size===1&&!r.isArray&&e.red!==void 0,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${r}"].location, v.red, v.green, v.blue)
                }`,codeUbo:r=>`
                    v = uv.${r};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:r=>r.type==="vec4"&&r.size===1&&!r.isArray,code:r=>`
                cv = ud["${r}"].value;
                v = uv["${r}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${r}"].location, v[0], v[1], v[2], v[3])
                }`}],sd={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},rd={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function nd(r,e){const t=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const i in r.uniforms){const s=e[i];if(!s){r.uniforms[i]?.group===!0&&(r.uniforms[i].ubo?t.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');
                    `):t.push(`
                        renderer.shader.syncUniformGroup(uv.${i}, syncData);
                    `));continue}const n=r.uniforms[i];let a=!1;for(let o=0;o<vi.length;o++)if(vi[o].test(s,n)){t.push(vi[o].code(i,n)),a=!0;break}if(!a){const o=(s.size===1&&!s.isArray?sd:rd)[s.type].replace("location",`ud["${i}"].location`);t.push(`
            cu = ud["${i}"];
            cv = cu.value;
            v = uv["${i}"];
            ${o};`)}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}const dl={};let ts=dl;function ad(){if(ts===dl||ts?.isContextLost()){const r=j.ADAPTER.createCanvas();let e;j.PREFER_ENV>=Qt.WEBGL2&&(e=r.getContext("webgl2",{})),e||(e=r.getContext("webgl",{})||r.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),ts=e}return ts}let is;function od(){if(!is){is=Ve.MEDIUM;const r=ad();if(r&&r.getShaderPrecisionFormat){const e=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);e&&(is=e.precision?Ve.HIGH:Ve.MEDIUM)}}return is}function ah(r,e){const t=r.getShaderSource(e).split(`
`).map((l,c)=>`${c}: ${l}`),i=r.getShaderInfoLog(e),s=i.split(`
`),n={},a=s.map(l=>parseFloat(l.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(l=>l&&!n[l]?(n[l]=!0,!0):!1),o=[""];a.forEach(l=>{t[l-1]=`%c${t[l-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const h=t.join(`
`);o[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function hd(r,e,t,i){r.getProgramParameter(e,r.LINK_STATUS)||(r.getShaderParameter(t,r.COMPILE_STATUS)||ah(r,t),r.getShaderParameter(i,r.COMPILE_STATUS)||ah(r,i),console.error("PixiJS Error: Could not initialize shader."),r.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",r.getProgramInfoLog(e)))}const ld={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function pl(r){return ld[r]}let ss=null;const oh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function fl(r,e){if(!ss){const t=Object.keys(oh);ss={};for(let i=0;i<t.length;++i){const s=t[i];ss[r[s]]=oh[s]}}return ss[e]}function hh(r,e,t){if(r.substring(0,9)!=="precision"){let i=e;return e===Ve.HIGH&&t!==Ve.HIGH&&(i=Ve.MEDIUM),`precision ${i} float;
${r}`}else if(t!==Ve.HIGH&&r.substring(0,15)==="precision highp")return r.replace("precision highp","precision mediump");return r}let Ci;function cd(){if(typeof Ci=="boolean")return Ci;try{Ci=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Ci=!1}return Ci}let ud=0;const rs={},Hn=class ui{constructor(e,t,i="pixi-shader",s={}){this.extra={},this.id=ud++,this.vertexSrc=e||ui.defaultVertexSrc,this.fragmentSrc=t||ui.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,this.vertexSrc.substring(0,8)!=="#version"&&(i=i.replace(/\s+/g,"-"),rs[i]?(rs[i]++,i+=`-${rs[i]}`):rs[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}
${this.fragmentSrc}`,this.vertexSrc=hh(this.vertexSrc,ui.defaultVertexPrecision,Ve.HIGH),this.fragmentSrc=hh(this.fragmentSrc,ui.defaultFragmentPrecision,od())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return id}static get defaultFragmentSrc(){return td}static from(e,t,i){const s=e+t;let n=eh[s];return n||(eh[s]=n=new ui(e,t,i)),n}};Hn.defaultVertexPrecision=Ve.HIGH,Hn.defaultFragmentPrecision=yt.apple.device?Ve.HIGH:Ve.MEDIUM;let xt=Hn,dd=0;class tt{constructor(e,t,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=dd++,this.static=!!t,this.ubo=!!i,e instanceof Ce?(this.buffer=e,this.buffer.type=lt.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=e,this.ubo&&(this.buffer=new Ce(new Float32Array(1)),this.buffer.type=lt.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(e,t,i){if(!this.ubo)this.uniforms[e]=new tt(t,i);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(e,t,i){return new tt(e,t,i)}static uboFrom(e,t){return new tt(e,t??!0,!0)}}class ct{constructor(e,t){this.uniformBindCount=0,this.program=e,t?t instanceof tt?this.uniformGroup=t:this.uniformGroup=new tt(t):this.uniformGroup=new tt({}),this.disposeRunner=new et("disposeShader")}checkUniformExists(e,t){if(t.uniforms[e])return!0;for(const i in t.uniforms){const s=t.uniforms[i];if(s.group===!0&&this.checkUniformExists(e,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(e,t,i){const s=xt.from(e,t);return new ct(s,i)}}class pd{constructor(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},!t.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!t.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(e){if(!this.programCache[e]){const i=new Int32Array(e);for(let n=0;n<e;n++)i[n]=n;this.defaultGroupCache[e]=tt.from({uSamplers:i},!0);let s=this.fragTemplate;s=s.replace(/%count%/gi,`${e}`),s=s.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new xt(this.vertexSrc,s)}const t={tint:new Float32Array([1,1,1,1]),translationMatrix:new Te,default:this.defaultGroupCache[e]};return new ct(this.programCache[e],t)}generateSampleSrc(e){let t="";t+=`
`,t+=`
`;for(let i=0;i<e;i++)i>0&&(t+=`
else `),i<e-1&&(t+=`if(vTextureId < ${i}.5)`),t+=`
{`,t+=`
	color = texture2D(uSamplers[${i}], vTextureCoord);`,t+=`
}`;return t+=`
`,t+=`
`,t}}class Wn{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let e=0;e<this.count;e++)this.elements[e]=null;this.count=0}}function fd(){return!yt.apple.device}function md(r){let e=!0;const t=j.ADAPTER.getNavigator();if(yt.tablet||yt.phone){if(yt.apple.device){const i=t.userAgent.match(/OS (\d+)_(\d+)?/);i&&parseInt(i[1],10)<11&&(e=!1)}if(yt.android.device){const i=t.userAgent.match(/Android\s([0-9.]*)/);i&&parseInt(i[1],10)<7&&(e=!1)}}return e?r:4}class Ys{constructor(e){this.renderer=e}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(e){}}var gd=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,yd=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const Di=class Je extends Ys{constructor(e){super(e),this.setShaderGenerator(),this.geometryClass=ll,this.vertexSize=6,this.state=dt.for2d(),this.size=Je.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),e.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??md(32),this._defaultMaxTextures}static set defaultMaxTextures(e){this._defaultMaxTextures=e}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??fd(),this._canUploadSameBuffer}static set canUploadSameBuffer(e){this._canUploadSameBuffer=e}get MAX_TEXTURES(){return de("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return yd}static get defaultFragmentTemplate(){return gd}setShaderGenerator({vertex:e=Je.defaultVertexSrc,fragment:t=Je.defaultFragmentTemplate}={}){this.shaderGenerator=new pd(e,t)}contextChange(){const e=this.renderer.gl;j.PREFER_ENV===Qt.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Je.defaultMaxTextures),this.maxTextures=Vu(this.maxTextures,e)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:e,_textureArrayPool:t}=Je,i=this.size/4,s=Math.floor(i/this.maxTextures)+1;for(;e.length<i;)e.push(new Nn);for(;t.length<s;)t.push(new Wn);for(let n=0;n<this.maxTextures;n++)this._tempBoundTextures[n]=null}onPrerender(){this._flushId=0}render(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)}buildTexturesAndDrawCalls(){const{_bufferedTextures:e,maxTextures:t}=this,i=Je._textureArrayPool,s=this.renderer.batch,n=this._tempBoundTextures,a=this.renderer.textureGC.count;let o=++ce._globalBatch,h=0,l=i[0],c=0;s.copyBoundTextures(n,t);for(let u=0;u<this._bufferSize;++u){const d=e[u];e[u]=null,d._batchEnabled!==o&&(l.count>=t&&(s.boundArray(l,n,o,t),this.buildDrawCalls(l,c,u),c=u,l=i[++h],++o),d._batchEnabled=o,d.touched=a,l.elements[l.count++]=d)}l.count>0&&(s.boundArray(l,n,o,t),this.buildDrawCalls(l,c,this._bufferSize),++h,++o);for(let u=0;u<n.length;u++)n[u]=null;ce._globalBatch=o}buildDrawCalls(e,t,i){const{_bufferedElements:s,_attributeBuffer:n,_indexBuffer:a,vertexSize:o}=this,h=Je._drawCallPool;let l=this._dcIndex,c=this._aIndex,u=this._iIndex,d=h[l];d.start=this._iIndex,d.texArray=e;for(let p=t;p<i;++p){const f=s[p],g=f._texture.baseTexture,m=nl[g.alphaMode?1:0][f.blendMode];s[p]=null,t<p&&d.blend!==m&&(d.size=u-d.start,t=p,d=h[++l],d.texArray=e,d.start=u),this.packInterleavedGeometry(f,n,a,c,u),c+=f.vertexData.length/2*o,u+=f.indices.length,d.blend=m}t<i&&(d.size=u-d.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=u}bindAndClearTexArray(e){const t=this.renderer.texture;for(let i=0;i<e.count;i++)t.bind(e.elements[i],e.ids[i]),e.elements[i]=null;e.count=0}updateGeometry(){const{_packedGeometries:e,_attributeBuffer:t,_indexBuffer:i}=this;Je.canUploadSameBuffer?(e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,e[this._flushId]=new this.geometryClass),e[this._flushId]._buffer.update(t.rawBinaryData),e[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(e[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const e=this._dcIndex,{gl:t,state:i}=this.renderer,s=Je._drawCallPool;let n=null;for(let a=0;a<e;a++){const{texArray:o,type:h,size:l,start:c,blend:u}=s[a];n!==o&&(n=o,this.bindAndClearTexArray(o)),this.state.blendMode=u,i.set(this.state),t.drawElements(h,l,t.UNSIGNED_SHORT,c*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),Je.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(e){const t=Ms(Math.ceil(e/8)),i=Zo(t),s=t*8;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._aBuffers[s];return n||(this._aBuffers[s]=n=new Ln(s*this.vertexSize*4)),n}getIndexBuffer(e){const t=Ms(Math.ceil(e/12)),i=Zo(t),s=t*12;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let n=this._iBuffers[i];return n||(this._iBuffers[i]=n=new Uint16Array(s)),n}packInterleavedGeometry(e,t,i,s,n){const{uint32View:a,float32View:o}=t,h=s/this.vertexSize,l=e.uvs,c=e.indices,u=e.vertexData,d=e._texture.baseTexture._batchLocation,p=Math.min(e.worldAlpha,1),f=_e.shared.setValue(e._tintRGB).toPremultiplied(p,e._texture.baseTexture.alphaMode>0);for(let g=0;g<u.length;g+=2)o[s++]=u[g],o[s++]=u[g+1],o[s++]=l[g],o[s++]=l[g+1],a[s++]=f,o[s++]=d;for(let g=0;g<c.length;g++)i[n++]=h+c[g]}};Di.defaultBatchSize=4096,Di.extension={name:"batch",type:V.RendererPlugin},Di._drawCallPool=[],Di._textureArrayPool=[];let Vt=Di;Z.add(Vt);var vd=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,xd=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const zn=class Fi extends ct{constructor(e,t,i){const s=xt.from(e||Fi.defaultVertexSrc,t||Fi.defaultFragmentSrc);super(s,i),this.padding=0,this.resolution=Fi.defaultResolution,this.multisample=Fi.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new dt}apply(e,t,i,s,n){e.applyFilter(this,t,i,s)}get blendMode(){return this.state.blendMode}set blendMode(e){this.state.blendMode=e}get resolution(){return this._resolution}set resolution(e){this._resolution=e}static get defaultVertexSrc(){return xd}static get defaultFragmentSrc(){return vd}};zn.defaultResolution=1,zn.defaultMultisample=Me.NONE;let ke=zn;class Is{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new _e(0),this.alpha=1}init(e){this.clearBeforeRender=e.clearBeforeRender;const{backgroundColor:t,background:i,backgroundAlpha:s}=e,n=i??t;n!==void 0&&(this.color=n),this.alpha=s}get color(){return this._backgroundColor.value}set color(e){this._backgroundColor.setValue(e)}get alpha(){return this._backgroundColor.alpha}set alpha(e){this._backgroundColor.setAlpha(e)}get backgroundColor(){return this._backgroundColor}destroy(){}}Is.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Is.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"background"};Z.add(Is);class ml{constructor(e){this.renderer=e,this.emptyRenderer=new Ys(e),this.currentRenderer=this.emptyRenderer}setObjectRenderer(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(e,t){const{boundTextures:i}=this.renderer.texture;for(let s=t-1;s>=0;--s)e[s]=i[s]||null,e[s]&&(e[s]._batchLocation=s)}boundArray(e,t,i,s){const{elements:n,ids:a,count:o}=e;let h=0;for(let l=0;l<o;l++){const c=n[l],u=c._batchLocation;if(u>=0&&u<s&&t[u]===c){a[l]=u;continue}for(;h<s;){const d=t[h];if(d&&d._batchEnabled===i&&d._batchLocation===h){h++;continue}a[l]=h,c._batchLocation=h,t[h]=c;break}}}destroy(){this.renderer=null}}ml.extension={type:V.RendererSystem,name:"batch"};Z.add(ml);let lh=0;class Bs{constructor(e){this.renderer=e,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=lh++}init(e){if(e.context)this.initFromContext(e.context);else{const t=this.renderer.background.alpha<1,i=e.premultipliedAlpha;this.preserveDrawingBuffer=e.preserveDrawingBuffer,this.useContextAlpha=e.useContextAlpha,this.powerPreference=e.powerPreference,this.initFromOptions({alpha:t,premultipliedAlpha:i,antialias:e.antialias,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference})}}initFromContext(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=lh++,this.renderer.runners.contextChange.emit(e);const t=this.renderer.view;t.addEventListener!==void 0&&(t.addEventListener("webglcontextlost",this.handleContextLost,!1),t.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(e){const t=this.createContext(this.renderer.view,e);this.initFromContext(t)}createContext(e,t){let i;if(j.PREFER_ENV>=Qt.WEBGL2&&(i=e.getContext("webgl2",t)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,t={loseContext:e.getExtension("WEBGL_lose_context"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,t,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,t,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this.renderer.view;this.renderer=null,e.removeEventListener!==void 0&&(e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(e){const t=e.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),t&&!t.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Bs.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Bs.extension={type:V.RendererSystem,name:"context"};Z.add(Bs);class $n{constructor(e,t){if(this.width=Math.round(e),this.height=Math.round(t),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new et("disposeFramebuffer"),this.multisample=Me.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(e=0,t){return this.colorTextures[e]=t||new ce(null,{scaleMode:gt.NEAREST,resolution:1,mipmap:ut.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(e){return this.depthTexture=e||new ce(null,{scaleMode:gt.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:ut.OFF,format:W.DEPTH_COMPONENT,type:ae.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(e,t){if(e=Math.round(e),t=Math.round(t),!e||!t)throw new Error("Framebuffer width and height must not be zero");if(!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],n=s.resolution;s.setSize(e/n,t/n)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(e/i,t/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class gl extends ce{constructor(e={}){if(typeof e=="number"){const t=arguments[0],i=arguments[1],s=arguments[2],n=arguments[3];e={width:t,height:i,scaleMode:s,resolution:n}}e.width=e.width??100,e.height=e.height??100,e.multisample??(e.multisample=Me.NONE),super(null,e),this.mipmap=ut.OFF,this.valid=!0,this._clear=new _e([0,0,0,0]),this.framebuffer=new $n(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=e.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(e){this._clear.setValue(e)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t){this.framebuffer.resize(e*this.resolution,t*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class wt extends zi{constructor(e){const t=e,i=t.naturalWidth||t.videoWidth||t.displayWidth||t.width,s=t.naturalHeight||t.videoHeight||t.displayHeight||t.height;super(i,s),this.source=e,this.noSubImage=!1}static crossOrigin(e,t,i){i===void 0&&!t.startsWith("data:")?e.crossOrigin=Wu(t):i!==!1&&(e.crossOrigin=typeof i=="string"?i:"anonymous")}upload(e,t,i,s){const n=e.gl,a=t.realWidth,o=t.realHeight;if(s=s||this.source,typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement){if(!s.complete||s.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&s instanceof HTMLVideoElement&&s.readyState<=1)return!1;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.alphaMode===Ue.UNPACK),!this.noSubImage&&t.target===n.TEXTURE_2D&&i.width===a&&i.height===o?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.format,i.type,s):(i.width=a,i.height=o,n.texImage2D(t.target,0,i.internalFormat,t.format,i.type,s)),!0}update(){if(this.destroyed)return;const e=this.source,t=e.naturalWidth||e.videoWidth||e.width,i=e.naturalHeight||e.videoHeight||e.height;this.resize(t,i),super.update()}dispose(){this.source=null}}class yl extends wt{constructor(e,t){if(t=t||{},typeof e=="string"){const i=new Image;wt.crossOrigin(i,e,t.crossorigin),i.src=e,e=i}super(e),!e.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=e.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(t.createBitmap??j.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.bitmap=null,this._load=null,t.autoLoad!==!1&&this.load()}load(e){return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise((t,i)=>{const s=this.source;this.url=s.src;const n=()=>{this.destroyed||(s.onload=null,s.onerror=null,this.update(),this._load=null,this.createBitmap?t(this.process()):t(this))};s.complete&&s.src?n():(s.onload=n,s.onerror=a=>{i(a),this.onError.emit(a)})}),this._load)}process(){const e=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const t=globalThis.createImageBitmap,i=!e.crossOrigin||e.crossOrigin==="anonymous";return this._process=fetch(e.src,{mode:i?"cors":"no-cors"}).then(s=>s.blob()).then(s=>t(s,0,0,e.width,e.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ue.UNPACK?"premultiply":"none"})).then(s=>this.destroyed?Promise.reject():(this.bitmap=s,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(e,t,i){if(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(e,t,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(e,t,i,this.bitmap),!this.preserveBitmap){let s=!0;const n=t._glTextures;for(const a in n){const o=n[a];if(o!==i&&o.dirtyId!==t.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(e){return typeof HTMLImageElement<"u"&&(typeof e=="string"||e instanceof HTMLImageElement)}}class xa{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(e,t,i){const s=t.width,n=t.height;if(i){const a=e.width/2/s,o=e.height/2/n,h=e.x/s+a,l=e.y/n+o;i=Se.add(i,Se.NW),this.x0=h+a*Se.uX(i),this.y0=l+o*Se.uY(i),i=Se.add(i,2),this.x1=h+a*Se.uX(i),this.y1=l+o*Se.uY(i),i=Se.add(i,2),this.x2=h+a*Se.uX(i),this.y2=l+o*Se.uY(i),i=Se.add(i,2),this.x3=h+a*Se.uX(i),this.y3=l+o*Se.uY(i)}else this.x0=e.x/s,this.y0=e.y/n,this.x1=(e.x+e.width)/s,this.y1=e.y/n,this.x2=(e.x+e.width)/s,this.y2=(e.y+e.height)/n,this.x3=e.x/s,this.y3=(e.y+e.height)/n;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}xa.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const ch=new xa;function ns(r){r.destroy=function(){},r.on=function(){},r.once=function(){},r.emit=function(){}}class K extends $i{constructor(e,t,i,s,n,a,o){if(super(),this.noFrame=!1,t||(this.noFrame=!0,t=new le(0,0,1,1)),e instanceof K&&(e=e.baseTexture),this.baseTexture=e,this._frame=t,this.trim=s,this.valid=!1,this.destroyed=!1,this._uvs=ch,this.uvMatrix=null,this.orig=i||t,this._rotate=Number(n||0),n===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new ye(a.x,a.y):new ye(0,0),this.defaultBorders=o,this._updateID=0,this.textureCacheIds=[],e.valid?this.noFrame?e.valid&&this.onBaseTextureUpdated(e):this.frame=t:e.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&e.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(e){if(this.baseTexture){if(e){const{resource:t}=this.baseTexture;t?.url&&Ne[t.url]&&K.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,K.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){const e=this._frame.clone(),t=this._frame===this.orig?e:this.orig.clone(),i=new K(this.baseTexture,!this.noFrame&&e,t,this.trim?.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(i._frame=e),i}updateUvs(){this._uvs===ch&&(this._uvs=new xa),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(e,t={},i=j.STRICT_TEXTURE_CACHE){const s=typeof e=="string";let n=null;if(s)n=e;else if(e instanceof ce){if(!e.cacheId){const o=t?.pixiIdPrefix||"pixiid";e.cacheId=`${o}-${Kt()}`,ce.addToCache(e,e.cacheId)}n=e.cacheId}else{if(!e._pixiId){const o=t?.pixiIdPrefix||"pixiid";e._pixiId=`${o}_${Kt()}`}n=e._pixiId}let a=Ne[n];if(s&&i&&!a)throw new Error(`The cacheId "${n}" does not exist in TextureCache.`);return!a&&!(e instanceof ce)?(t.resolution||(t.resolution=bt(e)),a=new K(new ce(e,t)),a.baseTexture.cacheId=n,ce.addToCache(a.baseTexture,n),K.addToCache(a,n)):!a&&e instanceof ce&&(a=new K(e),K.addToCache(a,n)),a}static fromURL(e,t){const i=Object.assign({autoLoad:!1},t?.resourceOptions),s=K.from(e,Object.assign({resourceOptions:i},t),!1),n=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):n.load().then(()=>Promise.resolve(s))}static fromBuffer(e,t,i,s){return new K(ce.fromBuffer(e,t,i,s))}static fromLoader(e,t,i,s){const n=new ce(e,Object.assign({scaleMode:ce.defaultOptions.scaleMode,resolution:bt(t)},s)),{resource:a}=n;a instanceof yl&&(a.url=t);const o=new K(n);return i||(i=t),ce.addToCache(o.baseTexture,i),K.addToCache(o,i),i!==t&&(ce.addToCache(o.baseTexture,t),K.addToCache(o,t)),o.baseTexture.valid?Promise.resolve(o):new Promise(h=>{o.baseTexture.once("loaded",()=>h(o))})}static addToCache(e,t){t&&(e.textureCacheIds.includes(t)||e.textureCacheIds.push(t),Ne[t]&&Ne[t]!==e&&console.warn(`Texture added to the cache with an id [${t}] that already had an entry`),Ne[t]=e)}static removeFromCache(e){if(typeof e=="string"){const t=Ne[e];if(t){const i=t.textureCacheIds.indexOf(e);return i>-1&&t.textureCacheIds.splice(i,1),delete Ne[e],t}}else if(e?.textureCacheIds){for(let t=0;t<e.textureCacheIds.length;++t)Ne[e.textureCacheIds[t]]===e&&delete Ne[e.textureCacheIds[t]];return e.textureCacheIds.length=0,e}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(e){this._frame=e,this.noFrame=!1;const{x:t,y:i,width:s,height:n}=e,a=t+s>this.baseTexture.width,o=i+n>this.baseTexture.height;if(a||o){const h=a&&o?"and":"or",l=`X: ${t} + ${s} = ${t+s} > ${this.baseTexture.width}`,c=`Y: ${i} + ${n} = ${i+n} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${l} ${h} ${c}`)}this.valid=s&&n&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(e){this._rotate=e,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return K._EMPTY||(K._EMPTY=new K(new ce),ns(K._EMPTY),ns(K._EMPTY.baseTexture)),K._EMPTY}static get WHITE(){if(!K._WHITE){const e=j.ADAPTER.createCanvas(16,16),t=e.getContext("2d");e.width=16,e.height=16,t.fillStyle="white",t.fillRect(0,0,16,16),K._WHITE=new K(ce.from(e)),ns(K._WHITE),ns(K._WHITE.baseTexture)}return K._WHITE}}class ei extends K{constructor(e,t){super(e,t),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(e){this.framebuffer.multisample=e}resize(e,t,i=!0){const s=this.baseTexture.resolution,n=Math.round(e*s)/s,a=Math.round(t*s)/s;this.valid=n>0&&a>0,this._frame.width=this.orig.width=n,this._frame.height=this.orig.height=a,i&&this.baseTexture.resize(n,a),this.updateUvs()}setResolution(e){const{baseTexture:t}=this;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))}static create(e){return new ei(new gl(e))}}class vl{constructor(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(e,t,i=Me.NONE){const s=new gl(Object.assign({width:e,height:t,resolution:1,multisample:i},this.textureOptions));return new ei(s)}getOptimalTexture(e,t,i=1,s=Me.NONE){let n;e=Math.max(Math.ceil(e*i-1e-6),1),t=Math.max(Math.ceil(t*i-1e-6),1),!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight?(e=Ms(e),t=Ms(t),n=((e&65535)<<16|t&65535)>>>0,s>1&&(n+=s*4294967296)):n=s>1?-s:-1,this.texturePool[n]||(this.texturePool[n]=[]);let a=this.texturePool[n].pop();return a||(a=this.createTexture(e,t,s)),a.filterPoolKey=n,a.setResolution(i),a}getFilterTexture(e,t,i){const s=this.getOptimalTexture(e.width,e.height,t||e.resolution,i||Me.NONE);return s.filterFrame=e.filterFrame,s}returnTexture(e){const t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)}returnFilterTexture(e){this.returnTexture(e)}clear(e){if(e=e!==!1,e)for(const t in this.texturePool){const i=this.texturePool[t];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0)}this.texturePool={}}setScreenSize(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){this.enableFullScreen=e.width>0&&e.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const i=this.texturePool[t];if(i)for(let s=0;s<i.length;s++)i[s].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=e.width,this._pixelsHeight=e.height}}}vl.SCREEN_KEY=-1;class _d extends Ft{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class xl extends Ft{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Ce(this.vertices),this.uvBuffer=new Ce(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(e,t){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+t.width/e.width,this.uvs[3]=s,this.uvs[4]=i+t.width/e.width,this.uvs[5]=s+t.height/e.height,this.uvs[6]=i,this.uvs[7]=s+t.height/e.height,i=t.x,s=t.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+t.width,this.vertices[3]=s,this.vertices[4]=i+t.width,this.vertices[5]=s+t.height,this.vertices[6]=i,this.vertices[7]=s+t.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class bd{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=Me.NONE,this.sourceFrame=new le,this.destinationFrame=new le,this.bindingSourceFrame=new le,this.bindingDestinationFrame=new le,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const as=[new ye,new ye,new ye,new ye],mn=new Te;class _l{constructor(e){this.renderer=e,this.defaultFilterStack=[{}],this.texturePool=new vl,this.statePool=[],this.quad=new _d,this.quadUv=new xl,this.tempRect=new le,this.activeState={},this.globalUniforms=new tt({outputFrame:new le,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(e,t){const i=this.renderer,s=this.defaultFilterStack,n=this.statePool.pop()||new bd,a=i.renderTexture;let o,h;if(a.current){const m=a.current;o=m.resolution,h=m.multisample}else o=i.resolution,h=i.multisample;let l=t[0].resolution||o,c=t[0].multisample??h,u=t[0].padding,d=t[0].autoFit,p=t[0].legacy??!0;for(let m=1;m<t.length;m++){const y=t[m];l=Math.min(l,y.resolution||o),c=Math.min(c,y.multisample??h),u=this.useMaxPadding?Math.max(u,y.padding):u+y.padding,d=d&&y.autoFit,p=p||(y.legacy??!0)}s.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),s.push(n),n.resolution=l,n.multisample=c,n.legacy=p,n.target=e,n.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),n.sourceFrame.pad(u);const f=this.tempRect.copyFrom(a.sourceFrame);i.projection.transform&&this.transformAABB(mn.copyFrom(i.projection.transform).invert(),f),d?(n.sourceFrame.fit(f),(n.sourceFrame.width<=0||n.sourceFrame.height<=0)&&(n.sourceFrame.width=0,n.sourceFrame.height=0)):n.sourceFrame.intersects(f)||(n.sourceFrame.width=0,n.sourceFrame.height=0),this.roundFrame(n.sourceFrame,a.current?a.current.resolution:i.resolution,a.sourceFrame,a.destinationFrame,i.projection.transform),n.renderTexture=this.getOptimalFilterTexture(n.sourceFrame.width,n.sourceFrame.height,l,c),n.filters=t,n.destinationFrame.width=n.renderTexture.width,n.destinationFrame.height=n.renderTexture.height;const g=this.tempRect;g.x=0,g.y=0,g.width=n.sourceFrame.width,g.height=n.sourceFrame.height,n.renderTexture.filterFrame=n.sourceFrame,n.bindingSourceFrame.copyFrom(a.sourceFrame),n.bindingDestinationFrame.copyFrom(a.destinationFrame),n.transform=i.projection.transform,i.projection.transform=null,a.bind(n.renderTexture,n.sourceFrame,g),i.framebuffer.clear(0,0,0,0)}pop(){const e=this.defaultFilterStack,t=e.pop(),i=t.filters;this.activeState=t;const s=this.globalUniforms.uniforms;s.outputFrame=t.sourceFrame,s.resolution=t.resolution;const n=s.inputSize,a=s.inputPixel,o=s.inputClamp;if(n[0]=t.destinationFrame.width,n[1]=t.destinationFrame.height,n[2]=1/n[0],n[3]=1/n[1],a[0]=Math.round(n[0]*t.resolution),a[1]=Math.round(n[1]*t.resolution),a[2]=1/a[0],a[3]=1/a[1],o[0]=.5*a[2],o[1]=.5*a[3],o[2]=t.sourceFrame.width*n[2]-.5*a[2],o[3]=t.sourceFrame.height*n[3]-.5*a[3],t.legacy){const l=s.filterArea;l[0]=t.destinationFrame.width,l[1]=t.destinationFrame.height,l[2]=t.sourceFrame.x,l[3]=t.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const h=e[e.length-1];if(this.renderer.framebuffer.blit(),i.length===1)i[0].apply(this,t.renderTexture,h.renderTexture,ot.BLEND,t),this.returnFilterTexture(t.renderTexture);else{let l=t.renderTexture,c=this.getOptimalFilterTexture(l.width,l.height,t.resolution);c.filterFrame=l.filterFrame;let u=0;for(u=0;u<i.length-1;++u){u===1&&t.multisample>1&&(c=this.getOptimalFilterTexture(l.width,l.height,t.resolution),c.filterFrame=l.filterFrame),i[u].apply(this,l,c,ot.CLEAR,t);const d=l;l=c,c=d}i[u].apply(this,l,h.renderTexture,ot.BLEND,t),u>1&&t.multisample>1&&this.returnFilterTexture(t.renderTexture),this.returnFilterTexture(l),this.returnFilterTexture(c)}t.clear(),this.statePool.push(t)}bindAndClear(e,t=ot.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(e===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,e?.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=e.filterFrame.width,a.height=e.filterFrame.height,i.bind(e,e.filterFrame,a)}else e!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(e):this.renderer.renderTexture.bind(e,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const n=s.stateId&1||this.forceClear;(t===ot.CLEAR||t===ot.BLIT&&n)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(e,t,i,s){const n=this.renderer;n.state.set(e.state),this.bindAndClear(i,s),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,n.shader.bind(e),e.legacy=!!e.program.attributeData.aTextureCoord,e.legacy?(this.quadUv.map(t._frame,t.filterFrame),n.geometry.bind(this.quadUv),n.geometry.draw(ht.TRIANGLES)):(n.geometry.bind(this.quad),n.geometry.draw(ht.TRIANGLE_STRIP))}calculateSpriteMatrix(e,t){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:n}=t._texture,a=e.set(s.width,0,0,s.height,i.x,i.y),o=t.worldTransform.copyTo(Te.TEMP_MATRIX);return o.invert(),a.prepend(o),a.scale(1/n.width,1/n.height),a.translate(t.anchor.x,t.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(e,t,i=1,s=Me.NONE){return this.texturePool.getOptimalTexture(e,t,i,s)}getFilterTexture(e,t,i){if(typeof e=="number"){const n=e;e=t,t=n}e=e||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution,i||Me.NONE);return s.filterFrame=e.filterFrame,s}returnFilterTexture(e){this.texturePool.returnTexture(e)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(e,t){const i=as[0],s=as[1],n=as[2],a=as[3];i.set(t.left,t.top),s.set(t.left,t.bottom),n.set(t.right,t.top),a.set(t.right,t.bottom),e.apply(i,i),e.apply(s,s),e.apply(n,n),e.apply(a,a);const o=Math.min(i.x,s.x,n.x,a.x),h=Math.min(i.y,s.y,n.y,a.y),l=Math.max(i.x,s.x,n.x,a.x),c=Math.max(i.y,s.y,n.y,a.y);t.x=o,t.y=h,t.width=l-o,t.height=c-h}roundFrame(e,t,i,s,n){if(!(e.width<=0||e.height<=0||i.width<=0||i.height<=0)){if(n){const{a,b:o,c:h,d:l}=n;if((Math.abs(o)>1e-4||Math.abs(h)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(l)>1e-4))return}n=n?mn.copyFrom(n):mn.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(n,e),e.ceil(t),this.transformAABB(n.invert(),e)}}}_l.extension={type:V.RendererSystem,name:"filter"};Z.add(_l);class wd{constructor(e){this.framebuffer=e,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=Me.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const Td=new le;class bl{constructor(e){this.renderer=e,this.managedFramebuffers=[],this.unknownFramebuffer=new $n(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new le,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let t=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;j.PREFER_ENV===Qt.WEBGL_LEGACY&&(t=null,i=null),t?e.drawBuffers=s=>t.drawBuffersWEBGL(s):(this.hasMRT=!1,e.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)}bind(e,t,i=0){const{gl:s}=this;if(e){const n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,s.bindFramebuffer(s.FRAMEBUFFER,n.framebuffer)),n.mipLevel!==i&&(e.dirtyId++,e.dirtyFormat++,n.mipLevel=i),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,n.dirtySize=e.dirtySize,this.updateFramebuffer(e,i)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(let a=0;a<e.colorTextures.length;a++){const o=e.colorTextures[a];this.renderer.texture.unbind(o.parentTextureArray||o)}if(e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t){const a=t.width>>i,o=t.height>>i,h=a/t.width;this.setViewport(t.x*h,t.y*h,a,o)}else{const a=e.width>>i,o=e.height>>i;this.setViewport(0,0,a,o)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(e,t,i,s){const n=this.viewport;e=Math.round(e),t=Math.round(t),i=Math.round(i),s=Math.round(s),(n.width!==i||n.height!==s||n.x!==e||n.y!==t)&&(n.x=e,n.y=t,n.width=i,n.height=s,this.gl.viewport(e,t,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(e,t,i,s,n=Pn.COLOR|Pn.DEPTH){const{gl:a}=this;a.clearColor(e,t,i,s),a.clear(n)}initFramebuffer(e){const{gl:t}=this,i=new wd(t.createFramebuffer());return i.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(e),e.disposeRunner.add(this),i}resizeFramebuffer(e){const{gl:t}=this,i=e.glFramebuffers[this.CONTEXT_UID];if(i.stencil){t.bindRenderbuffer(t.RENDERBUFFER,i.stencil);let a;this.renderer.context.webGLVersion===1?a=t.DEPTH_STENCIL:e.depth&&e.stencil?a=t.DEPTH24_STENCIL8:e.depth?a=t.DEPTH_COMPONENT24:a=t.STENCIL_INDEX8,i.msaaBuffer?t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,a,e.width,e.height):t.renderbufferStorage(t.RENDERBUFFER,a,e.width,e.height)}const s=e.colorTextures;let n=s.length;t.drawBuffers||(n=Math.min(n,1));for(let a=0;a<n;a++){const o=s[a],h=o.parentTextureArray||o;this.renderer.texture.bind(h,0),a===0&&i.msaaBuffer&&(t.bindRenderbuffer(t.RENDERBUFFER,i.msaaBuffer),t.renderbufferStorageMultisample(t.RENDERBUFFER,i.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height))}e.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(e.depthTexture,0)}updateFramebuffer(e,t){const{gl:i}=this,s=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures;let a=n.length;i.drawBuffers||(a=Math.min(a,1)),s.multisample>1&&this.canMultisampleFramebuffer(e)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const o=[];for(let h=0;h<a;h++){const l=n[h],c=l.parentTextureArray||l;this.renderer.texture.bind(c,0),h===0&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,c._glTextures[this.CONTEXT_UID].internalFormat,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+h,l.target,c._glTextures[this.CONTEXT_UID].texture,t),o.push(i.COLOR_ATTACHMENT0+h))}if(o.length>1&&i.drawBuffers(o),e.depthTexture&&this.writeDepthTexture){const h=e.depthTexture;this.renderer.texture.bind(h,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,h._glTextures[this.CONTEXT_UID].texture,t)}if((e.stencil||e.depth)&&!(e.depthTexture&&this.writeDepthTexture)){s.stencil=s.stencil||i.createRenderbuffer();let h,l;this.renderer.context.webGLVersion===1?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH_STENCIL):e.depth&&e.stencil?(h=i.DEPTH_STENCIL_ATTACHMENT,l=i.DEPTH24_STENCIL8):e.depth?(h=i.DEPTH_ATTACHMENT,l=i.DEPTH_COMPONENT24):(h=i.STENCIL_ATTACHMENT,l=i.STENCIL_INDEX8),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,l,e.width,e.height):i.renderbufferStorage(i.RENDERBUFFER,l,e.width,e.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,h,i.RENDERBUFFER,s.stencil)}else s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null)}canMultisampleFramebuffer(e){return this.renderer.context.webGLVersion!==1&&e.colorTextures.length<=1&&!e.depthTexture}detectSamples(e){const{msaaSamples:t}=this;let i=Me.NONE;if(e<=1||t===null)return i;for(let s=0;s<t.length;s++)if(t[s]<=e){i=t[s];break}return i===1&&(i=Me.NONE),i}blit(e,t,i){const{current:s,renderer:n,gl:a,CONTEXT_UID:o}=this;if(n.context.webGLVersion!==2||!s)return;const h=s.glFramebuffers[o];if(!h)return;if(!e){if(!h.msaaBuffer)return;const c=s.colorTextures[0];if(!c)return;h.blitFramebuffer||(h.blitFramebuffer=new $n(s.width,s.height),h.blitFramebuffer.addColorTexture(0,c)),e=h.blitFramebuffer,e.colorTextures[0]!==c&&(e.colorTextures[0]=c,e.dirtyId++,e.dirtyFormat++),(e.width!==s.width||e.height!==s.height)&&(e.width=s.width,e.height=s.height,e.dirtyId++,e.dirtySize++)}t||(t=Td,t.width=s.width,t.height=s.height),i||(i=t);const l=t.width===i.width&&t.height===i.height;this.bind(e),a.bindFramebuffer(a.READ_FRAMEBUFFER,h.framebuffer),a.blitFramebuffer(t.left,t.top,t.right,t.bottom,i.left,i.top,i.right,i.bottom,a.COLOR_BUFFER_BIT,l?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,e.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(e,t){const i=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete e.glFramebuffers[this.CONTEXT_UID];const n=this.managedFramebuffers.indexOf(e);n>=0&&this.managedFramebuffers.splice(n,1),e.disposeRunner.remove(this),t||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&this.disposeFramebuffer(i.blitFramebuffer,t)}disposeAll(e){const t=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<t.length;i++)this.disposeFramebuffer(t[i],e)}forceStencil(){const e=this.current;if(!e)return;const t=e.glFramebuffers[this.CONTEXT_UID];if(!t||t.stencil&&e.stencil)return;e.stencil=!0;const i=e.width,s=e.height,n=this.gl,a=t.stencil=n.createRenderbuffer();n.bindRenderbuffer(n.RENDERBUFFER,a);let o,h;this.renderer.context.webGLVersion===1?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH_STENCIL):e.depth?(o=n.DEPTH_STENCIL_ATTACHMENT,h=n.DEPTH24_STENCIL8):(o=n.STENCIL_ATTACHMENT,h=n.STENCIL_INDEX8),t.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,t.multisample,h,i,s):n.renderbufferStorage(n.RENDERBUFFER,h,i,s),n.framebufferRenderbuffer(n.FRAMEBUFFER,o,n.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new le}destroy(){this.renderer=null}}bl.extension={type:V.RendererSystem,name:"framebuffer"};Z.add(bl);const gn={5126:4,5123:2,5121:1};class wl{constructor(e){this.renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,t.webGLVersion!==2){let i=this.renderer.context.extensions.vertexArrayObject;j.PREFER_ENV===Qt.WEBGL_LEGACY&&(i=null),i?(e.createVertexArray=()=>i.createVertexArrayOES(),e.bindVertexArray=s=>i.bindVertexArrayOES(s),e.deleteVertexArray=s=>i.deleteVertexArrayOES(s)):(this.hasVao=!1,e.createVertexArray=()=>null,e.bindVertexArray=()=>null,e.deleteVertexArray=()=>null)}if(t.webGLVersion!==2){const i=e.getExtension("ANGLE_instanced_arrays");i?(e.vertexAttribDivisor=(s,n)=>i.vertexAttribDivisorANGLE(s,n),e.drawElementsInstanced=(s,n,a,o,h)=>i.drawElementsInstancedANGLE(s,n,a,o,h),e.drawArraysInstanced=(s,n,a,o)=>i.drawArraysInstancedANGLE(s,n,a,o)):this.hasInstance=!1}this.canUseUInt32ElementIndex=t.webGLVersion===2||!!t.extensions.uint32ElementIndex}bind(e,t){t=t||this.renderer.shader.shader;const{gl:i}=this;let s=e.glVertexArrayObjects[this.CONTEXT_UID],n=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},n=!0);const a=s[t.program.id]||this.initGeometryVao(e,t,n);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?i.bindVertexArray(a):this.activateVao(e,t.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,t=this.renderer.buffer;for(let i=0;i<e.buffers.length;i++){const s=e.buffers[i];t.update(s)}}checkCompatibility(e,t){const i=e.attributes,s=t.attributeData;for(const n in s)if(!i[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,t){const i=e.attributes,s=t.attributeData,n=["g",e.id];for(const a in i)s[a]&&n.push(a,s[a].location);return n.join("-")}initGeometryVao(e,t,i=!0){const s=this.gl,n=this.CONTEXT_UID,a=this.renderer.buffer,o=t.program;o.glPrograms[n]||this.renderer.shader.generateProgram(t),this.checkCompatibility(e,o);const h=this.getSignature(e,o),l=e.glVertexArrayObjects[this.CONTEXT_UID];let c=l[h];if(c)return l[o.id]=c,c;const u=e.buffers,d=e.attributes,p={},f={};for(const g in u)p[g]=0,f[g]=0;for(const g in d)!d[g].size&&o.attributeData[g]?d[g].size=o.attributeData[g].size:d[g].size||console.warn(`PIXI Geometry attribute '${g}' size cannot be determined (likely the bound shader does not have the attribute)`),p[d[g].buffer]+=d[g].size*gn[d[g].type];for(const g in d){const m=d[g],y=m.size;m.stride===void 0&&(p[m.buffer]===y*gn[m.type]?m.stride=0:m.stride=p[m.buffer]),m.start===void 0&&(m.start=f[m.buffer],f[m.buffer]+=y*gn[m.type])}c=s.createVertexArray(),s.bindVertexArray(c);for(let g=0;g<u.length;g++){const m=u[g];a.bind(m),i&&m._glBuffers[n].refCount++}return this.activateVao(e,o),l[o.id]=c,l[h]=c,s.bindVertexArray(null),a.unbind(lt.ARRAY_BUFFER),c}disposeGeometry(e,t){if(!this.managedGeometries[e.id])return;delete this.managedGeometries[e.id];const i=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,n=e.buffers,a=this.renderer?.buffer;if(e.disposeRunner.remove(this),!!i){if(a)for(let o=0;o<n.length;o++){const h=n[o]._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!t&&a.dispose(n[o],t))}if(!t){for(const o in i)if(o[0]==="g"){const h=i[o];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(e){const t=Object.keys(this.managedGeometries);for(let i=0;i<t.length;i++)this.disposeGeometry(this.managedGeometries[t[i]],e)}activateVao(e,t){const i=this.gl,s=this.CONTEXT_UID,n=this.renderer.buffer,a=e.buffers,o=e.attributes;e.indexBuffer&&n.bind(e.indexBuffer);let h=null;for(const l in o){const c=o[l],u=a[c.buffer],d=u._glBuffers[s];if(t.attributeData[l]){h!==d&&(n.bind(u),h=d);const p=t.attributeData[l].location;if(i.enableVertexAttribArray(p),i.vertexAttribPointer(p,c.size,c.type||i.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)i.vertexAttribDivisor(p,c.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,t,i,s){const{gl:n}=this,a=this._activeGeometry;if(a.indexBuffer){const o=a.indexBuffer.data.BYTES_PER_ELEMENT,h=o===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;o===2||o===4&&this.canUseUInt32ElementIndex?a.instanced?n.drawElementsInstanced(e,t||a.indexBuffer.data.length,h,(i||0)*o,s||1):n.drawElements(e,t||a.indexBuffer.data.length,h,(i||0)*o):console.warn("unsupported index buffer type: uint32")}else a.instanced?n.drawArraysInstanced(e,i,t||a.getSize(),s||1):n.drawArrays(e,i,t||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}wl.extension={type:V.RendererSystem,name:"geometry"};Z.add(wl);const uh=new Te;class Tl{constructor(e,t){this._texture=e,this.mapCoord=new Te,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}get texture(){return this._texture}set texture(e){this._texture=e,this._textureID=-1}multiplyUvs(e,t){t===void 0&&(t=e);const i=this.mapCoord;for(let s=0;s<e.length;s+=2){const n=e[s],a=e[s+1];t[s]=n*i.a+a*i.c+i.tx,t[s+1]=n*i.b+a*i.d+i.ty}return t}update(e){const t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;const i=t._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=t.orig,n=t.trim;n&&(uh.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(uh));const a=t.baseTexture,o=this.uClampFrame,h=this.clampMargin/a.resolution,l=this.clampOffset;return o[0]=(t._frame.x+h+l)/a.width,o[1]=(t._frame.y+h+l)/a.height,o[2]=(t._frame.x+t._frame.width-h+l)/a.width,o[3]=(t._frame.y+t._frame.height-h+l)/a.height,this.uClampOffset[0]=l/a.realWidth,this.uClampOffset[1]=l/a.realHeight,this.isSimple=t._frame.width===a.width&&t._frame.height===a.height&&t.rotate===0,!0}}var Sd=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Ed=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class Ad extends ke{constructor(e,t,i){let s=null;typeof e!="string"&&t===void 0&&i===void 0&&(s=e,e=void 0,t=void 0,i=void 0),super(e||Ed,t||Sd,i),this.maskSprite=s,this.maskMatrix=new Te}get maskSprite(){return this._maskSprite}set maskSprite(e){this._maskSprite=e,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(e,t,i,s){const n=this._maskSprite,a=n._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Tl(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,n).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=n.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,t,i,s))}}class Cd{constructor(e=null){this.type=Pe.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=ke.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(e){e?this._filters?this._filters[0]=e:this._filters=[e]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=Pe.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class Sl{constructor(e){this.renderer=e,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)}push(e,t){let i=t;if(!i.isMaskData){const n=this.maskDataPool.pop()||new Cd;n.pooled=!0,n.maskObject=t,i=n}const s=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=e,i.type!==Pe.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case Pe.SCISSOR:this.renderer.scissor.push(i);break;case Pe.STENCIL:this.renderer.stencil.push(i);break;case Pe.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case Pe.COLOR:this.pushColorMask(i);break}i.type===Pe.SPRITE&&this.maskStack.push(i)}pop(e){const t=this.maskStack.pop();if(!(!t||t._target!==e)){if(t.enabled)switch(t.type){case Pe.SCISSOR:this.renderer.scissor.pop(t);break;case Pe.STENCIL:this.renderer.stencil.pop(t.maskObject);break;case Pe.SPRITE:this.popSpriteMask(t);break;case Pe.COLOR:this.popColorMask(t);break}if(t.reset(),t.pooled&&this.maskDataPool.push(t),this.maskStack.length!==0){const i=this.maskStack[this.maskStack.length-1];i.type===Pe.SPRITE&&i._filters&&(i._filters[0].maskSprite=i.maskObject)}}}detect(e){const t=e.maskObject;t?t.isSprite?e.type=Pe.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(e)?e.type=Pe.SCISSOR:e.type=Pe.STENCIL:e.type=Pe.COLOR}pushSpriteMask(e){const{maskObject:t}=e,i=e._target;let s=e._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ad])),s[0].resolution=e.resolution,s[0].multisample=e.multisample,s[0].maskSprite=t;const n=i.filterArea;i.filterArea=t.getBounds(!0),this.renderer.filter.push(i,s),i.filterArea=n,e._filters||this.alphaMaskIndex++}popSpriteMask(e){this.renderer.filter.pop(),e._filters?e._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(e){const t=e._colorMask,i=e._colorMask=t&e.colorMask;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}popColorMask(e){const t=e._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==t&&this.renderer.gl.colorMask((i&1)!==0,(i&2)!==0,(i&4)!==0,(i&8)!==0)}destroy(){this.renderer=null}}Sl.extension={type:V.RendererSystem,name:"mask"};Z.add(Sl);class El{constructor(e){this.renderer=e,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(e){const{gl:t}=this.renderer,i=this.getStackLength();this.maskStack=e;const s=this.getStackLength();s!==i&&(s===0?t.disable(this.glConst):(t.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const dh=new Te,ph=[],Al=class _s extends El{constructor(e){super(e),this.glConst=j.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0}calcScissorRect(e){if(e._scissorRectLocal)return;const t=e._scissorRect,{maskObject:i}=e,{renderer:s}=this,n=s.renderTexture,a=i.getBounds(!0,ph.pop()??new le);this.roundFrameToPixels(a,n.current?n.current.resolution:s.resolution,n.sourceFrame,n.destinationFrame,s.projection.transform),t&&a.fit(t),e._scissorRectLocal=a}static isMatrixRotated(e){if(!e)return!1;const{a:t,b:i,c:s,d:n}=e;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(n)>1e-4)}testScissor(e){const{maskObject:t}=e;if(!t.isFastRect||!t.isFastRect()||_s.isMatrixRotated(t.worldTransform)||_s.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(e);const i=e._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(e,t,i,s,n){_s.isMatrixRotated(n)||(n=n?dh.copyFrom(n):dh.identity(),n.translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(n,e),e.fit(s),e.x=Math.round(e.x*t),e.y=Math.round(e.y*t),e.width=Math.round(e.width*t),e.height=Math.round(e.height*t))}push(e){e._scissorRectLocal||this.calcScissorRect(e);const{gl:t}=this.renderer;e._scissorRect||t.enable(t.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=e._scissorRectLocal,this._useCurrent()}pop(e){const{gl:t}=this.renderer;e&&ph.push(e._scissorRectLocal),this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)}_useCurrent(){const e=this.maskStack[this.maskStack.length-1]._scissorRect;let t;this.renderer.renderTexture.current?t=e.y:t=this.renderer.height-e.height-e.y,this.renderer.gl.scissor(e.x,t,e.width,e.height)}};Al.extension={type:V.RendererSystem,name:"scissor"};let Md=Al;Z.add(Md);class Cl extends El{constructor(e){super(e),this.glConst=j.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0}push(e){const t=e.maskObject,{gl:i}=this.renderer,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),e._stencilCounter++;const n=e._colorMask;n!==0&&(e._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(e._colorMask=n,i.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}pop(e){const t=this.renderer.gl;if(this.getStackLength()===0)t.disable(t.STENCIL_TEST);else{const i=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;s!==0&&(i._colorMask=0,t.colorMask(!1,!1,!1,!1)),t.stencilOp(t.KEEP,t.KEEP,t.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(i._colorMask=s,t.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}}_useCurrent(){const e=this.renderer.gl;e.stencilFunc(e.EQUAL,this.getStackLength(),4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}}Cl.extension={type:V.RendererSystem,name:"stencil"};Z.add(Cl);class Ml{constructor(e){this.renderer=e,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return de("7.0.0","renderer.plugins.extract has moved to renderer.extract"),e.extract}},prepare:{enumerable:!1,get(){return de("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),e.prepare}},interaction:{enumerable:!1,get(){return de("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),e.events}}})}init(){const e=this.rendererPlugins;for(const t in e)this.plugins[t]=new e[t](this.renderer)}destroy(){for(const e in this.plugins)this.plugins[e].destroy(),this.plugins[e]=null}}Ml.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"_plugin"};Z.add(Ml);class Rl{constructor(e){this.renderer=e,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new Te,this.transform=null}update(e,t,i,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const n=this.renderer;n.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,n.globalUniforms.update(),n.shader.shader&&n.shader.syncUniformGroup(n.shader.shader.uniforms.globals)}calculateProjection(e,t,i,s){const n=this.projectionMatrix,a=s?-1:1;n.identity(),n.a=1/t.width*2,n.d=a*(1/t.height*2),n.tx=-1-t.x*n.a,n.ty=-a-t.y*n.d}setTransform(e){}destroy(){this.renderer=null}}Rl.extension={type:V.RendererSystem,name:"projection"};Z.add(Rl);const Rd=new va,fh=new le;class Pl{constructor(e){this.renderer=e,this._tempMatrix=new Te}generateTexture(e,t){const{region:i,...s}=t||{},n=i?.copyTo(fh)||e.getLocalBounds(fh,!0),a=s.resolution||this.renderer.resolution;n.width=Math.max(n.width,1/a),n.height=Math.max(n.height,1/a),s.width=n.width,s.height=n.height,s.resolution=a,s.multisample??(s.multisample=this.renderer.multisample);const o=ei.create(s);this._tempMatrix.tx=-n.x,this._tempMatrix.ty=-n.y;const h=e.transform;return e.transform=Rd,this.renderer.render(e,{renderTexture:o,transform:this._tempMatrix,skipUpdateTransform:!!e.parent,blit:!0}),e.transform=h,o}destroy(){}}Pl.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"textureGenerator"};Z.add(Pl);const Nt=new le,Mi=new le;class Il{constructor(e){this.renderer=e,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new le,this.destinationFrame=new le,this.viewportFrame=new le}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}bind(e=null,t,i){const s=this.renderer;this.current=e;let n,a,o;e?(n=e.baseTexture,o=n.resolution,t||(Nt.width=e.frame.width,Nt.height=e.frame.height,t=Nt),i||(Mi.x=e.frame.x,Mi.y=e.frame.y,Mi.width=t.width,Mi.height=t.height,i=Mi),a=n.framebuffer):(o=s.resolution,t||(Nt.width=s._view.screen.width,Nt.height=s._view.screen.height,t=Nt),i||(i=Nt,i.width=t.width,i.height=t.height));const h=this.viewportFrame;h.x=i.x*o,h.y=i.y*o,h.width=i.width*o,h.height=i.height*o,e||(h.y=s.view.height-(h.y+h.height)),h.ceil(),this.renderer.framebuffer.bind(a,h),this.renderer.projection.update(i,t,o,!a),e?this.renderer.mask.setMaskStack(n.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(t),this.destinationFrame.copyFrom(i)}clear(e,t){const i=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,s=_e.shared.setValue(e||i);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&s.premultiply(s.alpha);const n=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,o=n.width!==a.width||n.height!==a.height;if(o){let{x:h,y:l,width:c,height:u}=this.viewportFrame;h=Math.round(h),l=Math.round(l),c=Math.round(c),u=Math.round(u),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(h,l,c,u)}this.renderer.framebuffer.clear(s.red,s.green,s.blue,s.alpha,t),o&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}Il.extension={type:V.RendererSystem,name:"renderTexture"};Z.add(Il);class qg{}class Pd{constructor(e,t){this.program=e,this.uniformData=t,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Id(r,e){const t={},i=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const n=e.getActiveAttrib(r,s);if(n.name.startsWith("gl_"))continue;const a=fl(e,n.type),o={type:a,name:n.name,size:pl(a),location:e.getAttribLocation(r,n.name)};t[n.name]=o}return t}function Bd(r,e){const t={},i=e.getProgramParameter(r,e.ACTIVE_UNIFORMS);for(let s=0;s<i;s++){const n=e.getActiveUniform(r,s),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),h=fl(e,n.type);t[a]={name:a,index:s,type:h,size:n.size,isArray:o,value:ul(h,n.size)}}return t}function Dd(r,e){const t=nh(r,r.VERTEX_SHADER,e.vertexSrc),i=nh(r,r.FRAGMENT_SHADER,e.fragmentSrc),s=r.createProgram();r.attachShader(s,t),r.attachShader(s,i);const n=e.extra?.transformFeedbackVaryings;if(n&&(typeof r.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):r.transformFeedbackVaryings(s,n.names,n.bufferMode==="separate"?r.SEPARATE_ATTRIBS:r.INTERLEAVED_ATTRIBS)),r.linkProgram(s),r.getProgramParameter(s,r.LINK_STATUS)||hd(r,s,t,i),e.attributeData=Id(s,r),e.uniformData=Bd(s,r),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const o=Object.keys(e.attributeData);o.sort((h,l)=>h>l?1:-1);for(let h=0;h<o.length;h++)e.attributeData[o[h]].location=h,r.bindAttribLocation(s,h,o[h]);r.linkProgram(s)}r.deleteShader(t),r.deleteShader(i);const a={};for(const o in e.uniformData){const h=e.uniformData[o];a[o]={location:r.getUniformLocation(s,o),value:ul(h.type,h.size)}}return new Pd(s,a)}function Fd(r,e,t,i,s){t.buffer.update(s)}const Ld={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},Bl={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function Od(r){const e=r.map(n=>({data:n,offset:0,dataLen:0,dirty:0}));let t=0,i=0,s=0;for(let n=0;n<e.length;n++){const a=e[n];if(t=Bl[a.data.type],a.data.size>1&&(t=Math.max(t,16)*a.data.size),a.dataLen=t,i%t!==0&&i<16){const o=i%t%16;i+=o,s+=o}i+t>16?(s=Math.ceil(s/16)*16,a.offset=s,s+=t,i=t):(a.offset=s,i+=t,s+=t)}return s=Math.ceil(s/16)*16,{uboElements:e,size:s}}function kd(r,e){const t=[];for(const i in r)e[i]&&t.push(e[i]);return t.sort((i,s)=>i.index-s.index),t}function Nd(r,e){if(!r.autoManage)return{size:0,syncFunc:Fd};const t=kd(r.uniforms,e),{uboElements:i,size:s}=Od(t),n=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<i.length;a++){const o=i[a],h=r.uniforms[o.data.name],l=o.data.name;let c=!1;for(let u=0;u<vi.length;u++){const d=vi[u];if(d.codeUbo&&d.test(o.data,h)){n.push(`offset = ${o.offset/4};`,vi[u].codeUbo(o.data.name,h)),c=!0;break}}if(!c)if(o.data.size>1){const u=pl(o.data.type),d=Math.max(Bl[o.data.type]/16,1),p=u/d,f=(4-p%4)%4;n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};

                t = 0;

                for(var i=0; i < ${o.data.size*d}; i++)
                {
                    for(var j = 0; j < ${p}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${f};
                }

                `)}else{const u=Ld[o.data.type];n.push(`
                cv = ud.${l}.value;
                v = uv.${l};
                offset = ${o.offset/4};
                ${u};
                `)}}return n.push(`
       renderer.buffer.update(buffer);
    `),{size:s,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join(`
`))}}let Ud=0;const os={textureCount:0,uboCount:0};class Dl{constructor(e){this.destroyed=!1,this.renderer=e,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=Ud++}systemCheck(){if(!cd())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(e){this.gl=e,this.reset()}bind(e,t){e.disposeRunner.add(this),e.uniforms.globals=this.renderer.globalUniforms;const i=e.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(e);return this.shader=e,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),t||(os.textureCount=0,os.uboCount=0,this.syncUniformGroup(e.uniformGroup,os)),s}setUniforms(e){const t=this.shader.program,i=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(i.uniformData,e,this.renderer)}syncUniformGroup(e,t){const i=this.getGlProgram();(!e.static||e.dirtyId!==i.uniformDirtyGroups[e.id])&&(i.uniformDirtyGroups[e.id]=e.dirtyId,this.syncUniforms(e,i,t))}syncUniforms(e,t,i){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer,i)}createSyncGroups(e){const t=this.getSignature(e,this.shader.program.uniformData,"u");return this.cache[t]||(this.cache[t]=nd(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(e,t){const i=this.getGlProgram();if(!e.static||e.dirtyId!==0||!i.uniformGroups[e.id]){e.dirtyId=0;const s=i.uniformGroups[e.id]||this.createSyncBufferGroup(e,i,t);e.buffer.update(),s(i.uniformData,e.uniforms,this.renderer,os,e.buffer)}this.renderer.buffer.bindBufferBase(e.buffer,i.uniformBufferBindings[t])}createSyncBufferGroup(e,t,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(e.buffer);const n=this.gl.getUniformBlockIndex(t.program,i);t.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(t.program,n,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(e,this.shader.program.uniformData,"ubo");let o=this._uboCache[a];if(o||(o=this._uboCache[a]=Nd(e,this.shader.program.uniformData)),e.autoManage){const h=new Float32Array(o.size/4);e.buffer.update(h)}return t.uniformGroups[e.id]=o.syncFunc,t.uniformGroups[e.id]}getSignature(e,t,i){const s=e.uniforms,n=[`${i}-`];for(const a in s)n.push(a),t[a]&&n.push(t[a].type);return n.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(e){const t=this.gl,i=e.program,s=Dd(t,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(e){this.shader===e&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Dl.extension={type:V.RendererSystem,name:"shader"};Z.add(Dl);class Ds{constructor(e){this.renderer=e}run(e){const{renderer:t}=this;t.runners.init.emit(t.options),e.hello&&console.log(`PixiJS 7.4.3 - ${t.rendererLogId} - https://pixijs.com`),t.resize(t.screen.width,t.screen.height)}destroy(){}}Ds.defaultOptions={hello:!1},Ds.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"startup"};Z.add(Ds);function Gd(r,e=[]){return e[oe.NORMAL]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.ADD]=[r.ONE,r.ONE],e[oe.MULTIPLY]=[r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.SCREEN]=[r.ONE,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.OVERLAY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.DARKEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.LIGHTEN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.COLOR_DODGE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.COLOR_BURN]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.HARD_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.SOFT_LIGHT]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.DIFFERENCE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.EXCLUSION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.HUE]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.SATURATION]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.COLOR]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.LUMINOSITY]=[r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.NONE]=[0,0],e[oe.NORMAL_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.ADD_NPM]=[r.SRC_ALPHA,r.ONE,r.ONE,r.ONE],e[oe.SCREEN_NPM]=[r.SRC_ALPHA,r.ONE_MINUS_SRC_COLOR,r.ONE,r.ONE_MINUS_SRC_ALPHA],e[oe.SRC_IN]=[r.DST_ALPHA,r.ZERO],e[oe.SRC_OUT]=[r.ONE_MINUS_DST_ALPHA,r.ZERO],e[oe.SRC_ATOP]=[r.DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[oe.DST_OVER]=[r.ONE_MINUS_DST_ALPHA,r.ONE],e[oe.DST_IN]=[r.ZERO,r.SRC_ALPHA],e[oe.DST_OUT]=[r.ZERO,r.ONE_MINUS_SRC_ALPHA],e[oe.DST_ATOP]=[r.ONE_MINUS_DST_ALPHA,r.SRC_ALPHA],e[oe.XOR]=[r.ONE_MINUS_DST_ALPHA,r.ONE_MINUS_SRC_ALPHA],e[oe.SUBTRACT]=[r.ONE,r.ONE,r.ONE,r.ONE,r.FUNC_REVERSE_SUBTRACT,r.FUNC_ADD],e}const Hd=0,Wd=1,zd=2,$d=3,Vd=4,Xd=5,Fl=class Vn{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=oe.NONE,this._blendEq=!1,this.map=[],this.map[Hd]=this.setBlend,this.map[Wd]=this.setOffset,this.map[zd]=this.setCullFace,this.map[$d]=this.setDepthTest,this.map[Vd]=this.setFrontFace,this.map[Xd]=this.setDepthMask,this.checks=[],this.defaultState=new dt,this.defaultState.blend=!0}contextChange(e){this.gl=e,this.blendModes=Gd(e),this.set(this.defaultState),this.reset()}set(e){if(e=e||this.defaultState,this.stateId!==e.data){let t=this.stateId^e.data,i=0;for(;t;)t&1&&this.map[i].call(this,!!(e.data&1<<i)),t=t>>1,i++;this.stateId=e.data}for(let t=0;t<this.checks.length;t++)this.checks[t](this,e)}forceState(e){e=e||this.defaultState;for(let t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(let t=0;t<this.checks.length;t++)this.checks[t](this,e);this.stateId=e.data}setBlend(e){this.updateCheck(Vn.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)}setOffset(e){this.updateCheck(Vn.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(e){this.gl.depthMask(e)}setCullFace(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])}setBlendMode(e){if(e===this.blendMode)return;this.blendMode=e;const t=this.blendModes[e],i=this.gl;t.length===2?i.blendFunc(t[0],t[1]):i.blendFuncSeparate(t[0],t[1],t[2],t[3]),t.length===6?(this._blendEq=!0,i.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(e,t){this.gl.polygonOffset(e,t)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(e,t){const i=this.checks.indexOf(e);t&&i===-1?this.checks.push(e):!t&&i!==-1&&this.checks.splice(i,1)}static checkBlendMode(e,t){e.setBlendMode(t.blendMode)}static checkPolygonOffset(e,t){e.setPolygonOffset(1,t.polygonOffset)}destroy(){this.gl=null}};Fl.extension={type:V.RendererSystem,name:"state"};let jd=Fl;Z.add(jd);class Yd extends $i{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(e){this.addRunners(...e.runners);const t=(e.priority??[]).filter(s=>e.systems[s]),i=[...t,...Object.keys(e.systems).filter(s=>!t.includes(s))];for(const s of i)this.addSystem(e.systems[s],s)}addRunners(...e){e.forEach(t=>{this.runners[t]=new et(t)})}addSystem(e,t){const i=new e(this);if(this[t])throw new Error(`Whoops! The name "${t}" is already in use`);this[t]=i,this._systemsHash[t]=i;for(const s in this.runners)this.runners[s].add(i);return this}emitWithCustomOptions(e,t){const i=Object.keys(this._systemsHash);e.items.forEach(s=>{const n=i.find(a=>this._systemsHash[a]===s);s[e.name](t[n])})}destroy(){Object.values(this.runners).forEach(e=>{e.destroy()}),this._systemsHash={}}}const Li=class bs{constructor(e){this.renderer=e,this.count=0,this.checkCount=0,this.maxIdle=bs.defaultMaxIdle,this.checkCountMax=bs.defaultCheckCountMax,this.mode=bs.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==fa.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const e=this.renderer.texture,t=e.managedTextures;let i=!1;for(let s=0;s<t.length;s++){const n=t[s];n.resource&&this.count-n.touched>this.maxIdle&&(e.destroyTexture(n,!0),t[s]=null,i=!0)}if(i){let s=0;for(let n=0;n<t.length;n++)t[n]!==null&&(t[s++]=t[n]);t.length=s}}unload(e){const t=this.renderer.texture,i=e._texture;i&&!i.framebuffer&&t.destroyTexture(i);for(let s=e.children.length-1;s>=0;s--)this.unload(e.children[s])}destroy(){this.renderer=null}};Li.defaultMode=fa.AUTO,Li.defaultMaxIdle=60*60,Li.defaultCheckCountMax=60*10,Li.extension={type:V.RendererSystem,name:"textureGC"};let Xt=Li;Z.add(Xt);class yn{constructor(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=ae.UNSIGNED_BYTE,this.internalFormat=W.RGBA,this.samplerType=0}}function qd(r){let e;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?e={[r.RGB]:X.FLOAT,[r.RGBA]:X.FLOAT,[r.ALPHA]:X.FLOAT,[r.LUMINANCE]:X.FLOAT,[r.LUMINANCE_ALPHA]:X.FLOAT,[r.R8]:X.FLOAT,[r.R8_SNORM]:X.FLOAT,[r.RG8]:X.FLOAT,[r.RG8_SNORM]:X.FLOAT,[r.RGB8]:X.FLOAT,[r.RGB8_SNORM]:X.FLOAT,[r.RGB565]:X.FLOAT,[r.RGBA4]:X.FLOAT,[r.RGB5_A1]:X.FLOAT,[r.RGBA8]:X.FLOAT,[r.RGBA8_SNORM]:X.FLOAT,[r.RGB10_A2]:X.FLOAT,[r.RGB10_A2UI]:X.FLOAT,[r.SRGB8]:X.FLOAT,[r.SRGB8_ALPHA8]:X.FLOAT,[r.R16F]:X.FLOAT,[r.RG16F]:X.FLOAT,[r.RGB16F]:X.FLOAT,[r.RGBA16F]:X.FLOAT,[r.R32F]:X.FLOAT,[r.RG32F]:X.FLOAT,[r.RGB32F]:X.FLOAT,[r.RGBA32F]:X.FLOAT,[r.R11F_G11F_B10F]:X.FLOAT,[r.RGB9_E5]:X.FLOAT,[r.R8I]:X.INT,[r.R8UI]:X.UINT,[r.R16I]:X.INT,[r.R16UI]:X.UINT,[r.R32I]:X.INT,[r.R32UI]:X.UINT,[r.RG8I]:X.INT,[r.RG8UI]:X.UINT,[r.RG16I]:X.INT,[r.RG16UI]:X.UINT,[r.RG32I]:X.INT,[r.RG32UI]:X.UINT,[r.RGB8I]:X.INT,[r.RGB8UI]:X.UINT,[r.RGB16I]:X.INT,[r.RGB16UI]:X.UINT,[r.RGB32I]:X.INT,[r.RGB32UI]:X.UINT,[r.RGBA8I]:X.INT,[r.RGBA8UI]:X.UINT,[r.RGBA16I]:X.INT,[r.RGBA16UI]:X.UINT,[r.RGBA32I]:X.INT,[r.RGBA32UI]:X.UINT,[r.DEPTH_COMPONENT16]:X.FLOAT,[r.DEPTH_COMPONENT24]:X.FLOAT,[r.DEPTH_COMPONENT32F]:X.FLOAT,[r.DEPTH_STENCIL]:X.FLOAT,[r.DEPTH24_STENCIL8]:X.FLOAT,[r.DEPTH32F_STENCIL8]:X.FLOAT}:e={[r.RGB]:X.FLOAT,[r.RGBA]:X.FLOAT,[r.ALPHA]:X.FLOAT,[r.LUMINANCE]:X.FLOAT,[r.LUMINANCE_ALPHA]:X.FLOAT,[r.DEPTH_STENCIL]:X.FLOAT},e}function Kd(r){let e;return"WebGL2RenderingContext"in globalThis&&r instanceof globalThis.WebGL2RenderingContext?e={[ae.UNSIGNED_BYTE]:{[W.RGBA]:r.RGBA8,[W.RGB]:r.RGB8,[W.RG]:r.RG8,[W.RED]:r.R8,[W.RGBA_INTEGER]:r.RGBA8UI,[W.RGB_INTEGER]:r.RGB8UI,[W.RG_INTEGER]:r.RG8UI,[W.RED_INTEGER]:r.R8UI,[W.ALPHA]:r.ALPHA,[W.LUMINANCE]:r.LUMINANCE,[W.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ae.BYTE]:{[W.RGBA]:r.RGBA8_SNORM,[W.RGB]:r.RGB8_SNORM,[W.RG]:r.RG8_SNORM,[W.RED]:r.R8_SNORM,[W.RGBA_INTEGER]:r.RGBA8I,[W.RGB_INTEGER]:r.RGB8I,[W.RG_INTEGER]:r.RG8I,[W.RED_INTEGER]:r.R8I},[ae.UNSIGNED_SHORT]:{[W.RGBA_INTEGER]:r.RGBA16UI,[W.RGB_INTEGER]:r.RGB16UI,[W.RG_INTEGER]:r.RG16UI,[W.RED_INTEGER]:r.R16UI,[W.DEPTH_COMPONENT]:r.DEPTH_COMPONENT16},[ae.SHORT]:{[W.RGBA_INTEGER]:r.RGBA16I,[W.RGB_INTEGER]:r.RGB16I,[W.RG_INTEGER]:r.RG16I,[W.RED_INTEGER]:r.R16I},[ae.UNSIGNED_INT]:{[W.RGBA_INTEGER]:r.RGBA32UI,[W.RGB_INTEGER]:r.RGB32UI,[W.RG_INTEGER]:r.RG32UI,[W.RED_INTEGER]:r.R32UI,[W.DEPTH_COMPONENT]:r.DEPTH_COMPONENT24},[ae.INT]:{[W.RGBA_INTEGER]:r.RGBA32I,[W.RGB_INTEGER]:r.RGB32I,[W.RG_INTEGER]:r.RG32I,[W.RED_INTEGER]:r.R32I},[ae.FLOAT]:{[W.RGBA]:r.RGBA32F,[W.RGB]:r.RGB32F,[W.RG]:r.RG32F,[W.RED]:r.R32F,[W.DEPTH_COMPONENT]:r.DEPTH_COMPONENT32F},[ae.HALF_FLOAT]:{[W.RGBA]:r.RGBA16F,[W.RGB]:r.RGB16F,[W.RG]:r.RG16F,[W.RED]:r.R16F},[ae.UNSIGNED_SHORT_5_6_5]:{[W.RGB]:r.RGB565},[ae.UNSIGNED_SHORT_4_4_4_4]:{[W.RGBA]:r.RGBA4},[ae.UNSIGNED_SHORT_5_5_5_1]:{[W.RGBA]:r.RGB5_A1},[ae.UNSIGNED_INT_2_10_10_10_REV]:{[W.RGBA]:r.RGB10_A2,[W.RGBA_INTEGER]:r.RGB10_A2UI},[ae.UNSIGNED_INT_10F_11F_11F_REV]:{[W.RGB]:r.R11F_G11F_B10F},[ae.UNSIGNED_INT_5_9_9_9_REV]:{[W.RGB]:r.RGB9_E5},[ae.UNSIGNED_INT_24_8]:{[W.DEPTH_STENCIL]:r.DEPTH24_STENCIL8},[ae.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[W.DEPTH_STENCIL]:r.DEPTH32F_STENCIL8}}:e={[ae.UNSIGNED_BYTE]:{[W.RGBA]:r.RGBA,[W.RGB]:r.RGB,[W.ALPHA]:r.ALPHA,[W.LUMINANCE]:r.LUMINANCE,[W.LUMINANCE_ALPHA]:r.LUMINANCE_ALPHA},[ae.UNSIGNED_SHORT_5_6_5]:{[W.RGB]:r.RGB},[ae.UNSIGNED_SHORT_4_4_4_4]:{[W.RGBA]:r.RGBA},[ae.UNSIGNED_SHORT_5_5_5_1]:{[W.RGBA]:r.RGBA}},e}class Ll{constructor(e){this.renderer=e,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new ce,this.hasIntegerTextures=!1}contextChange(){const e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=Kd(e),this.samplerTypes=qd(e);const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(let s=0;s<t;s++)this.boundTextures[s]=null;this.emptyTextures={};const i=new yn(e.createTexture());e.bindTexture(e.TEXTURE_2D,i.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=i,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new yn(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(let s=0;s<6;s++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(let s=0;s<this.boundTextures.length;s++)this.bind(null,s)}bind(e,t=0){const{gl:i}=this;if(e=e?.castToBaseTexture(),e?.valid&&!e.parentTextureArray){e.touched=this.renderer.textureGC.count;const s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[t]!==e&&(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId?(this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),this.updateTexture(e)):s.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(e),this.boundTextures[t]=e}else this.currentLocation!==t&&(this.currentLocation=t,i.activeTexture(i.TEXTURE0+t)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[t]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture}unbind(e){const{gl:t,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let s=0;s<i.length;s++)i[s]===this.unknownTexture&&this.bind(null,s)}for(let s=0;s<i.length;s++)i[s]===e&&(this.currentLocation!==s&&(t.activeTexture(t.TEXTURE0+s),this.currentLocation=s),t.bindTexture(e.target,this.emptyTextures[e.target].texture),i[s]=null)}ensureSamplerType(e){const{boundTextures:t,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let n=e-1;n>=0;--n){const a=t[n];a&&a._glTextures[s].samplerType!==X.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(e){const t=new yn(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t}initTextureType(e,t){t.internalFormat=this.internalFormats[e.type]?.[e.format]??e.format,t.samplerType=this.samplerTypes[t.internalFormat]??X.FLOAT,this.webGLVersion===2&&e.type===ae.HALF_FLOAT?t.type=this.gl.HALF_FLOAT:t.type=e.type}updateTexture(e){const t=e._glTextures[this.CONTEXT_UID];if(!t)return;const i=this.renderer;if(this.initTextureType(e,t),e.resource?.upload(i,e,t))t.samplerType!==X.FLOAT&&(this.hasIntegerTextures=!0);else{const s=e.realWidth,n=e.realHeight,a=i.gl;(t.width!==s||t.height!==n||t.dirtyId<0)&&(t.width=s,t.height=n,a.texImage2D(e.target,0,t.internalFormat,s,n,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}destroyTexture(e,t){const{gl:i}=this;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),i.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){const s=this.managedTextures.indexOf(e);s!==-1&&yi(this.managedTextures,s,1)}}updateTextureStyle(e){const t=e._glTextures[this.CONTEXT_UID];t&&((e.mipmap===ut.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?t.mipmap=!1:t.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?t.wrapMode=Dt.CLAMP:t.wrapMode=e.wrapMode,e.resource?.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)}setStyle(e,t){const i=this.gl;if(t.mipmap&&e.mipmap!==ut.ON_MANUAL&&i.generateMipmap(e.target),i.texParameteri(e.target,i.TEXTURE_WRAP_S,t.wrapMode),i.texParameteri(e.target,i.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===gt.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===gt.LINEAR){const n=Math.min(e.anisotropicLevel,i.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,n)}}else i.texParameteri(e.target,i.TEXTURE_MIN_FILTER,e.scaleMode===gt.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(e.target,i.TEXTURE_MAG_FILTER,e.scaleMode===gt.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}Ll.extension={type:V.RendererSystem,name:"texture"};Z.add(Ll);class Ol{constructor(e){this.renderer=e}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glTransformFeedbacks[i]||this.createGLTransformFeedback(e);t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:e}=this;e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(e,t){const{gl:i,renderer:s}=this;t&&s.shader.bind(t),i.beginTransformFeedback(e)}endTransformFeedback(){const{gl:e}=this;e.endTransformFeedback()}createGLTransformFeedback(e){const{gl:t,renderer:i,CONTEXT_UID:s}=this,n=t.createTransformFeedback();e._glTransformFeedbacks[s]=n,t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,n);for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];o&&(i.buffer.update(o),o._glBuffers[s].refCount++,t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,a,o._glBuffers[s].buffer||null))}return t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null),e.disposeRunner.add(this),n}disposeTransformFeedback(e,t){const i=e._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this);const n=this.renderer.buffer;if(n)for(let a=0;a<e.buffers.length;a++){const o=e.buffers[a];if(!o)continue;const h=o._glBuffers[this.CONTEXT_UID];h&&(h.refCount--,h.refCount===0&&!t&&n.dispose(o,t))}i&&(t||s.deleteTransformFeedback(i),delete e._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Ol.extension={type:V.RendererSystem,name:"transformFeedback"};Z.add(Ol);class Fs{constructor(e){this.renderer=e}init(e){this.screen=new le(0,0,e.width,e.height),this.element=e.view||j.ADAPTER.createCanvas(),this.resolution=e.resolution||j.RESOLUTION,this.autoDensity=!!e.autoDensity}resizeView(e,t){this.element.width=Math.round(e*this.resolution),this.element.height=Math.round(t*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(e){e&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}Fs.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Fs.extension={type:[V.RendererSystem,V.CanvasRendererSystem],name:"_view"};Z.add(Fs);j.PREFER_ENV=Qt.WEBGL2;j.STRICT_TEXTURE_CACHE=!1;j.RENDER_OPTIONS={...Bs.defaultOptions,...Is.defaultOptions,...Fs.defaultOptions,...Ds.defaultOptions};Object.defineProperties(j,{WRAP_MODE:{get(){return ce.defaultOptions.wrapMode},set(r){de("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),ce.defaultOptions.wrapMode=r}},SCALE_MODE:{get(){return ce.defaultOptions.scaleMode},set(r){de("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),ce.defaultOptions.scaleMode=r}},MIPMAP_TEXTURES:{get(){return ce.defaultOptions.mipmap},set(r){de("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),ce.defaultOptions.mipmap=r}},ANISOTROPIC_LEVEL:{get(){return ce.defaultOptions.anisotropicLevel},set(r){de("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),ce.defaultOptions.anisotropicLevel=r}},FILTER_RESOLUTION:{get(){return de("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),ke.defaultResolution},set(r){ke.defaultResolution=r}},FILTER_MULTISAMPLE:{get(){return de("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),ke.defaultMultisample},set(r){ke.defaultMultisample=r}},SPRITE_MAX_TEXTURES:{get(){return Vt.defaultMaxTextures},set(r){de("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Vt.defaultMaxTextures=r}},SPRITE_BATCH_SIZE:{get(){return Vt.defaultBatchSize},set(r){de("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Vt.defaultBatchSize=r}},CAN_UPLOAD_SAME_BUFFER:{get(){return Vt.canUploadSameBuffer},set(r){de("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Vt.canUploadSameBuffer=r}},GC_MODE:{get(){return Xt.defaultMode},set(r){de("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Xt.defaultMode=r}},GC_MAX_IDLE:{get(){return Xt.defaultMaxIdle},set(r){de("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Xt.defaultMaxIdle=r}},GC_MAX_CHECK_COUNT:{get(){return Xt.defaultCheckCountMax},set(r){de("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Xt.defaultCheckCountMax=r}},PRECISION_VERTEX:{get(){return xt.defaultVertexPrecision},set(r){de("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),xt.defaultVertexPrecision=r}},PRECISION_FRAGMENT:{get(){return xt.defaultFragmentPrecision},set(r){de("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),xt.defaultFragmentPrecision=r}}});var Jt=(r=>(r[r.INTERACTION=50]="INTERACTION",r[r.HIGH=25]="HIGH",r[r.NORMAL=0]="NORMAL",r[r.LOW=-25]="LOW",r[r.UTILITY=-50]="UTILITY",r))(Jt||{});class vn{constructor(e,t=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=e,this.context=t,this.priority=i,this.once=s}match(e,t=null){return this.fn===e&&this.context===t}emit(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));const t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t}connect(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this}destroy(e=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const t=this.next;return this.next=e?null:t,this.previous=null,t}}const kl=class He{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new vn(null,null,1/0),this.deltaMS=1/He.targetFPMS,this.elapsedMS=1/He.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,i=Jt.NORMAL){return this._addListener(new vn(e,t,i))}addOnce(e,t,i=Jt.NORMAL){return this._addListener(new vn(e,t,i,!0))}_addListener(e){let t=this._head.next,i=this._head;if(!t)e.connect(i);else{for(;t;){if(e.priority>t.priority){e.connect(i);break}i=t,t=t.next}e.previous||e.connect(i)}return this._startIfPossible(),this}remove(e,t){let i=this._head.next;for(;i;)i.match(e,t)?i=i.destroy():i=i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const n=e-this._lastFrame|0;if(n<this._minElapsedMS)return;this._lastFrame=e-n%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*He.targetFPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),i=Math.min(Math.max(0,t)/1e3,He.targetFPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!He._shared){const e=He._shared=new He;e.autoStart=!0,e._protected=!0}return He._shared}static get system(){if(!He._system){const e=He._system=new He;e.autoStart=!0,e._protected=!0}return He._system}};kl.targetFPMS=.06;let We=kl;Object.defineProperties(j,{TARGET_FPMS:{get(){return We.targetFPMS},set(r){de("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),We.targetFPMS=r}}});class Nl{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,Jt.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?We.shared:new We,e.autoStart&&this.start()}static destroy(){if(this._ticker){const e=this._ticker;this.ticker=null,e.destroy()}}}Nl.extension=V.Application;Z.add(Nl);const Ul=[];Z.handleByList(V.Renderer,Ul);function Jd(r){for(const e of Ul)if(e.test(r))return new e(r);throw new Error("Unable to auto-detect a suitable renderer.")}var Zd=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Qd=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const ep=Zd,Gl=Qd;class Hl{constructor(e){this.renderer=e}contextChange(e){let t;if(this.renderer.context.webGLVersion===1){const i=e.getParameter(e.FRAMEBUFFER_BINDING);e.bindFramebuffer(e.FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.FRAMEBUFFER,i)}else{const i=e.getParameter(e.DRAW_FRAMEBUFFER_BINDING);e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),t=e.getParameter(e.SAMPLES),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,i)}t>=Me.HIGH?this.multisample=Me.HIGH:t>=Me.MEDIUM?this.multisample=Me.MEDIUM:t>=Me.LOW?this.multisample=Me.LOW:this.multisample=Me.NONE}destroy(){}}Hl.extension={type:V.RendererSystem,name:"_multisample"};Z.add(Hl);class tp{constructor(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Wl{constructor(e){this.renderer=e,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glBuffers[i]||this.createGLBuffer(e);t.bindBuffer(e.type,s.buffer)}unbind(e){const{gl:t}=this;t.bindBuffer(e,null)}bindBufferBase(e,t){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[t]!==e){const n=e._glBuffers[s]||this.createGLBuffer(e);this.boundBufferBases[t]=e,i.bindBufferBase(i.UNIFORM_BUFFER,t,n.buffer)}}bindBufferRange(e,t,i){const{gl:s,CONTEXT_UID:n}=this;i=i||0;const a=e._glBuffers[n]||this.createGLBuffer(e);s.bindBufferRange(s.UNIFORM_BUFFER,t||0,a.buffer,i*256,256)}update(e){const{gl:t,CONTEXT_UID:i}=this,s=e._glBuffers[i]||this.createGLBuffer(e);if(e._updateID!==s.updateID)if(s.updateID=e._updateID,t.bindBuffer(e.type,s.buffer),s.byteLength>=e.data.byteLength)t.bufferSubData(e.type,0,e.data);else{const n=e.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,t.bufferData(e.type,e.data,n)}}dispose(e,t){if(!this.managedBuffers[e.id])return;delete this.managedBuffers[e.id];const i=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),i&&(t||s.deleteBuffer(i.buffer),delete e._glBuffers[this.CONTEXT_UID])}disposeAll(e){const t=Object.keys(this.managedBuffers);for(let i=0;i<t.length;i++)this.dispose(this.managedBuffers[t[i]],e)}createGLBuffer(e){const{CONTEXT_UID:t,gl:i}=this;return e._glBuffers[t]=new tp(i.createBuffer()),this.managedBuffers[e.id]=e,e.disposeRunner.add(this),e._glBuffers[t]}}Wl.extension={type:V.RendererSystem,name:"buffer"};Z.add(Wl);class zl{constructor(e){this.renderer=e}render(e,t){const i=this.renderer;let s,n,a,o;if(t&&(s=t.renderTexture,n=t.clear,a=t.transform,o=t.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=a,!i.context.isLost){if(s||(this.lastObjectRendered=e),!o){const h=e.enableTempParent();e.updateTransform(),e.disableTempParent(h)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(n??i.background.clearBeforeRender)&&i.renderTexture.clear(),e.render(i),i.batch.currentRenderer.flush(),s&&(t.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}zl.extension={type:V.RendererSystem,name:"objectRenderer"};Z.add(zl);const ws=class Xn extends Yd{constructor(e){super(),this.type=Vh.WEBGL,e=Object.assign({},j.RENDER_OPTIONS,e),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new tt({projectionMatrix:new Te},!0);const t={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Xn.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(t),"useContextAlpha"in e&&(de("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),e.premultipliedAlpha=e.useContextAlpha&&e.useContextAlpha!=="notMultiplied",e.backgroundAlpha=e.useContextAlpha===!1?1:e.backgroundAlpha),this._plugin.rendererPlugins=Xn.__plugins,this.options=e,this.startup.run(this.options)}static test(e){return e?.forceCanvas?!1:Su()}render(e,t){this.objectRenderer.render(e,t)}resize(e,t){this._view.resizeView(e,t)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(e=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:e}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(e){this._view.resolution=e,this.runners.resolutionChange.emit(e)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return de("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return de("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return de("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return de("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(e){de("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=e}get backgroundAlpha(){return de("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(e){de("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=e}get powerPreference(){return de("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(e,t){return this.textureGenerator.generateTexture(e,t)}};ws.extension={type:V.Renderer,priority:1},ws.__plugins={},ws.__systems={};let _a=ws;Z.handleByMap(V.RendererPlugin,_a.__plugins);Z.handleByMap(V.RendererSystem,_a.__systems);Z.add(_a);class $l extends zi{constructor(e,t){const{width:i,height:s}=t||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let n=0;n<e;n++){const a=new ce;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=e,this._load=null,this.baseTexture=null}initFromArray(e,t){for(let i=0;i<this.length;i++)e[i]&&(e[i].castToBaseTexture?this.addBaseTextureAt(e[i].castToBaseTexture(),i):e[i]instanceof zi?this.addResourceAt(e[i],i):this.addResourceAt(hl(e[i],t),i))}dispose(){for(let e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(e,t){if(!this.items[t])throw new Error(`Index ${t} is out of bounds`);return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this}bind(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=e,this.items[t].on("update",e.update,e)}unbind(e){super.unbind(e);for(let t=0;t<this.length;t++)this.items[t].parentTextureArray=null,this.items[t].off("update",e.update,e)}load(){if(this._load)return this._load;const e=this.items.map(t=>t.resource).filter(t=>t).map(t=>t.load());return this._load=Promise.all(e).then(()=>{const{realWidth:t,realHeight:i}=this.items[0];return this.resize(t,i),this.update(),Promise.resolve(this)}),this._load}}class ip extends $l{constructor(e,t){const{width:i,height:s}=t||{};let n,a;Array.isArray(e)?(n=e,a=e.length):a=e,super(a,{width:i,height:s}),n&&this.initFromArray(n,t)}addBaseTextureAt(e,t){if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(e){super.bind(e),e.target=gi.TEXTURE_2D_ARRAY}upload(e,t,i){const{length:s,itemDirtyIds:n,items:a}=this,{gl:o}=e;i.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,t.format,i.type,null);for(let h=0;h<s;h++){const l=a[h];n[h]<l.dirtyId&&(n[h]=l.dirtyId,l.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,h,l.resource.width,l.resource.height,1,t.format,i.type,l.resource.source))}return!0}}class sp extends wt{constructor(e){super(e)}static test(e){const{OffscreenCanvas:t}=globalThis;return t&&e instanceof t?!0:globalThis.HTMLCanvasElement&&e instanceof HTMLCanvasElement}}const Vl=class Oi extends $l{constructor(e,t){const{width:i,height:s,autoLoad:n,linkBaseTexture:a}=t||{};if(e&&e.length!==Oi.SIDES)throw new Error(`Invalid length. Got ${e.length}, expected 6`);super(6,{width:i,height:s});for(let o=0;o<Oi.SIDES;o++)this.items[o].target=gi.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=a!==!1,e&&this.initFromArray(e,t),n!==!1&&this.load()}bind(e){super.bind(e),e.target=gi.TEXTURE_CUBE_MAP}addBaseTextureAt(e,t,i){if(i===void 0&&(i=this.linkBaseTexture),!this.items[t])throw new Error(`Index ${t} is out of bounds`);if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,t);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=gi.TEXTURE_CUBE_MAP_POSITIVE_X+t,e.parentTextureArray=this.baseTexture,this.items[t]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[t]=e,this}upload(e,t,i){const s=this.itemDirtyIds;for(let n=0;n<Oi.SIDES;n++){const a=this.items[n];(s[n]<a.dirtyId||i.dirtyId<t.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(e,a,i),s[n]=a.dirtyId):s[n]<-1&&(e.gl.texImage2D(a.target,0,i.internalFormat,t.realWidth,t.realHeight,0,t.format,i.type,null),s[n]=-1))}return!0}static test(e){return Array.isArray(e)&&e.length===Oi.SIDES}};Vl.SIDES=6;let rp=Vl;class mi extends wt{constructor(e,t){t=t||{};let i,s,n;typeof e=="string"?(i=mi.EMPTY,s=e,n=!0):(i=e,s=null,n=!1),super(i),this.url=s,this.crossOrigin=t.crossOrigin??!0,this.alphaMode=typeof t.alphaMode=="number"?t.alphaMode:null,this.ownsImageBitmap=t.ownsImageBitmap??n,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(e,t)=>{if(this.url===null){e(this);return}try{const i=await j.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const s=await i.blob();if(this.destroyed)return;const n=await createImageBitmap(s,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===Ue.UNPACK?"premultiply":"none"});if(this.destroyed){n.close();return}this.source=n,this.update(),e(this)}catch(i){if(this.destroyed)return;t(i),this.onError.emit(i)}}),this._load)}upload(e,t,i){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(t.alphaMode=this.alphaMode),super.upload(e,t,i)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(e){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof e=="string"||e instanceof ImageBitmap)}static get EMPTY(){return mi._EMPTY=mi._EMPTY??j.ADAPTER.createCanvas(0,0),mi._EMPTY}}const jn=class Ts extends wt{constructor(e,t){t=t||{},super(j.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=e,this.scale=t.scale||1,this._overrideWidth=t.width,this._overrideHeight=t.height,this._resolve=null,this._crossorigin=t.crossorigin,this._load=null,t.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(e=>{if(this._resolve=()=>{this.update(),e(this)},Ts.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const e=new Image;wt.crossOrigin(e,this.svg,this._crossorigin),e.src=this.svg,e.onerror=t=>{this._resolve&&(e.onerror=null,this.onError.emit(t))},e.onload=()=>{if(!this._resolve)return;const t=e.width,i=e.height;if(!t||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=t*this.scale,n=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*t,n=this._overrideHeight||this._overrideWidth/t*i),s=Math.round(s),n=Math.round(n);const a=this.source;a.width=s,a.height=n,a._pixiId=`canvas_${Kt()}`,a.getContext("2d").drawImage(e,0,0,t,i,0,0,s,n),this._resolve(),this._resolve=null}}static getSize(e){const t=Ts.SVG_SIZE.exec(e),i={};return t&&(i[t[1]]=Math.round(parseFloat(t[3])),i[t[5]]=Math.round(parseFloat(t[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(e,t){return t==="svg"||typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&Ts.SVG_XML.test(e)}};jn.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,jn.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Yn=jn;class np extends wt{constructor(e){super(e)}static test(e){return!!globalThis.VideoFrame&&e instanceof globalThis.VideoFrame}}const qn=class Kn extends wt{constructor(e,t){if(t=t||{},!(e instanceof HTMLVideoElement)){const i=document.createElement("video");t.autoLoad!==!1&&i.setAttribute("preload","auto"),t.playsinline!==!1&&(i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline","")),t.muted===!0&&(i.setAttribute("muted",""),i.muted=!0),t.loop===!0&&i.setAttribute("loop",""),t.autoPlay!==!1&&i.setAttribute("autoplay",""),typeof e=="string"&&(e=[e]);const s=e[0].src||e[0];wt.crossOrigin(i,s,t.crossorigin);for(let n=0;n<e.length;++n){const a=document.createElement("source");let{src:o,mime:h}=e[n];if(o=o||e[n],o.startsWith("data:"))h=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){const l=o.split("?").shift().toLowerCase(),c=l.slice(l.lastIndexOf(".")+1);h=h||Kn.MIME_TYPES[c]||`video/${c}`}a.src=o,h&&(a.type=h),i.appendChild(a)}e=i}super(e),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}update(e=0){if(!this.destroyed){if(this._updateFPS){const t=We.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const e=this.source;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlay),e.addEventListener("error",this._onError,!0)),this._load=new Promise((t,i)=>{this.valid?t(this):(this._resolve=t,this._reject=i,e.load())}),this._load}_onError(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.source;return!e.paused&&!e.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);const t=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!t&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()}dispose(){this._configureAutoUpdate();const e=this.source;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(We.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(We.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(We.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e,t){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||Kn.TYPES.includes(t)}};qn.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qn.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let Xl=qn;On.push(mi,yl,sp,Xl,np,Yn,$s,rp,ip);class Ls{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(e){return this.minX>this.maxX||this.minY>this.maxY?le.EMPTY:(e=e||new le(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)}addPoint(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)}addPointMatrix(e,t){const{a:i,b:s,c:n,d:a,tx:o,ty:h}=e,l=i*t.x+n*t.y+o,c=s*t.x+a*t.y+h;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(e){let t=this.minX,i=this.minY,s=this.maxX,n=this.maxY,a=e[0],o=e[1];t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,a=e[2],o=e[3],t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,a=e[4],o=e[5],t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,a=e[6],o=e[7],t=a<t?a:t,i=o<i?o:i,s=a>s?a:s,n=o>n?o:n,this.minX=t,this.minY=i,this.maxX=s,this.maxY=n}addFrame(e,t,i,s,n){this.addFrameMatrix(e.worldTransform,t,i,s,n)}addFrameMatrix(e,t,i,s,n){const a=e.a,o=e.b,h=e.c,l=e.d,c=e.tx,u=e.ty;let d=this.minX,p=this.minY,f=this.maxX,g=this.maxY,m=a*t+h*i+c,y=o*t+l*i+u;d=m<d?m:d,p=y<p?y:p,f=m>f?m:f,g=y>g?y:g,m=a*s+h*i+c,y=o*s+l*i+u,d=m<d?m:d,p=y<p?y:p,f=m>f?m:f,g=y>g?y:g,m=a*t+h*n+c,y=o*t+l*n+u,d=m<d?m:d,p=y<p?y:p,f=m>f?m:f,g=y>g?y:g,m=a*s+h*n+c,y=o*s+l*n+u,d=m<d?m:d,p=y<p?y:p,f=m>f?m:f,g=y>g?y:g,this.minX=d,this.minY=p,this.maxX=f,this.maxY=g}addVertexData(e,t,i){let s=this.minX,n=this.minY,a=this.maxX,o=this.maxY;for(let h=t;h<i;h+=2){const l=e[h],c=e[h+1];s=l<s?l:s,n=c<n?c:n,a=l>a?l:a,o=c>o?c:o}this.minX=s,this.minY=n,this.maxX=a,this.maxY=o}addVertices(e,t,i,s){this.addVerticesMatrix(e.worldTransform,t,i,s)}addVerticesMatrix(e,t,i,s,n=0,a=n){const o=e.a,h=e.b,l=e.c,c=e.d,u=e.tx,d=e.ty;let p=this.minX,f=this.minY,g=this.maxX,m=this.maxY;for(let y=i;y<s;y+=2){const S=t[y],_=t[y+1],E=o*S+l*_+u,w=c*_+h*S+d;p=Math.min(p,E-n),g=Math.max(g,E+n),f=Math.min(f,w-a),m=Math.max(m,w+a)}this.minX=p,this.minY=f,this.maxX=g,this.maxY=m}addBounds(e){const t=this.minX,i=this.minY,s=this.maxX,n=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<i?e.minY:i,this.maxX=e.maxX>s?e.maxX:s,this.maxY=e.maxY>n?e.maxY:n}addBoundsMask(e,t){const i=e.minX>t.minX?e.minX:t.minX,s=e.minY>t.minY?e.minY:t.minY,n=e.maxX<t.maxX?e.maxX:t.maxX,a=e.maxY<t.maxY?e.maxY:t.maxY;if(i<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=i<o?i:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>c?a:c}}addBoundsMatrix(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)}addBoundsArea(e,t){const i=e.minX>t.x?e.minX:t.x,s=e.minY>t.y?e.minY:t.y,n=e.maxX<t.x+t.width?e.maxX:t.x+t.width,a=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(i<=n&&s<=a){const o=this.minX,h=this.minY,l=this.maxX,c=this.maxY;this.minX=i<o?i:o,this.minY=s<h?s:h,this.maxX=n>l?n:l,this.maxY=a>c?a:c}}pad(e=0,t=e){this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)}addFramePad(e,t,i,s,n,a){e-=n,t-=a,i+=n,s+=a,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>s?this.maxY:s}}class Ee extends $i{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new va,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ls,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(e){const t=Object.keys(e);for(let i=0;i<t.length;++i){const s=t[i];Object.defineProperty(Ee.prototype,s,Object.getOwnPropertyDescriptor(e,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new le),t=this._boundsRect),this._bounds.getRectangle(t)}getLocalBounds(e){e||(this._localBoundsRect||(this._localBoundsRect=new le),e=this._localBoundsRect),this._localBounds||(this._localBounds=new Ls);const t=this.transform,i=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=i?.worldAlpha??1,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,n=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,e);return this.parent=i,this.transform=t,this._bounds=s,this._bounds.updateID+=this._boundsID-n,a}toGlobal(e,t,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)}toLocal(e,t,i,s){return t&&(e=t.toGlobal(e,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,i)}setParent(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e}removeFromParent(){this.parent?.removeChild(this)}setTransform(e=0,t=0,i=1,s=1,n=0,a=0,o=0,h=0,l=0){return this.position.x=e,this.position.y=t,this.scale.x=i||1,this.scale.y=s||1,this.rotation=n,this.skew.x=a,this.skew.y=o,this.pivot.x=h,this.pivot.y=l,this}destroy(e){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new ap),this.tempDisplayObjectParent}enableTempParent(){const e=this.parent;return this.parent=this._tempDisplayObjectParent,e}disableTempParent(e){this.parent=e}get x(){return this.position.x}set x(e){this.transform.position.x=e}get y(){return this.position.y}set y(e){this.transform.position.y=e}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(e){this.transform.position.copyFrom(e)}get scale(){return this.transform.scale}set scale(e){this.transform.scale.copyFrom(e)}get pivot(){return this.transform.pivot}set pivot(e){this.transform.pivot.copyFrom(e)}get skew(){return this.transform.skew}set skew(e){this.transform.skew.copyFrom(e)}get rotation(){return this.transform.rotation}set rotation(e){this.transform.rotation=e}get angle(){return this.transform.rotation*Zu}set angle(e){this.transform.rotation=e*Qu}get zIndex(){return this._zIndex}set zIndex(e){this._zIndex!==e&&(this._zIndex=e,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0}get mask(){return this._mask}set mask(e){if(this._mask!==e){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,t._maskRefCount===0&&(t.renderable=!0,t.isMask=!1))}if(this._mask=e,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount===0&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class ap extends Ee{constructor(){super(...arguments),this.sortDirty=null}}Ee.prototype.displayObjectUpdateTransform=Ee.prototype.updateTransform;const op=new Te;function hp(r,e){return r.zIndex===e.zIndex?r._lastSortedIndex-e._lastSortedIndex:r.zIndex-e.zIndex}const jl=class Jn extends Ee{constructor(){super(),this.children=[],this.sortableChildren=Jn.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(e){}addChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.addChild(e[t]);else{const t=e[0];t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.push(t),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",t,this,this.children.length-1),t.emit("added",this)}return e[0]}addChildAt(e,t){if(t<0||t>this.children.length)throw new Error(`${e}addChildAt: The index ${t} supplied is out of bounds ${this.children.length}`);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e}swapChildren(e,t){if(e===t)return;const i=this.getChildIndex(e),s=this.getChildIndex(t);this.children[i]=t,this.children[s]=e,this.onChildrenChange(i<s?i:s)}getChildIndex(e){const t=this.children.indexOf(e);if(t===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return t}setChildIndex(e,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(e);yi(this.children,i,1),this.children.splice(t,0,e),this.onChildrenChange(t)}getChildAt(e){if(e<0||e>=this.children.length)throw new Error(`getChildAt: Index (${e}) does not exist.`);return this.children[e]}removeChild(...e){if(e.length>1)for(let t=0;t<e.length;t++)this.removeChild(e[t]);else{const t=e[0],i=this.children.indexOf(t);if(i===-1)return null;t.parent=null,t.transform._parentID=-1,yi(this.children,i,1),this._boundsID++,this.onChildrenChange(i),t.emit("removed",this),this.emit("childRemoved",t,this,i)}return e[0]}removeChildAt(e){const t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,yi(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t}removeChildren(e=0,t=this.children.length){const i=e,s=t,n=s-i;let a;if(n>0&&n<=s){a=this.children.splice(i,n);for(let o=0;o<a.length;++o)a[o].parent=null,a[o].transform&&(a[o].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(let o=0;o<a.length;++o)a[o].emit("removed",this),this.emit("childRemoved",a[o],this,o);return a}else if(n===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let e=!1;for(let t=0,i=this.children.length;t<i;++t){const s=this.children[t];s._lastSortedIndex=t,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(hp),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let e=0,t=this.children.length;e<t;++e){const i=this.children[e];i.visible&&i.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let e=0;e<this.children.length;e++){const t=this.children[e];if(!(!t.visible||!t.renderable))if(t.calculateBounds(),t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;i?(i.calculateBounds(),this._bounds.addBoundsMask(t._bounds,i._bounds)):this._bounds.addBounds(t._bounds)}else t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(e,t=!1){const i=super.getLocalBounds(e);if(!t)for(let s=0,n=this.children.length;s<n;++s){const a=this.children[s];a.visible&&a.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(e){const t=e.renderTexture.sourceFrame;if(!(t.width>0&&t.height>0))return;let i,s;this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Jn.prototype._render&&(i=this.getBounds(!0));const n=e.projection.transform;if(n&&(s?(s=op.copyFrom(s),s.prepend(n)):s=n),i&&t.intersects(i,s))this._render(e);else if(this.cullArea)return;for(let a=0,o=this.children.length;a<o;++a){const h=this.children[a],l=h.cullable;h.cullable=l||!this.cullArea,h.render(e),h.cullable=l}}render(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters?.length)this.renderAdvanced(e);else if(this.cullable)this._renderWithCulling(e);else{this._render(e);for(let t=0,i=this.children.length;t<i;++t)this.children[t].render(e)}}renderAdvanced(e){const t=this.filters,i=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let n=0;n<t.length;n++)t[n].enabled&&this._enabledFilters.push(t[n])}const s=t&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==Pe.NONE));if(s&&e.batch.flush(),t&&this._enabledFilters?.length&&e.filter.push(this,this._enabledFilters),i&&e.mask.push(this,this._mask),this.cullable)this._renderWithCulling(e);else{this._render(e);for(let n=0,a=this.children.length;n<a;++n)this.children[n].render(e)}s&&e.batch.flush(),i&&e.mask.pop(this),t&&this._enabledFilters?.length&&e.filter.pop()}_render(e){}destroy(e){super.destroy(),this.sortDirty=!1;const t=typeof e=="boolean"?e:e?.children,i=this.removeChildren(0,this.children.length);if(t)for(let s=0;s<i.length;++s)i[s].destroy(e)}get width(){return this.scale.x*this.getLocalBounds().width}set width(e){const t=this.getLocalBounds().width;t!==0?this.scale.x=e/t:this.scale.x=1,this._width=e}get height(){return this.scale.y*this.getLocalBounds().height}set height(e){const t=this.getLocalBounds().height;t!==0?this.scale.y=e/t:this.scale.y=1,this._height=e}};jl.defaultSortableChildren=!1;let ve=jl;ve.prototype.containerUpdateTransform=ve.prototype.updateTransform;Object.defineProperties(j,{SORTABLE_CHILDREN:{get(){return ve.defaultSortableChildren},set(r){de("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ve.defaultSortableChildren=r}}});const Ri=new ye,lp=new Uint16Array([0,1,2,0,2,3]);class Ie extends ve{constructor(e){super(),this._anchor=new vt(this._onAnchorUpdate,this,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new _e(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=oe.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=e||K.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=lp,this.pluginName="batch",this.isSprite=!0,this._roundPixels=j.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=It(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=It(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const e=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===e._updateID)return;this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;const t=this.transform.worldTransform,i=t.a,s=t.b,n=t.c,a=t.d,o=t.tx,h=t.ty,l=this.vertexData,c=e.trim,u=e.orig,d=this._anchor;let p=0,f=0,g=0,m=0;if(c?(f=c.x-d._x*u.width,p=f+c.width,m=c.y-d._y*u.height,g=m+c.height):(f=-d._x*u.width,p=f+u.width,m=-d._y*u.height,g=m+u.height),l[0]=i*f+n*m+o,l[1]=a*m+s*f+h,l[2]=i*p+n*m+o,l[3]=a*m+s*p+h,l[4]=i*p+n*g+o,l[5]=a*g+s*p+h,l[6]=i*f+n*g+o,l[7]=a*g+s*f+h,this._roundPixels){const y=j.RESOLUTION;for(let S=0;S<l.length;++S)l[S]=Math.round(l[S]*y)/y}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const e=this._texture,t=this.vertexTrimmedData,i=e.orig,s=this._anchor,n=this.transform.worldTransform,a=n.a,o=n.b,h=n.c,l=n.d,c=n.tx,u=n.ty,d=-s._x*i.width,p=d+i.width,f=-s._y*i.height,g=f+i.height;if(t[0]=a*d+h*f+c,t[1]=l*f+o*d+u,t[2]=a*p+h*f+c,t[3]=l*f+o*p+u,t[4]=a*p+h*g+c,t[5]=l*g+o*p+u,t[6]=a*d+h*g+c,t[7]=l*g+o*d+u,this._roundPixels){const m=j.RESOLUTION;for(let y=0;y<t.length;++y)t[y]=Math.round(t[y]*m)/m}}_render(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)}_calculateBounds(){const e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(e){return this.children.length===0?(this._localBounds||(this._localBounds=new Ls),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new le),e=this._localBoundsRect),this._localBounds.getRectangle(e)):super.getLocalBounds.call(this,e)}containsPoint(e){this.worldTransform.applyInverse(e,Ri);const t=this._texture.orig.width,i=this._texture.orig.height,s=-t*this.anchor.x;let n=0;return Ri.x>=s&&Ri.x<s+t&&(n=-i*this.anchor.y,Ri.y>=n&&Ri.y<n+i)}destroy(e){if(super.destroy(e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof e=="boolean"?e:e?.texture){const t=typeof e=="boolean"?e:e?.baseTexture;this._texture.destroy(!!t)}this._texture=null}static from(e,t){const i=e instanceof K?e:K.from(e,t);return new Ie(i)}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(e){const t=It(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(e){const t=It(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get anchor(){return this._anchor}set anchor(e){this._anchor.copyFrom(e)}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||K.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))}}const Yl=new Te;Ee.prototype._cacheAsBitmap=!1;Ee.prototype._cacheData=null;Ee.prototype._cacheAsBitmapResolution=null;Ee.prototype._cacheAsBitmapMultisample=null;class cp{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Ee.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(r){r!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(r){r!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=r,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(r){if(this._cacheAsBitmap===r)return;this._cacheAsBitmap=r;let e;r?(this._cacheData||(this._cacheData=new cp),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}});Ee.prototype._renderCached=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(r),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(r))};Ee.prototype._initCachedDisplayObject=function(r){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,r.batch.flush();const t=this.getLocalBounds(new le,!0);if(this.filters?.length){const d=this.filters[0].padding;t.pad(d)}const i=this.cacheAsBitmapResolution||r.resolution;t.ceil(i),t.width=Math.max(t.width,1/i),t.height=Math.max(t.height,1/i);const s=r.renderTexture.current,n=r.renderTexture.sourceFrame.clone(),a=r.renderTexture.destinationFrame.clone(),o=r.projection.transform,h=ei.create({width:t.width,height:t.height,resolution:i,multisample:this.cacheAsBitmapMultisample??r.multisample}),l=`cacheAsBitmap_${Kt()}`;this._cacheData.textureCacheId=l,ce.addToCache(h.baseTexture,l),K.addToCache(h,l);const c=this.transform.localTransform.copyTo(Yl).invert().translate(-t.x,-t.y);this.render=this._cacheData.originalRender,r.render(this,{renderTexture:h,clear:!0,transform:c,skipUpdateTransform:!1}),r.framebuffer.blit(),r.projection.transform=o,r.renderTexture.bind(s,n,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const u=new Ie(h);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(t.x/t.width),u.anchor.y=-(t.y/t.height),u.alpha=e,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=u.containsPoint.bind(u)};Ee.prototype._renderCachedCanvas=function(r){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(r),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(r))};Ee.prototype._initCachedDisplayObjectCanvas=function(r){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(new le,!0),t=this.alpha;this.alpha=1;const i=r.canvasContext.activeContext,s=r._projTransform,n=this.cacheAsBitmapResolution||r.resolution;e.ceil(n),e.width=Math.max(e.width,1/n),e.height=Math.max(e.height,1/n);const a=ei.create({width:e.width,height:e.height,resolution:n}),o=`cacheAsBitmap_${Kt()}`;this._cacheData.textureCacheId=o,ce.addToCache(a.baseTexture,o),K.addToCache(a,o);const h=Yl;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=e.x,h.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,r.render(this,{renderTexture:a,clear:!0,transform:h,skipUpdateTransform:!1}),r.canvasContext.activeContext=i,r._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const l=new Ie(a);l.transform.worldTransform=this.transform.worldTransform,l.anchor.x=-(e.x/e.width),l.anchor.y=-(e.y/e.height),l.alpha=t,l._bounds=this._bounds,this._cacheData.sprite=l,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=r._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=l.containsPoint.bind(l)};Ee.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Ee.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Ee.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,ce.removeFromCache(this._cacheData.textureCacheId),K.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Ee.prototype._cacheAsBitmapDestroy=function(r){this.cacheAsBitmap=!1,this.destroy(r)};Ee.prototype.name=null;ve.prototype.getChildByName=function(r,e){for(let t=0,i=this.children.length;t<i;t++)if(this.children[t].name===r)return this.children[t];if(e)for(let t=0,i=this.children.length;t<i;t++){const s=this.children[t];if(!s.getChildByName)continue;const n=s.getChildByName(r,!0);if(n)return n}return null};Ee.prototype.getGlobalPosition=function(r=new ye,e=!1){return this.parent?this.parent.toGlobal(this.position,r,e):(r.x=this.position.x,r.y=this.position.y),r};var up=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class dp extends ke{constructor(e=1){super(ep,up,{uAlpha:1}),this.alpha=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}const pp={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},fp=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function mp(r){const e=pp[r],t=e.length;let i=fp,s="";const n="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let o=0;o<r;o++){let h=n.replace("%index%",o.toString());a=o,o>=t&&(a=r-o-1),h=h.replace("%value%",e[a].toString()),s+=h,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}const gp=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function yp(r,e){const t=Math.ceil(r/2);let i=gp,s="",n;e?n="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":n="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<r;a++){let o=n.replace("%index%",a.toString());o=o.replace("%sampleIndex%",`${a-(t-1)}.0`),s+=o,s+=`
`}return i=i.replace("%blur%",s),i=i.replace("%size%",r.toString()),i}class Zn extends ke{constructor(e,t=8,i=4,s=ke.defaultResolution,n=5){const a=yp(n,e),o=mp(n);super(a,o),this.horizontal=e,this.resolution=s,this._quality=0,this.quality=i,this.blur=t}apply(e,t,i,s){if(i?this.horizontal?this.uniforms.strength=1/i.width*(i.width/t.width):this.uniforms.strength=1/i.height*(i.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,t,i,s);else{const n=e.getFilterTexture(),a=e.renderer;let o=t,h=n;this.state.blend=!1,e.applyFilter(this,o,h,ot.CLEAR);for(let l=1;l<this.passes-1;l++){e.bindAndClear(o,ot.BLIT),this.uniforms.uSampler=h;const c=h;h=o,o=c,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,h,i,s),e.returnFilterTexture(n)}}get blur(){return this.strength}set blur(e){this.padding=1+Math.abs(e)*2,this.strength=e}get quality(){return this._quality}set quality(e){this._quality=e,this.passes=e}}class vp extends ke{constructor(e=8,t=4,i=ke.defaultResolution,s=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new Zn(!0,e,t,i,s),this.blurYFilter=new Zn(!1,e,t,i,s),this.resolution=i,this.quality=t,this.blur=e,this.repeatEdgePixels=!1}apply(e,t,i,s){const n=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(n&&a){const o=e.getFilterTexture();this.blurXFilter.apply(e,t,o,ot.CLEAR),this.blurYFilter.apply(e,o,i,s),e.returnFilterTexture(o)}else a?this.blurYFilter.apply(e,t,i,s):this.blurXFilter.apply(e,t,i,s)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(e){this.blurXFilter.quality=this.blurYFilter.quality=e}get blurX(){return this.blurXFilter.blur}set blurX(e){this.blurXFilter.blur=e,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(e){this.blurYFilter.blur=e,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(e){this.blurYFilter.blendMode=e}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(e){this._repeatEdgePixels=e,this.updatePadding()}}var xp=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class Qn extends ke{constructor(){const e={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Gl,xp,e),this.alpha=1}_loadMatrix(e,t=!1){let i=e;t&&(this._multiply(i,this.uniforms.m,e),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(e,t,i){return e[0]=t[0]*i[0]+t[1]*i[5]+t[2]*i[10]+t[3]*i[15],e[1]=t[0]*i[1]+t[1]*i[6]+t[2]*i[11]+t[3]*i[16],e[2]=t[0]*i[2]+t[1]*i[7]+t[2]*i[12]+t[3]*i[17],e[3]=t[0]*i[3]+t[1]*i[8]+t[2]*i[13]+t[3]*i[18],e[4]=t[0]*i[4]+t[1]*i[9]+t[2]*i[14]+t[3]*i[19]+t[4],e[5]=t[5]*i[0]+t[6]*i[5]+t[7]*i[10]+t[8]*i[15],e[6]=t[5]*i[1]+t[6]*i[6]+t[7]*i[11]+t[8]*i[16],e[7]=t[5]*i[2]+t[6]*i[7]+t[7]*i[12]+t[8]*i[17],e[8]=t[5]*i[3]+t[6]*i[8]+t[7]*i[13]+t[8]*i[18],e[9]=t[5]*i[4]+t[6]*i[9]+t[7]*i[14]+t[8]*i[19]+t[9],e[10]=t[10]*i[0]+t[11]*i[5]+t[12]*i[10]+t[13]*i[15],e[11]=t[10]*i[1]+t[11]*i[6]+t[12]*i[11]+t[13]*i[16],e[12]=t[10]*i[2]+t[11]*i[7]+t[12]*i[12]+t[13]*i[17],e[13]=t[10]*i[3]+t[11]*i[8]+t[12]*i[13]+t[13]*i[18],e[14]=t[10]*i[4]+t[11]*i[9]+t[12]*i[14]+t[13]*i[19]+t[14],e[15]=t[15]*i[0]+t[16]*i[5]+t[17]*i[10]+t[18]*i[15],e[16]=t[15]*i[1]+t[16]*i[6]+t[17]*i[11]+t[18]*i[16],e[17]=t[15]*i[2]+t[16]*i[7]+t[17]*i[12]+t[18]*i[17],e[18]=t[15]*i[3]+t[16]*i[8]+t[17]*i[13]+t[18]*i[18],e[19]=t[15]*i[4]+t[16]*i[9]+t[17]*i[14]+t[18]*i[19]+t[19],e}_colorMatrix(e){const t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t}brightness(e,t){const i=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}tint(e,t){const[i,s,n]=_e.shared.setValue(e).toArray(),a=[i,0,0,0,0,0,s,0,0,0,0,0,n,0,0,0,0,0,1,0];this._loadMatrix(a,t)}greyscale(e,t){const i=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(i,t)}blackAndWhite(e){const t=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(t,e)}hue(e,t){e=(e||0)/180*Math.PI;const i=Math.cos(e),s=Math.sin(e),n=Math.sqrt,a=1/3,o=n(a),h=i+(1-i)*a,l=a*(1-i)-o*s,c=a*(1-i)+o*s,u=a*(1-i)+o*s,d=i+a*(1-i),p=a*(1-i)-o*s,f=a*(1-i)-o*s,g=a*(1-i)+o*s,m=i+a*(1-i),y=[h,l,c,0,0,u,d,p,0,0,f,g,m,0,0,0,0,0,1,0];this._loadMatrix(y,t)}contrast(e,t){const i=(e||0)+1,s=-.5*(i-1),n=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(n,t)}saturate(e=0,t){const i=e*2/3+1,s=(i-1)*-.5,n=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(n,t)}desaturate(){this.saturate(-1)}negative(e){const t=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(t,e)}sepia(e){const t=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(t,e)}technicolor(e){const t=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(t,e)}polaroid(e){const t=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(t,e)}toBGR(e){const t=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(t,e)}kodachrome(e){const t=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(t,e)}browni(e){const t=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(t,e)}vintage(e){const t=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(t,e)}colorTone(e,t,i,s,n){e=e||.2,t=t||.15,i=i||16770432,s=s||3375104;const a=_e.shared,[o,h,l]=a.setValue(i).toArray(),[c,u,d]=a.setValue(s).toArray(),p=[.3,.59,.11,0,0,o,h,l,e,0,c,u,d,t,0,o-c,h-u,l-d,0,0];this._loadMatrix(p,n)}night(e,t){e=e||.1;const i=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(i,t)}predator(e,t){const i=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(i,t)}lsd(e){const t=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(t,e)}reset(){const e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)}get matrix(){return this.uniforms.m}set matrix(e){this.uniforms.m=e}get alpha(){return this.uniforms.uAlpha}set alpha(e){this.uniforms.uAlpha=e}}Qn.prototype.grayscale=Qn.prototype.greyscale;var _p=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,bp=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class wp extends ke{constructor(e,t){const i=new Te;e.renderable=!1,super(bp,_p,{mapSampler:e._texture,filterMatrix:i,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=e,this.maskMatrix=i,t==null&&(t=20),this.scale=new ye(t,t)}apply(e,t,i,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const n=this.maskSprite.worldTransform,a=Math.sqrt(n.a*n.a+n.b*n.b),o=Math.sqrt(n.c*n.c+n.d*n.d);a!==0&&o!==0&&(this.uniforms.rotation[0]=n.a/a,this.uniforms.rotation[1]=n.b/a,this.uniforms.rotation[2]=n.c/o,this.uniforms.rotation[3]=n.d/o),e.applyFilter(this,t,i,s)}get map(){return this.uniforms.mapSampler}set map(e){this.uniforms.mapSampler=e}}var Tp=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Sp=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class Ep extends ke{constructor(){super(Sp,Tp)}}var Ap=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class Cp extends ke{constructor(e=.5,t=Math.random()){super(Gl,Ap,{uNoise:0,uSeed:0}),this.noise=e,this.seed=t}get noise(){return this.uniforms.uNoise}set noise(e){this.uniforms.uNoise=e}get seed(){return this.uniforms.uSeed}set seed(e){this.uniforms.uSeed=e}}const mh={AlphaFilter:dp,BlurFilter:vp,BlurFilterPass:Zn,ColorMatrixFilter:Qn,DisplacementFilter:wp,FXAAFilter:Ep,NoiseFilter:Cp};Object.entries(mh).forEach(([r,e])=>{Object.defineProperty(mh,r,{get(){return de("7.1.0",`filters.${r} has moved to ${r}`),e}})});class Mp{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(e){this.removeTickerListener(),this.events=e,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(e){this._pauseUpdate=e}addTickerListener(){this.tickerAdded||!this.domElement||(We.system.add(this.tickerUpdate,this,Jt.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(We.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const e=this.events.rootPointerEvent;this.events.supportsTouchEvents&&e.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:e.clientX,clientY:e.clientY}))}tickerUpdate(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const Pt=new Mp;class Vi{constructor(e){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Vi.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ye,this.page=new ye,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=e}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(e,t,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(e,t,i,s,n){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Os extends Vi{constructor(){super(...arguments),this.client=new ye,this.movement=new ye,this.offset=new ye,this.global=new ye,this.screen=new ye}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(e,t,i){return e.worldTransform.applyInverse(i||this.global,t)}getModifierState(e){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(e)}initMouseEvent(e,t,i,s,n,a,o,h,l,c,u,d,p,f,g){throw new Error("Method not implemented.")}}class Ze extends Os{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class xi extends Os{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}xi.DOM_DELTA_PIXEL=0,xi.DOM_DELTA_LINE=1,xi.DOM_DELTA_PAGE=2;const Rp=2048,Pp=new ye,xn=new ye;class Ip{constructor(e){this.dispatch=new $i,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=e,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(e,t){this.mappingTable[e]||(this.mappingTable[e]=[]),this.mappingTable[e].push({fn:t,priority:0}),this.mappingTable[e].sort((i,s)=>i.priority-s.priority)}dispatchEvent(e,t){e.propagationStopped=!1,e.propagationImmediatelyStopped=!1,this.propagate(e,t),this.dispatch.emit(t||e.type,e)}mapEvent(e){if(!this.rootTarget)return;const t=this.mappingTable[e.type];if(t)for(let i=0,s=t.length;i<s;i++)t[i].fn(e);else console.warn(`[EventBoundary]: Event mapping not defined for ${e.type}`)}hitTest(e,t){Pt.pauseUpdate=!0;const i=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",s=this[i](this.rootTarget,this.rootTarget.eventMode,Pp.set(e,t),this.hitTestFn,this.hitPruneFn);return s&&s[0]}propagate(e,t){if(!e.target)return;const i=e.composedPath();e.eventPhase=e.CAPTURING_PHASE;for(let s=0,n=i.length-1;s<n;s++)if(e.currentTarget=i[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,this.notifyTarget(e,t),!(e.propagationStopped||e.propagationImmediatelyStopped)){e.eventPhase=e.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(e.currentTarget=i[s],this.notifyTarget(e,t),e.propagationStopped||e.propagationImmediatelyStopped)return}}all(e,t,i=this._allInteractiveElements){if(i.length===0)return;e.eventPhase=e.BUBBLING_PHASE;const s=Array.isArray(t)?t:[t];for(let n=i.length-1;n>=0;n--)s.forEach(a=>{e.currentTarget=i[n],this.notifyTarget(e,a)})}propagationPath(e){const t=[e];for(let i=0;i<Rp&&e!==this.rootTarget;i++){if(!e.parent)throw new Error("Cannot find propagation path to disconnected target");t.push(e.parent),e=e.parent}return t.reverse(),t}hitTestMoveRecursive(e,t,i,s,n,a=!1){let o=!1;if(this._interactivePrune(e))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Pt.pauseUpdate=!1),e.interactiveChildren&&e.children){const c=e.children;for(let u=c.length-1;u>=0;u--){const d=c[u],p=this.hitTestMoveRecursive(d,this._isInteractive(t)?t:d.eventMode,i,s,n,a||n(e,i));if(p){if(p.length>0&&!p[p.length-1].parent)continue;const f=e.isInteractive();(p.length>0||f)&&(f&&this._allInteractiveElements.push(e),p.push(e)),this._hitElements.length===0&&(this._hitElements=p),o=!0}}}const h=this._isInteractive(t),l=e.isInteractive();return h&&l&&this._allInteractiveElements.push(e),a||this._hitElements.length>0?null:o?this._hitElements:h&&!n(e,i)&&s(e,i)?l?[e]:[]:null}hitTestRecursive(e,t,i,s,n){if(this._interactivePrune(e)||n(e,i))return null;if((e.eventMode==="dynamic"||t==="dynamic")&&(Pt.pauseUpdate=!1),e.interactiveChildren&&e.children){const h=e.children;for(let l=h.length-1;l>=0;l--){const c=h[l],u=this.hitTestRecursive(c,this._isInteractive(t)?t:c.eventMode,i,s,n);if(u){if(u.length>0&&!u[u.length-1].parent)continue;const d=e.isInteractive();return(u.length>0||d)&&u.push(e),u}}}const a=this._isInteractive(t),o=e.isInteractive();return a&&s(e,i)?o?[e]:[]:null}_isInteractive(e){return e==="static"||e==="dynamic"}_interactivePrune(e){return!!(!e||e.isMask||!e.visible||!e.renderable||e.eventMode==="none"||e.eventMode==="passive"&&!e.interactiveChildren||e.isMask)}hitPruneFn(e,t){if(e.hitArea&&(e.worldTransform.applyInverse(t,xn),!e.hitArea.contains(xn.x,xn.y)))return!0;if(e._mask){const i=e._mask.isMaskData?e._mask.maskObject:e._mask;if(i&&!i.containsPoint?.(t))return!0}return!1}hitTestFn(e,t){return e.eventMode==="passive"?!1:e.hitArea?!0:e.containsPoint?e.containsPoint(t):!1}notifyTarget(e,t){t=t??e.type;const i=`on${t}`;e.currentTarget[i]?.(e);const s=e.eventPhase===e.CAPTURING_PHASE||e.eventPhase===e.AT_TARGET?`${t}capture`:t;this.notifyListeners(e,s),e.eventPhase===e.AT_TARGET&&this.notifyListeners(e,t)}mapPointerDown(e){if(!(e instanceof Ze)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.createPointerEvent(e);if(this.dispatchEvent(t,"pointerdown"),t.pointerType==="touch")this.dispatchEvent(t,"touchstart");else if(t.pointerType==="mouse"||t.pointerType==="pen"){const s=t.button===2;this.dispatchEvent(t,s?"rightdown":"mousedown")}const i=this.trackingData(e.pointerId);i.pressTargetsByButton[e.button]=t.composedPath(),this.freeEvent(t)}mapPointerMove(e){if(!(e instanceof Ze)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const t=this.createPointerEvent(e);this._isPointerMoveEvent=!1;const i=t.pointerType==="mouse"||t.pointerType==="pen",s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.overTargets);if(s.overTargets?.length>0&&n!==t.target){const h=e.type==="mousemove"?"mouseout":"pointerout",l=this.createPointerEvent(e,h,n);if(this.dispatchEvent(l,"pointerout"),i&&this.dispatchEvent(l,"mouseout"),!t.composedPath().includes(n)){const c=this.createPointerEvent(e,"pointerleave",n);for(c.eventPhase=c.AT_TARGET;c.target&&!t.composedPath().includes(c.target);)c.currentTarget=c.target,this.notifyTarget(c),i&&this.notifyTarget(c,"mouseleave"),c.target=c.target.parent;this.freeEvent(c)}this.freeEvent(l)}if(n!==t.target){const h=e.type==="mousemove"?"mouseover":"pointerover",l=this.clonePointerEvent(t,h);this.dispatchEvent(l,"pointerover"),i&&this.dispatchEvent(l,"mouseover");let c=n?.parent;for(;c&&c!==this.rootTarget.parent&&c!==t.target;)c=c.parent;if(!c||c===this.rootTarget.parent){const u=this.clonePointerEvent(t,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==n&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),i&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;this.freeEvent(u)}this.freeEvent(l)}const a=[],o=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(t,"pointermove"),o&&a.push("globalpointermove"),t.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(t,"touchmove"),o&&a.push("globaltouchmove")),i&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(t,"mousemove"),o&&a.push("globalmousemove"),this.cursor=t.target?.cursor),a.length>0&&this.all(t,a),this._allInteractiveElements.length=0,this._hitElements.length=0,s.overTargets=t.composedPath(),this.freeEvent(t)}mapPointerOver(e){if(!(e instanceof Ze)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.createPointerEvent(e),s=i.pointerType==="mouse"||i.pointerType==="pen";this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),i.pointerType==="mouse"&&(this.cursor=i.target?.cursor);const n=this.clonePointerEvent(i,"pointerenter");for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),s&&this.notifyTarget(n,"mouseenter"),n.target=n.target.parent;t.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(n)}mapPointerOut(e){if(!(e instanceof Ze)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId);if(t.overTargets){const i=e.pointerType==="mouse"||e.pointerType==="pen",s=this.findMountedTarget(t.overTargets),n=this.createPointerEvent(e,"pointerout",s);this.dispatchEvent(n),i&&this.dispatchEvent(n,"mouseout");const a=this.createPointerEvent(e,"pointerleave",s);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),i&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;t.overTargets=null,this.freeEvent(n),this.freeEvent(a)}this.cursor=null}mapPointerUp(e){if(!(e instanceof Ze)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=performance.now(),i=this.createPointerEvent(e);if(this.dispatchEvent(i,"pointerup"),i.pointerType==="touch")this.dispatchEvent(i,"touchend");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const o=i.button===2;this.dispatchEvent(i,o?"rightup":"mouseup")}const s=this.trackingData(e.pointerId),n=this.findMountedTarget(s.pressTargetsByButton[e.button]);let a=n;if(n&&!i.composedPath().includes(n)){let o=n;for(;o&&!i.composedPath().includes(o);){if(i.currentTarget=o,this.notifyTarget(i,"pointerupoutside"),i.pointerType==="touch")this.notifyTarget(i,"touchendoutside");else if(i.pointerType==="mouse"||i.pointerType==="pen"){const h=i.button===2;this.notifyTarget(i,h?"rightupoutside":"mouseupoutside")}o=o.parent}delete s.pressTargetsByButton[e.button],a=o}if(a){const o=this.clonePointerEvent(i,"click");o.target=a,o.path=null,s.clicksByButton[e.button]||(s.clicksByButton[e.button]={clickCount:0,target:o.target,timeStamp:t});const h=s.clicksByButton[e.button];if(h.target===o.target&&t-h.timeStamp<200?++h.clickCount:h.clickCount=1,h.target=o.target,h.timeStamp=t,o.detail=h.clickCount,o.pointerType==="mouse"){const l=o.button===2;this.dispatchEvent(o,l?"rightclick":"click")}else o.pointerType==="touch"&&this.dispatchEvent(o,"tap");this.dispatchEvent(o,"pointertap"),this.freeEvent(o)}this.freeEvent(i)}mapPointerUpOutside(e){if(!(e instanceof Ze)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const t=this.trackingData(e.pointerId),i=this.findMountedTarget(t.pressTargetsByButton[e.button]),s=this.createPointerEvent(e);if(i){let n=i;for(;n;)s.currentTarget=n,this.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch"?this.notifyTarget(s,"touchendoutside"):(s.pointerType==="mouse"||s.pointerType==="pen")&&this.notifyTarget(s,s.button===2?"rightupoutside":"mouseupoutside"),n=n.parent;delete t.pressTargetsByButton[e.button]}this.freeEvent(s)}mapWheel(e){if(!(e instanceof xi)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const t=this.createWheelEvent(e);this.dispatchEvent(t),this.freeEvent(t)}findMountedTarget(e){if(!e)return null;let t=e[0];for(let i=1;i<e.length&&e[i].parent===t;i++)t=e[i];return t}createPointerEvent(e,t,i){const s=this.allocateEvent(Ze);return this.copyPointerData(e,s),this.copyMouseData(e,s),this.copyData(e,s),s.nativeEvent=e.nativeEvent,s.originalEvent=e,s.target=i??this.hitTest(s.global.x,s.global.y)??this._hitElements[0],typeof t=="string"&&(s.type=t),s}createWheelEvent(e){const t=this.allocateEvent(xi);return this.copyWheelData(e,t),this.copyMouseData(e,t),this.copyData(e,t),t.nativeEvent=e.nativeEvent,t.originalEvent=e,t.target=this.hitTest(t.global.x,t.global.y),t}clonePointerEvent(e,t){const i=this.allocateEvent(Ze);return i.nativeEvent=e.nativeEvent,i.originalEvent=e.originalEvent,this.copyPointerData(e,i),this.copyMouseData(e,i),this.copyData(e,i),i.target=e.target,i.path=e.composedPath().slice(),i.type=t??i.type,i}copyWheelData(e,t){t.deltaMode=e.deltaMode,t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ}copyPointerData(e,t){e instanceof Ze&&t instanceof Ze&&(t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist)}copyMouseData(e,t){e instanceof Os&&t instanceof Os&&(t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.copyFrom(e.client),t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.copyFrom(e.movement),t.screen.copyFrom(e.screen),t.shiftKey=e.shiftKey,t.global.copyFrom(e.global))}copyData(e,t){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.detail=e.detail,t.view=e.view,t.which=e.which,t.layer.copyFrom(e.layer),t.page.copyFrom(e.page)}trackingData(e){return this.mappingState.trackingData[e]||(this.mappingState.trackingData[e]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[e]}allocateEvent(e){this.eventPool.has(e)||this.eventPool.set(e,[]);const t=this.eventPool.get(e).pop()||new e(this);return t.eventPhase=t.NONE,t.currentTarget=null,t.path=null,t.target=null,t}freeEvent(e){if(e.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const t=e.constructor;this.eventPool.has(t)||this.eventPool.set(t,[]),this.eventPool.get(t).push(e)}notifyListeners(e,t){const i=e.currentTarget._events[t];if(i&&e.currentTarget.isInteractive())if("fn"in i)i.once&&e.currentTarget.removeListener(t,i.fn,void 0,!0),i.fn.call(i.context,e);else for(let s=0,n=i.length;s<n&&!e.propagationImmediatelyStopped;s++)i[s].once&&e.currentTarget.removeListener(t,i[s].fn,void 0,!0),i[s].fn.call(i[s].context,e)}}const Bp=1,Dp={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},ea=class ta{constructor(e){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=e,this.rootBoundary=new Ip(null),Pt.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Ze(null),this.rootWheelEvent=new xi(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...ta.defaultEventFeatures},{set:(t,i,s)=>(i==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=s),t[i]=s,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(e){const{view:t,resolution:i}=this.renderer;this.setTargetElement(t),this.resolution=i,ta._defaultEventMode=e.eventMode??"auto",Object.assign(this.features,e.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(e){this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(e){e=e||"default";let t=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(t=!1),this.currentCursor===e)return;this.currentCursor=e;const i=this.cursorStyles[e];if(i)switch(typeof i){case"string":t&&(this.domElement.style.cursor=i);break;case"function":i(e);break;case"object":t&&Object.assign(this.domElement.style,i);break}else t&&typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.domElement.style.cursor=e)}get pointer(){return this.rootPointerEvent}onPointerDown(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(let i=0,s=t.length;i<s;i++){const n=t[i],a=this.bootstrapEvent(this.rootPointerEvent,n);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(e){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,Pt.pointerMoved();const t=this.normalizeToPointerData(e);for(let i=0,s=t.length;i<s;i++){const n=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let t=e.target;e.composedPath&&e.composedPath().length>0&&(t=e.composedPath()[0]);const i=t!==this.domElement?"outside":"",s=this.normalizeToPointerData(e);for(let n=0,a=s.length;n<a;n++){const o=this.bootstrapEvent(this.rootPointerEvent,s[n]);o.type+=i,this.rootBoundary.mapEvent(o)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(e){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const t=this.normalizeToPointerData(e);for(let i=0,s=t.length;i<s;i++){const n=this.bootstrapEvent(this.rootPointerEvent,t[i]);this.rootBoundary.mapEvent(n)}this.setCursor(this.rootBoundary.cursor)}onWheel(e){if(!this.features.wheel)return;const t=this.normalizeWheelEvent(e);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(t)}setTargetElement(e){this.removeEvents(),this.domElement=e,Pt.domElement=e,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;Pt.addTickerListener();const e=this.domElement.style;e&&(globalThis.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;Pt.removeTickerListener();const e=this.domElement.style;globalThis.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(e,t,i){const s=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},n=1/this.resolution;e.x=(t-s.left)*(this.domElement.width/s.width)*n,e.y=(i-s.top)*(this.domElement.height/s.height)*n}normalizeToPointerData(e){const t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(let i=0,s=e.changedTouches.length;i<s;i++){const n=e.changedTouches[i];typeof n.button>"u"&&(n.button=0),typeof n.buttons>"u"&&(n.buttons=1),typeof n.isPrimary>"u"&&(n.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof n.width>"u"&&(n.width=n.radiusX||1),typeof n.height>"u"&&(n.height=n.radiusY||1),typeof n.tiltX>"u"&&(n.tiltX=0),typeof n.tiltY>"u"&&(n.tiltY=0),typeof n.pointerType>"u"&&(n.pointerType="touch"),typeof n.pointerId>"u"&&(n.pointerId=n.identifier||0),typeof n.pressure>"u"&&(n.pressure=n.force||.5),typeof n.twist>"u"&&(n.twist=0),typeof n.tangentialPressure>"u"&&(n.tangentialPressure=0),typeof n.layerX>"u"&&(n.layerX=n.offsetX=n.clientX),typeof n.layerY>"u"&&(n.layerY=n.offsetY=n.clientY),n.isNormalized=!0,n.type=e.type,t.push(n)}else if(!globalThis.MouseEvent||e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof globalThis.PointerEvent))){const i=e;typeof i.isPrimary>"u"&&(i.isPrimary=!0),typeof i.width>"u"&&(i.width=1),typeof i.height>"u"&&(i.height=1),typeof i.tiltX>"u"&&(i.tiltX=0),typeof i.tiltY>"u"&&(i.tiltY=0),typeof i.pointerType>"u"&&(i.pointerType="mouse"),typeof i.pointerId>"u"&&(i.pointerId=Bp),typeof i.pressure>"u"&&(i.pressure=.5),typeof i.twist>"u"&&(i.twist=0),typeof i.tangentialPressure>"u"&&(i.tangentialPressure=0),i.isNormalized=!0,t.push(i)}else t.push(e);return t}normalizeWheelEvent(e){const t=this.rootWheelEvent;return this.transferMouseData(t,e),t.deltaX=e.deltaX,t.deltaY=e.deltaY,t.deltaZ=e.deltaZ,t.deltaMode=e.deltaMode,this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.nativeEvent=e,t.type=e.type,t}bootstrapEvent(e,t){return e.originalEvent=null,e.nativeEvent=t,e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist,this.transferMouseData(e,t),this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.isTrusted=t.isTrusted,e.type==="pointerleave"&&(e.type="pointerout"),e.type.startsWith("mouse")&&(e.type=e.type.replace("mouse","pointer")),e.type.startsWith("touch")&&(e.type=Dp[e.type]||e.type),e}transferMouseData(e,t){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.x=t.clientX,e.client.y=t.clientY,e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.x=t.movementX,e.movement.y=t.movementY,e.page.x=t.pageX,e.page.y=t.pageY,e.relatedTarget=null,e.shiftKey=t.shiftKey}};ea.extension={name:"events",type:[V.RendererSystem,V.CanvasRendererSystem]},ea.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let ia=ea;Z.add(ia);function gh(r){return r==="dynamic"||r==="static"}const Fp={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??gh(ia.defaultEventMode)},set interactive(r){de("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=r,this.eventMode=r?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??ia.defaultEventMode},set eventMode(r){this._internalInteractive=gh(r),this._internalEventMode=r},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(r,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof t=="object"?t.signal:void 0,n=typeof t=="object"?t.once===!0:!1,a=typeof e=="function"?void 0:e;r=i?`${r}capture`:r;const o=typeof e=="function"?e:e.handleEvent,h=this;s&&s.addEventListener("abort",()=>{h.off(r,o,a)}),n?h.once(r,o,a):h.on(r,o,a)},removeEventListener(r,e,t){const i=typeof t=="boolean"&&t||typeof t=="object"&&t.capture,s=typeof e=="function"?void 0:e;r=i?`${r}capture`:r,e=typeof e=="function"?e:e.handleEvent,this.off(r,e,s)},dispatchEvent(r){if(!(r instanceof Vi))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return r.defaultPrevented=!1,r.path=null,r.target=this,r.manager.dispatchEvent(r),!r.defaultPrevented}};Ee.mixin(Fp);const Lp={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ee.mixin(Lp);const Op=9,hs=100,kp=0,Np=0,yh=2,vh=1,Up=-1e3,Gp=-1e3,Hp=2;class ql{constructor(e){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(yt.tablet||yt.phone)&&this.createTouchHook();const t=document.createElement("div");t.style.width=`${hs}px`,t.style.height=`${hs}px`,t.style.position="absolute",t.style.top=`${kp}px`,t.style.left=`${Np}px`,t.style.zIndex=yh.toString(),this.div=t,this.renderer=e,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const e=document.createElement("button");e.style.width=`${vh}px`,e.style.height=`${vh}px`,e.style.position="absolute",e.style.top=`${Up}px`,e.style.left=`${Gp}px`,e.style.zIndex=Hp.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessibility for this content",e.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(e){if(!e.visible||!e.accessibleChildren)return;e.accessible&&e.isInteractive()&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);const t=e.children;if(t)for(let i=0;i<t.length;i++)this.updateAccessibleObjects(t[i])}update(){const e=performance.now();if(yt.android.device&&e<this.androidUpdateCount||(this.androidUpdateCount=e+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:t,y:i,width:s,height:n}=this.renderer.view.getBoundingClientRect(),{width:a,height:o,resolution:h}=this.renderer,l=s/a*h,c=n/o*h;let u=this.div;u.style.left=`${t}px`,u.style.top=`${i}px`,u.style.width=`${a}px`,u.style.height=`${o}px`;for(let d=0;d<this.children.length;d++){const p=this.children[d];if(p.renderId!==this.renderId)p._accessibleActive=!1,yi(this.children,d,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,d--;else{u=p._accessibleDiv;let f=p.hitArea;const g=p.worldTransform;p.hitArea?(u.style.left=`${(g.tx+f.x*g.a)*l}px`,u.style.top=`${(g.ty+f.y*g.d)*c}px`,u.style.width=`${f.width*g.a*l}px`,u.style.height=`${f.height*g.d*c}px`):(f=p.getBounds(),this.capHitArea(f),u.style.left=`${f.x*l}px`,u.style.top=`${f.y*c}px`,u.style.width=`${f.width*l}px`,u.style.height=`${f.height*c}px`,u.title!==p.accessibleTitle&&p.accessibleTitle!==null&&(u.title=p.accessibleTitle),u.getAttribute("aria-label")!==p.accessibleHint&&p.accessibleHint!==null&&u.setAttribute("aria-label",p.accessibleHint)),(p.accessibleTitle!==u.title||p.tabIndex!==u.tabIndex)&&(u.title=p.accessibleTitle,u.tabIndex=p.tabIndex,this.debug&&this.updateDebugHTML(u))}}this.renderId++}updateDebugHTML(e){e.innerHTML=`type: ${e.type}</br> title : ${e.title}</br> tabIndex: ${e.tabIndex}`}capHitArea(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0);const{width:t,height:i}=this.renderer;e.x+e.width>t&&(e.width=t-e.x),e.y+e.height>i&&(e.height=i-e.y)}addChild(e){let t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=`${hs}px`,t.style.height=`${hs}px`,t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=yh.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title=`displayObject ${e.tabIndex}`),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex}_dispatchEvent(e,t){const{displayObject:i}=e.target,s=this.renderer.events.rootBoundary,n=Object.assign(new Vi(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,t.forEach(a=>s.dispatchEvent(n,a))}_onClick(e){this._dispatchEvent(e,["click","pointertap","tap"])}_onFocus(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive"),this._dispatchEvent(e,["mouseover"])}_onFocusOut(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite"),this._dispatchEvent(e,["mouseout"])}_onKeyDown(e){e.keyCode===Op&&this.activate()}_onMouseMove(e){e.movementX===0&&e.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}ql.extension={name:"accessibility",type:[V.RendererPlugin,V.CanvasRendererPlugin]};Z.add(ql);const Kl=class sa{constructor(e){this.stage=new ve,e=Object.assign({forceCanvas:!1},e),this.renderer=Jd(e),sa._plugins.forEach(t=>{t.init.call(this,e)})}render(){this.renderer.render(this.stage)}get view(){return this.renderer?.view}get screen(){return this.renderer?.screen}destroy(e,t){const i=sa._plugins.slice(0);i.reverse(),i.forEach(s=>{s.destroy.call(this)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null}};Kl._plugins=[];let Jl=Kl;Z.handleByList(V.Application,Jl._plugins);class Zl{static init(e){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let t,i;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:s,clientHeight:n}=this._resizeTo;t=s,i=n}this.renderer.resize(t,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Zl.extension=V.Application;Z.add(Zl);const xh={loader:V.LoadParser,resolver:V.ResolveParser,cache:V.CacheParser,detection:V.DetectionParser};Z.handle(V.Asset,r=>{const e=r.ref;Object.entries(xh).filter(([t])=>!!e[t]).forEach(([t,i])=>Z.add(Object.assign(e[t],{extension:e[t].extension??i})))},r=>{const e=r.ref;Object.keys(xh).filter(t=>!!e[t]).forEach(t=>Z.remove(e[t]))});class Wp{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<t;i++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}function Ti(r,e){if(Array.isArray(e)){for(const t of e)if(r.startsWith(`data:${t}`))return!0;return!1}return r.startsWith(`data:${e}`)}function Lt(r,e){const t=r.split("?")[0],i=De.extname(t).toLowerCase();return Array.isArray(e)?e.includes(i):i===e}const Qe=(r,e,t=!1)=>(Array.isArray(r)||(r=[r]),e?r.map(i=>typeof i=="string"||t?e(i):i):r),ra=(r,e)=>{const t=e.split("?")[1];return t&&(r+=`?${t}`),r};function Ql(r,e,t,i,s){const n=e[t];for(let a=0;a<n.length;a++){const o=n[a];t<e.length-1?Ql(r.replace(i[t],o),e,t+1,i,s):s.push(r.replace(i[t],o))}}function zp(r){const e=/\{(.*?)\}/g,t=r.match(e),i=[];if(t){const s=[];t.forEach(n=>{const a=n.substring(1,n.length-1).split(",");s.push(a)}),Ql(r,s,0,t,i)}else i.push(r);return i}const ks=r=>!Array.isArray(r);class $p{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(e){return this._cache.has(e)}get(e){const t=this._cache.get(e);return t||console.warn(`[Assets] Asset id ${e} was not found in the Cache`),t}set(e,t){const i=Qe(e);let s;for(let o=0;o<this.parsers.length;o++){const h=this.parsers[o];if(h.test(t)){s=h.getCacheableAssets(i,t);break}}s||(s={},i.forEach(o=>{s[o]=t}));const n=Object.keys(s),a={cacheKeys:n,keys:i};if(i.forEach(o=>{this._cacheMap.set(o,a)}),n.forEach(o=>{const h=s?s[o]:t;this._cache.has(o)&&this._cache.get(o)!==h&&console.warn("[Cache] already has key:",o),this._cache.set(o,s[o])}),t instanceof K){const o=t;i.forEach(h=>{o.baseTexture!==K.EMPTY.baseTexture&&ce.addToCache(o.baseTexture,h),K.addToCache(o,h)})}}remove(e){if(!this._cacheMap.has(e)){console.warn(`[Assets] Asset id ${e} was not found in the Cache`);return}const t=this._cacheMap.get(e);t.cacheKeys.forEach(i=>{this._cache.delete(i)}),t.keys.forEach(i=>{this._cacheMap.delete(i)})}get parsers(){return this._parsers}}const jt=new $p;class Vp{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,i)=>(this._parsersValidated=!1,e[t]=i,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const i={promise:null,parser:null};return i.promise=(async()=>{let s=null,n=null;if(t.loadParser&&(n=this._parserHash[t.loadParser],n||console.warn(`[Assets] specified load parser "${t.loadParser}" not found while loading ${e}`)),!n){for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];if(o.load&&o.test?.(e,t,this)){n=o;break}}if(!n)return console.warn(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}s=await n.load(e,t,this),i.parser=n;for(let a=0;a<this.parsers.length;a++){const o=this.parsers[a];o.parse&&o.parse&&await o.testParse?.(s,t,this)&&(s=await o.parse(s,t,this)||s,i.parser=o)}return s})(),i}async load(e,t){this._parsersValidated||this._validateParsers();let i=0;const s={},n=ks(e),a=Qe(e,l=>({alias:[l],src:l})),o=a.length,h=a.map(async l=>{const c=De.toAbsolute(l.src);if(!s[l.src])try{this.promiseCache[c]||(this.promiseCache[c]=this._getLoadPromiseAndParser(c,l)),s[l.src]=await this.promiseCache[c].promise,t&&t(++i/o)}catch(u){throw delete this.promiseCache[c],delete s[l.src],new Error(`[Loader.load] Failed to load ${c}.
${u}`)}});return await Promise.all(h),n?s[a[0].src]:s}async unload(e){const t=Qe(e,i=>({alias:[i],src:i})).map(async i=>{const s=De.toAbsolute(i.src),n=this.promiseCache[s];if(n){const a=await n.promise;delete this.promiseCache[s],n.parser?.unload?.(a,i,this)}});await Promise.all(t)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name).reduce((e,t)=>(e[t.name]&&console.warn(`[Assets] loadParser name conflict "${t.name}"`),{...e,[t.name]:t}),{})}}var it=(r=>(r[r.Low=0]="Low",r[r.Normal=1]="Normal",r[r.High=2]="High",r))(it||{});const Xp=".json",jp="application/json",Yp={extension:{type:V.LoadParser,priority:it.Low},name:"loadJson",test(r){return Ti(r,jp)||Lt(r,Xp)},async load(r){return await(await j.ADAPTER.fetch(r)).json()}};Z.add(Yp);const qp=".txt",Kp="text/plain",Jp={name:"loadTxt",extension:{type:V.LoadParser,priority:it.Low},test(r){return Ti(r,Kp)||Lt(r,qp)},async load(r){return await(await j.ADAPTER.fetch(r)).text()}};Z.add(Jp);const Zp=["normal","bold","100","200","300","400","500","600","700","800","900"],Qp=[".ttf",".otf",".woff",".woff2"],ef=["font/ttf","font/otf","font/woff","font/woff2"],tf=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function sf(r){const e=De.extname(r),t=De.basename(r,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let i=t.length>0;for(const n of t)if(!n.match(tf)){i=!1;break}let s=t.join(" ");return i||(s=`"${s.replace(/[\\"]/g,"\\$&")}"`),s}const rf=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function nf(r){return rf.test(r)?r:encodeURI(r)}const af={extension:{type:V.LoadParser,priority:it.Low},name:"loadWebFont",test(r){return Ti(r,ef)||Lt(r,Qp)},async load(r,e){const t=j.ADAPTER.getFontFaceSet();if(t){const i=[],s=e.data?.family??sf(r),n=e.data?.weights?.filter(o=>Zp.includes(o))??["normal"],a=e.data??{};for(let o=0;o<n.length;o++){const h=n[o],l=new FontFace(s,`url(${nf(r)})`,{...a,weight:h});await l.load(),t.add(l),i.push(l)}return i.length===1?i[0]:i}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(r){(Array.isArray(r)?r:[r]).forEach(e=>j.ADAPTER.getFontFaceSet().delete(e))}};Z.add(af);const of=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let _i=null,na=class{constructor(){_i||(_i=URL.createObjectURL(new Blob([of],{type:"application/javascript"}))),this.worker=new Worker(_i)}};na.revokeObjectURL=function(){_i&&(URL.revokeObjectURL(_i),_i=null)};const hf=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let bi=null;class ec{constructor(){bi||(bi=URL.createObjectURL(new Blob([hf],{type:"application/javascript"}))),this.worker=new Worker(bi)}}ec.revokeObjectURL=function(){bi&&(URL.revokeObjectURL(bi),bi=null)};let _h=0,_n;class lf{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new na;t.addEventListener("message",i=>{t.terminate(),na.revokeObjectURL(),e(i.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e){return this._run("loadImageBitmap",[e])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){_n===void 0&&(_n=navigator.hardwareConcurrency||4);let e=this.workerPool.pop();return!e&&this._createdWorkers<_n&&(this._createdWorkers++,e=new ec().worker,e.addEventListener("message",t=>{this.complete(t.data),this.returnWorker(t.target),this.next()})),e}returnWorker(e){this.workerPool.push(e)}complete(e){e.error!==void 0?this.resolveHash[e.uuid].reject(e.error):this.resolveHash[e.uuid].resolve(e.data),this.resolveHash[e.uuid]=null}async _run(e,t){await this._initWorkers();const i=new Promise((s,n)=>{this.queue.push({id:e,arguments:t,resolve:s,reject:n})});return this.next(),i}next(){if(!this.queue.length)return;const e=this.getWorker();if(!e)return;const t=this.queue.pop(),i=t.id;this.resolveHash[_h]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:_h++,id:i})}}const bh=new lf;function Xi(r,e,t){r.resource.internal=!0;const i=new K(r),s=()=>{delete e.promiseCache[t],jt.has(t)&&jt.remove(t)};return i.baseTexture.once("destroyed",()=>{t in e.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),s())}),i.once("destroyed",()=>{r.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),i}const cf=[".jpeg",".jpg",".png",".webp",".avif"],uf=["image/jpeg","image/png","image/webp","image/avif"];async function df(r){const e=await j.ADAPTER.fetch(r);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${r}: ${e.status} ${e.statusText}`);const t=await e.blob();return await createImageBitmap(t)}const qs={name:"loadTextures",extension:{type:V.LoadParser,priority:it.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(r){return Ti(r,uf)||Lt(r,cf)},async load(r,e,t){const i=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let s;i?this.config.preferWorkers&&await bh.isImageBitmapSupported()?s=await bh.loadImageBitmap(r):s=await df(r):s=await new Promise((o,h)=>{const l=new Image;l.crossOrigin=this.config.crossOrigin,l.src=r,l.complete?o(l):(l.onload=()=>o(l),l.onerror=c=>h(c))});const n={...e.data};n.resolution??(n.resolution=bt(r)),i&&n.resourceOptions?.ownsImageBitmap===void 0&&(n.resourceOptions={...n.resourceOptions},n.resourceOptions.ownsImageBitmap=!0);const a=new ce(s,n);return a.resource.src=r,Xi(a,t,r)},unload(r){r.destroy(!0)}};Z.add(qs);const pf=".svg",ff="image/svg+xml",mf={extension:{type:V.LoadParser,priority:it.High},name:"loadSVG",test(r){return Ti(r,ff)||Lt(r,pf)},async testParse(r){return Yn.test(r)},async parse(r,e,t){const i=new Yn(r,e?.data?.resourceOptions);await i.load();const s=new ce(i,{resolution:bt(r),...e?.data});return s.resource.src=e.src,Xi(s,t,e.src)},async load(r,e){return(await j.ADAPTER.fetch(r)).text()},unload:qs.unload};Z.add(mf);const gf=[".mp4",".m4v",".webm",".ogv"],yf=["video/mp4","video/webm","video/ogg"],vf={name:"loadVideo",extension:{type:V.LoadParser,priority:it.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(r){return Ti(r,yf)||Lt(r,gf)},async load(r,e,t){let i;const s=await(await j.ADAPTER.fetch(r)).blob(),n=URL.createObjectURL(s);try{const a={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...e?.data?.resourceOptions,autoLoad:!0},o=new Xl(n,a);await o.load();const h=new ce(o,{alphaMode:await Tu(),resolution:bt(r),...e?.data});h.resource.src=r,i=Xi(h,t,r),i.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(n)})}catch(a){throw URL.revokeObjectURL(n),a}return i},unload(r){r.destroy(!0)}};Z.add(vf);class xf{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(e,t)=>`${e}${this._bundleIdConnector}${t}`,extractAssetIdFromBundle:(e,t)=>t.replace(`${e}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(e){if(this._bundleIdConnector=e.connector??this._bundleIdConnector,this._createBundleAssetId=e.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=e.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...e){e.forEach(t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))}),this._resolverHash={}}set basePath(e){this._basePath=e}get basePath(){return this._basePath}set rootPath(e){this._rootPath=e}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(e){if(typeof e=="string")this._defaultSearchParams=e;else{const t=e;this._defaultSearchParams=Object.keys(t).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(t[i])}`).join("&")}}getAlias(e){const{alias:t,name:i,src:s,srcs:n}=e;return Qe(t||i||s||n,a=>typeof a=="string"?a:Array.isArray(a)?a.map(o=>o?.src??o?.srcs??o):a?.src||a?.srcs?a.src??a.srcs:a,!0)}addManifest(e){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=e,e.bundles.forEach(t=>{this.addBundle(t.name,t.assets)})}addBundle(e,t){const i=[];Array.isArray(t)?t.forEach(s=>{const n=s.src??s.srcs,a=s.alias??s.name;let o;if(typeof a=="string"){const h=this._createBundleAssetId(e,a);i.push(h),o=[a,h]}else{const h=a.map(l=>this._createBundleAssetId(e,l));i.push(...h),o=[...a,...h]}this.add({...s,alias:o,src:n})}):Object.keys(t).forEach(s=>{const n=[s,this._createBundleAssetId(e,s)];if(typeof t[s]=="string")this.add({alias:n,src:t[s]});else if(Array.isArray(t[s]))this.add({alias:n,src:t[s]});else{const a=t[s],o=a.src??a.srcs;this.add({...a,alias:n,src:Array.isArray(o)?o:[o]})}i.push(...n)}),this._bundles[e]=i}add(e,t,i,s,n){const a=[];typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?(de("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),a.push({alias:e,src:t,data:i,format:s,loadParser:n})):Array.isArray(e)?a.push(...e):a.push(e);let o;o=h=>{this.hasKey(h)&&console.warn(`[Resolver] already has key: ${h} overwriting`)},Qe(a).forEach(h=>{const{src:l,srcs:c}=h;let{data:u,format:d,loadParser:p}=h;const f=Qe(l||c).map(y=>typeof y=="string"?zp(y):Array.isArray(y)?y:[y]),g=this.getAlias(h);Array.isArray(g)?g.forEach(o):o(g);const m=[];f.forEach(y=>{y.forEach(S=>{let _={};if(typeof S!="object"){_.src=S;for(let E=0;E<this._parsers.length;E++){const w=this._parsers[E];if(w.test(S)){_=w.parse(S);break}}}else u=S.data??u,d=S.format??d,p=S.loadParser??p,_={..._,...S};if(!g)throw new Error(`[Resolver] alias is undefined for this asset: ${_.src}`);_=this.buildResolvedAsset(_,{aliases:g,data:u,format:d,loadParser:p}),m.push(_)})}),g.forEach(y=>{this._assetMap[y]=m})})}resolveBundle(e){const t=ks(e);e=Qe(e);const i={};return e.forEach(s=>{const n=this._bundles[s];if(n){const a=this.resolve(n),o={};for(const h in a){const l=a[h];o[this._extractAssetIdFromBundle(s,h)]=l}i[s]=o}}),t?i[e[0]]:i}resolveUrl(e){const t=this.resolve(e);if(typeof e!="string"){const i={};for(const s in t)i[s]=t[s].src;return i}return t.src}resolve(e){const t=ks(e);e=Qe(e);const i={};return e.forEach(s=>{if(!this._resolverHash[s])if(this._assetMap[s]){let n=this._assetMap[s];const a=n[0],o=this._getPreferredOrder(n);o?.priority.forEach(h=>{o.params[h].forEach(l=>{const c=n.filter(u=>u[h]?u[h]===l:!1);c.length&&(n=c)})}),this._resolverHash[s]=n[0]??a}else this._resolverHash[s]=this.buildResolvedAsset({alias:[s],src:s},{});i[s]=this._resolverHash[s]}),t?i[e[0]]:i}hasKey(e){return!!this._assetMap[e]}hasBundle(e){return!!this._bundles[e]}_getPreferredOrder(e){for(let t=0;t<e.length;t++){const i=e[0],s=this._preferredOrder.find(n=>n.params.format.includes(i.format));if(s)return s}return this._preferredOrder[0]}_appendDefaultSearchParams(e){if(!this._defaultSearchParams)return e;const t=/\?/.test(e)?"&":"?";return`${e}${t}${this._defaultSearchParams}`}buildResolvedAsset(e,t){const{aliases:i,data:s,loadParser:n,format:a}=t;return(this._basePath||this._rootPath)&&(e.src=De.toAbsolute(e.src,this._basePath,this._rootPath)),e.alias=i??e.alias??[e.src],e.src=this._appendDefaultSearchParams(e.src),e.data={...s||{},...e.data},e.loadParser=n??e.loadParser,e.format=a??e.format??De.extname(e.src).slice(1),e.srcs=e.src,e.name=e.alias,e}}class _f{constructor(){this._detections=[],this._initialized=!1,this.resolver=new xf,this.loader=new Vp,this.cache=jt,this._backgroundLoader=new Wp(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let n=e.manifest;typeof n=="string"&&(n=await this.load(n)),this.resolver.addManifest(n)}const t=e.texturePreference?.resolution??1,i=typeof t=="number"?[t]:t,s=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:i}}),e.preferences&&this.setPreferences(e.preferences)}add(e,t,i,s,n){this.resolver.add(e,t,i,s,n)}async load(e,t){this._initialized||await this.init();const i=ks(e),s=Qe(e).map(o=>{if(typeof o!="string"){const h=this.resolver.getAlias(o);return h.some(l=>!this.resolver.hasKey(l))&&this.add(o),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(o)||this.add({alias:o,src:o}),o}),n=this.resolver.resolve(s),a=await this._mapLoadToResolve(n,t);return i?a[s[0]]:a}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let i=!1;typeof e=="string"&&(i=!0,e=[e]);const s=this.resolver.resolveBundle(e),n={},a=Object.keys(s);let o=0,h=0;const l=()=>{t?.(++o/h)},c=a.map(u=>{const d=s[u];return h+=Object.keys(d).length,this._mapLoadToResolve(d,l).then(p=>{n[u]=p})});return await Promise.all(c),i?n[e[0]]:n}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(i=>{this._backgroundLoader.add(Object.values(i))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return jt.get(e);const t={};for(let i=0;i<e.length;i++)t[i]=jt.get(e[i]);return t}async _mapLoadToResolve(e,t){const i=Object.values(e),s=Object.keys(e);this._backgroundLoader.active=!1;const n=await this.loader.load(i,t);this._backgroundLoader.active=!0;const a={};return i.forEach((o,h)=>{const l=n[o.src],c=[o.src];o.alias&&c.push(...o.alias),a[s[h]]=l,jt.set(c,l)}),a}async unload(e){this._initialized||await this.init();const t=Qe(e).map(s=>typeof s!="string"?s.src:s),i=this.resolver.resolve(t);await this._unloadFromResolved(i)}async unloadBundle(e){this._initialized||await this.init(),e=Qe(e);const t=this.resolver.resolveBundle(e),i=Object.keys(t).map(s=>this._unloadFromResolved(t[s]));await Promise.all(i)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(i=>{jt.remove(i.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const i of e.detections)e.skipDetections||await i.test()?t=await i.add(t):e.skipDetections||(t=await i.remove(t));return t=t.filter((i,s)=>t.indexOf(i)===s),t}get detections(){return this._detections}get preferWorkers(){return qs.config.preferWorkers}set preferWorkers(e){de("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:e})}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(i=>i in e).forEach(i=>{t.config[i]=e[i]})})}}const _t=new _f;Z.handleByList(V.LoadParser,_t.loader.parsers).handleByList(V.ResolveParser,_t.resolver.parsers).handleByList(V.CacheParser,_t.cache.parsers).handleByList(V.DetectionParser,_t.detections);const bf={extension:V.CacheParser,test:r=>Array.isArray(r)&&r.every(e=>e instanceof K),getCacheableAssets:(r,e)=>{const t={};return r.forEach(i=>{e.forEach((s,n)=>{t[i+(n===0?"":n+1)]=s})}),t}};Z.add(bf);async function tc(r){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=r});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(r)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const wf={extension:{type:V.DetectionParser,priority:1},test:async()=>tc("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async r=>[...r,"avif"],remove:async r=>r.filter(e=>e!=="avif")};Z.add(wf);const Tf={extension:{type:V.DetectionParser,priority:0},test:async()=>tc("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async r=>[...r,"webp"],remove:async r=>r.filter(e=>e!=="webp")};Z.add(Tf);const wh=["png","jpg","jpeg"],Sf={extension:{type:V.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async r=>[...r,...wh],remove:async r=>r.filter(e=>!wh.includes(e))};Z.add(Sf);const Ef="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function ba(r){return Ef?!1:document.createElement("video").canPlayType(r)!==""}const Af={extension:{type:V.DetectionParser,priority:0},test:async()=>ba("video/webm"),add:async r=>[...r,"webm"],remove:async r=>r.filter(e=>e!=="webm")};Z.add(Af);const Cf={extension:{type:V.DetectionParser,priority:0},test:async()=>ba("video/mp4"),add:async r=>[...r,"mp4","m4v"],remove:async r=>r.filter(e=>e!=="mp4"&&e!=="m4v")};Z.add(Cf);const Mf={extension:{type:V.DetectionParser,priority:0},test:async()=>ba("video/ogg"),add:async r=>[...r,"ogv"],remove:async r=>r.filter(e=>e!=="ogv")};Z.add(Mf);const Rf={extension:V.ResolveParser,test:qs.test,parse:r=>({resolution:parseFloat(j.RETINA_PREFIX.exec(r)?.[1]??"1"),format:De.extname(r).slice(1),src:r})};Z.add(Rf);var Fe=(r=>(r[r.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",r[r.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",r[r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",r[r.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",r[r.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",r[r.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",r[r.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",r[r.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",r[r.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",r[r.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",r[r.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",r[r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",r[r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",r[r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",r[r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",r[r.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",r[r.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",r[r.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",r[r.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",r[r.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",r[r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",r[r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",r[r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",r))(Fe||{});const Ns={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let rt,di;function Th(){di={bptc:rt.getExtension("EXT_texture_compression_bptc"),astc:rt.getExtension("WEBGL_compressed_texture_astc"),etc:rt.getExtension("WEBGL_compressed_texture_etc"),s3tc:rt.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:rt.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:rt.getExtension("WEBGL_compressed_texture_pvrtc")||rt.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:rt.getExtension("WEBGL_compressed_texture_etc1"),atc:rt.getExtension("WEBGL_compressed_texture_atc")}}const Pf={extension:{type:V.DetectionParser,priority:2},test:async()=>{const r=j.ADAPTER.createCanvas().getContext("webgl");return r?(rt=r,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async r=>{di||Th();const e=[];for(const t in di)di[t]&&e.push(t);return[...e,...r]},remove:async r=>(di||Th(),r.filter(e=>!(e in di)))};Z.add(Pf);class If extends $s{constructor(e,t={width:1,height:1,autoLoad:!0}){let i,s;typeof e=="string"?(i=e,s=new Uint8Array):(i=null,s=e),super(s,t),this.origin=i,this.buffer=s?new Ln(s):null,this._load=null,this.loaded=!1,this.origin!==null&&t.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(e){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(e=>e.blob()).then(e=>e.arrayBuffer()).then(e=>(this.data=new Uint32Array(e),this.buffer=new Ln(e),this.loaded=!0,this.onBlobLoaded(e),this.update(),this)),this._load)}}class qt extends If{constructor(e,t){super(e,t),this.format=t.format,this.levels=t.levels||1,this._width=t.width,this._height=t.height,this._extension=qt._formatToExtension(this.format),(t.levelBuffers||this.buffer)&&(this._levelBuffers=t.levelBuffers||qt._createLevelBuffers(e instanceof Uint8Array?e:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(e,t,i){const s=e.gl;if(!e.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;s.pixelStorei(s.UNPACK_ALIGNMENT,4);for(let n=0,a=this.levels;n<a;n++){const{levelID:o,levelWidth:h,levelHeight:l,levelBuffer:c}=this._levelBuffers[n];s.compressedTexImage2D(s.TEXTURE_2D,o,this.format,h,l,0,c)}return!0}onBlobLoaded(){this._levelBuffers=qt._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(e){if(e>=33776&&e<=33779)return"s3tc";if(e>=35916&&e<=35919)return"s3tc_sRGB";if(e>=37488&&e<=37497)return"etc";if(e>=35840&&e<=35843)return"pvrtc";if(e===36196)return"etc1";if(e===35986||e===35987||e===34798)return"atc";if(e>=36492&&e<=36495)return"bptc";if(e===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${e}`)}static _createLevelBuffers(e,t,i,s,n,a,o){const h=new Array(i);let l=e.byteOffset,c=a,u=o,d=c+s-1&~(s-1),p=u+n-1&~(n-1),f=d*p*Ns[t];for(let g=0;g<i;g++)h[g]={levelID:g,levelWidth:i>1?c:d,levelHeight:i>1?u:p,levelBuffer:new Uint8Array(e.buffer,l,f)},l+=f,c=c>>1||1,u=u>>1||1,d=c+s-1&~(s-1),p=u+n-1&~(n-1),f=d*p*Ns[t];return h}}const bn=4,ls=124,Bf=32,Sh=20,Df=542327876,cs={HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},Ff={FOURCC:2},us={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3},Lf=1,Of=2,kf=4,Nf=64,Uf=512,Gf=131072,Hf=827611204,Wf=861165636,zf=894720068,$f=808540228,Vf=4,Xf={[Hf]:Fe.COMPRESSED_RGBA_S3TC_DXT1_EXT,[Wf]:Fe.COMPRESSED_RGBA_S3TC_DXT3_EXT,[zf]:Fe.COMPRESSED_RGBA_S3TC_DXT5_EXT},jf={70:Fe.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Fe.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Fe.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Fe.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Fe.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Fe.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Fe.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Fe.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Fe.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Fe.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Fe.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Fe.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Fe.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function Yf(r){const e=new Uint32Array(r);if(e[0]!==Df)throw new Error("Invalid DDS file magic word");const t=new Uint32Array(r,0,ls/Uint32Array.BYTES_PER_ELEMENT),i=t[cs.HEIGHT],s=t[cs.WIDTH],n=t[cs.MIPMAP_COUNT],a=new Uint32Array(r,cs.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,Bf/Uint32Array.BYTES_PER_ELEMENT),o=a[Lf];if(o&kf){const h=a[Ff.FOURCC];if(h!==$f){const S=Xf[h],_=bn+ls,E=new Uint8Array(r,_);return[new qt(E,{format:S,width:s,height:i,levels:n})]}const l=bn+ls,c=new Uint32Array(e.buffer,l,Sh/Uint32Array.BYTES_PER_ELEMENT),u=c[us.DXGI_FORMAT],d=c[us.RESOURCE_DIMENSION],p=c[us.MISC_FLAG],f=c[us.ARRAY_SIZE],g=jf[u];if(g===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${u}`);if(p===Vf)throw new Error("DDSParser does not support cubemap textures");if(d===6)throw new Error("DDSParser does not supported 3D texture data");const m=new Array,y=bn+ls+Sh;if(f===1)m.push(new Uint8Array(r,y));else{const S=Ns[g];let _=0,E=s,w=i;for(let v=0;v<n;v++){const F=Math.max(1,E+3&-4),U=Math.max(1,w+3&-4),G=F*U*S;_+=G,E=E>>>1,w=w>>>1}let B=y;for(let v=0;v<f;v++)m.push(new Uint8Array(r,B,_)),B+=_}return m.map(S=>new qt(S,{format:g,width:s,height:i,levels:n}))}throw o&Nf?new Error("DDSParser does not support uncompressed texture data."):o&Uf?new Error("DDSParser does not supported YUV uncompressed texture data."):o&Gf?new Error("DDSParser does not support single-channel (lumninance) texture data!"):o&Of?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Eh=[171,75,84,88,32,49,49,187,13,10,26,10],qf=67305985,Ke={ENDIANNESS:12,GL_TYPE:16,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},aa=64,Ah={[ae.UNSIGNED_BYTE]:1,[ae.UNSIGNED_SHORT]:2,[ae.INT]:4,[ae.UNSIGNED_INT]:4,[ae.FLOAT]:4,[ae.HALF_FLOAT]:8},Kf={[W.RGBA]:4,[W.RGB]:3,[W.RG]:2,[W.RED]:1,[W.LUMINANCE]:1,[W.LUMINANCE_ALPHA]:2,[W.ALPHA]:1},Jf={[ae.UNSIGNED_SHORT_4_4_4_4]:2,[ae.UNSIGNED_SHORT_5_5_5_1]:2,[ae.UNSIGNED_SHORT_5_6_5]:2};function Zf(r,e,t=!1){const i=new DataView(e);if(!Qf(r,i))return null;const s=i.getUint32(Ke.ENDIANNESS,!0)===qf,n=i.getUint32(Ke.GL_TYPE,s),a=i.getUint32(Ke.GL_FORMAT,s),o=i.getUint32(Ke.GL_INTERNAL_FORMAT,s),h=i.getUint32(Ke.PIXEL_WIDTH,s),l=i.getUint32(Ke.PIXEL_HEIGHT,s)||1,c=i.getUint32(Ke.PIXEL_DEPTH,s)||1,u=i.getUint32(Ke.NUMBER_OF_ARRAY_ELEMENTS,s)||1,d=i.getUint32(Ke.NUMBER_OF_FACES,s),p=i.getUint32(Ke.NUMBER_OF_MIPMAP_LEVELS,s),f=i.getUint32(Ke.BYTES_OF_KEY_VALUE_DATA,s);if(l===0||c!==1)throw new Error("Only 2D textures are supported");if(d!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(u!==1)throw new Error("WebGL does not support array textures");const g=4,m=4,y=h+3&-4,S=l+3&-4,_=new Array(u);let E=h*l;n===0&&(E=y*S);let w;if(n!==0?Ah[n]?w=Ah[n]*Kf[a]:w=Jf[n]:w=Ns[o],w===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const B=t?tm(i,f,s):null;let v=E*w,F=h,U=l,G=y,N=S,M=aa+f;for(let O=0;O<p;O++){const k=i.getUint32(M,s);let J=M+4;for(let b=0;b<u;b++){let T=_[b];T||(T=_[b]=new Array(p)),T[O]={levelID:O,levelWidth:p>1||n!==0?F:G,levelHeight:p>1||n!==0?U:N,levelBuffer:new Uint8Array(e,J,v)},J+=v}M+=k+4,M=M%4!==0?M+4-M%4:M,F=F>>1||1,U=U>>1||1,G=F+g-1&-4,N=U+m-1&-4,v=G*N*w}return n!==0?{uncompressed:_.map(O=>{let k=O[0].levelBuffer,J=!1;return n===ae.FLOAT?k=new Float32Array(O[0].levelBuffer.buffer,O[0].levelBuffer.byteOffset,O[0].levelBuffer.byteLength/4):n===ae.UNSIGNED_INT?(J=!0,k=new Uint32Array(O[0].levelBuffer.buffer,O[0].levelBuffer.byteOffset,O[0].levelBuffer.byteLength/4)):n===ae.INT&&(J=!0,k=new Int32Array(O[0].levelBuffer.buffer,O[0].levelBuffer.byteOffset,O[0].levelBuffer.byteLength/4)),{resource:new $s(k,{width:O[0].levelWidth,height:O[0].levelHeight}),type:n,format:J?em(a):a}}),kvData:B}:{compressed:_.map(O=>new qt(null,{format:o,width:h,height:l,levels:p,levelBuffers:O})),kvData:B}}function Qf(r,e){for(let t=0;t<Eh.length;t++)if(e.getUint8(t)!==Eh[t])return console.error(`${r} is not a valid *.ktx file!`),!1;return!0}function em(r){switch(r){case W.RGBA:return W.RGBA_INTEGER;case W.RGB:return W.RGB_INTEGER;case W.RG:return W.RG_INTEGER;case W.RED:return W.RED_INTEGER;default:return r}}function tm(r,e,t){const i=new Map;let s=0;for(;s<e;){const n=r.getUint32(aa+s,t),a=aa+s+4,o=3-(n+3)%4;if(n===0||n>e-s){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&r.getUint8(a+h)!==0;h++);if(h===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=new TextDecoder().decode(new Uint8Array(r.buffer,a,h)),c=new DataView(r.buffer,a+h+1,n-h-1);i.set(l,c),s+=4+n+o}return i}const im={extension:{type:V.LoadParser,priority:it.High},name:"loadDDS",test(r){return Lt(r,".dds")},async load(r,e,t){const i=await(await j.ADAPTER.fetch(r)).arrayBuffer(),s=Yf(i).map(n=>{const a=new ce(n,{mipmap:ut.OFF,alphaMode:Ue.NO_PREMULTIPLIED_ALPHA,resolution:bt(r),...e.data});return Xi(a,t,r)});return s.length===1?s[0]:s},unload(r){Array.isArray(r)?r.forEach(e=>e.destroy(!0)):r.destroy(!0)}};Z.add(im);const sm={extension:{type:V.LoadParser,priority:it.High},name:"loadKTX",test(r){return Lt(r,".ktx")},async load(r,e,t){const i=await(await j.ADAPTER.fetch(r)).arrayBuffer(),{compressed:s,uncompressed:n,kvData:a}=Zf(r,i),o=s??n,h={mipmap:ut.OFF,alphaMode:Ue.NO_PREMULTIPLIED_ALPHA,resolution:bt(r),...e.data},l=o.map(c=>{o===n&&Object.assign(h,{type:c.type,format:c.format});const u=c.resource??c,d=new ce(u,h);return d.ktxKeyValueData=a,Xi(d,t,r)});return l.length===1?l[0]:l},unload(r){Array.isArray(r)?r.forEach(e=>e.destroy(!0)):r.destroy(!0)}};Z.add(sm);const rm=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],nm={extension:V.ResolveParser,test:r=>{const e=De.extname(r).slice(1);return["basis","ktx","dds"].includes(e)},parse:r=>{const e=r.split("."),t=e.pop();if(["ktx","dds"].includes(t)){const i=e.pop();if(rm.includes(i))return{resolution:parseFloat(j.RETINA_PREFIX.exec(r)?.[1]??"1"),format:i,src:r}}return{resolution:parseFloat(j.RETINA_PREFIX.exec(r)?.[1]??"1"),format:t,src:r}}};Z.add(nm);const ds=new le,am=4,ic=class ki{constructor(e){this.renderer=e,this._rendererPremultipliedAlpha=!1}contextChange(){const e=this.renderer?.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(e&&e.alpha&&e.premultipliedAlpha)}async image(e,t,i,s){const n=new Image;return n.src=await this.base64(e,t,i,s),n}async base64(e,t,i,s){const n=this.canvas(e,s);if(n.toBlob!==void 0)return new Promise((a,o)=>{n.toBlob(h=>{if(!h){o(new Error("ICanvas.toBlob failed!"));return}const l=new FileReader;l.onload=()=>a(l.result),l.onerror=o,l.readAsDataURL(h)},t,i)});if(n.toDataURL!==void 0)return n.toDataURL(t,i);if(n.convertToBlob!==void 0){const a=await n.convertToBlob({type:t,quality:i});return new Promise((o,h)=>{const l=new FileReader;l.onload=()=>o(l.result),l.onerror=h,l.readAsDataURL(a)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(e,t){const{pixels:i,width:s,height:n,flipY:a,premultipliedAlpha:o}=this._rawPixels(e,t);a&&ki._flipY(i,s,n),o&&ki._unpremultiplyAlpha(i);const h=new Uu(s,n,1),l=new ImageData(new Uint8ClampedArray(i.buffer),s,n);return h.context.putImageData(l,0,0),h.canvas}pixels(e,t){const{pixels:i,width:s,height:n,flipY:a,premultipliedAlpha:o}=this._rawPixels(e,t);return a&&ki._flipY(i,s,n),o&&ki._unpremultiplyAlpha(i),i}_rawPixels(e,t){const i=this.renderer;if(!i)throw new Error("The Extract has already been destroyed");let s,n=!1,a=!1,o,h=!1;e&&(e instanceof ei?o=e:(o=i.generateTexture(e,{region:t,resolution:i.resolution,multisample:i.multisample}),h=!0,t&&(ds.width=t.width,ds.height=t.height,t=ds)));const l=i.gl;if(o){if(s=o.baseTexture.resolution,t=t??o.frame,n=!1,a=o.baseTexture.alphaMode>0&&o.baseTexture.format===W.RGBA,!h){i.renderTexture.bind(o);const p=o.framebuffer.glFramebuffers[i.CONTEXT_UID];p.blitFramebuffer&&i.framebuffer.bind(p.blitFramebuffer)}}else s=i.resolution,t||(t=ds,t.width=i.width/s,t.height=i.height/s),n=!0,a=this._rendererPremultipliedAlpha,i.renderTexture.bind();const c=Math.max(Math.round(t.width*s),1),u=Math.max(Math.round(t.height*s),1),d=new Uint8Array(am*c*u);return l.readPixels(Math.round(t.x*s),Math.round(t.y*s),c,u,l.RGBA,l.UNSIGNED_BYTE,d),h&&o?.destroy(!0),{pixels:d,width:c,height:u,flipY:n,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(e,t,i){const s=t<<2,n=i>>1,a=new Uint8Array(s);for(let o=0;o<n;o++){const h=o*s,l=(i-o-1)*s;a.set(e.subarray(h,h+s)),e.copyWithin(h,l,l+s),e.set(a,l)}}static _unpremultiplyAlpha(e){e instanceof Uint8ClampedArray&&(e=new Uint8Array(e.buffer));const t=e.length;for(let i=0;i<t;i+=4){const s=e[i+3];if(s!==0){const n=255.001/s;e[i]=e[i]*n+.5,e[i+1]=e[i+1]*n+.5,e[i+2]=e[i+2]*n+.5}}}};ic.extension={name:"extract",type:V.RendererSystem};let om=ic;Z.add(om);const Us={build(r){const e=r.points;let t,i,s,n,a,o;if(r.type===Le.CIRC){const f=r.shape;t=f.x,i=f.y,a=o=f.radius,s=n=0}else if(r.type===Le.ELIP){const f=r.shape;t=f.x,i=f.y,a=f.width,o=f.height,s=n=0}else{const f=r.shape,g=f.width/2,m=f.height/2;t=f.x+g,i=f.y+m,a=o=Math.max(0,Math.min(f.radius,Math.min(g,m))),s=g-a,n=m-o}if(!(a>=0&&o>=0&&s>=0&&n>=0)){e.length=0;return}const h=Math.ceil(2.3*Math.sqrt(a+o)),l=h*8+(s?4:0)+(n?4:0);if(e.length=l,l===0)return;if(h===0){e.length=8,e[0]=e[6]=t+s,e[1]=e[3]=i+n,e[2]=e[4]=t-s,e[5]=e[7]=i-n;return}let c=0,u=h*4+(s?2:0)+2,d=u,p=l;{const f=s+a,g=n,m=t+f,y=t-f,S=i+g;if(e[c++]=m,e[c++]=S,e[--u]=S,e[--u]=y,n){const _=i-g;e[d++]=y,e[d++]=_,e[--p]=_,e[--p]=m}}for(let f=1;f<h;f++){const g=Math.PI/2*(f/h),m=s+Math.cos(g)*a,y=n+Math.sin(g)*o,S=t+m,_=t-m,E=i+y,w=i-y;e[c++]=S,e[c++]=E,e[--u]=E,e[--u]=_,e[d++]=_,e[d++]=w,e[--p]=w,e[--p]=S}{const f=s,g=n+o,m=t+f,y=t-f,S=i+g,_=i-g;e[c++]=m,e[c++]=S,e[--p]=_,e[--p]=m,s&&(e[c++]=y,e[c++]=S,e[--p]=_,e[--p]=y)}},triangulate(r,e){const t=r.points,i=e.points,s=e.indices;if(t.length===0)return;let n=i.length/2;const a=n;let o,h;if(r.type!==Le.RREC){const c=r.shape;o=c.x,h=c.y}else{const c=r.shape;o=c.x+c.width/2,h=c.y+c.height/2}const l=r.matrix;i.push(r.matrix?l.a*o+l.c*h+l.tx:o,r.matrix?l.b*o+l.d*h+l.ty:h),n++,i.push(t[0],t[1]);for(let c=2;c<t.length;c+=2)i.push(t[c],t[c+1]),s.push(n++,a,n);s.push(a+1,a,n)}};function Ch(r,e=!1){const t=r.length;if(t<6)return;let i=0;for(let s=0,n=r[t-2],a=r[t-1];s<t;s+=2){const o=r[s],h=r[s+1];i+=(o-n)*(h+a),n=o,a=h}if(!e&&i>0||e&&i<=0){const s=t/2;for(let n=s+s%2;n<t;n+=2){const a=t-n-2,o=t-n-1,h=n,l=n+1;[r[a],r[h]]=[r[h],r[a]],[r[o],r[l]]=[r[l],r[o]]}}}const sc={build(r){r.points=r.shape.points.slice()},triangulate(r,e){let t=r.points;const i=r.holes,s=e.points,n=e.indices;if(t.length>=6){Ch(t,!1);const a=[];for(let l=0;l<i.length;l++){const c=i[l];Ch(c.points,!0),a.push(t.length/2),t=t.concat(c.points)}const o=kc(t,a,2);if(!o)return;const h=s.length/2;for(let l=0;l<o.length;l+=3)n.push(o[l]+h),n.push(o[l+1]+h),n.push(o[l+2]+h);for(let l=0;l<t.length;l++)s.push(t[l])}}},hm={build(r){const e=r.shape,t=e.x,i=e.y,s=e.width,n=e.height,a=r.points;a.length=0,s>=0&&n>=0&&a.push(t,i,t+s,i,t+s,i+n,t,i+n)},triangulate(r,e){const t=r.points,i=e.points;if(t.length===0)return;const s=i.length/2;i.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(s,s+1,s+2,s+1,s+2,s+3)}},lm={build(r){Us.build(r)},triangulate(r,e){Us.triangulate(r,e)}};var $e=(r=>(r.MITER="miter",r.BEVEL="bevel",r.ROUND="round",r))($e||{}),Bt=(r=>(r.BUTT="butt",r.ROUND="round",r.SQUARE="square",r))(Bt||{});const Zt={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(r,e=20){if(!this.adaptive||!r||isNaN(r))return e;let t=Math.ceil(r/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}},Jg=Zt;class Mh{static curveTo(e,t,i,s,n,a){const o=a[a.length-2],h=a[a.length-1]-t,l=o-e,c=s-t,u=i-e,d=Math.abs(h*u-l*c);if(d<1e-8||n===0)return(a[a.length-2]!==e||a[a.length-1]!==t)&&a.push(e,t),null;const p=h*h+l*l,f=c*c+u*u,g=h*c+l*u,m=n*Math.sqrt(p)/d,y=n*Math.sqrt(f)/d,S=m*g/p,_=y*g/f,E=m*u+y*l,w=m*c+y*h,B=l*(y+S),v=h*(y+S),F=u*(m+_),U=c*(m+_),G=Math.atan2(v-w,B-E),N=Math.atan2(U-w,F-E);return{cx:E+e,cy:w+t,radius:n,startAngle:G,endAngle:N,anticlockwise:l*c>u*h}}static arc(e,t,i,s,n,a,o,h,l){const c=o-a,u=Zt._segmentsCount(Math.abs(c)*n,Math.ceil(Math.abs(c)/Ps)*40),d=c/(u*2),p=d*2,f=Math.cos(d),g=Math.sin(d),m=u-1,y=m%1/m;for(let S=0;S<=m;++S){const _=S+y*S,E=d+a+p*_,w=Math.cos(E),B=-Math.sin(E);l.push((f*w+g*B)*n+i,(f*-B+g*w)*n+s)}}}class cm{constructor(){this.reset()}begin(e,t,i){this.reset(),this.style=e,this.start=t,this.attribStart=i}end(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class wa{static curveLength(e,t,i,s,n,a,o,h){let l=0,c=0,u=0,d=0,p=0,f=0,g=0,m=0,y=0,S=0,_=0,E=e,w=t;for(let B=1;B<=10;++B)c=B/10,u=c*c,d=u*c,p=1-c,f=p*p,g=f*p,m=g*e+3*f*c*i+3*p*u*n+d*o,y=g*t+3*f*c*s+3*p*u*a+d*h,S=E-m,_=w-y,E=m,w=y,l+=Math.sqrt(S*S+_*_);return l}static curveTo(e,t,i,s,n,a,o){const h=o[o.length-2],l=o[o.length-1];o.length-=2;const c=Zt._segmentsCount(wa.curveLength(h,l,e,t,i,s,n,a));let u=0,d=0,p=0,f=0,g=0;o.push(h,l);for(let m=1,y=0;m<=c;++m)y=m/c,u=1-y,d=u*u,p=d*u,f=y*y,g=f*y,o.push(p*h+3*d*y*e+3*u*f*i+g*n,p*l+3*d*y*t+3*u*f*s+g*a)}}function Rh(r,e,t,i,s,n,a,o){const h=r-t*s,l=e-i*s,c=r+t*n,u=e+i*n;let d,p;a?(d=i,p=-t):(d=-i,p=t);const f=h+d,g=l+p,m=c+d,y=u+p;return o.push(f,g,m,y),2}function Ut(r,e,t,i,s,n,a,o){const h=t-r,l=i-e;let c=Math.atan2(h,l),u=Math.atan2(s-r,n-e);o&&c<u?c+=Math.PI*2:!o&&c>u&&(u+=Math.PI*2);let d=c;const p=u-c,f=Math.abs(p),g=Math.sqrt(h*h+l*l),m=(15*f*Math.sqrt(g)/Math.PI>>0)+1,y=p/m;if(d+=y,o){a.push(r,e,t,i);for(let S=1,_=d;S<m;S++,_+=y)a.push(r,e,r+Math.sin(_)*g,e+Math.cos(_)*g);a.push(r,e,s,n)}else{a.push(t,i,r,e);for(let S=1,_=d;S<m;S++,_+=y)a.push(r+Math.sin(_)*g,e+Math.cos(_)*g,r,e);a.push(s,n,r,e)}return m*2}function um(r,e){const t=r.shape;let i=r.points||t.points.slice();const s=e.closePointEps;if(i.length===0)return;const n=r.lineStyle,a=new ye(i[0],i[1]),o=new ye(i[i.length-2],i[i.length-1]),h=t.type!==Le.POLY||t.closeStroke,l=Math.abs(a.x-o.x)<s&&Math.abs(a.y-o.y)<s;if(h){i=i.slice(),l&&(i.pop(),i.pop(),o.set(i[i.length-2],i[i.length-1]));const T=(a.x+o.x)*.5,x=(o.y+a.y)*.5;i.unshift(T,x),i.push(T,x)}const c=e.points,u=i.length/2;let d=i.length;const p=c.length/2,f=n.width/2,g=f*f,m=n.miterLimit*n.miterLimit;let y=i[0],S=i[1],_=i[2],E=i[3],w=0,B=0,v=-(S-E),F=y-_,U=0,G=0,N=Math.sqrt(v*v+F*F);v/=N,F/=N,v*=f,F*=f;const M=n.alignment,O=(1-M)*2,k=M*2;h||(n.cap===Bt.ROUND?d+=Ut(y-v*(O-k)*.5,S-F*(O-k)*.5,y-v*O,S-F*O,y+v*k,S+F*k,c,!0)+2:n.cap===Bt.SQUARE&&(d+=Rh(y,S,v,F,O,k,!0,c))),c.push(y-v*O,S-F*O,y+v*k,S+F*k);for(let T=1;T<u-1;++T){y=i[(T-1)*2],S=i[(T-1)*2+1],_=i[T*2],E=i[T*2+1],w=i[(T+1)*2],B=i[(T+1)*2+1],v=-(S-E),F=y-_,N=Math.sqrt(v*v+F*F),v/=N,F/=N,v*=f,F*=f,U=-(E-B),G=_-w,N=Math.sqrt(U*U+G*G),U/=N,G/=N,U*=f,G*=f;const x=_-y,R=S-E,A=_-w,C=B-E,D=x*A+R*C,I=R*A-C*x,H=I<0;if(Math.abs(I)<.001*Math.abs(D)){c.push(_-v*O,E-F*O,_+v*k,E+F*k),D>=0&&(n.join===$e.ROUND?d+=Ut(_,E,_-v*O,E-F*O,_-U*O,E-G*O,c,!1)+4:d+=2,c.push(_-U*k,E-G*k,_+U*O,E+G*O));continue}const z=(-v+y)*(-F+E)-(-v+_)*(-F+S),Y=(-U+w)*(-G+E)-(-U+_)*(-G+B),q=(x*Y-A*z)/I,Q=(C*z-R*Y)/I,se=(q-_)*(q-_)+(Q-E)*(Q-E),$=_+(q-_)*O,te=E+(Q-E)*O,re=_-(q-_)*k,ue=E-(Q-E)*k,ge=Math.min(x*x+R*R,A*A+C*C),ie=H?O:k,ne=ge+ie*ie*g,Ae=se<=ne;let Re=n.join;if(Re===$e.MITER&&se/g>m&&(Re=$e.BEVEL),Ae)switch(Re){case $e.MITER:{c.push($,te,re,ue);break}case $e.BEVEL:{H?c.push($,te,_+v*k,E+F*k,$,te,_+U*k,E+G*k):c.push(_-v*O,E-F*O,re,ue,_-U*O,E-G*O,re,ue),d+=2;break}case $e.ROUND:{H?(c.push($,te,_+v*k,E+F*k),d+=Ut(_,E,_+v*k,E+F*k,_+U*k,E+G*k,c,!0)+4,c.push($,te,_+U*k,E+G*k)):(c.push(_-v*O,E-F*O,re,ue),d+=Ut(_,E,_-v*O,E-F*O,_-U*O,E-G*O,c,!1)+4,c.push(_-U*O,E-G*O,re,ue));break}}else{switch(c.push(_-v*O,E-F*O,_+v*k,E+F*k),Re){case $e.MITER:{H?c.push(re,ue,re,ue):c.push($,te,$,te),d+=2;break}case $e.ROUND:{H?d+=Ut(_,E,_+v*k,E+F*k,_+U*k,E+G*k,c,!0)+2:d+=Ut(_,E,_-v*O,E-F*O,_-U*O,E-G*O,c,!1)+2;break}}c.push(_-U*O,E-G*O,_+U*k,E+G*k),d+=2}}y=i[(u-2)*2],S=i[(u-2)*2+1],_=i[(u-1)*2],E=i[(u-1)*2+1],v=-(S-E),F=y-_,N=Math.sqrt(v*v+F*F),v/=N,F/=N,v*=f,F*=f,c.push(_-v*O,E-F*O,_+v*k,E+F*k),h||(n.cap===Bt.ROUND?d+=Ut(_-v*(O-k)*.5,E-F*(O-k)*.5,_-v*O,E-F*O,_+v*k,E+F*k,c,!1)+2:n.cap===Bt.SQUARE&&(d+=Rh(_,E,v,F,O,k,!1,c)));const J=e.indices,b=Zt.epsilon*Zt.epsilon;for(let T=p;T<d+p-2;++T)y=c[T*2],S=c[T*2+1],_=c[(T+1)*2],E=c[(T+1)*2+1],w=c[(T+2)*2],B=c[(T+2)*2+1],!(Math.abs(y*(E-B)+_*(B-S)+w*(S-E))<b)&&J.push(T,T+1,T+2)}function dm(r,e){let t=0;const i=r.shape,s=r.points||i.points,n=i.type!==Le.POLY||i.closeStroke;if(s.length===0)return;const a=e.points,o=e.indices,h=s.length/2,l=a.length/2;let c=l;for(a.push(s[0],s[1]),t=1;t<h;t++)a.push(s[t*2],s[t*2+1]),o.push(c,c+1),c++;n&&o.push(c,l)}function Ph(r,e){r.lineStyle.native?dm(r,e):um(r,e)}class Ta{static curveLength(e,t,i,s,n,a){const o=e-2*i+n,h=t-2*s+a,l=2*i-2*e,c=2*s-2*t,u=4*(o*o+h*h),d=4*(o*l+h*c),p=l*l+c*c,f=2*Math.sqrt(u+d+p),g=Math.sqrt(u),m=2*u*g,y=2*Math.sqrt(p),S=d/g;return(m*f+g*d*(f-y)+(4*p*u-d*d)*Math.log((2*g+S+f)/(S+y)))/(4*m)}static curveTo(e,t,i,s,n){const a=n[n.length-2],o=n[n.length-1],h=Zt._segmentsCount(Ta.curveLength(a,o,e,t,i,s));let l=0,c=0;for(let u=1;u<=h;++u){const d=u/h;l=a+(e-a)*d,c=o+(t-o)*d,n.push(l+(e+(i-e)*d-l)*d,c+(t+(s-t)*d-c)*d)}}}const wn={[Le.POLY]:sc,[Le.CIRC]:Us,[Le.ELIP]:Us,[Le.RECT]:hm,[Le.RREC]:lm},Ih=[],ps=[];class Gs{constructor(e,t=null,i=null,s=null){this.points=[],this.holes=[],this.shape=e,this.lineStyle=i,this.fillStyle=t,this.matrix=s,this.type=e.type}clone(){return new Gs(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const hi=new ye,rc=class nc extends ll{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ls,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),ps.push(this.drawCalls[e]);this.drawCalls.length=0;for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t.reset(),Ih.push(t)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(e,t=null,i=null,s=null){const n=new Gs(e,t,i,s);return this.graphicsData.push(n),this.dirty++,this}drawHole(e,t=null){if(!this.graphicsData.length)return null;const i=new Gs(e,null,null,t),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(e){const t=this.graphicsData;for(let i=0;i<t.length;++i){const s=t[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,hi):hi.copyFrom(e),s.shape.contains(hi.x,hi.y))){let n=!1;if(s.holes){for(let a=0;a<s.holes.length;a++)if(s.holes[a].shape.contains(hi.x,hi.y)){n=!0;break}}if(!n)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const e=this.uvs,t=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let h=this.shapeIndex;h<t.length;h++){this.shapeIndex++;const l=t[h],c=l.fillStyle,u=l.lineStyle;wn[l.type].build(l),l.matrix&&this.transformPoints(l.points,l.matrix),(c.visible||u.visible)&&this.processHoles(l.holes);for(let d=0;d<2;d++){const p=d===0?c:u;if(!p.visible)continue;const f=p.texture.baseTexture,g=this.indices.length,m=this.points.length/2;f.wrapMode=Dt.REPEAT,d===0?this.processFill(l):this.processLine(l);const y=this.points.length/2-m;y!==0&&(i&&!this._compareStyles(s,p)&&(i.end(g,m),i=null),i||(i=Ih.pop()||new cm,i.begin(p,g,m),this.batches.push(i),s=p),this.addUvs(this.points,e,p.texture,m,y,p.matrix))}}const n=this.indices.length,a=this.points.length/2;if(i&&i.end(n,a),this.batches.length===0){this.batchable=!0;return}const o=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(e,t){return!(!e||!t||e.texture.baseTexture!==t.texture.baseTexture||e.color+e.alpha!==t.color+t.alpha||!!e.native!=!!t.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let e=0,t=this.graphicsData.length;e<t;e++){const i=this.graphicsData[e],s=i.fillStyle,n=i.lineStyle;if(s&&!s.texture.baseTexture.valid||n&&!n.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const e=this.batches;for(let t=0,i=e.length;t<i;t++){const s=e[t];for(let n=0;n<s.size;n++){const a=s.start+n;this.indicesUint16[a]=this.indicesUint16[a]-s.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const e=this.batches;for(let t=0;t<e.length;t++)if(e[t].style.native)return!1;return this.points.length<nc.BATCHABLE_SIZE*2}buildDrawCalls(){let e=++ce._globalBatch;for(let u=0;u<this.drawCalls.length;u++)this.drawCalls[u].texArray.clear(),ps.push(this.drawCalls[u]);this.drawCalls.length=0;const t=this.colors,i=this.textureIds;let s=ps.pop();s||(s=new Nn,s.texArray=new Wn),s.texArray.count=0,s.start=0,s.size=0,s.type=ht.TRIANGLES;let n=0,a=null,o=0,h=!1,l=ht.TRIANGLES,c=0;this.drawCalls.push(s);for(let u=0;u<this.batches.length;u++){const d=this.batches[u],p=8,f=d.style,g=f.texture.baseTexture;h!==!!f.native&&(h=!!f.native,l=h?ht.LINES:ht.TRIANGLES,a=null,n=p,e++),a!==g&&(a=g,g._batchEnabled!==e&&(n===p&&(e++,n=0,s.size>0&&(s=ps.pop(),s||(s=new Nn,s.texArray=new Wn),this.drawCalls.push(s)),s.start=c,s.size=0,s.texArray.count=0,s.type=l),g.touched=1,g._batchEnabled=e,g._batchLocation=n,g.wrapMode=Dt.REPEAT,s.texArray.elements[s.texArray.count++]=g,n++)),s.size+=d.size,c+=d.size,o=g._batchLocation,this.addColors(t,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,o,d.attribSize,d.attribStart)}ce._globalBatch=e,this.packAttributes()}packAttributes(){const e=this.points,t=this.uvs,i=this.colors,s=this.textureIds,n=new ArrayBuffer(e.length*3*4),a=new Float32Array(n),o=new Uint32Array(n);let h=0;for(let l=0;l<e.length/2;l++)a[h++]=e[l*2],a[h++]=e[l*2+1],a[h++]=t[l*2],a[h++]=t[l*2+1],o[h++]=i[l],a[h++]=s[l];this._buffer.update(n),this._indexBuffer.update(this.indicesUint16)}processFill(e){e.holes.length?sc.triangulate(e,this):wn[e.type].triangulate(e,this)}processLine(e){Ph(e,this);for(let t=0;t<e.holes.length;t++)Ph(e.holes[t],this)}processHoles(e){for(let t=0;t<e.length;t++){const i=e[t];wn[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const e=this._bounds;e.clear(),e.addVertexData(this.points,0,this.points.length),e.pad(this.boundsPadding,this.boundsPadding)}transformPoints(e,t){for(let i=0;i<e.length/2;i++){const s=e[i*2],n=e[i*2+1];e[i*2]=t.a*s+t.c*n+t.tx,e[i*2+1]=t.b*s+t.d*n+t.ty}}addColors(e,t,i,s,n=0){const a=_e.shared.setValue(t).toLittleEndianNumber(),o=_e.shared.setValue(a).toPremultiplied(i);e.length=Math.max(e.length,n+s);for(let h=0;h<s;h++)e[n+h]=o}addTextureIds(e,t,i,s=0){e.length=Math.max(e.length,s+i);for(let n=0;n<i;n++)e[s+n]=t}addUvs(e,t,i,s,n,a=null){let o=0;const h=t.length,l=i.frame;for(;o<n;){let u=e[(s+o)*2],d=e[(s+o)*2+1];if(a){const p=a.a*u+a.c*d+a.tx;d=a.b*u+a.d*d+a.ty,u=p}o++,t.push(u/l.width,d/l.height)}const c=i.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(t,i,h,n)}adjustUvs(e,t,i,s){const n=t.baseTexture,a=1e-6,o=i+s*2,h=t.frame,l=h.width/n.width,c=h.height/n.height;let u=h.x/h.width,d=h.y/h.height,p=Math.floor(e[i]+a),f=Math.floor(e[i+1]+a);for(let g=i+2;g<o;g+=2)p=Math.min(p,Math.floor(e[g]+a)),f=Math.min(f,Math.floor(e[g+1]+a));u-=p,d-=f;for(let g=i;g<o;g+=2)e[g]=(e[g]+u)*l,e[g+1]=(e[g+1]+d)*c}};rc.BATCHABLE_SIZE=100;let pm=rc;class Ks{constructor(){this.color=16777215,this.alpha=1,this.texture=K.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const e=new Ks;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e}reset(){this.color=16777215,this.alpha=1,this.texture=K.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Sa extends Ks{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Bt.BUTT,this.join=$e.MITER,this.miterLimit=10}clone(){const e=new Sa;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=Bt.BUTT,this.join=$e.MITER,this.miterLimit=10}}const Tn={},oa=class Ss extends ve{constructor(e=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Ks,this._lineStyle=new Sa,this._matrix=null,this._holeMode=!1,this.state=dt.for2d(),this._geometry=e||new pm,this._geometry.refCount++,this._transformID=-1,this._tintColor=new _e(16777215),this.blendMode=oe.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new Ss(this._geometry)}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(e){this._tintColor.setValue(e)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(e=null,t=0,i,s=.5,n=!1){return typeof e=="number"&&(e={width:e,color:t,alpha:i,alignment:s,native:n}),this.lineTextureStyle(e)}lineTextureStyle(e){const t={width:0,texture:K.WHITE,color:e?.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:Bt.BUTT,join:$e.MITER,miterLimit:10};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.width>0&&e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:i},e)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Yt,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Yt,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this}lineTo(e,t){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],n=i[i.length-1];return(s!==e||n!==t)&&i.push(e,t),this}_initCurve(e=0,t=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,t]):this.moveTo(e,t)}quadraticCurveTo(e,t,i,s){this._initCurve();const n=this.currentPath.points;return n.length===0&&this.moveTo(0,0),Ta.curveTo(e,t,i,s,n),this}bezierCurveTo(e,t,i,s,n,a){return this._initCurve(),wa.curveTo(e,t,i,s,n,a,this.currentPath.points),this}arcTo(e,t,i,s,n){this._initCurve(e,t);const a=this.currentPath.points,o=Mh.curveTo(e,t,i,s,n,a);if(o){const{cx:h,cy:l,radius:c,startAngle:u,endAngle:d,anticlockwise:p}=o;this.arc(h,l,c,u,d,p)}return this}arc(e,t,i,s,n,a=!1){if(s===n)return this;if(!a&&n<=s?n+=Ps:a&&s<=n&&(s+=Ps),n-s===0)return this;const o=e+Math.cos(s)*i,h=t+Math.sin(s)*i,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const u=Math.abs(c[c.length-2]-o),d=Math.abs(c[c.length-1]-h);u<l&&d<l||c.push(o,h)}else this.moveTo(o,h),c=this.currentPath.points;return Mh.arc(o,h,e,t,i,s,n,a,c),this}beginFill(e=0,t){return this.beginTextureFill({texture:K.WHITE,color:e,alpha:t})}normalizeColor(e){const t=_e.shared.setValue(e.color??0);e.color=t.toNumber(),e.alpha??(e.alpha=t.alpha)}beginTextureFill(e){const t={texture:K.WHITE,color:16777215,matrix:null};e=Object.assign(t,e),this.normalizeColor(e),this.currentPath&&this.startPoly();const i=e.alpha>0;return i?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:i},e)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(e,t,i,s){return this.drawShape(new le(e,t,i,s))}drawRoundedRect(e,t,i,s,n){return this.drawShape(new js(e,t,i,s,n))}drawCircle(e,t,i){return this.drawShape(new Vs(e,t,i))}drawEllipse(e,t,i,s){return this.drawShape(new Xs(e,t,i,s))}drawPolygon(...e){let t,i=!0;const s=e[0];s.points?(i=s.closeStroke,t=s.points):Array.isArray(e[0])?t=e[0]:t=e;const n=new Yt(t);return n.closeStroke=i,this.drawShape(n),this}drawShape(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Le.RECT&&!e[0].matrix&&!e[0].holes.length&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)}_render(e){this.finishPoly();const t=this._geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))}_populateBatches(){const e=this._geometry,t=this.blendMode,i=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(e.points);for(let s=0;s<i;s++){const n=e.batches[s],a=n.style.color,o=new Float32Array(this.vertexData.buffer,n.attribStart*4*2,n.attribSize*2),h=new Float32Array(e.uvsFloat32.buffer,n.attribStart*4*2,n.attribSize*2),l=new Uint16Array(e.indicesUint16.buffer,n.start*2,n.size),c={vertexData:o,blendMode:t,indices:l,uvs:h,_batchRGB:_e.shared.setValue(a).toRgbArray(),_tintRGB:a,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[s]=c}}_renderBatched(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let t=0,i=this.batches.length;t<i;t++){const s=this.batches[t];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}}_renderDirect(e){const t=this._resolveDirectShader(e),i=this._geometry,s=this.worldAlpha,n=t.uniforms,a=i.drawCalls;n.translationMatrix=this.transform.worldTransform,_e.shared.setValue(this._tintColor).premultiply(s).toArray(n.tint),e.shader.bind(t),e.geometry.bind(i,t),e.state.set(this.state);for(let o=0,h=a.length;o<h;o++)this._renderDrawCallDirect(e,i.drawCalls[o])}_renderDrawCallDirect(e,t){const{texArray:i,type:s,size:n,start:a}=t,o=i.count;for(let h=0;h<o;h++)e.texture.bind(i.elements[h],h);e.geometry.draw(s,n,a)}_resolveDirectShader(e){let t=this.shader;const i=this.pluginName;if(!t){if(!Tn[i]){const{maxTextures:s}=e.plugins[i],n=new Int32Array(s);for(let h=0;h<s;h++)n[h]=h;const a={tint:new Float32Array([1,1,1,1]),translationMatrix:new Te,default:tt.from({uSamplers:n},!0)},o=e.plugins[i]._shader.program;Tn[i]=new ct(o,a)}t=Tn[i]}return t}_calculateBounds(){this.finishPoly();const e=this._geometry;if(!e.graphicsData.length)return;const{minX:t,minY:i,maxX:s,maxY:n}=e.bounds;this._bounds.addFrame(this.transform,t,i,s,n)}containsPoint(e){return this.worldTransform.applyInverse(e,Ss._TEMP_POINT),this._geometry.containsPoint(Ss._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let e=0;e<this.batches.length;e++){const t=this.batches[e];t._tintRGB=_e.shared.setValue(this._tintColor).multiply(t._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const e=this.transform._worldID;if(this._transformID===e)return;this._transformID=e;const t=this.transform.worldTransform,i=t.a,s=t.b,n=t.c,a=t.d,o=t.tx,h=t.ty,l=this._geometry.points,c=this.vertexData;let u=0;for(let d=0;d<l.length;d+=2){const p=l[d],f=l[d+1];c[u++]=i*p+n*f+o,c[u++]=a*f+s*p+h}}closePath(){const e=this.currentPath;return e&&(e.closeStroke=!0,this.finishPoly()),this}setMatrix(e){return this._matrix=e,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(e)}};oa.curves=Zt,oa._TEMP_POINT=new ye;let me=oa;class fm{constructor(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(e){if(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}}const Sn=new ye,Bh=new Yt,ac=class oc extends ve{constructor(e,t,i,s=ht.TRIANGLES){super(),this.geometry=e,this.shader=t,this.state=i||dt.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=j.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=e,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(e){this.shader=e}get material(){return this.shader}set blendMode(e){this.state.blendMode=e}get blendMode(){return this.state.blendMode}set roundPixels(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(e){this.shader.tint=e}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(e){this.shader.texture=e}_render(e){const t=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ht.TRIANGLES&&t.length<oc.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)}_renderDefault(e){const t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(e){const t=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[s]),e.plugins[s].render(this)}calculateVertices(){const e=this.geometry.buffers[0],t=e.data,i=e._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));const s=this.transform.worldTransform,n=s.a,a=s.b,o=s.c,h=s.d,l=s.tx,c=s.ty,u=this.vertexData;for(let d=0;d<u.length/2;d++){const p=t[d*2],f=t[d*2+1];u[d*2]=n*p+o*f+l,u[d*2+1]=a*p+h*f+c}if(this._roundPixels){const d=j.RESOLUTION;for(let p=0;p<u.length;++p)u[p]=Math.round(u[p]*d)/d}this.vertexDirty=i}calculateUvs(){const e=this.geometry.buffers[1],t=this.shader;t.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new fm(e,t.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,Sn);const t=this.geometry.getBuffer("aVertexPosition").data,i=Bh.points,s=this.geometry.getIndex().data,n=s.length,a=this.drawMode===4?3:1;for(let o=0;o+2<n;o+=a){const h=s[o]*2,l=s[o+1]*2,c=s[o+2]*2;if(i[0]=t[h],i[1]=t[h+1],i[2]=t[l],i[3]=t[l+1],i[4]=t[c],i[5]=t[c+1],Bh.contains(Sn.x,Sn.y))return!0}return!1}destroy(e){super.destroy(e),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};ac.BATCHABLE_SIZE=100;let Dh=ac;class mm extends Ft{constructor(e,t,i){super();const s=new Ce(e),n=new Ce(t,!0),a=new Ce(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,ae.FLOAT).addAttribute("aTextureCoord",n,2,!1,ae.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var gm=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,ym=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class Fh extends ct{constructor(e,t){const i={uSampler:e,alpha:1,uTextureMatrix:Te.IDENTITY,uColor:new Float32Array([1,1,1,1])};t=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},t),t.uniforms&&Object.assign(i,t.uniforms),super(t.program||xt.from(ym,gm),i),this._colorDirty=!1,this.uvMatrix=new Tl(e),this.batchable=t.program===void 0,this.pluginName=t.pluginName,this._tintColor=new _e(t.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=t.alpha}get texture(){return this.uniforms.uSampler}set texture(e){this.uniforms.uSampler!==e&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!e.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=e,this.uvMatrix.texture=e)}set alpha(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(e){e!==this.tint&&(this._tintColor.setValue(e),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const e=this.texture.baseTexture.alphaMode;_e.shared.setValue(this._tintColor).premultiply(this._alpha,e).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class Lh{constructor(e,t,i){this.geometry=new Ft,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let s=0;s<e.length;++s){let n=e[s];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||ae.FLOAT,offset:n.offset},t[s]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const e=this.geometry;let t=0;this.indexBuffer=new Ce(ku(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];o.offset=t,t+=o.size,this.dynamicStride+=o.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Ce(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];o.offset=s,s+=o.size,this.staticStride+=o.size}const n=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(n),this.staticDataUint32=new Uint32Array(n),this.staticBuffer=new Ce(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const o=this.dynamicProperties[a];e.addAttribute(o.attributeName,this.dynamicBuffer,0,o.type===ae.UNSIGNED_BYTE,o.type,this.dynamicStride*4,o.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const o=this.staticProperties[a];e.addAttribute(o.attributeName,this.staticBuffer,0,o.type===ae.UNSIGNED_BYTE,o.type,this.staticStride*4,o.offset*4)}}uploadDynamic(e,t,i){for(let s=0;s<this.dynamicProperties.length;s++){const n=this.dynamicProperties[s];n.uploadFunction(e,t,i,n.type===ae.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,n.offset)}this.dynamicBuffer._updateID++}uploadStatic(e,t,i){for(let s=0;s<this.staticProperties.length;s++){const n=this.staticProperties[s];n.uploadFunction(e,t,i,n.type===ae.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,n.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var vm=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,xm=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class hc extends Ys{constructor(e){super(e),this.shader=null,this.properties=null,this.tempMatrix=new Te,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:ae.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=ct.from(xm,vm,{}),this.state=dt.for2d()}render(e){const t=e.children,i=e._maxSize,s=e._batchSize,n=this.renderer;let a=t.length;if(a===0)return;a>i&&!e.autoResize&&(a=i);let o=e._buffers;o||(o=e._buffers=this.generateBuffers(e));const h=t[0]._texture.baseTexture,l=h.alphaMode>0;this.state.blendMode=al(e.blendMode,l),n.state.set(this.state);const c=n.gl,u=e.worldTransform.copyTo(this.tempMatrix);u.prepend(n.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=_e.shared.setValue(e.tintRgb).premultiply(e.worldAlpha,l).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=h,this.renderer.shader.bind(this.shader);let d=!1;for(let p=0,f=0;p<a;p+=s,f+=1){let g=a-p;g>s&&(g=s),f>=o.length&&o.push(this._generateOneMoreBuffer(e));const m=o[f];m.uploadDynamic(t,p,g);const y=e._bufferUpdateIDs[f]||0;d=d||m._updateID<y,d&&(m._updateID=e._updateID,m.uploadStatic(t,p,g)),n.geometry.bind(m.geometry),c.drawElements(c.TRIANGLES,g*6,c.UNSIGNED_SHORT,0)}}generateBuffers(e){const t=[],i=e._maxSize,s=e._batchSize,n=e._properties;for(let a=0;a<i;a+=s)t.push(new Lh(this.properties,n,s));return t}_generateOneMoreBuffer(e){const t=e._batchSize,i=e._properties;return new Lh(this.properties,i,t)}uploadVertices(e,t,i,s,n,a){let o=0,h=0,l=0,c=0;for(let u=0;u<i;++u){const d=e[t+u],p=d._texture,f=d.scale.x,g=d.scale.y,m=p.trim,y=p.orig;m?(h=m.x-d.anchor.x*y.width,o=h+m.width,c=m.y-d.anchor.y*y.height,l=c+m.height):(o=y.width*(1-d.anchor.x),h=y.width*-d.anchor.x,l=y.height*(1-d.anchor.y),c=y.height*-d.anchor.y),s[a]=h*f,s[a+1]=c*g,s[a+n]=o*f,s[a+n+1]=c*g,s[a+n*2]=o*f,s[a+n*2+1]=l*g,s[a+n*3]=h*f,s[a+n*3+1]=l*g,a+=n*4}}uploadPosition(e,t,i,s,n,a){for(let o=0;o<i;o++){const h=e[t+o].position;s[a]=h.x,s[a+1]=h.y,s[a+n]=h.x,s[a+n+1]=h.y,s[a+n*2]=h.x,s[a+n*2+1]=h.y,s[a+n*3]=h.x,s[a+n*3+1]=h.y,a+=n*4}}uploadRotation(e,t,i,s,n,a){for(let o=0;o<i;o++){const h=e[t+o].rotation;s[a]=h,s[a+n]=h,s[a+n*2]=h,s[a+n*3]=h,a+=n*4}}uploadUvs(e,t,i,s,n,a){for(let o=0;o<i;++o){const h=e[t+o]._texture._uvs;h?(s[a]=h.x0,s[a+1]=h.y0,s[a+n]=h.x1,s[a+n+1]=h.y1,s[a+n*2]=h.x2,s[a+n*2+1]=h.y2,s[a+n*3]=h.x3,s[a+n*3+1]=h.y3,a+=n*4):(s[a]=0,s[a+1]=0,s[a+n]=0,s[a+n+1]=0,s[a+n*2]=0,s[a+n*2+1]=0,s[a+n*3]=0,s[a+n*3+1]=0,a+=n*4)}}uploadTint(e,t,i,s,n,a){for(let o=0;o<i;++o){const h=e[t+o],l=_e.shared.setValue(h._tintRGB).toPremultiplied(h.alpha,h.texture.baseTexture.alphaMode>0);s[a]=l,s[a+n]=l,s[a+n*2]=l,s[a+n*3]=l,a+=n*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}hc.extension={name:"particle",type:V.RendererPlugin};Z.add(hc);var Js=(r=>(r[r.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",r[r.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",r))(Js||{});const fs={willReadFrequently:!0},nt=class ee{static get experimentalLetterSpacingSupported(){let e=ee._experimentalLetterSpacingSupported;if(e!==void 0){const t=j.ADAPTER.getCanvasRenderingContext2D().prototype;e=ee._experimentalLetterSpacingSupported="letterSpacing"in t||"textLetterSpacing"in t}return e}constructor(e,t,i,s,n,a,o,h,l){this.text=e,this.style=t,this.width=i,this.height=s,this.lines=n,this.lineWidths=a,this.lineHeight=o,this.maxLineWidth=h,this.fontProperties=l}static measureText(e,t,i,s=ee._canvas){i=i??t.wordWrap;const n=t.toFontString(),a=ee.measureFont(n);a.fontSize===0&&(a.fontSize=t.fontSize,a.ascent=t.fontSize);const o=s.getContext("2d",fs);o.font=n;const h=(i?ee.wordWrap(e,t,s):e).split(/(?:\r\n|\r|\n)/),l=new Array(h.length);let c=0;for(let f=0;f<h.length;f++){const g=ee._measureText(h[f],t.letterSpacing,o);l[f]=g,c=Math.max(c,g)}let u=c+t.strokeThickness;t.dropShadow&&(u+=t.dropShadowDistance);const d=t.lineHeight||a.fontSize+t.strokeThickness;let p=Math.max(d,a.fontSize+t.strokeThickness*2)+t.leading+(h.length-1)*(d+t.leading);return t.dropShadow&&(p+=t.dropShadowDistance),new ee(e,t,u,p,h,l,d+t.leading,c,a)}static _measureText(e,t,i){let s=!1;ee.experimentalLetterSpacingSupported&&(ee.experimentalLetterSpacing?(i.letterSpacing=`${t}px`,i.textLetterSpacing=`${t}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(e).width;return n>0&&(s?n-=t:n+=(ee.graphemeSegmenter(e).length-1)*t),n}static wordWrap(e,t,i=ee._canvas){const s=i.getContext("2d",fs);let n=0,a="",o="";const h=Object.create(null),{letterSpacing:l,whiteSpace:c}=t,u=ee.collapseSpaces(c),d=ee.collapseNewlines(c);let p=!u;const f=t.wordWrapWidth+l,g=ee.tokenize(e);for(let m=0;m<g.length;m++){let y=g[m];if(ee.isNewline(y)){if(!d){o+=ee.addLine(a),p=!u,a="",n=0;continue}y=" "}if(u){const _=ee.isBreakingSpace(y),E=ee.isBreakingSpace(a[a.length-1]);if(_&&E)continue}const S=ee.getFromCache(y,l,h,s);if(S>f)if(a!==""&&(o+=ee.addLine(a),a="",n=0),ee.canBreakWords(y,t.breakWords)){const _=ee.wordWrapSplit(y);for(let E=0;E<_.length;E++){let w=_[E],B=w,v=1;for(;_[E+v];){const U=_[E+v];if(!ee.canBreakChars(B,U,y,E,t.breakWords))w+=U;else break;B=U,v++}E+=v-1;const F=ee.getFromCache(w,l,h,s);F+n>f&&(o+=ee.addLine(a),p=!1,a="",n=0),a+=w,n+=F}}else{a.length>0&&(o+=ee.addLine(a),a="",n=0);const _=m===g.length-1;o+=ee.addLine(y,!_),p=!1,a="",n=0}else S+n>f&&(p=!1,o+=ee.addLine(a),a="",n=0),(a.length>0||!ee.isBreakingSpace(y)||p)&&(a+=y,n+=S)}return o+=ee.addLine(a,!1),o}static addLine(e,t=!0){return e=ee.trimRight(e),e=t?`${e}
`:e,e}static getFromCache(e,t,i,s){let n=i[e];return typeof n!="number"&&(n=ee._measureText(e,t,s)+t,i[e]=n),n}static collapseSpaces(e){return e==="normal"||e==="pre-line"}static collapseNewlines(e){return e==="normal"}static trimRight(e){if(typeof e!="string")return"";for(let t=e.length-1;t>=0;t--){const i=e[t];if(!ee.isBreakingSpace(i))break;e=e.slice(0,-1)}return e}static isNewline(e){return typeof e!="string"?!1:ee._newlines.includes(e.charCodeAt(0))}static isBreakingSpace(e,t){return typeof e!="string"?!1:ee._breakingSpaces.includes(e.charCodeAt(0))}static tokenize(e){const t=[];let i="";if(typeof e!="string")return t;for(let s=0;s<e.length;s++){const n=e[s],a=e[s+1];if(ee.isBreakingSpace(n,a)||ee.isNewline(n)){i!==""&&(t.push(i),i=""),t.push(n);continue}i+=n}return i!==""&&t.push(i),t}static canBreakWords(e,t){return t}static canBreakChars(e,t,i,s,n){return!0}static wordWrapSplit(e){return ee.graphemeSegmenter(e)}static measureFont(e){if(ee._fonts[e])return ee._fonts[e];const t={ascent:0,descent:0,fontSize:0},i=ee._canvas,s=ee._context;s.font=e;const n=ee.METRICS_STRING+ee.BASELINE_SYMBOL,a=Math.ceil(s.measureText(n).width);let o=Math.ceil(s.measureText(ee.BASELINE_SYMBOL).width);const h=Math.ceil(ee.HEIGHT_MULTIPLIER*o);if(o=o*ee.BASELINE_MULTIPLIER|0,a===0||h===0)return ee._fonts[e]=t,t;i.width=a,i.height=h,s.fillStyle="#f00",s.fillRect(0,0,a,h),s.font=e,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(n,0,o);const l=s.getImageData(0,0,a,h).data,c=l.length,u=a*4;let d=0,p=0,f=!1;for(d=0;d<o;++d){for(let g=0;g<u;g+=4)if(l[p+g]!==255){f=!0;break}if(!f)p+=u;else break}for(t.ascent=o-d,p=c-u,f=!1,d=h;d>o;--d){for(let g=0;g<u;g+=4)if(l[p+g]!==255){f=!0;break}if(!f)p-=u;else break}return t.descent=d-o,t.fontSize=t.ascent+t.descent,ee._fonts[e]=t,t}static clearMetrics(e=""){e?delete ee._fonts[e]:ee._fonts={}}static get _canvas(){if(!ee.__canvas){let e;try{const t=new OffscreenCanvas(0,0);if(t.getContext("2d",fs)?.measureText)return ee.__canvas=t,t;e=j.ADAPTER.createCanvas()}catch{e=j.ADAPTER.createCanvas()}e.width=e.height=10,ee.__canvas=e}return ee.__canvas}static get _context(){return ee.__context||(ee.__context=ee._canvas.getContext("2d",fs)),ee.__context}};nt.METRICS_STRING="|ÉqÅ",nt.BASELINE_SYMBOL="M",nt.BASELINE_MULTIPLIER=1.4,nt.HEIGHT_MULTIPLIER=2,nt.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){const r=new Intl.Segmenter;return e=>[...r.segment(e)].map(t=>t.segment)}return r=>[...r]})(),nt.experimentalLetterSpacing=!1,nt._fonts={},nt._newlines=[10,13],nt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Rt=nt;const _m=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],lc=class Ni{constructor(e){this.styleID=0,this.reset(),An(this,e,e)}clone(){const e={};return An(e,this,Ni.defaultStyle),new Ni(e)}reset(){An(this,Ni.defaultStyle,Ni.defaultStyle)}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(e){const t=En(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)}get fill(){return this._fill}set fill(e){const t=En(e);this._fill!==t&&(this._fill=t,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(e){bm(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)}get leading(){return this._leading}set leading(e){this._leading!==e&&(this._leading=e,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)}get padding(){return this._padding}set padding(e){this._padding!==e&&(this._padding=e,this.styleID++)}get stroke(){return this._stroke}set stroke(e){const t=En(e);this._stroke!==t&&(this._stroke=t,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)}get trim(){return this._trim}set trim(e){this._trim!==e&&(this._trim=e,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)}toFontString(){const e=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(let i=t.length-1;i>=0;i--){let s=t[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!_m.includes(s)&&(s=`"${s}"`),t[i]=s}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${e} ${t.join(",")}`}};lc.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Js.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let fe=lc;function En(r){const e=_e.shared,t=i=>{const s=e.setValue(i);return s.alpha===1?s.toHex():s.toRgbaString()};return Array.isArray(r)?r.map(t):t(r)}function bm(r,e){if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length)return!1;for(let t=0;t<r.length;++t)if(r[t]!==e[t])return!1;return!0}function An(r,e,t){for(const i in t)Array.isArray(e[i])?r[i]=e[i].slice():r[i]=e[i]}const wm={texture:!0,children:!1,baseTexture:!0},cc=class ha extends Ie{constructor(e,t,i){let s=!1;i||(i=j.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const n=K.from(i);n.orig=new le,n.trim=new le,super(n),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=ha.defaultResolution??j.RESOLUTION,this._autoResolution=ha.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=e,this.style=t,this.localStyleID=-1}static get experimentalLetterSpacing(){return Rt.experimentalLetterSpacing}static set experimentalLetterSpacing(e){de("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),Rt.experimentalLetterSpacing=e}updateText(e){const t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;this._font=this._style.toFontString();const i=this.context,s=Rt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),n=s.width,a=s.height,o=s.lines,h=s.lineHeight,l=s.lineWidths,c=s.maxLineWidth,u=s.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,n)+t.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+t.padding*2)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;let d,p;const f=t.dropShadow?2:1;for(let g=0;g<f;++g){const m=t.dropShadow&&g===0,y=m?Math.ceil(Math.max(1,a)+t.padding*2):0,S=y*this._resolution;if(m){i.fillStyle="black",i.strokeStyle="black";const E=t.dropShadowColor,w=t.dropShadowBlur*this._resolution,B=t.dropShadowDistance*this._resolution;i.shadowColor=_e.shared.setValue(E).setAlpha(t.dropShadowAlpha).toRgbaString(),i.shadowBlur=w,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*B,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*B+S}else i.fillStyle=this._generateFillStyle(t,o,s),i.strokeStyle=t.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let _=(h-u.fontSize)/2;h-u.fontSize<0&&(_=0);for(let E=0;E<o.length;E++)d=t.strokeThickness/2,p=t.strokeThickness/2+E*h+u.ascent+_,t.align==="right"?d+=c-l[E]:t.align==="center"&&(d+=(c-l[E])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(o[E],d+t.padding,p+t.padding-y,!0),t.fill&&this.drawLetterSpacing(o[E],d+t.padding,p+t.padding-y)}this.updateTexture()}drawLetterSpacing(e,t,i,s=!1){const n=this._style.letterSpacing;let a=!1;if(Rt.experimentalLetterSpacingSupported&&(Rt.experimentalLetterSpacing?(this.context.letterSpacing=`${n}px`,this.context.textLetterSpacing=`${n}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),n===0||a){s?this.context.strokeText(e,t,i):this.context.fillText(e,t,i);return}let o=t;const h=Rt.graphemeSegmenter(e);let l=this.context.measureText(e).width,c=0;for(let u=0;u<h.length;++u){const d=h[u];s?this.context.strokeText(d,o,i):this.context.fillText(d,o,i);let p="";for(let f=u+1;f<h.length;++f)p+=h[f];c=this.context.measureText(p).width,o+=l-c+n,l=c}}updateTexture(){const e=this.canvas;if(this._style.trim){const a=Hu(e);a.data&&(e.width=a.width,e.height=a.height,this.context.putImageData(a.data,0,0))}const t=this._texture,i=this._style,s=i.trim?0:i.padding,n=t.baseTexture;t.trim.width=t._frame.width=e.width/this._resolution,t.trim.height=t._frame.height=e.height/this._resolution,t.trim.x=-s,t.trim.y=-s,t.orig.width=t._frame.width-s*2,t.orig.height=t._frame.height-s*2,this._onTextureUpdate(),n.setRealSize(e.width,e.height,this._resolution),t.updateUvs(),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(e,t){return this.updateText(!0),this._textureID===-1&&(e=!1),super.getBounds(e,t)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds.call(this,e)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(e,t,i){const s=e.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;let n;const a=e.dropShadow?e.dropShadowDistance:0,o=e.padding||0,h=this.canvas.width/this._resolution-a-o*2,l=this.canvas.height/this._resolution-a-o*2,c=s.slice(),u=e.fillGradientStops.slice();if(!u.length){const d=c.length+1;for(let p=1;p<d;++p)u.push(p/d)}if(c.unshift(s[0]),u.unshift(0),c.push(s[s.length-1]),u.push(1),e.fillGradientType===Js.LINEAR_VERTICAL){n=this.context.createLinearGradient(h/2,o,h/2,l+o);const d=i.fontProperties.fontSize+e.strokeThickness;for(let p=0;p<t.length;p++){const f=i.lineHeight*(p-1)+d,g=i.lineHeight*p;let m=g;p>0&&f>g&&(m=(g+f)/2);const y=g+d,S=i.lineHeight*(p+1);let _=y;p+1<t.length&&S<y&&(_=(y+S)/2);const E=(_-m)/l;for(let w=0;w<c.length;w++){let B=0;typeof u[w]=="number"?B=u[w]:B=w/c.length;let v=Math.min(1,Math.max(0,m/l+B*E));v=Number(v.toFixed(5)),n.addColorStop(v,c[w])}}}else{n=this.context.createLinearGradient(o,l/2,h+o,l/2);const d=c.length+1;let p=1;for(let f=0;f<c.length;f++){let g;typeof u[f]=="number"?g=u[f]:g=p/d,n.addColorStop(g,c[f]),p++}}return n}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},wm,e),super.destroy(e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(e){this.updateText(!0);const t=It(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(e){this.updateText(!0);const t=It(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e}get style(){return this._style}set style(e){e=e||{},e instanceof fe?this._style=e:this._style=new fe(e),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}};cc.defaultAutoResolution=!0;let he=cc;class Tm{constructor(e){this.maxItemsPerFrame=e,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function Sm(r,e){let t=!1;if(r?._textures?.length){for(let i=0;i<r._textures.length;i++)if(r._textures[i]instanceof K){const s=r._textures[i].baseTexture;e.includes(s)||(e.push(s),t=!0)}}return t}function Em(r,e){if(r.baseTexture instanceof ce){const t=r.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Am(r,e){if(r._texture&&r._texture instanceof K){const t=r._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Cm(r,e){return e instanceof he?(e.updateText(!0),!0):!1}function Mm(r,e){if(e instanceof fe){const t=e.toFontString();return Rt.measureFont(t),!0}return!1}function Rm(r,e){if(r instanceof he){e.includes(r.style)||e.push(r.style),e.includes(r)||e.push(r);const t=r._texture.baseTexture;return e.includes(t)||e.push(t),!0}return!1}function Pm(r,e){return r instanceof fe?(e.includes(r)||e.push(r),!0):!1}const uc=class dc{constructor(e){this.limiter=new Tm(dc.uploadsPerFrame),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Rm),this.registerFindHook(Pm),this.registerFindHook(Sm),this.registerFindHook(Em),this.registerFindHook(Am),this.registerUploadHook(Cm),this.registerUploadHook(Mm)}upload(e){return new Promise(t=>{e&&this.add(e),this.queue.length?(this.completes.push(t),this.ticking||(this.ticking=!0,We.system.addOnce(this.tick,this,Jt.UTILITY))):t()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const e=this.queue[0];let t=!1;if(e&&!e._destroyed){for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)We.system.addOnce(this.tick,this,Jt.UTILITY);else{this.ticking=!1;const e=this.completes.slice(0);this.completes.length=0;for(let t=0,i=e.length;t<i;t++)e[t]()}}registerFindHook(e){return e&&this.addHooks.push(e),this}registerUploadHook(e){return e&&this.uploadHooks.push(e),this}add(e){for(let t=0,i=this.addHooks.length;t<i&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ve)for(let t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this}destroy(){this.ticking&&We.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};uc.uploadsPerFrame=4;let la=uc;Object.defineProperties(j,{UPLOADS_PER_FRAME:{get(){return la.uploadsPerFrame},set(r){de("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),la.uploadsPerFrame=r}}});function pc(r,e){return e instanceof ce?(e._glTextures[r.CONTEXT_UID]||r.texture.bind(e),!0):!1}function Im(r,e){if(!(e instanceof me))return!1;const{geometry:t}=e;e.finishPoly(),t.updateBatches();const{batches:i}=t;for(let s=0;s<i.length;s++){const{texture:n}=i[s].style;n&&pc(r,n.baseTexture)}return t.batchable||r.geometry.bind(t,e._resolveDirectShader(r)),!0}function Bm(r,e){return r instanceof me?(e.push(r),!0):!1}class fc extends la{constructor(e){super(e),this.uploadHookHelper=this.renderer,this.registerFindHook(Bm),this.registerUploadHook(pc),this.registerUploadHook(Im)}}fc.extension={name:"prepare",type:V.RendererSystem};Z.add(fc);var Dm=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,Fm=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Lm=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Oh=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Om=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const ms=new Te;class mc extends Ys{constructor(e){super(e),e.runners.contextChange.add(this),this.quad=new xl,this.state=dt.for2d()}contextChange(){const e=this.renderer,t={globals:e.globalUniforms};this.simpleShader=ct.from(Oh,Om,t),this.shader=e.context.webGLVersion>1?ct.from(Fm,Dm,t):ct.from(Oh,Lm,t)}render(e){const t=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y);const n=e.uvRespectAnchor?e.anchor.x:0,a=e.uvRespectAnchor?e.anchor.y:0;s=i.uvs,s[0]=s[6]=-n,s[1]=s[3]=-a,s[2]=s[4]=1-n,s[5]=s[7]=1-a,i.invalidate();const o=e._texture,h=o.baseTexture,l=h.alphaMode>0,c=e.tileTransform.localTransform,u=e.uvMatrix;let d=h.isPowerOfTwo&&o.frame.width===h.width&&o.frame.height===h.height;d&&(h._glTextures[t.CONTEXT_UID]?d=h.wrapMode!==Dt.CLAMP:h.wrapMode===Dt.CLAMP&&(h.wrapMode=Dt.REPEAT));const p=d?this.simpleShader:this.shader,f=o.width,g=o.height,m=e._width,y=e._height;ms.set(c.a*f/m,c.b*f/y,c.c*g/m,c.d*g/y,c.tx/m,c.ty/y),ms.invert(),d?ms.prepend(u.mapCoord):(p.uniforms.uMapCoord=u.mapCoord.toArray(!0),p.uniforms.uClampFrame=u.uClampFrame,p.uniforms.uClampOffset=u.uClampOffset),p.uniforms.uTransform=ms.toArray(!0),p.uniforms.uColor=_e.shared.setValue(e.tint).premultiply(e.worldAlpha,l).toArray(p.uniforms.uColor),p.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),p.uniforms.uSampler=o,t.shader.bind(p),t.geometry.bind(i),this.state.blendMode=al(e.blendMode,l),t.state.set(this.state),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}mc.extension={name:"tilingSprite",type:V.RendererPlugin};Z.add(mc);const gc=class Ui{constructor(e,t,i){this.linkedSheets=[],(e instanceof ce||e instanceof K)&&(e={texture:e,data:t,resolutionFilename:i});const{texture:s,data:n,resolutionFilename:a=null,cachePrefix:o=""}=e;this.cachePrefix=o,this._texture=s instanceof K?s:null,this.baseTexture=s instanceof ce?s:this._texture.baseTexture,this.textures={},this.animations={},this.data=n;const h=this.baseTexture.resource;this.resolution=this._updateResolution(a||(h?h.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(e=null){const{scale:t}=this.data.meta;let i=bt(e,null);return i===null&&(i=typeof t=="number"?t:parseFloat(t??"1")),i!==1&&this.baseTexture.setResolution(i),i}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=Ui.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const i=Ui.BATCH_SIZE;for(;t-e<i&&t<this._frameKeys.length;){const s=this._frameKeys[t],n=this._frames[s],a=n.frame;if(a){let o=null,h=null;const l=n.trimmed!==!1&&n.sourceSize?n.sourceSize:n.frame,c=new le(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n.rotated?o=new le(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new le(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.trimmed!==!1&&n.spriteSourceSize&&(h=new le(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[s]=new K(this.baseTexture,o,c,h,n.rotated?2:0,n.anchor,n.borders),K.addToCache(this.textures[s],this.cachePrefix+s.toString())}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let i=0;i<e[t].length;i++){const s=e[t][i];this.animations[t].push(this.textures[s])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ui.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Ui.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};gc.BATCH_SIZE=1e3;let kh=gc;const km=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function yc(r,e,t){const i={};if(r.forEach(s=>{i[s]=e}),Object.keys(e.textures).forEach(s=>{i[`${e.cachePrefix}${s}`]=e.textures[s]}),!t){const s=De.dirname(r[0]);e.linkedSheets.forEach((n,a)=>{Object.assign(i,yc([`${s}/${e.data.meta.related_multi_packs[a]}`],n,!0))})}return i}const Nm={extension:V.Asset,cache:{test:r=>r instanceof kh,getCacheableAssets:(r,e)=>yc(r,e,!1)},resolver:{test:r=>{const e=r.split("?")[0].split("."),t=e.pop(),i=e.pop();return t==="json"&&km.includes(i)},parse:r=>{const e=r.split(".");return{resolution:parseFloat(j.RETINA_PREFIX.exec(r)?.[1]??"1"),format:e[e.length-2],src:r}}},loader:{name:"spritesheetLoader",extension:{type:V.LoadParser,priority:it.Normal},async testParse(r,e){return De.extname(e.src).toLowerCase()===".json"&&!!r.frames},async parse(r,e,t){const{texture:i,imageFilename:s,cachePrefix:n}=e?.data??{};let a=De.dirname(e.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let o;if(i&&i.baseTexture)o=i;else{const c=ra(a+(s??r.meta.image),e.src);o=(await t.load([c]))[c]}const h=new kh({texture:o.baseTexture,data:r,resolutionFilename:e.src,cachePrefix:n});await h.parse();const l=r?.meta?.related_multi_packs;if(Array.isArray(l)){const c=[];for(const d of l){if(typeof d!="string")continue;let p=a+d;e.data?.ignoreMultiPack||(p=ra(p,e.src),c.push(t.load({src:p,data:{ignoreMultiPack:!0}})))}const u=await Promise.all(c);h.linkedSheets=u,u.forEach(d=>{d.linkedSheets=[h].concat(h.linkedSheets.filter(p=>p!==d))})}return h},unload(r){r.destroy(!0)}}};Z.add(Nm);class Hs{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Es{static test(e){return typeof e=="string"&&e.startsWith("info face=")}static parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const n in t){const a=t[n].match(/^[a-z]+/gm)[0],o=t[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),h={};for(const l in o){const c=o[l].split("="),u=c[0],d=c[1].replace(/"/gm,""),p=parseFloat(d),f=isNaN(p)?d:p;h[u]=f}i[a].push(h)}const s=new Hs;return i.info.forEach(n=>s.info.push({face:n.face,size:parseInt(n.size,10)})),i.common.forEach(n=>s.common.push({lineHeight:parseInt(n.lineHeight,10)})),i.page.forEach(n=>s.page.push({id:parseInt(n.id,10),file:n.file})),i.char.forEach(n=>s.char.push({id:parseInt(n.id,10),page:parseInt(n.page,10),x:parseInt(n.x,10),y:parseInt(n.y,10),width:parseInt(n.width,10),height:parseInt(n.height,10),xoffset:parseInt(n.xoffset,10),yoffset:parseInt(n.yoffset,10),xadvance:parseInt(n.xadvance,10)})),i.kerning.forEach(n=>s.kerning.push({first:parseInt(n.first,10),second:parseInt(n.second,10),amount:parseInt(n.amount,10)})),i.distanceField.forEach(n=>s.distanceField.push({distanceRange:parseInt(n.distanceRange,10),fieldType:n.fieldType})),s}}class ca{static test(e){const t=e;return typeof e!="string"&&"getElementsByTagName"in e&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(e){const t=new Hs,i=e.getElementsByTagName("info"),s=e.getElementsByTagName("common"),n=e.getElementsByTagName("page"),a=e.getElementsByTagName("char"),o=e.getElementsByTagName("kerning"),h=e.getElementsByTagName("distanceField");for(let l=0;l<i.length;l++)t.info.push({face:i[l].getAttribute("face"),size:parseInt(i[l].getAttribute("size"),10)});for(let l=0;l<s.length;l++)t.common.push({lineHeight:parseInt(s[l].getAttribute("lineHeight"),10)});for(let l=0;l<n.length;l++)t.page.push({id:parseInt(n[l].getAttribute("id"),10)||0,file:n[l].getAttribute("file")});for(let l=0;l<a.length;l++){const c=a[l];t.char.push({id:parseInt(c.getAttribute("id"),10),page:parseInt(c.getAttribute("page"),10)||0,x:parseInt(c.getAttribute("x"),10),y:parseInt(c.getAttribute("y"),10),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10),xoffset:parseInt(c.getAttribute("xoffset"),10),yoffset:parseInt(c.getAttribute("yoffset"),10),xadvance:parseInt(c.getAttribute("xadvance"),10)})}for(let l=0;l<o.length;l++)t.kerning.push({first:parseInt(o[l].getAttribute("first"),10),second:parseInt(o[l].getAttribute("second"),10),amount:parseInt(o[l].getAttribute("amount"),10)});for(let l=0;l<h.length;l++)t.distanceField.push({fieldType:h[l].getAttribute("fieldType"),distanceRange:parseInt(h[l].getAttribute("distanceRange"),10)});return t}}class ua{static test(e){return typeof e=="string"&&e.includes("<font>")?ca.test(j.ADAPTER.parseXML(e)):!1}static parse(e){return ca.parse(j.ADAPTER.parseXML(e))}}const Cn=[Es,ca,ua];function Um(r){for(let e=0;e<Cn.length;e++)if(Cn[e].test(r))return Cn[e];return null}function Gm(r,e,t,i,s,n){const a=t.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let o;const h=t.dropShadow?t.dropShadowDistance:0,l=t.padding||0,c=r.width/i-h-l*2,u=r.height/i-h-l*2,d=a.slice(),p=t.fillGradientStops.slice();if(!p.length){const f=d.length+1;for(let g=1;g<f;++g)p.push(g/f)}if(d.unshift(a[0]),p.unshift(0),d.push(a[a.length-1]),p.push(1),t.fillGradientType===Js.LINEAR_VERTICAL){o=e.createLinearGradient(c/2,l,c/2,u+l);let f=0;const g=(n.fontProperties.fontSize+t.strokeThickness)/u;for(let m=0;m<s.length;m++){const y=n.lineHeight*m;for(let S=0;S<d.length;S++){let _=0;typeof p[S]=="number"?_=p[S]:_=S/d.length;const E=y/u+_*g;let w=Math.max(f,E);w=Math.min(w,1),o.addColorStop(w,d[S]),f=w}}}else{o=e.createLinearGradient(l,u/2,c+l,u/2);const f=d.length+1;let g=1;for(let m=0;m<d.length;m++){let y;typeof p[m]=="number"?y=p[m]:y=g/f,o.addColorStop(y,d[m]),g++}}return o}function Hm(r,e,t,i,s,n,a){const o=t.text,h=t.fontProperties;e.translate(i,s),e.scale(n,n);const l=a.strokeThickness/2,c=-(a.strokeThickness/2);if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=Gm(r,e,a,n,[o],t),e.strokeStyle=a.stroke,a.dropShadow){const u=a.dropShadowColor,d=a.dropShadowBlur*n,p=a.dropShadowDistance*n;e.shadowColor=_e.shared.setValue(u).setAlpha(a.dropShadowAlpha).toRgbaString(),e.shadowBlur=d,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*p,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*p}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(o,l,c+t.lineHeight-h.descent),a.fill&&e.fillText(o,l,c+t.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function As(r){return r.codePointAt?r.codePointAt(0):r.charCodeAt(0)}function vc(r){return Array.from?Array.from(r):r.split("")}function Wm(r){typeof r=="string"&&(r=[r]);const e=[];for(let t=0,i=r.length;t<i;t++){const s=r[t];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const n=s[0].charCodeAt(0),a=s[1].charCodeAt(0);if(a<n)throw new Error("[BitmapFont]: Invalid character range.");for(let o=n,h=a;o<=h;o++)e.push(String.fromCharCode(o))}else e.push(...vc(s))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}const Ct=class at{constructor(e,t,i){const[s]=e.info,[n]=e.common,[a]=e.page,[o]=e.distanceField,h=bt(a.file),l={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=n.lineHeight/h,this.chars={},this.pageTextures=l;for(let c=0;c<e.page.length;c++){const{id:u,file:d}=e.page[c];l[u]=t instanceof Array?t[c]:t[d],o?.fieldType&&o.fieldType!=="none"&&(l[u].baseTexture.alphaMode=Ue.NO_PREMULTIPLIED_ALPHA,l[u].baseTexture.mipmap=ut.OFF)}for(let c=0;c<e.char.length;c++){const{id:u,page:d}=e.char[c];let{x:p,y:f,width:g,height:m,xoffset:y,yoffset:S,xadvance:_}=e.char[c];p/=h,f/=h,g/=h,m/=h,y/=h,S/=h,_/=h;const E=new le(p+l[d].frame.x/h,f+l[d].frame.y/h,g,m);this.chars[u]={xOffset:y,yOffset:S,xAdvance:_,kerning:{},texture:new K(l[d].baseTexture,E),page:d}}for(let c=0;c<e.kerning.length;c++){let{first:u,second:d,amount:p}=e.kerning[c];u/=h,d/=h,p/=h,this.chars[d]&&(this.chars[d].kerning[u]=p)}this.distanceFieldRange=o?.distanceRange,this.distanceFieldType=o?.fieldType?.toLowerCase()??"none"}destroy(){for(const e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(const e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null}static install(e,t,i){let s;if(e instanceof Hs)s=e;else{const a=Um(e);if(!a)throw new Error("Unrecognized data format for font.");s=a.parse(e)}t instanceof K&&(t=[t]);const n=new at(s,t,i);return at.available[n.font]=n,n}static uninstall(e){const t=at.available[e];if(!t)throw new Error(`No font found named '${e}'`);t.destroy(),delete at.available[e]}static from(e,t,i){if(!e)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:n,resolution:a,textureWidth:o,textureHeight:h,...l}=Object.assign({},at.defaultOptions,i),c=Wm(s),u=t instanceof fe?t:new fe(t),d=o,p=new Hs;p.info[0]={face:u.fontFamily,size:u.fontSize},p.common[0]={lineHeight:u.fontSize};let f=0,g=0,m,y,S,_=0;const E=[];for(let B=0;B<c.length;B++){m||(m=j.ADAPTER.createCanvas(),m.width=o,m.height=h,y=m.getContext("2d"),S=new ce(m,{resolution:a,...l}),E.push(new K(S)),p.page.push({id:E.length-1,file:""}));const v=c[B],F=Rt.measureText(v,u,!1,m),U=F.width,G=Math.ceil(F.height),N=Math.ceil((u.fontStyle==="italic"?2:1)*U);if(g>=h-G*a){if(g===0)throw new Error(`[BitmapFont] textureHeight ${h}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${v}')`);--B,m=null,y=null,S=null,g=0,f=0,_=0;continue}if(_=Math.max(G+F.fontProperties.descent,_),N*a+f>=d){if(f===0)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${u.fontFamily}', fontSize: ${u.fontSize}px, char: '${v}')`);--B,g+=_*a,g=Math.ceil(g),f=0,_=0;continue}Hm(m,y,F,f,g,a,u);const M=As(F.text);p.char.push({id:M,page:E.length-1,x:f/a,y:g/a,width:N,height:G,xoffset:0,yoffset:0,xadvance:U-(u.dropShadow?u.dropShadowDistance:0)-(u.stroke?u.strokeThickness:0)}),f+=(N+2*n)*a,f=Math.ceil(f)}if(!i?.skipKerning)for(let B=0,v=c.length;B<v;B++){const F=c[B];for(let U=0;U<v;U++){const G=c[U],N=y.measureText(F).width,M=y.measureText(G).width,O=y.measureText(F+G).width-(N+M);O&&p.kerning.push({first:As(F),second:As(G),amount:O})}}const w=new at(p,E,!0);return at.available[e]!==void 0&&at.uninstall(e),at.available[e]=w,w}};Ct.ALPHA=[["a","z"],["A","Z"]," "],Ct.NUMERIC=[["0","9"]],Ct.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Ct.ASCII=[[" ","~"]],Ct.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:Ct.ALPHANUMERIC},Ct.available={};let Mt=Ct;var zm=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,$m=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const Nh=[],Uh=[],Gh=[],xc=class _c extends ve{constructor(e,t={}){super();const{align:i,tint:s,maxWidth:n,letterSpacing:a,fontName:o,fontSize:h}=Object.assign({},_c.styleDefaults,t);if(!Mt.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tintColor=new _e(s),this._font=void 0,this._fontName=o,this._fontSize=h,this.text=e,this._maxWidth=n,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new vt(()=>{this.dirty=!0},this,0,0),this._roundPixels=j.ROUND_PIXELS,this.dirty=!0,this._resolution=j.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const e=Mt.available[this._fontName],t=this.fontSize,i=t/e.size,s=new ye,n=[],a=[],o=[],h=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",l=vc(h),c=this._maxWidth*e.size/t,u=e.distanceFieldType==="none"?Nh:Uh;let d=null,p=0,f=0,g=0,m=-1,y=0,S=0,_=0,E=0;for(let N=0;N<l.length;N++){const M=l[N],O=As(M);if(/(?:\s)/.test(M)&&(m=N,y=p,E++),M==="\r"||M===`
`){a.push(p),o.push(-1),f=Math.max(f,p),++g,++S,s.x=0,s.y+=e.lineHeight,d=null,E=0;continue}const k=e.chars[O];if(!k)continue;d&&k.kerning[d]&&(s.x+=k.kerning[d]);const J=Gh.pop()||{texture:K.EMPTY,line:0,charCode:0,prevSpaces:0,position:new ye};J.texture=k.texture,J.line=g,J.charCode=O,J.position.x=Math.round(s.x+k.xOffset+this._letterSpacing/2),J.position.y=Math.round(s.y+k.yOffset),J.prevSpaces=E,n.push(J),p=J.position.x+Math.max(k.xAdvance-k.xOffset,k.texture.orig.width),s.x+=k.xAdvance+this._letterSpacing,_=Math.max(_,k.yOffset+k.texture.height),d=O,m!==-1&&c>0&&s.x>c&&(++S,yi(n,1+m-S,1+N-m),N=m,m=-1,a.push(y),o.push(n.length>0?n[n.length-1].prevSpaces:0),f=Math.max(f,y),g++,s.x=0,s.y+=e.lineHeight,d=null,E=0)}const w=l[l.length-1];w!=="\r"&&w!==`
`&&(/(?:\s)/.test(w)&&(p=y),a.push(p),f=Math.max(f,p),o.push(-1));const B=[];for(let N=0;N<=g;N++){let M=0;this._align==="right"?M=f-a[N]:this._align==="center"?M=(f-a[N])/2:this._align==="justify"&&(M=o[N]<0?0:(f-a[N])/o[N]),B.push(M)}const v=n.length,F={},U=[],G=this._activePagesMeshData;u.push(...G);for(let N=0;N<v;N++){const M=n[N].texture,O=M.baseTexture.uid;if(!F[O]){let k=u.pop();if(!k){const b=new mm;let T,x;e.distanceFieldType==="none"?(T=new Fh(K.EMPTY),x=oe.NORMAL):(T=new Fh(K.EMPTY,{program:xt.from($m,zm),uniforms:{uFWidth:0}}),x=oe.NORMAL_NPM);const R=new Dh(b,T);R.blendMode=x,k={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:R,vertices:null,uvs:null,indices:null}}k.index=0,k.indexCount=0,k.vertexCount=0,k.uvsCount=0,k.total=0;const{_textureCache:J}=this;J[O]=J[O]||new K(M.baseTexture),k.mesh.texture=J[O],k.mesh.tint=this._tintColor.value,U.push(k),F[O]=k}F[O].total++}for(let N=0;N<G.length;N++)U.includes(G[N])||this.removeChild(G[N].mesh);for(let N=0;N<U.length;N++)U[N].mesh.parent!==this&&this.addChild(U[N].mesh);this._activePagesMeshData=U;for(const N in F){const M=F[N],O=M.total;if(!(M.indices?.length>6*O)||M.vertices.length<Dh.BATCHABLE_SIZE*2)M.vertices=new Float32Array(4*2*O),M.uvs=new Float32Array(4*2*O),M.indices=new Uint16Array(6*O);else{const k=M.total,J=M.vertices;for(let b=k*4*2;b<J.length;b++)J[b]=0}M.mesh.size=6*O}for(let N=0;N<v;N++){const M=n[N];let O=M.position.x+B[M.line]*(this._align==="justify"?M.prevSpaces:1);this._roundPixels&&(O=Math.round(O));const k=O*i,J=M.position.y*i,b=M.texture,T=F[b.baseTexture.uid],x=b.frame,R=b._uvs,A=T.index++;T.indices[A*6+0]=0+A*4,T.indices[A*6+1]=1+A*4,T.indices[A*6+2]=2+A*4,T.indices[A*6+3]=0+A*4,T.indices[A*6+4]=2+A*4,T.indices[A*6+5]=3+A*4,T.vertices[A*8+0]=k,T.vertices[A*8+1]=J,T.vertices[A*8+2]=k+x.width*i,T.vertices[A*8+3]=J,T.vertices[A*8+4]=k+x.width*i,T.vertices[A*8+5]=J+x.height*i,T.vertices[A*8+6]=k,T.vertices[A*8+7]=J+x.height*i,T.uvs[A*8+0]=R.x0,T.uvs[A*8+1]=R.y0,T.uvs[A*8+2]=R.x1,T.uvs[A*8+3]=R.y1,T.uvs[A*8+4]=R.x2,T.uvs[A*8+5]=R.y2,T.uvs[A*8+6]=R.x3,T.uvs[A*8+7]=R.y3}this._textWidth=f*i,this._textHeight=(s.y+e.lineHeight)*i;for(const N in F){const M=F[N];if(this.anchor.x!==0||this.anchor.y!==0){let b=0;const T=this._textWidth*this.anchor.x,x=this._textHeight*this.anchor.y;for(let R=0;R<M.total;R++)M.vertices[b++]-=T,M.vertices[b++]-=x,M.vertices[b++]-=T,M.vertices[b++]-=x,M.vertices[b++]-=T,M.vertices[b++]-=x,M.vertices[b++]-=T,M.vertices[b++]-=x}this._maxLineHeight=_*i;const O=M.mesh.geometry.getBuffer("aVertexPosition"),k=M.mesh.geometry.getBuffer("aTextureCoord"),J=M.mesh.geometry.getIndex();O.data=M.vertices,k.data=M.uvs,J.data=M.indices,O.update(),k.update(),J.update()}for(let N=0;N<n.length;N++)Gh.push(n[N]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0);const{distanceFieldRange:t,distanceFieldType:i,size:s}=Mt.available[this._fontName];if(i!=="none"){const{a:n,b:a,c:o,d:h}=this.worldTransform,l=Math.sqrt(n*n+a*a),c=Math.sqrt(o*o+h*h),u=(Math.abs(l)+Math.abs(c))/2,d=this.fontSize/s,p=e._view.resolution;for(const f of this._activePagesMeshData)f.mesh.shader.uniforms.uFWidth=u*t*d*p}super._render(e)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const e=Mt.available[this._fontName];if(!e)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==e&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(e){if(this.tint!==e){this._tintColor.setValue(e);for(let t=0;t<this._activePagesMeshData.length;t++)this._activePagesMeshData[t].mesh.tint=e}}get align(){return this._align}set align(e){this._align!==e&&(this._align=e,this.dirty=!0)}get fontName(){return this._fontName}set fontName(e){if(!Mt.available[e])throw new Error(`Missing BitmapFont "${e}"`);this._fontName!==e&&(this._fontName=e,this.dirty=!0)}get fontSize(){return this._fontSize??Mt.available[this._fontName].size}set fontSize(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get text(){return this._text}set text(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}destroy(e){const{_textureCache:t}=this,i=Mt.available[this._fontName].distanceFieldType==="none"?Nh:Uh;i.push(...this._activePagesMeshData);for(const s of this._activePagesMeshData)this.removeChild(s.mesh);this._activePagesMeshData=[],i.filter(s=>t[s.mesh.texture.baseTexture.uid]).forEach(s=>{s.mesh.texture=K.EMPTY});for(const s in t)t[s].destroy(),delete t[s];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(e)}};xc.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};let Zg=xc;const Vm=[".xml",".fnt"],Xm={extension:{type:V.LoadParser,priority:it.Normal},name:"loadBitmapFont",test(r){return Vm.includes(De.extname(r).toLowerCase())},async testParse(r){return Es.test(r)||ua.test(r)},async parse(r,e,t){const i=Es.test(r)?Es.parse(r):ua.parse(r),{src:s}=e,{page:n}=i,a=[];for(let l=0;l<n.length;++l){const c=n[l].file;let u=De.join(De.dirname(s),c);u=ra(u,s),a.push(u)}const o=await t.load(a),h=a.map(l=>o[l]);return Mt.install(i,h,!0)},async load(r,e){return(await j.ADAPTER.fetch(r)).text()},unload(r){r.destroy()}};Z.add(Xm);const da=class pi extends fe{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(e){return new pi(Object.keys(pi.defaultOptions).reduce((t,i)=>({...t,[i]:e[i]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(e=>{URL.revokeObjectURL(e.src),e.refs--,e.refs===0&&(e.fontFace&&document.fonts.delete(e.fontFace),delete pi.availableFonts[e.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(e,t={}){const{availableFonts:i}=pi;if(i[e]){const s=i[e];return this._fonts.push(s),s.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return j.ADAPTER.fetch(e).then(s=>s.blob()).then(async s=>new Promise((n,a)=>{const o=URL.createObjectURL(s),h=new FileReader;h.onload=()=>n([o,h.result]),h.onerror=a,h.readAsDataURL(s)})).then(async([s,n])=>{const a=Object.assign({family:De.basename(e,De.extname(e)),weight:"normal",style:"normal",display:"auto",src:s,dataSrc:n,refs:1,originalUrl:e,fontFace:null},t);i[e]=a,this._fonts.push(a),this.styleID++;const o=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=o,await o.load(),document.fonts.add(o),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...e){const t=e.filter(i=>!this._overrides.includes(i));t.length>0&&(this._overrides.push(...t),this.styleID++)}removeOverride(...e){const t=e.filter(i=>this._overrides.includes(i));t.length>0&&(this._overrides=this._overrides.filter(i=>!t.includes(i)),this.styleID++)}toCSS(e){return[`transform: scale(${e})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((e,t)=>`${e}
            @font-face {
                font-family: "${t.family}";
                src: url('${t.dataSrc}');
                font-weight: ${t.weight};
                font-style: ${t.style};
                font-display: ${t.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(e){this._stylesheet!==e&&(this._stylesheet=e,this.styleID++)}normalizeColor(e){return Array.isArray(e)&&(e=Lu(e)),typeof e=="number"?Fu(e):e}dropShadowToCSS(){let e=this.normalizeColor(this.dropShadowColor);const t=this.dropShadowAlpha,i=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),s=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);e.startsWith("#")&&t<1&&(e+=(t*255|0).toString(16).padStart(2,"0"));const n=`${i}px ${s}px`;return this.dropShadowBlur>0?`text-shadow: ${n} ${this.dropShadowBlur}px ${e}`:`text-shadow: ${n} ${e}`}reset(){Object.assign(this,pi.defaultOptions)}onBeforeDraw(){const{fontsDirty:e}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&e?new Promise(t=>setTimeout(t,100)):Promise.resolve()}get isSafari(){const{userAgent:e}=j.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(e)}set fillGradientStops(e){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(e){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(e){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(e){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(e){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(e){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(e){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};da.availableFonts={},da.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let Mn=da;const Gi=class fi extends Ie{constructor(e="",t={}){super(K.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const i=new Image,s=K.from(i,{scaleMode:j.SCALE_MODE,resourceOptions:{autoLoad:!1}});s.orig=new le,s.trim=new le,this.texture=s;const n="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",o=document.createElementNS(n,"svg"),h=document.createElementNS(n,"foreignObject"),l=document.createElementNS(a,"div"),c=document.createElementNS(a,"style");h.setAttribute("width","10000"),h.setAttribute("height","10000"),h.style.overflow="hidden",o.appendChild(h),this.maxWidth=fi.defaultMaxWidth,this.maxHeight=fi.defaultMaxHeight,this._domElement=l,this._styleElement=c,this._svgRoot=o,this._foreignObject=h,this._foreignObject.appendChild(c),this._foreignObject.appendChild(l),this._image=i,this._loadImage=new Image,this._autoResolution=fi.defaultAutoResolution,this._resolution=fi.defaultResolution??j.RESOLUTION,this.text=e,this.style=t}measureText(e){const{text:t,style:i,resolution:s}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},e);Object.assign(this._domElement,{innerHTML:t,style:i.toCSS(s)}),this._styleElement.textContent=i.toGlobalCSS(),document.body.appendChild(this._svgRoot);const n=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:o}=n;(a>this.maxWidth||o>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const h=Math.min(this.maxWidth,Math.ceil(a)),l=Math.min(this.maxHeight,Math.ceil(o));return this._svgRoot.setAttribute("width",h.toString()),this._svgRoot.setAttribute("height",l.toString()),t!==this._text&&(this._domElement.innerHTML=this._text),i!==this._style&&(Object.assign(this._domElement,{style:this._style?.toCSS(s)}),this._styleElement.textContent=this._style?.toGlobalCSS()),{width:h+i.padding*2,height:l+i.padding*2}}async updateText(e=!0){const{style:t,_image:i,_loadImage:s}=this;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),!this.dirty&&e)return;const{width:n,height:a}=this.measureText();i.width=s.width=Math.ceil(Math.max(1,n)),i.height=s.height=Math.ceil(Math.max(1,a)),this._updateID++;const o=this._updateID;await new Promise(h=>{s.onload=async()=>{if(o<this._updateID){h();return}await t.onBeforeDraw(),i.src=s.src,s.onload=null,s.src="",this.updateTexture(),h()};const l=new XMLSerializer().serializeToString(this._svgRoot);s.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(l)}`})}get source(){return this._image}updateTexture(){const{style:e,texture:t,_image:i,resolution:s}=this,{padding:n}=e,{baseTexture:a}=t;t.trim.width=t._frame.width=i.width/s,t.trim.height=t._frame.height=i.height/s,t.trim.x=-n,t.trim.y=-n,t.orig.width=t._frame.width-n*2,t.orig.height=t._frame.height-n*2,this._onTextureUpdate(),a.setRealSize(i.width,i.height,s),this.dirty=!1}_render(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._render(e)}_renderCanvas(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(e)}getLocalBounds(e){return this.updateText(!0),super.getLocalBounds(e)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},fi.defaultDestroyOptions,e),super.destroy(e);const t=null;this.ownsStyle&&this._style?.cleanFonts(),this._style=t,this._svgRoot?.remove(),this._svgRoot=t,this._domElement?.remove(),this._domElement=t,this._foreignObject?.remove(),this._foreignObject=t,this._styleElement?.remove(),this._styleElement=t,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=t,this._image.src="",this._image=t}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(e){this.updateText(!0);const t=It(this.scale.x)||1;this.scale.x=t*e/this._image.width/this.resolution,this._width=e}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(e){this.updateText(!0);const t=It(this.scale.y)||1;this.scale.y=t*e/this._image.height/this.resolution,this._height=e}get style(){return this._style}set style(e){this._style!==e&&(e=e||{},e instanceof Mn?(this.ownsStyle=!1,this._style=e):e instanceof fe?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=Mn.from(e)):(this.ownsStyle=!0,this._style=new Mn(e)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(e){e=String(e===""||e===null||e===void 0?" ":e),e=this.sanitiseText(e),this._text!==e&&(this._text=e,this.dirty=!0)}get resolution(){return this._resolution}set resolution(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)}sanitiseText(e){return e.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};Gi.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},Gi.defaultMaxWidth=2024,Gi.defaultMaxHeight=2024,Gi.defaultAutoResolution=!0;let Qg=Gi;class jm{_level=1;_experience=0;_experienceToNextLevel=100;_score=0;_time=0;_enemiesKilled=0;constructor(){}update(e){console.warn("GameState: Updating state..."),this._time+=e/60,console.warn("GameState: State updated successfully")}addExperience(e){return this._experience+=e,this._experience>=this._experienceToNextLevel?(this.levelUp(),!0):!1}levelUp(){this._level++,this._experience-=this._experienceToNextLevel,this._experienceToNextLevel=Math.floor(this._experienceToNextLevel*1.2),console.log(`Level up! Now level ${this._level}`)}addScore(e){this._score+=e}incrementEnemiesKilled(){this._enemiesKilled++}get level(){return this._level}get experience(){return this._experience}get experienceToNextLevel(){return this._experienceToNextLevel}get score(){return this._score}get time(){return this._time}get enemiesKilled(){return this._enemiesKilled}get experienceProgress(){return this._experience/this._experienceToNextLevel}}class Ym{keys=new Set;keysJustPressed=new Set;mousePosition={x:0,y:0};init(){console.warn("InputManager: Initializing..."),window.addEventListener("keydown",this.onKeyDown.bind(this)),window.addEventListener("keyup",this.onKeyUp.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),console.warn("InputManager: Initialized successfully")}onKeyDown(e){(e.code==="Space"||e.code==="Escape")&&console.log("Key down:",e.code,"| Key:",e.key),this.keys.has(e.code)||this.keysJustPressed.add(e.code),this.keys.add(e.code)}onKeyUp(e){this.keys.delete(e.code)}onMouseMove(e){this.mousePosition.x=e.clientX,this.mousePosition.y=e.clientY}update(){}clearJustPressed(){this.keysJustPressed.clear()}clearJustPressedKey(e){this.keysJustPressed.delete(e)}getInputState(){return{left:this.keys.has("KeyA")||this.keys.has("ArrowLeft"),right:this.keys.has("KeyD")||this.keys.has("ArrowRight"),up:this.keys.has("KeyW")||this.keys.has("ArrowUp"),down:this.keys.has("KeyS")||this.keys.has("ArrowDown"),mouseX:this.mousePosition.x,mouseY:this.mousePosition.y}}isKeyPressed(e){return this.keys.has(e)}isKeyJustPressed(e){return this.keysJustPressed.has(e)}cleanup(){console.log("InputManager cleanup called")}}var Oe=(r=>(r.PLAYER="player",r.ENEMY="enemy",r.PROJECTILE="projectile",r.PICKUP="pickup",r))(Oe||{});const qm="modulepreload",Km=function(r){return"/MOMsters-game/"+r},Hh={},Hi=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let h=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");s=h(t.map(l=>{if(l=Km(l),l in Hh)return;Hh[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":qm,c||(d.as="script"),d.crossOrigin="",d.href=l,o&&d.setAttribute("nonce",o),document.head.appendChild(d),c)return new Promise((p,f)=>{d.addEventListener("load",p),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})};class mt{sprite;collisionRadius=8;collisionGroup=Oe.PROJECTILE;visualSprite=null;animationFrames=[];currentFrame=0;frameTimer=0;frameInterval=6;velocity;_speed;damage;lifetime;maxLifetime;isActive=!0;pierceCount=0;maxPierce=0;weaponType="fireball";rotationSpeed=0;currentRotation=0;onHitTarget;onExpired;constructor(e,t,i,s,n=300,a=10,o=0,h="fireball"){this.sprite=new ve,this._speed=n,this.damage=a,this.lifetime=0,this.maxLifetime=3,this.maxPierce=o,this.weaponType=h,this.sprite.x=e,this.sprite.y=t;const l=i-e,c=s-t,u=Math.sqrt(l*l+c*c);u>0?this.velocity={x:l/u*this._speed,y:c/u*this._speed}:this.velocity={x:this._speed,y:0},this.createSprite(),this.setRotationSpeed(),this.updateRotation(),console.warn("Projectile: Creating projectile...")}createSprite(){switch(this.sprite.removeChildren(),this.weaponType){case"axe":this.loadAxeSprite();break;case"knife":this.loadKnifeSprite();break;case"rune_tracer":this.loadRuneTracerSprite();break;case"fireball":default:this.loadFireballSprite();break}console.warn("Projectile: Projectile created successfully")}async loadFireballSprite(){try{const e=await Hi(()=>import("./index-DxNb0WdF-1751731084935-ULTRA-CACHE-BREAK.js"),[]).then(n=>n.Assets.load("/MOMsters-game/sprites/fireball.png")),t=128,i=128,s=6;for(let n=0;n<s;n++){const a=new le(n*t,0,t,i),o=new Ie(new K(e.baseTexture,a));o.width=this.collisionRadius*4.05,o.height=this.collisionRadius*4.05,o.anchor.set(.5,.5),o.visible=n===0,this.animationFrames.push(o),this.sprite.addChild(o)}this.visualSprite=this.animationFrames[0],console.log(`Created ${this.animationFrames.length} fireball animation frames`)}catch(e){console.log("Fireball sprite not found, using fallback graphics:",e),this.createFallbackGraphics()}}async loadAxeSprite(){try{const e=await Hi(()=>import("./index-DxNb0WdF-1751731084935-ULTRA-CACHE-BREAK.js"),[]).then(i=>i.Assets.load("/MOMsters-game/sprites/axe_1.png")),t=new Ie(e);t.width=this.collisionRadius*3,t.height=this.collisionRadius*3,t.anchor.set(.5,.5),this.visualSprite=t,this.sprite.addChild(t),console.log("Created axe sprite")}catch(e){console.log("Axe sprite not found, using fallback graphics:",e),this.createFallbackGraphics()}}async loadKnifeSprite(){try{const e=await Hi(()=>import("./index-DxNb0WdF-1751731084935-ULTRA-CACHE-BREAK.js"),[]).then(i=>i.Assets.load("/MOMsters-game/sprites/knife_1.png")),t=new Ie(e);t.width=this.collisionRadius*1.25,t.height=this.collisionRadius*1.25,t.anchor.set(.5,.5),this.visualSprite=t,this.sprite.addChild(t),console.log("Created knife sprite")}catch(e){console.log("Knife sprite not found, using fallback graphics:",e),this.createFallbackGraphics()}}async loadRuneTracerSprite(){try{const e=await Hi(()=>import("./index-DxNb0WdF-1751731084935-ULTRA-CACHE-BREAK.js"),[]).then(i=>i.Assets.load("/MOMsters-game/sprites/beam_01_origin.png")),t=new Ie(e);t.width=this.collisionRadius*2,t.height=this.collisionRadius*2,t.anchor.set(.5,.5),t.tint=4491519,this.visualSprite=t,this.sprite.addChild(t),console.log("Created rune tracer sprite")}catch(e){console.log("Beam sprite not found, using custom rune tracer graphics:",e),this.createRuneTracerFallbackGraphics()}}createFallbackGraphics(){const e=new me;e.beginFill(16777215),e.drawCircle(0,0,this.collisionRadius),e.endFill(),e.beginFill(43775),e.drawCircle(0,0,this.collisionRadius-1),e.endFill(),e.beginFill(16777215,.3),e.drawCircle(-2,0,1),e.endFill(),this.visualSprite=e,this.sprite.addChild(e)}createRuneTracerFallbackGraphics(){const e=new me;e.beginFill(4491519),e.drawEllipse(0,0,this.collisionRadius*1.5,this.collisionRadius*.5),e.endFill(),e.beginFill(16777215),e.drawEllipse(0,0,this.collisionRadius*1.2,this.collisionRadius*.3),e.endFill(),e.beginFill(4491519,.3),e.drawEllipse(-this.collisionRadius,0,this.collisionRadius*.8,this.collisionRadius*.3),e.endFill(),this.visualSprite=e,this.sprite.addChild(e)}setRotationSpeed(){switch(this.weaponType){case"axe":this.rotationSpeed=Math.PI*4;break;case"knife":this.rotationSpeed=Math.PI*6;break;default:this.rotationSpeed=0;break}}update(e){if(!this.isActive)return;const t={x:this.velocity.x*(e/60),y:this.velocity.y*(e/60)};this.sprite.x+=t.x,this.sprite.y+=t.y,this.rotationSpeed>0&&(this.currentRotation+=this.rotationSpeed*(e/60),this.visualSprite&&(this.visualSprite.rotation=this.currentRotation)),this.lifetime+=e/60,this.lifetime>=this.maxLifetime&&this.expire(),this.updateAnimation(e),this.updateAppearance()}updateAnimation(e){this.animationFrames.length!==0&&(this.frameTimer+=e,this.frameTimer>=this.frameInterval&&(this.frameTimer=0,this.animationFrames[this.currentFrame].visible=!1,this.currentFrame=(this.currentFrame+1)%this.animationFrames.length,this.animationFrames[this.currentFrame].visible=!0,this.visualSprite=this.animationFrames[this.currentFrame]),this.updateRotation())}updateRotation(){if(this.animationFrames.length!==0&&this.rotationSpeed===0){const e=Math.atan2(this.velocity.y,this.velocity.x);for(const t of this.animationFrames)t.rotation=e}}updateAppearance(){const e=this.lifetime/this.maxLifetime;if(this.sprite.alpha=1-e*.3,this.visualSprite&&this.animationFrames.length===0&&this.rotationSpeed===0){const t=Math.atan2(this.velocity.y,this.velocity.x);this.visualSprite.rotation=t}}onCollision(e){this.isActive&&e.collisionGroup===Oe.ENEMY&&(this.onHitTarget&&this.onHitTarget(e),this.pierceCount++,this.pierceCount>this.maxPierce?this.destroy():(this.sprite.alpha=.8,setTimeout(()=>{this.sprite.alpha=1},50)))}expire(){this.isActive=!1,this.onExpired&&this.onExpired()}destroy(){this.isActive=!1,this.sprite.alpha=.5,this.visualSprite&&"tint"in this.visualSprite&&(this.visualSprite.tint=16776960)}get active(){return this.isActive}get projectileDamage(){return this.damage}get position(){return{x:this.sprite.x,y:this.sprite.y}}get currentVelocity(){return{...this.velocity}}}class Zs{sprite;collisionRadius;collisionGroup=Oe.ENEMY;target;formationIndex;formationSize;health;maxHealth;speed;damage;xpValue=1;isAlive=!0;constructor(e,t,i,s,n=1){this.sprite=new ve,this.health=e,this.maxHealth=e,this.speed=t,this.damage=i,this.collisionRadius=s,this.xpValue=n}setTarget(e){this.target=e}attack(){this.target&&this.isAlive}isActive(){return this.isAlive&&this.target!==void 0}get currentHealth(){return this.health}get maximumHealth(){return this.maxHealth}update(e,t){this.isAlive&&(this.moveTowardPlayer(e,t),this.updateAppearance())}moveTowardPlayer(e,t){const i=t.sprite.x-this.sprite.x,s=t.sprite.y-this.sprite.y,n=Math.sqrt(i*i+s*s);if(n>0){const a=this.speed*(e/60);this.sprite.x+=i/n*a,this.sprite.y+=s/n*a,this.updateRotation(i,s)}}updateRotation(e,t){e<0?this.sprite.scale.x=-1:e>0&&(this.sprite.scale.x=1)}onCollision(e){if(e instanceof mt){const t=e;this.takeDamage(t.damage)}}takeDamage(e){return this.isAlive?(this.health=Math.floor(this.health-e),this.health<=0?(this.health=0,this.die(),!0):!1):!1}die(){this.isAlive=!1,this.sprite.alpha=.3,setTimeout(()=>{this.sprite.parent&&this.sprite.parent.removeChild(this.sprite)},500)}updateAppearance(){if(!this.isAlive)return;const e=this.health/this.maxHealth;this.sprite.alpha=.5+e*.5}get healthPercent(){return this.health/this.maxHealth}get alive(){return this.isAlive}get attackDamage(){return this.damage}get position(){return{x:this.sprite.x,y:this.sprite.y}}get experienceValue(){return this.xpValue}}class Jm{sprite;collisionRadius=25;collisionGroup=Oe.PLAYER;speed=200;health=100;maxHealth=100;invulnerabilityTimer=0;invulnerabilityDuration=60;healthRegenRate=.5;healthRegenDelay=5;timeSinceLastDamage=0;animationTime=0;graphicsSprite;godzillaSprite;currentDesign="godzilla";onDamageTaken;onPlayerDied;constructor(){this.graphicsSprite=new me,this.sprite=this.graphicsSprite,this.createHexagonCharacter()}async init(){await this.loadGodzillaSprite(),this.godzillaSprite&&this.switchCharacterDesign("godzilla")}async loadGodzillaSprite(){try{const e=await _t.load("/MOMsters-game/sprites/godzilla_small.png");this.godzillaSprite=new Ie(e),this.godzillaSprite.width=64,this.godzillaSprite.height=64,this.godzillaSprite.anchor.set(.5,.5)}catch{}}update(e,t,i=1024,s=768){const n=t.getInputState(),a=this.speed*(e/60);this.animationTime+=e,this.invulnerabilityTimer>0&&(this.invulnerabilityTimer-=e),this.health<this.maxHealth&&(this.health+=this.healthRegenRate*e,this.health>this.maxHealth&&(this.health=this.maxHealth)),this.updateAppearance(),this.updateAnimation(),t.isKeyJustPressed("KeyC")?this.switchCharacterDesign("circle"):t.isKeyJustPressed("KeyH")?this.switchCharacterDesign("hexagon"):t.isKeyJustPressed("KeyG")?this.switchCharacterDesign("godzilla"):t.isKeyJustPressed("KeyT")&&this.testGodzillaSprite();let o=0,h=0;if(n.left&&(o-=a),n.right&&(o+=a),n.up&&(h-=a),n.down&&(h+=a),o!==0&&h!==0){const c=Math.sqrt(2)/2;o*=c,h*=c}this.sprite.x+=o,this.sprite.y+=h,this.updateSpriteOrientation(o);const l=i/2;this.sprite.x=Math.max(-l+25,Math.min(l-25,this.sprite.x)),this.sprite.y=Math.max(-l+25,Math.min(l-25,this.sprite.y))}switchCharacterDesign(e){this.currentDesign=e;const t=this.sprite.x,i=this.sprite.y,s=this.sprite.parent;s&&s.removeChild(this.sprite),e==="godzilla"&&this.godzillaSprite?this.sprite=this.godzillaSprite:e==="godzilla"&&!this.godzillaSprite?(this.sprite=this.graphicsSprite,this.createHexagonCharacter()):(this.sprite=this.graphicsSprite,e==="hexagon"?this.createHexagonCharacter():e==="circle"&&this.createCircleCharacter()),this.sprite.x=t,this.sprite.y=i,s&&s.addChild(this.sprite)}createHexagonCharacter(){this.graphicsSprite.clear(),this.graphicsSprite.beginFill(4886754),this.graphicsSprite.drawPolygon([-24,-16,24,-16,30,0,24,16,-24,16,-30,0]),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(6004978),this.graphicsSprite.drawPolygon([-16,-12,16,-12,20,0,16,12,-16,12,-20,0]),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(16777215),this.graphicsSprite.drawCircle(0,0,8),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(8107007,.6),this.graphicsSprite.drawCircle(0,0,12),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(2899536),this.graphicsSprite.drawCircle(12,-4,4),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(16777215),this.graphicsSprite.drawCircle(14,-6,2),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(8107007,.4),this.graphicsSprite.drawCircle(-16,-20,4),this.graphicsSprite.drawCircle(16,-20,4),this.graphicsSprite.drawCircle(-16,20,4),this.graphicsSprite.drawCircle(16,20,4),this.graphicsSprite.endFill()}createCircleCharacter(){this.graphicsSprite.clear(),this.graphicsSprite.beginFill(65416),this.graphicsSprite.drawCircle(0,0,30),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(65450,.5),this.graphicsSprite.drawCircle(0,0,24),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(16777215),this.graphicsSprite.drawCircle(0,0,12),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(34884),this.graphicsSprite.drawCircle(16,0,6),this.graphicsSprite.endFill(),this.graphicsSprite.beginFill(16777215),this.graphicsSprite.drawCircle(18,-2,2),this.graphicsSprite.endFill()}updateHealthRegeneration(e){if(this.timeSinceLastDamage+=e/60,this.timeSinceLastDamage>=this.healthRegenDelay&&this.health<this.maxHealth){const t=this.healthRegenRate*(e/60),i=this.health;this.health=Math.min(this.maxHealth,Math.floor(this.health+t)),Math.floor(this.timeSinceLastDamage)%2===0&&this.health>i}}updateAppearance(){if(this.invulnerabilityTimer>0){const t=Math.sin(this.invulnerabilityTimer*8)>0?1:.5;this.sprite.alpha=t}else this.sprite.alpha=1;if(this.sprite===this.graphicsSprite){const e=this.health/this.maxHealth;e<.3?this.sprite.tint=16764108:e<.6?this.sprite.tint=16768460:this.sprite.tint=16777215}}updateAnimation(){const i=1+Math.sin(this.animationTime*.1)*.05;this.sprite.scale.set(i,i)}updateSpriteOrientation(e){this.currentDesign==="godzilla"&&this.godzillaSprite&&(e<0?this.godzillaSprite.scale.x=-1:e>0&&(this.godzillaSprite.scale.x=1))}testGodzillaSprite(){this.godzillaSprite}takeDamage(e){return this.health=Math.floor(this.health-e),this.timeSinceLastDamage=0,this.health<=0?(this.health=0,!0):!1}onCollision(e){if(e instanceof Zs){const t=e;this.takeDamage(t.damage)}}heal(e){this.health=Math.min(this.maxHealth,Math.floor(this.health+e))}get currentHealth(){return this.health}get maximumHealth(){return this.maxHealth}get position(){return{x:this.sprite.x,y:this.sprite.y}}get isInvulnerable(){return this.invulnerabilityTimer>0}get isDead(){return this.health<=0}get healthPercent(){return this.health/this.maxHealth}applyHealthUpgrades(e,t){const i=this.maxHealth+e;i!==this.maxHealth&&(this.maxHealth=i,this.health=Math.min(this.health+e*.5,this.maxHealth)),this.healthRegenRate=this.healthRegenRate+t}applySpeedUpgrade(e){this.speed+=e}setHealthRegenRate(e){this.healthRegenRate=e,this.eventBus.emit("player:regenRateChanged",{playerId:this.id,newRate:e})}}class Zm{container;targetX=0;targetY=0;currentX=0;currentY=0;followSpeed=.1;screenWidth;screenHeight;constructor(e,t,i){this.container=e,this.screenWidth=t,this.screenHeight=i}setTarget(e,t){this.targetX=e,this.targetY=t}update(e){const t=Math.min(1,this.followSpeed*e);this.currentX+=(this.targetX-this.currentX)*t,this.currentY+=(this.targetY-this.currentY)*t,this.container.x=-this.currentX+this.screenWidth/2,this.container.y=-this.currentY+this.screenHeight/2}getPosition(){return{x:this.currentX,y:this.currentY}}worldToScreen(e,t){return{x:e-this.currentX+this.screenWidth/2,y:t-this.currentY+this.screenHeight/2}}screenToWorld(e,t){return{x:e+this.currentX-this.screenWidth/2,y:t+this.currentY-this.screenHeight/2}}isVisible(e,t,i=100){const s=this.worldToScreen(e,t);return s.x>=-i&&s.x<=this.screenWidth+i&&s.y>=-i&&s.y<=this.screenHeight+i}getVisibleBounds(e=0){const t=this.screenToWorld(-e,-e),i=this.screenToWorld(this.screenWidth+e,this.screenHeight+e);return{left:t.x,right:i.x,top:t.y,bottom:i.y}}setFollowSpeed(e){this.followSpeed=Math.max(.01,Math.min(1,e))}}class Qm{entities=[];collisionPairs=[];constructor(){this.setupDefaultCollisions()}setupDefaultCollisions(){this.addCollisionPair(Oe.PLAYER,Oe.ENEMY),this.addCollisionPair(Oe.PLAYER,Oe.PICKUP),this.addCollisionPair(Oe.PROJECTILE,Oe.ENEMY)}addEntity(e){this.entities.includes(e)||this.entities.push(e)}removeEntity(e){const t=this.entities.indexOf(e);t>-1&&this.entities.splice(t,1)}addCollisionPair(e,t,i){this.collisionPairs.push({groupA:e,groupB:t,callback:i})}circleCollision(e,t){const i=e.sprite.x-t.sprite.x,s=e.sprite.y-t.sprite.y,n=Math.sqrt(i*i+s*s),a=e.collisionRadius+t.collisionRadius;return n<a}shouldCollide(e,t){return this.collisionPairs.find(i=>i.groupA===e&&i.groupB===t||i.groupA===t&&i.groupB===e)||null}update(){for(let e=0;e<this.entities.length;e++)for(let t=e+1;t<this.entities.length;t++){const i=this.entities[e],s=this.entities[t],n=this.shouldCollide(i.collisionGroup,s.collisionGroup);n&&this.circleCollision(i,s)&&(n.callback&&n.callback(i,s),i.onCollision&&i.onCollision(s),s.onCollision&&s.onCollision(i))}}getEntitiesInGroup(e){return this.entities.filter(t=>t.collisionGroup===e)}checkEntityCollisions(e){const t=[];for(const i of this.entities)i===e||!this.shouldCollide(e.collisionGroup,i.collisionGroup)||this.circleCollision(e,i)&&t.push(i);return t}clear(){this.entities=[]}getStats(){const e={};for(const t of this.entities)e[t.collisionGroup]=(e[t.collisionGroup]||0)+1;return{totalEntities:this.entities.length,entitiesByGroup:e}}}class eg{terrainTexture;decorationTexture;tileSize=32;actualTileSize=32;tilesPerRow=10;tilesPerColumn=2;totalTiles=this.tilesPerRow*this.tilesPerColumn;decorationTilesPerRow=10;decorationTilesPerColumn=6;totalDecorationTiles=this.decorationTilesPerRow*this.decorationTilesPerColumn;defaultBiomes=[{name:"grassland",tileWeights:[.6,.3,.1,0,0,0,0,0,0,0,.6,.3,.1,0,0,0,0,0,0,0],frequency:.25,clusterSize:40,colorTint:9498256},{name:"forest",tileWeights:[0,.3,.6,.1,0,0,0,0,0,0,0,.3,.6,.1,0,0,0,0,0,0],frequency:.25,clusterSize:50,colorTint:2263842},{name:"rocky",tileWeights:[0,0,.3,.6,.1,0,0,0,0,0,0,0,.3,.6,.1,0,0,0,0,0],frequency:.25,clusterSize:35,colorTint:6908265},{name:"water",tileWeights:[0,0,0,.3,.6,.1,0,0,0,0,0,0,0,.3,.6,.1,0,0,0,0],frequency:.25,clusterSize:60,colorTint:4286945}];constructor(){this.loadTerrainSheet(),this.loadDecorationSheet()}async loadTerrainSheet(){try{console.warn("TerrainManager: Loading terrain..."),this.terrainTexture=await _t.load("/MOMsters-game/sprites/terrain2_10x2.png"),console.warn("TerrainManager: Terrain loaded successfully"),console.warn(`📊 Sheet contains ${this.totalTiles} tiles (${this.tilesPerRow}x${this.tilesPerColumn})`),console.warn("🔍 Terrain texture dimensions:",this.terrainTexture.width,"x",this.terrainTexture.height);const e=Math.floor(this.terrainTexture.width/this.tilesPerRow),t=Math.floor(this.terrainTexture.height/this.tilesPerColumn);console.warn("🔍 Calculated tile size:",e,"x",t),(e!==this.actualTileSize||t!==this.actualTileSize)&&(console.warn(`⚠️ Tile size mismatch! Expected ${this.actualTileSize}x${this.actualTileSize}, got ${e}x${t}`),console.warn(`📏 Texture tiles are ${e}x${t}, will be scaled to ${this.tileSize}x${this.tileSize} for rendering`),this.actualTileSize=Math.min(e,t),console.warn(`✅ Tiles will render at ${this.tileSize}x${this.tileSize} (scaled from ${this.actualTileSize}x${this.actualTileSize})`))}catch(e){console.error("❌ Failed to load terrain sprite sheet:",e),console.error("Error details:",e)}}async loadDecorationSheet(){try{console.warn("🔄 Loading decoration sprite sheet..."),this.decorationTexture=await _t.load("/MOMsters-game/sprites/terrain_decoration-10x6.png"),console.warn("✅ Decoration sprite sheet loaded successfully!"),console.warn(`📊 Sheet contains ${this.totalDecorationTiles} decoration tiles (${this.decorationTilesPerRow}x${this.decorationTilesPerColumn})`),console.warn("🔍 Decoration texture dimensions:",this.decorationTexture.width,"x",this.decorationTexture.height)}catch(e){console.error("❌ Failed to load decoration sprite sheet:",e),console.error("Error details:",e)}}createTerrainTile(e,t,i,s){if(!this.terrainTexture||e<0||e>=this.totalTiles)return console.warn(`⚠️ Invalid tile type: ${e}. Must be 0-${this.totalTiles-1} (20 tiles total)`),null;const n=Math.floor(e/this.tilesPerRow),a=e%this.tilesPerRow,o=a*this.actualTileSize,h=n*this.actualTileSize;if(o+this.actualTileSize>this.terrainTexture.width||h+this.actualTileSize>this.terrainTexture.height)return console.warn(`⚠️ Tile ${e} (row ${n}, col ${a}) would exceed texture bounds!`),console.warn(`   Tile position: (${o}, ${h}) with size ${this.actualTileSize}x${this.actualTileSize}`),console.warn(`   Texture size: ${this.terrainTexture.width}x${this.terrainTexture.height}`),null;const l=new le(o,h,this.actualTileSize,this.actualTileSize),c=new K(this.terrainTexture.baseTexture,l),u=new Ie(c);u.x=t,u.y=i,u.anchor.set(0,0),u.zIndex=-1e4,u.alpha=.25+Math.random()*.75;const d=this.tileSize/this.actualTileSize;if(u.scale.set(d,d),s){const p=this.defaultBiomes.find(f=>f.name===s);p?.colorTint&&(u.tint=p.colorTint)}return{sprite:u,tileType:e,x:t,y:i,biome:s}}createDecorationTile(e,t,i){if(!this.decorationTexture||e<0||e>=this.totalDecorationTiles)return console.warn(`⚠️ Invalid decoration tile type: ${e}. Must be 0-${this.totalDecorationTiles-1} (60 tiles total)`),null;const s=Math.floor(e/this.decorationTilesPerRow),n=e%this.decorationTilesPerRow,a=n*this.actualTileSize,o=s*this.actualTileSize;if(a+this.actualTileSize>this.decorationTexture.width||o+this.actualTileSize>this.decorationTexture.height)return console.warn(`⚠️ Decoration tile ${e} (row ${s}, col ${n}) would exceed texture bounds!`),null;const h=new le(a,o,this.actualTileSize,this.actualTileSize),l=new K(this.decorationTexture.baseTexture,h),c=new Ie(l);c.x=t,c.y=i,c.anchor.set(0,0),c.zIndex=-5e3,c.alpha=.6+Math.random()*.4;const u=this.tileSize/this.actualTileSize,d=1+Math.random()*3,p=u*d;return c.scale.set(p,p),{sprite:c,tileType:e,x:t,y:i}}generateSparseDecorations(e){console.log("🌿 Generating sparse decorations...");const t=[],i=.02,s=Math.ceil(e.worldWidth/e.tileSize),n=Math.ceil(e.worldHeight/e.tileSize);console.log(`📊 Generating decorations for ${s}x${n} grid with ${i*100}% density`);const a=this.createSeededRandom(e.biomeSeed?e.biomeSeed+1e3:void 0);for(let o=0;o<n;o++)for(let h=0;h<s;h++)if(a()<i){const l=Math.floor(a()*this.totalDecorationTiles),c=h*e.tileSize,u=o*e.tileSize,d=this.createDecorationTile(l,c,u);d&&t.push(d)}return console.log(`✅ Generated ${t.length} decoration tiles`),t}generateProceduralTerrain(e){console.log("🌍 Generating decorative procedural terrain..."),console.log(`📐 World size: ${e.worldWidth}x${e.worldHeight}`),console.log(`🔲 Tile size: ${e.tileSize}`);const t=[],i=e.biomeTypes||this.defaultBiomes,s=Math.ceil(e.worldWidth/e.tileSize),n=Math.ceil(e.worldHeight/e.tileSize);console.log(`📊 Grid dimensions: ${s}x${n} tiles`);const a=this.generateBiomeMap(s,n,i,e.biomeSeed),o=this.generateDensityMap(s,n,e.terrainDensity||.8),h=this.generateTileTypeMap(s,n,a,i,e.biomeSeed);for(let c=0;c<n;c++)for(let u=0;u<s;u++){const d=u*e.tileSize-e.worldWidth/2,p=c*e.tileSize-e.worldHeight/2;if(o[c][u]>Math.random()){const f=a[c][u],g=h[c][u],m=this.createTerrainTile(g,d,p,f.name);m&&t.push(m)}}console.log(`✅ Generated ${t.length} decorative terrain tiles`),console.log(`📊 Density map statistics: min=${Math.min(...o.flat())}, max=${Math.max(...o.flat())}, avg=${o.flat().reduce((c,u)=>c+u,0)/o.flat().length}`),console.log(`🎯 Terrain placement: ${t.length} tiles placed out of ${s*n} possible positions`),console.log(`🔍 Density settings: base=${e.terrainDensity}, threshold=0.4, grid=${s}x${n}`);const l=o.flat().filter(c=>c>0);return console.log(`🔍 Non-zero density values: ${l.length} out of ${o.flat().length} (${(l.length/o.flat().length*100).toFixed(1)}%)`),l.length>0&&console.log(`🔍 Density range: ${Math.min(...l).toFixed(3)} to ${Math.max(...l).toFixed(3)}`),t}generateBiomeMap(e,t,i,s){const n=[],a=this.createSeededRandom(s);for(let o=0;o<t;o++){n[o]=[];for(let h=0;h<e;h++)n[o][h]=this.selectRandomBiome(i,a)}for(let o=0;o<8;o++){const h=[];for(let l=0;l<t;l++){h[l]=[];for(let c=0;c<e;c++){const u=this.getNeighborBiomes(n,c,l,e,t),d=this.getMostCommonBiome(u);a()<.9?h[l][c]=d:h[l][c]=n[l][c]}}n.splice(0,n.length,...h)}for(let o=0;o<4;o++){const h=[];for(let l=0;l<t;l++){h[l]=[];for(let c=0;c<e;c++){const u=this.getNeighborBiomes(n,c,l,e,t),d=this.getMostCommonBiome(u);a()<.98?h[l][c]=d:h[l][c]=n[l][c]}}n.splice(0,n.length,...h)}return n}createSeededRandom(e){if(e===void 0)return Math.random;let t=e;return()=>(t=(t*9301+49297)%233280,t/233280)}generateDensityMap(e,t,i){const s=[];for(let n=0;n<t;n++){s[n]=[];for(let a=0;a<e;a++){const o=this.simpleNoise(a*.03,n*.03),h=this.simpleNoise(a*.08,n*.08),l=this.simpleNoise(a*.2,n*.2),c=o*.6+h*.3+l*.1,u=i+c*.6-.3,d=Math.max(0,Math.min(1,u)),p=.4;s[n][a]=d>p?d:0}}return s}simpleNoise(e,t){const i=Math.sin(e*12.9898+t*78.233)*43758.5453;return i-Math.floor(i)}selectRandomBiome(e,t=Math.random){const i=e.reduce((n,a)=>n+a.frequency,0);let s=t()*i;for(const n of e)if(s-=n.frequency,s<=0)return n;return e[0]}getNeighborBiomes(e,t,i,s,n){const a=[];for(let o=-1;o<=1;o++)for(let h=-1;h<=1;h++){if(h===0&&o===0)continue;const l=t+h,c=i+o;l>=0&&l<s&&c>=0&&c<n&&a.push(e[c][l])}return a}getMostCommonBiome(e){const t=new Map;for(const n of e)t.set(n.name,(t.get(n.name)||0)+1);let i=e[0],s=0;for(const[n,a]of t)a>s&&(s=a,i=e.find(o=>o.name===n)||e[0]);return i}generateTileTypeMap(e,t,i,s,n){const a=[],o=this.createSeededRandom(n?n+1e3:void 0);for(let h=0;h<t;h++){a[h]=[];for(let l=0;l<e;l++)a[h][l]=this.selectTileTypeForBiome(i[h][l],s)}for(let h=0;h<6;h++){const l=[];for(let c=0;c<t;c++){l[c]=[];for(let u=0;u<e;u++){const d=this.getNeighborTileTypes(a,u,c,e,t,i),p=this.getMostCommonTileType(d);o()<.9?l[c][u]=p:l[c][u]=a[c][u]}}a.splice(0,a.length,...l)}for(let h=0;h<3;h++){const l=[];for(let c=0;c<t;c++){l[c]=[];for(let u=0;u<e;u++){const d=this.getNeighborTileTypes(a,u,c,e,t,i),p=this.getMostCommonTileType(d);o()<.95?l[c][u]=p:l[c][u]=a[c][u]}}a.splice(0,a.length,...l)}return a}getNeighborTileTypes(e,t,i,s,n,a){const o=[];for(let h=-1;h<=1;h++)for(let l=-1;l<=1;l++){if(l===0&&h===0)continue;const c=t+l,u=i+h;c>=0&&c<s&&u>=0&&u<n&&a[u][c].name===a[i][t].name&&o.push(e[u][c])}return o}getMostCommonTileType(e){if(e.length===0)return 0;const t=new Map;for(const n of e)t.set(n,(t.get(n)||0)+1);let i=e[0],s=0;for(const[n,a]of t)a>s&&(s=a,i=n);return i}selectTileTypeForBiome(e,t){const i=e.tileWeights.reduce((n,a)=>n+a,0);let s=Math.random()*i;for(let n=0;n<e.tileWeights.length;n++)if(s-=e.tileWeights[n],s<=0)return n;return 0}createTerrainGrid(e,t,i,s,n){const a=[];for(let o=0;o<s;o++)for(let h=0;h<i;h++){const l=e+h*this.tileSize,c=t+o*this.tileSize;let u;typeof n=="function"?u=n(h,o):u=n[o]?.[h]??0;const d=this.createTerrainTile(u,l,c);d&&a.push(d)}return a}getTerrainInfo(){return{tileSize:this.tileSize,tilesPerRow:this.tilesPerRow,tilesPerColumn:this.tilesPerColumn,totalTiles:this.totalTiles,isLoaded:!!this.terrainTexture}}isLoaded(){return!!this.terrainTexture}}class tg{enemyAtlasTexture;loaded=!1;customTextures=new Map;atlasPath="/MOMsters-game/sprites/enemies_01.png";tilesPerRow=10;tilesPerColumn=3;totalEnemies=this.tilesPerRow*this.tilesPerColumn;tileSize=32;customSprites=[{enemyId:28,spritePath:"/MOMsters-game/sprites/chicken_01.png",scale:3}];enemyConfigs=[{id:0,name:"Blob",health:20,speed:75,damage:6,collisionRadius:10,xpValue:4},{id:1,name:"Goblin",health:25,speed:90,damage:8,collisionRadius:12,xpValue:6},{id:2,name:"Plant",health:15,speed:60,damage:5,collisionRadius:8,xpValue:4},{id:3,name:"Hobgoblin",health:35,speed:85,damage:10,collisionRadius:13,xpValue:8},{id:4,name:"Mermaid",health:30,speed:95,damage:9,collisionRadius:11,xpValue:6},{id:5,name:"Gargoyle",health:45,speed:70,damage:12,collisionRadius:14,xpValue:10},{id:6,name:"ChompChest",health:60,speed:50,damage:15,collisionRadius:16,xpValue:12},{id:7,name:"TreeEnt",health:80,speed:45,damage:18,collisionRadius:18,xpValue:16},{id:8,name:"Reaper",health:55,speed:80,damage:14,collisionRadius:15,xpValue:12},{id:9,name:"Palomino",health:40,speed:100,damage:11,collisionRadius:13,xpValue:8},{id:10,name:"Green Dragon",health:120,speed:75,damage:25,collisionRadius:20,xpValue:30},{id:11,name:"Red Dragon",health:150,speed:70,damage:30,collisionRadius:22,xpValue:40},{id:12,name:"Blue Dragon",health:180,speed:65,damage:35,collisionRadius:24,xpValue:50},{id:13,name:"Skeleton",health:30,speed:85,damage:10,collisionRadius:12,xpValue:8},{id:14,name:"Mollusk",health:25,speed:55,damage:8,collisionRadius:10,xpValue:6},{id:15,name:"Banshee",health:35,speed:90,damage:12,collisionRadius:12,xpValue:10},{id:16,name:"Floating Maw",health:50,speed:80,damage:16,collisionRadius:14,xpValue:14},{id:17,name:"Cacodemon",health:70,speed:75,damage:20,collisionRadius:16,xpValue:18},{id:18,name:"Sea Hag",health:40,speed:85,damage:13,collisionRadius:13,xpValue:10},{id:19,name:"Demon",health:80,speed:85,damage:22,collisionRadius:17,xpValue:20},{id:20,name:"Centaur",health:65,speed:95,damage:18,collisionRadius:15,xpValue:16},{id:21,name:"Green Orc",health:55,speed:80,damage:15,collisionRadius:14,xpValue:12},{id:22,name:"Golden Orc",health:75,speed:75,damage:20,collisionRadius:16,xpValue:18},{id:23,name:"Void",health:45,speed:100,damage:16,collisionRadius:13,xpValue:14},{id:24,name:"Golem",health:100,speed:60,damage:25,collisionRadius:18,xpValue:24},{id:25,name:"Ice Golem",health:120,speed:55,damage:28,collisionRadius:19,xpValue:28},{id:26,name:"Jawa",health:20,speed:110,damage:7,collisionRadius:9,xpValue:6},{id:27,name:"Mud Golem",health:90,speed:50,damage:22,collisionRadius:17,xpValue:20},{id:28,name:"Skull King",health:500,speed:60,damage:50,collisionRadius:25,xpValue:100,scale:3,customSprite:"chicken_01.png"},{id:29,name:"PlasmaMan",health:60,speed:88,damage:19,collisionRadius:15,xpValue:16}];constructor(){}async loadEnemyAtlas(){console.warn("EnemySpriteManager: Loading enemy sprites...");try{this.enemyAtlasTexture=await _t.load(this.atlasPath),await this.loadCustomSprites(),this.loaded=!0,console.warn("EnemySpriteManager: Enemy sprites loaded successfully")}catch(e){throw console.error("❌ Error loading enemy atlas:",e),e}}async loadCustomSprites(){console.log("🎨 Loading custom enemy sprites...");for(const e of this.customSprites)try{const t=await _t.load(e.spritePath);this.customTextures.set(e.enemyId,t),console.log(`✅ Loaded custom sprite for enemy ${e.enemyId}: ${e.spritePath}`)}catch(t){console.warn(`⚠️ Failed to load custom sprite for enemy ${e.enemyId}:`,t)}}createEnemySprite(e){if(!this.loaded||!this.enemyAtlasTexture)return console.warn("Enemy atlas not loaded!"),null;if(e<0||e>=this.totalEnemies)return console.warn(`Invalid enemy ID: ${e}. Must be 0-${this.totalEnemies-1}`),null;const t=this.customTextures.get(e);if(t){const h=new Ie(t);h.anchor.set(.5,.5);const l=this.customSprites.find(c=>c.enemyId===e);return l&&(h.scale.set(l.scale,l.scale),console.log(`🐔 Created custom sprite for enemy ${e} at ${l.scale}x scale`)),h}const i=Math.floor(e/this.tilesPerRow),s=e%this.tilesPerRow,n=new le(s*this.tileSize,i*this.tileSize,this.tileSize,this.tileSize),a=new K(this.enemyAtlasTexture.baseTexture,n),o=new Ie(a);return o.anchor.set(.5,.5),o}getEnemyConfig(e){return e<0||e>=this.enemyConfigs.length?null:this.enemyConfigs[e]}getRandomEnemyConfig(){const e=Math.floor(Math.random()*this.enemyConfigs.length);return this.enemyConfigs[e]}getAllEnemyConfigs(){return[...this.enemyConfigs]}get isLoaded(){return this.loaded}get totalEnemyTypes(){return this.totalEnemies}}class ig{app;gemTexture=null;gemSprites=[];isLoaded=!1;gemConfigs=[{xpValue:1,spriteIndex:0,scale:1,tint:65280},{xpValue:10,spriteIndex:1,scale:1.2,tint:16746496}];constructor(e){this.app=e}async loadGemAtlas(){if(!this.isLoaded)try{console.warn("GemSpriteManager: Loading gem sprites..."),this.gemTexture=ce.from("/MOMsters-game/sprites/gems.png"),await new Promise((e,t)=>{this.gemTexture.valid?e():(this.gemTexture.on("loaded",()=>e()),this.gemTexture.on("error",t))}),this.createGemSprites(),this.isLoaded=!0,console.warn("GemSpriteManager: Gem sprites loaded successfully")}catch(e){console.error("❌ Failed to load gem atlas:",e),this.isLoaded=!1}}createGemSprites(){if(!this.gemTexture)return;const e=16,t=2;for(let i=0;i<2;i++){const s=i%t*e,n=Math.floor(i/t)*e,a=new K(this.gemTexture,new le(s,n,e,e)),o=new Ie(a);o.anchor.set(.5,.5),this.gemSprites.push(o)}}createGemSprite(e){if(!this.isLoaded||this.gemSprites.length===0)return null;const t=this.gemConfigs.find(s=>s.xpValue===e);if(!t){const s=new Ie(this.gemSprites[0].texture);return s.anchor.set(.5,.5),s.scale.set(1),s}const i=new Ie(this.gemSprites[t.spriteIndex].texture);return i.anchor.set(.5,.5),i.scale.set(t.scale),t.tint&&(i.tint=t.tint),i}getGemConfig(e){return this.gemConfigs.find(t=>t.xpValue===e)||null}get loaded(){return this.isLoaded}getAllGemConfigs(){return[...this.gemConfigs]}}class sg extends Zs{enemySpriteManager;visualSprite;enemyType;constructor(e,t=0){const i=e.getEnemyConfig(t)||{health:30,speed:80,damage:10,collisionRadius:12,xpValue:2};super(i.health,i.speed,i.damage,i.collisionRadius,i.xpValue),this.enemySpriteManager=e,this.enemyType=t,this.createSprite()}createSprite(){this.sprite.removeChildren();const e=this.enemySpriteManager.createEnemySprite(this.enemyType);if(e)this.visualSprite=e,this.sprite.addChild(e);else{const t=new me;t.beginFill(16729156),t.drawCircle(0,0,this.collisionRadius),t.endFill(),t.beginFill(16711680),t.drawCircle(0,0,this.collisionRadius-4),t.endFill(),t.beginFill(0),t.drawCircle(3,-3,2),t.endFill(),t.beginFill(0),t.drawCircle(-3,-3,2),t.endFill(),this.visualSprite=t,this.sprite.addChild(t)}}updateAppearance(){if(super.updateAppearance(),this.visualSprite)if(this.healthPercent<.5){const e=Math.sin(Date.now()/100)*.3+.7;this.visualSprite.alpha=e}else this.visualSprite.alpha=.5+this.healthPercent*.5}}class rg extends Zs{enemySpriteManager;visualSprite;isHopping=!1;hopCooldown=0;hopDuration=.6;hopCooldownTime=1;hopHeight=30;hopTimer=0;hopStartX=0;hopStartY=0;hopTargetX=0;hopTargetY=0;originalY=0;constructor(e){const t=e.getEnemyConfig(0)||{health:20,speed:75,damage:6,collisionRadius:10,xpValue:4};super(t.health,t.speed,t.damage,t.collisionRadius,t.xpValue),this.enemySpriteManager=e,this.createSprite()}createSprite(){this.sprite.removeChildren();const e=this.enemySpriteManager.createEnemySprite(0);if(e)this.visualSprite=e,this.sprite.addChild(e);else{const t=new me;t.beginFill(4521796),t.drawEllipse(0,0,this.collisionRadius,this.collisionRadius*.8),t.endFill(),t.beginFill(8978312),t.drawEllipse(-3,-4,this.collisionRadius*.6,this.collisionRadius*.5),t.endFill(),t.beginFill(0),t.drawCircle(-4,-2,2),t.drawCircle(4,-2,2),t.endFill(),this.visualSprite=t,this.sprite.addChild(t)}}moveTowardPlayer(e,t){const i=e/60;if(this.hopCooldown>0&&(this.hopCooldown-=i),this.isHopping){this.updateHopAnimation(i);return}this.hopCooldown<=0&&this.startHop(t)}startHop(e){const t=e.sprite.x-this.sprite.x,i=e.sprite.y-this.sprite.y,s=Math.sqrt(t*t+i*i);if(s===0)return;this.isHopping=!0,this.hopTimer=0,this.hopStartX=this.sprite.x,this.hopStartY=this.sprite.y,this.originalY=this.sprite.y;const n=this.speed*.6;this.hopTargetX=this.sprite.x+t/s*n,this.hopTargetY=this.sprite.y+i/s*n,this.updateRotation(t,i)}updateHopAnimation(e){this.hopTimer+=e;const t=Math.min(this.hopTimer/this.hopDuration,1);if(t>=1)this.sprite.x=this.hopTargetX,this.sprite.y=this.hopTargetY,this.isHopping=!1,this.hopCooldown=this.hopCooldownTime,this.addLandingEffect();else{this.sprite.x=this.hopStartX+(this.hopTargetX-this.hopStartX)*t,this.sprite.y=this.hopStartY+(this.hopTargetY-this.hopStartY)*t;const i=Math.sin(t*Math.PI)*this.hopHeight;this.sprite.y=this.originalY+(this.hopTargetY-this.originalY)*t-i}}addLandingEffect(){if(this.visualSprite){const e=this.visualSprite.scale.y;this.visualSprite.scale.y=.7,this.visualSprite.scale.x=1.2,setTimeout(()=>{this.visualSprite&&(this.visualSprite.scale.y=e,this.visualSprite.scale.x=1)},100)}}updateAppearance(){if(super.updateAppearance(),this.visualSprite&&this.hopCooldown>0){const e=1-this.hopCooldown/this.hopCooldownTime;this.visualSprite.alpha=Math.max(.6,.6+e*.4)}}}class ng extends Zs{enemySpriteManager;visualSprite;isHopping=!1;hopCooldown=0;hopDuration=.6;hopCooldownTime=1;hopHeight=30;hopTimer=0;hopStartX=0;hopStartY=0;hopTargetX=0;hopTargetY=0;originalY=0;constructor(e){const i={...e.getEnemyConfig(6)||{health:60,speed:50,damage:15,collisionRadius:16,xpValue:12},speed:150};super(i.health,i.speed,i.damage,i.collisionRadius,i.xpValue),this.enemySpriteManager=e,this.createSprite(),console.warn("ChompChestEnemy: Creating enemy...")}createSprite(){const e=this.enemySpriteManager.createEnemySprite(6);e?(this.visualSprite=e,this.sprite.addChild(this.visualSprite),this.visualSprite.anchor.set(.5),console.warn("ChompChest enemy created with atlas sprite")):(console.warn("ChompChest sprite not found in atlas, using fallback graphics"),this.createFallbackSprite()),console.warn("ChompChestEnemy: Enemy created successfully")}createFallbackSprite(){const e=new me;e.beginFill(9127187),e.drawRoundedRect(-this.collisionRadius,-this.collisionRadius,this.collisionRadius*2,this.collisionRadius*2,4),e.endFill(),e.beginFill(6636321),e.drawRoundedRect(-this.collisionRadius,-this.collisionRadius,this.collisionRadius*2,this.collisionRadius*2,4),e.endFill(),e.beginFill(16766720),e.drawRect(-2,-this.collisionRadius/2,4,this.collisionRadius),e.endFill(),this.visualSprite=e,this.sprite.addChild(this.visualSprite)}update(e){}updateHopState(e,t){this.isHopping?(this.hopTimer+=e/60,this.hopTimer>=this.hopDuration&&(this.isHopping=!1,this.hopTimer=0,this.hopCooldown=this.hopCooldownTime,this.sprite.x=this.hopTargetX,this.sprite.y=this.hopTargetY,this.addLandingEffects())):this.hopCooldown>0&&(this.hopCooldown-=e/60,this.hopCooldown<=0&&(t?this.startHopTowardPlayer(t):this.startHop()))}startHop(){const e=this.sprite.x,t=this.sprite.y,i=this.speed*.6,s=400,n=300,a=s-e,o=n-t,h=Math.sqrt(a*a+o*o);if(h>0){const l=a/h,c=o/h;this.hopStartX=e,this.hopStartY=t,this.hopTargetX=e+l*i,this.hopTargetY=t+c*i,this.originalY=t,this.isHopping=!0,this.hopTimer=0}}startHopTowardPlayer(e){const t=this.sprite.x,i=this.sprite.y,s=this.speed*.6,n=e.position.x-t,a=e.position.y-i,o=Math.sqrt(n*n+a*a);if(o>0){const h=n/o,l=a/o;this.hopStartX=t,this.hopStartY=i,this.hopTargetX=t+h*s,this.hopTargetY=i+l*s,this.originalY=i,this.isHopping=!0,this.hopTimer=0}}performHop(e){if(!this.isHopping)return;const t=Math.min(1,this.hopTimer/this.hopDuration),i=this.hopStartX+(this.hopTargetX-this.hopStartX)*t,s=this.hopStartY+(this.hopTargetY-this.hopStartY)*t,n=Math.sin(t*Math.PI)*this.hopHeight;this.sprite.x=i,this.sprite.y=s-n}addLandingEffects(){if(!this.visualSprite)return;this.visualSprite.scale.set(1.2,.8);const e=.15,t=Date.now(),i=()=>{const s=(Date.now()-t)/1e3,n=Math.min(1,s/e),a=1-Math.pow(1-n,3),o=1.2-.2*a,h=.8+.2*a;this.visualSprite.scale.set(o,h),n<1?requestAnimationFrame(i):this.visualSprite.scale.set(1,1)};requestAnimationFrame(i)}moveTowardPlayer(e,t){this.isHopping||super.moveTowardPlayer(e,t)}updateAppearance(){if(super.updateAppearance(),this.visualSprite&&this.hopCooldown>0){const e=1-this.hopCooldown/this.hopCooldownTime;this.visualSprite.alpha=Math.max(.6,.6+e*.4)}}getRandomTreasure(){const e=["gold","gems","weapons","health"];return e[Math.floor(Math.random()*e.length)]}getEnemyType(){return"chomp-chest"}}class ag{enemies=[];gameContainer;camera;collisionManager;player;enemySpriteManager;gameTime=0;currentWaveIndex=0;currentWave=null;timeSinceLastSpawn=0;enemyNameToType=new Map;isEventActive=!1;eventTimer=0;eventDuration=0;circleFormationAngle=0;circleFormationRadius=300;bossSpawned=!1;onEnemyKilled;onWaveChanged;onGameComplete;waveConfigs=[{start_time:0,end_time:1,enemies:["Blob"],spawn_rate:50,max_count:50,event:"Normal"},{start_time:.5,end_time:2,enemies:["Goblin","Plant"],spawn_rate:60,max_count:60,event:"Normal"},{start_time:1.5,end_time:2.5,enemies:["Hobgoblin"],spawn_rate:75,max_count:70,event:"Normal"},{start_time:2,end_time:3,enemies:["Mermaid","Gargoyle"],spawn_rate:90,max_count:80,event:"CircleFormation"},{start_time:2.5,end_time:4,enemies:["ChompChest","TreeEnt"],spawn_rate:100,max_count:90,event:"Normal"},{start_time:3.5,end_time:5,enemies:["Reaper","Palomino"],spawn_rate:110,max_count:100,event:"Normal"},{start_time:4.5,end_time:5.25,enemies:["Green Dragon"],spawn_rate:5,max_count:1,event:"BossEvent"},{start_time:4.75,end_time:6,enemies:["Red Dragon","Blue Dragon"],spawn_rate:125,max_count:110,event:"Normal"},{start_time:5.5,end_time:7,enemies:["Skeleton","Mollusk"],spawn_rate:135,max_count:120,event:"Normal"},{start_time:6.5,end_time:7.5,enemies:["Banshee","Floating Maw"],spawn_rate:150,max_count:130,event:"SwarmEvent"},{start_time:7,end_time:8.5,enemies:["Cacodemon","Sea Hag"],spawn_rate:160,max_count:140,event:"Normal"},{start_time:8,end_time:9.5,enemies:["Demon","Centaur"],spawn_rate:175,max_count:150,event:"Normal"},{start_time:9,end_time:10,enemies:["Green Orc","Golden Orc"],spawn_rate:190,max_count:160,event:"CircleFormation"},{start_time:9.5,end_time:10.25,enemies:["Void"],spawn_rate:5,max_count:1,event:"BossEvent"},{start_time:9.75,end_time:11,enemies:["Golem","Ice Golem"],spawn_rate:200,max_count:170,event:"Normal"},{start_time:10.5,end_time:12,enemies:["Jawa","Mud Golem"],spawn_rate:210,max_count:180,event:"Normal"},{start_time:11.5,end_time:12.5,enemies:["Skull","PlasmaMan"],spawn_rate:225,max_count:190,event:"SwarmEvent"},{start_time:12,end_time:13.5,enemies:["Red Dragon","Demon","Void"],spawn_rate:240,max_count:200,event:"Normal"},{start_time:13,end_time:14.5,enemies:["PlasmaMan","Ice Golem","Void"],spawn_rate:250,max_count:220,event:"Normal"},{start_time:14,end_time:15,enemies:["Golden Orc","Void","PlasmaMan"],spawn_rate:275,max_count:250,event:"FinalAssault"},{start_time:14.5,end_time:15.5,enemies:["Skull King"],spawn_rate:5,max_count:1,event:"BossEvent"}];constructor(e,t,i,s,n){this.gameContainer=e,this.camera=t,this.collisionManager=i,this.player=s,this.enemySpriteManager=n,this.initializeEnemyMapping(),this.updateCurrentWave(),console.warn("WaveSpawner: WaveSpawner initialized with "+this.waveConfigs.length+" waves"),console.warn("WaveSpawner: Initial wave: "+(this.currentWave?this.currentWave.enemies.join(", "):"None")),console.warn("WaveSpawner: Game time: "+this.gameTime.toFixed(3)+" minutes"),console.warn("WaveSpawner: Current wave index: "+this.currentWaveIndex+", Wave: "+(this.currentWave?`${this.currentWave.start_time}-${this.currentWave.end_time}min, spawn_rate: ${this.currentWave.spawn_rate}/s`:"None"))}initializeEnemyMapping(){this.enemyNameToType.set("Blob",0),this.enemyNameToType.set("Goblin",1),this.enemyNameToType.set("Plant",2),this.enemyNameToType.set("Hobgoblin",3),this.enemyNameToType.set("Mermaid",4),this.enemyNameToType.set("Gargoyle",5),this.enemyNameToType.set("ChompChest",6),this.enemyNameToType.set("TreeEnt",7),this.enemyNameToType.set("Reaper",8),this.enemyNameToType.set("Palomino",9),this.enemyNameToType.set("Green Dragon",10),this.enemyNameToType.set("Red Dragon",11),this.enemyNameToType.set("Blue Dragon",12),this.enemyNameToType.set("Skeleton",13),this.enemyNameToType.set("Mollusk",14),this.enemyNameToType.set("Banshee",15),this.enemyNameToType.set("Floating Maw",16),this.enemyNameToType.set("Cacodemon",17),this.enemyNameToType.set("Sea Hag",18),this.enemyNameToType.set("Demon",19),this.enemyNameToType.set("Centaur",20),this.enemyNameToType.set("Green Orc",21),this.enemyNameToType.set("Golden Orc",22),this.enemyNameToType.set("Void",23),this.enemyNameToType.set("Golem",24),this.enemyNameToType.set("Ice Golem",25),this.enemyNameToType.set("Jawa",26),this.enemyNameToType.set("Mud Golem",27),this.enemyNameToType.set("Skull",28),this.enemyNameToType.set("PlasmaMan",29),this.enemyNameToType.set("Skull King",28)}update(e){this.updateGameTime(e),this.updateCurrentWave(),this.updateSpecialEvents(e),this.updateSpawning(e),this.updateEnemies(e),this.cleanupDeadEnemies()}updateGameTime(e){const t=this.gameTime;this.gameTime+=e/6e4,this.gameTime<5&&Math.floor(this.gameTime*20)>Math.floor(t*20)&&(console.warn("WaveSpawner: Game time: "+this.gameTime.toFixed(3)+" minutes (deltaTime: "+e.toFixed(1)+"ms) - Real time passed: "+(this.gameTime*60).toFixed(1)+"s"),console.warn("WaveSpawner: Current wave should be: "+this.getCurrentExpectedWaveIndex()+" ("+this.getExpectedWaveName()+")")),this.gameTime>=30.5&&this.onGameComplete?.()}getCurrentExpectedWaveIndex(){for(let e=0;e<this.waveConfigs.length;e++){const t=this.waveConfigs[e];if(this.gameTime>=t.start_time&&this.gameTime<t.end_time)return e}return-1}getExpectedWaveName(){const e=this.getCurrentExpectedWaveIndex();return e>=0?this.waveConfigs[e].enemies.join(", "):"None"}updateCurrentWave(){const e=this.currentWaveIndex,t=this.currentWave;for(let i=0;i<this.waveConfigs.length;i++){const s=this.waveConfigs[i];if(this.gameTime>=s.start_time&&this.gameTime<s.end_time){this.currentWaveIndex=i,this.currentWave=s;break}}this.currentWave||(console.warn("WaveSpawner: No current wave found for time "+this.gameTime.toFixed(3)+" min"),console.warn("WaveSpawner: gameTime: "+this.gameTime+", previousWave: "+(t?`${t.start_time}-${t.end_time}`:"null"))),e!==this.currentWaveIndex&&this.currentWave&&(this.onWaveChanged?.(this.currentWaveIndex,this.currentWave),this.resetEventState(),console.warn("WaveSpawner: WAVE CHANGED! From "+e+" to "+this.currentWaveIndex),console.warn("WaveSpawner: Wave "+(this.currentWaveIndex+1)+": "+this.currentWave.enemies.join(", ")+" ("+this.currentWave.event+") - spawn_rate: "+this.currentWave.spawn_rate+"/s, max: "+this.currentWave.max_count),console.warn("WaveSpawner: Time range: "+this.currentWave.start_time+"-"+this.currentWave.end_time+" minutes, Current time: "+this.gameTime.toFixed(3)+" minutes")),this.gameTime<5&&this.currentWave&&Math.floor(this.gameTime*2)!==Math.floor((this.gameTime-.001)*2)&&console.warn("WaveSpawner: Wave Status: gameTime="+this.gameTime.toFixed(3)+"min, currentWaveIndex="+this.currentWaveIndex+", currentWave="+this.currentWave.enemies.join(","))}resetEventState(){this.isEventActive=!1,this.eventTimer=0,this.eventDuration=0,this.bossSpawned=!1,this.circleFormationAngle=0}updateSpecialEvents(e){if(!this.currentWave||this.currentWave.event==="Normal")return;const t=e/1e3;switch(this.currentWave.event){case"CircleFormation":this.updateCircleFormation(t);break;case"BossEvent":this.updateBossEvent(t);break;case"SwarmEvent":this.updateSwarmEvent(t);break;case"FinalAssault":this.updateFinalAssault(t);break}}updateCircleFormation(e){this.circleFormationAngle+=e*.5,this.circleFormationAngle>=Math.PI*2&&(this.circleFormationAngle=0)}updateBossEvent(e){this.bossSpawned||this.enemies.length>10&&(this.enemies.slice(10).forEach(i=>{this.collisionManager.removeEntity(i),i.sprite.parent&&i.sprite.parent.removeChild(i.sprite)}),this.enemies=this.enemies.slice(0,10))}updateSwarmEvent(e){if(this.eventTimer+=e,this.eventTimer>=2){this.eventTimer=0;for(let t=0;t<5;t++)this.enemies.length<(this.currentWave?.max_count||100)&&this.spawnEnemy()}}updateFinalAssault(e){if(this.eventTimer+=e,this.eventTimer>=.3){this.eventTimer=0;for(let t=0;t<3;t++)this.enemies.length<(this.currentWave?.max_count||250)&&this.spawnEnemy()}}updateSpawning(e){if(!this.currentWave){console.warn("WaveSpawner: updateSpawning early return: no currentWave");return}const t=this.enemies.filter(s=>s.alive).length;if(t>=this.currentWave.max_count){t%10===0&&console.warn("WaveSpawner: updateSpawning early return: alive enemies="+t+" >= max_count="+this.currentWave.max_count+" (total in array: "+this.enemies.length+")");return}if(this.currentWave.event==="SwarmEvent"||this.currentWave.event==="FinalAssault"){console.warn("WaveSpawner: updateSpawning early return: special event "+this.currentWave.event);return}this.timeSinceLastSpawn+=e/1e3;const i=1/this.currentWave.spawn_rate;this.timeSinceLastSpawn>=i&&((t%10===0||t<10)&&console.warn("WaveSpawner: Spawning enemy! Alive enemies: "+t+"/"+this.currentWave.max_count+", spawn_rate: "+this.currentWave.spawn_rate+"/s"),this.spawnEnemy(),this.timeSinceLastSpawn=0)}spawnEnemy(){if(!this.currentWave||this.currentWave.enemies.length===0){console.warn("WaveSpawner: Cannot spawn enemy: currentWave="+!!this.currentWave+", enemies="+(this.currentWave?.enemies.length||0));return}const e=Math.floor(Math.random()*this.currentWave.enemies.length),t=this.currentWave.enemies[e],i=this.enemyNameToType.get(t);if(i===void 0){console.warn("WaveSpawner: Unknown enemy type: "+t);return}console.warn("WaveSpawner: Spawning enemy: "+t+" (type "+i+")");let s;i===0?s=new rg(this.enemySpriteManager):i===6?s=new ng(this.enemySpriteManager):s=new sg(this.enemySpriteManager,i);const n=this.getSpawnPosition();s.sprite.x=n.x,s.sprite.y=n.y,this.currentWave.event==="BossEvent"&&(this.bossSpawned=!0),this.gameContainer.addChild(s.sprite),s.sprite.zIndex=50,this.collisionManager.addEntity(s),this.enemies.push(s),this.enemies.length%10===0&&console.warn("WaveSpawner: Enemy added to world! "+t+" #"+this.enemies.length+" at ("+s.sprite.x.toFixed(0)+", "+s.sprite.y.toFixed(0)+")"),this.enemies.length%20===0&&console.warn("WaveSpawner: Spawned "+t+" #"+this.enemies.length+" (Wave "+(this.currentWaveIndex+1)+")")}getSpawnPosition(){const e=this.camera.getVisibleBounds(100);if(this.currentWave?.event==="CircleFormation"){const t=this.player.position,i=this.circleFormationAngle+Math.random()*Math.PI*.5,s=this.circleFormationRadius+Math.random()*100;return{x:t.x+Math.cos(i)*s,y:t.y+Math.sin(i)*s}}else if(this.currentWave?.event==="BossEvent"){const t=this.player.position,i=Math.random()*Math.PI*2,s=400+Math.random()*200;return{x:t.x+Math.cos(i)*s,y:t.y+Math.sin(i)*s}}else{const t=Math.floor(Math.random()*4);let i,s;switch(t){case 0:i=e.left+Math.random()*(e.right-e.left),s=e.top;break;case 1:i=e.right,s=e.top+Math.random()*(e.bottom-e.top);break;case 2:i=e.left+Math.random()*(e.right-e.left),s=e.bottom;break;case 3:i=e.left,s=e.top+Math.random()*(e.bottom-e.top);break;default:i=e.left,s=e.top}return{x:i,y:s}}}updateEnemies(e){for(const t of this.enemies)t.alive&&t.update(e,this.player)}cleanupDeadEnemies(){const e=[];for(const i of this.enemies)i.alive?e.push(i):(this.onEnemyKilled&&this.onEnemyKilled(i,{x:i.sprite.x,y:i.sprite.y}),this.collisionManager.removeEntity(i),i.sprite.parent&&i.sprite.parent.removeChild(i.sprite));const t=this.enemies.length-e.length;t>0&&console.warn("WaveSpawner: Cleaned up "+t+" dead enemies. Total alive: "+e.length),this.enemies=e}getStats(){const e=this.currentWave?(this.gameTime-this.currentWave.start_time)/(this.currentWave.end_time-this.currentWave.start_time):0;return{count:this.enemies.length,spawnRate:this.currentWave?.spawn_rate||0,maxEnemies:this.currentWave?.max_count||0,phaseSpawnRate:this.currentWave?.spawn_rate||0,globalDifficulty:this.gameTime/30,phaseProgress:Math.min(1,e)}}getProgressionInfo(){const e=this.currentWave?(this.gameTime-this.currentWave.start_time)/(this.currentWave.end_time-this.currentWave.start_time):0;return{currentWave:this.currentWaveIndex+1,currentWaveName:this.currentWave?.enemies.join(", ")||"Unknown",gameTime:this.gameTime,waveProgress:Math.min(1,e),enemies:this.currentWave?.enemies||[],event:this.currentWave?.event||"Normal",spawnRate:this.currentWave?.spawn_rate||0,maxCount:this.currentWave?.max_count||0}}getEnemies(){return this.enemies.filter(e=>e.alive)}clear(){for(const e of this.enemies)this.collisionManager.removeEntity(e),e.sprite.parent&&e.sprite.parent.removeChild(e.sprite);this.enemies=[],this.gameTime=0,this.currentWaveIndex=0,this.resetEventState()}getWaveInfo(){const e=this.currentWave?(this.gameTime-this.currentWave.start_time)/(this.currentWave.end_time-this.currentWave.start_time):0,t=this.currentWave?Math.max(0,this.currentWave.end_time-this.gameTime):0;return{currentWave:this.currentWaveIndex+1,waveName:this.currentWave?.enemies.join(", ")||"Unknown",waveProgress:Math.min(1,e),spawnRate:this.currentWave?.spawn_rate||0,difficulty:this.gameTime/30,event:this.currentWave?.event||"Normal",timeRemaining:t}}getGameTime(){return this.gameTime}getTotalWaves(){return this.waveConfigs.length}}class og{sprite;collisionRadius=8;collisionGroup=Oe.PROJECTILE;beamSprite=null;visualSprite=null;beamTextures=[];animationPhase="creation";currentFrame=0;animationTimer=0;frameInterval=.1;damage;lifetime;maxPierce;range;beamWidth=32;rotationDuration=3;currentAngle=0;totalRotation=0;playerX=0;playerY=0;onHitTarget;onExpired;_active=!0;pierceCount=0;flipTimer=0;flipInterval=.1;constructor(e,t,i=10,s=0,n=350,a=3){this.sprite=new ve,this.damage=i,this.lifetime=0,this.maxPierce=s,this.range=n,this.rotationDuration=a,this.playerX=e,this.playerY=t,this.currentAngle=0,this.totalRotation=0,this.collisionRadius=20,this.sprite.x=e,this.sprite.y=t,this.createBeam()}async createBeam(){this.sprite.removeChildren();try{console.warn("Beam: Creating beam...");for(let t=1;t<=4;t++){const i=t.toString().padStart(2,"0"),s=await Hi(()=>import("./index-DxNb0WdF-1751731084935-ULTRA-CACHE-BREAK.js"),[]).then(n=>n.Assets.load(`/MOMsters-game/sprites/Beam_full_${i}.png`));this.beamTextures.push(s)}this.beamSprite=new Ie(this.beamTextures[0]),this.beamSprite.anchor.set(0,.5);const e=this.range/256;this.beamSprite.scale.set(e,1),this.beamSprite.x=16,this.beamSprite.y=0,this.sprite.addChild(this.beamSprite),this.visualSprite=this.beamSprite,console.warn("Beam: Beam created successfully")}catch(e){console.log("Beam sprites not found, using fallback graphics:",e),this.createFallbackGraphics()}}createFallbackGraphics(){const e=new me,t=this.range,i=128,n=Math.round(this.range/i)*i;this.range=n,console.log(`Created fallback beam graphics, adjusted range: ${this.range} (was ${t}), collision radius: ${this.collisionRadius}`),e.beginFill(16729156,.8),e.drawRect(16,-16,n,32),e.endFill(),e.beginFill(16746632,.3),e.drawRect(16,-20,n,40),e.endFill(),this.visualSprite=e,this.sprite.addChild(e)}update(e){if(!this._active)return;if(!this.sprite||this.sprite.destroyed){this._active=!1;return}const i=360/this.rotationDuration*(e/60);if(this.currentAngle+=i,this.totalRotation+=i,this.currentAngle>=360&&(this.currentAngle-=360),this.sprite.rotation=this.currentAngle*Math.PI/180,this.totalRotation>=360){this.expire();return}this.updateAnimation(e),this.updateAppearance(),this.lifetime+=e/60}updateAppearance(){if(!this.sprite||this.sprite.destroyed)return;const e=.8+Math.sin(this.lifetime*8)*.2;this.sprite.alpha=e;const t=1+Math.sin(this.lifetime*6)*.05;this.sprite.scale.set(t)}updateAnimation(e){if(!(!this.beamSprite||this.beamTextures.length===0)&&(this.animationTimer+=e/60,this.animationTimer>=this.frameInterval)){switch(this.animationTimer=0,this.animationPhase){case"creation":this.currentFrame++,this.currentFrame>=4&&(this.currentFrame=2,this.animationPhase="sustain");break;case"sustain":this.currentFrame=this.currentFrame===2?3:2,this.totalRotation/360>=.9&&(this.animationPhase="destruction",this.currentFrame=3);break;case"destruction":if(this.currentFrame--,this.currentFrame<0){this.expire();return}break}this.beamSprite.texture=this.beamTextures[this.currentFrame]}}onCollision(e){}expire(){if(this.animationPhase!=="destruction"){this.animationPhase="destruction",this.currentFrame=3;return}this._active=!1,this.sprite&&!this.sprite.destroyed&&(this.sprite.alpha=.5,this.sprite.scale.set(1.2)),this.onExpired&&this.onExpired()}destroy(){this.sprite&&!this.sprite.destroyed&&(this.sprite.destroy(),this.sprite=null),this.beamSprite&&!this.beamSprite.destroyed&&(this.beamSprite.destroy(),this.beamSprite=null),this.visualSprite&&!this.visualSprite.destroyed&&(this.visualSprite.destroy(),this.visualSprite=null),this.sprite&&this.sprite.parent&&!this.sprite.destroyed&&this.sprite.parent.removeChild(this.sprite),this.sprite&&!this.sprite.destroyed&&this.sprite.destroy(),this.sprite&&!this.sprite.destroyed&&this.sprite.destroy()}get projectileDamage(){return Math.floor(this.damage)}get position(){return{x:this.sprite.x,y:this.sprite.y}}get currentVelocity(){return{x:0,y:0}}get active(){return this._active}updatePosition(e,t){this.playerX=e,this.playerY=t,this.sprite&&!this.sprite.destroyed&&(this.sprite.x=e,this.sprite.y=t)}}class hg{projectiles=[];beams=[];gameContainer;collisionManager;player;enemySpawner;eventBus;recentBeamHits=new Map;weapons=new Map;activeWeapons=["fireball"];weaponTimers=new Map;attackInterval=1;timeSinceLastShot=0;range=300;projectileSpeed=400;projectileDamage=25;pierceBonus=0;totalShotsFired=0;totalHits=0;constructor(e,t,i,s,n){this.gameContainer=e,this.collisionManager=t,this.player=i,this.enemySpawner=s,this.eventBus=n,this.initializeWeapons()}initializeWeapons(){[{type:"fireball",name:"Fireball",description:"Single target projectile",icon:"🔥",baseDamage:25,baseAttackSpeed:1,baseRange:300,basePierce:0,projectileSpeed:400,maxLevel:8,currentLevel:1,effects:{damageMultiplier:1.25}},{type:"axe",name:"Axe",description:"Thrown weapon that returns",icon:"🪓",baseDamage:30,baseAttackSpeed:1.2,baseRange:200,basePierce:1,projectileSpeed:350,maxLevel:6,currentLevel:0,effects:{damageMultiplier:1.25,pierceBonus:1}},{type:"knife",name:"Knife",description:"Multiple projectiles in all directions",icon:"🗡️",baseDamage:15,baseAttackSpeed:1.8,baseRange:250,basePierce:0,projectileSpeed:450,maxLevel:7,currentLevel:0,effects:{projectileCount:4,damageMultiplier:1.15}},{type:"rune_tracer",name:"Eye Beam",description:"Laser-like projectiles from kaiju eyes",icon:"🎯",baseDamage:20,baseAttackSpeed:1.3,baseRange:350,basePierce:0,projectileSpeed:380,maxLevel:7,currentLevel:0,effects:{damageMultiplier:1.2,rangeBonus:50}},{type:"eye_beam",name:"Eye Beam",description:"Continuous beam weapon",icon:"👁️",baseDamage:10,baseAttackSpeed:1.3,baseRange:350,basePierce:0,projectileSpeed:380,maxLevel:7,currentLevel:0,effects:{damageMultiplier:1.2,rangeBonus:50}}].forEach(t=>{this.weapons.set(t.type,t),this.weaponTimers.set(t.type,0)})}update(e){this.updateAllWeapons(e),this.updateProjectiles(e),this.updateBeams(e),this.cleanupInactiveProjectiles(),this.cleanupInactiveBeams()}updateAllWeapons(e){for(const t of this.activeWeapons){const i=this.weapons.get(t);if(!i)continue;const n=(this.weaponTimers.get(t)||0)+e/60;this.weaponTimers.set(t,n);const a=this.getWeaponAttackInterval(i);n>=a&&(this.fireWeapon(t),this.weaponTimers.set(t,0))}}getWeaponAttackInterval(e){const t=e.baseAttackSpeed,i=e.effects.fireRateMultiplier||1;return Math.max(.1,t/i)}fireWeapon(e){const t=this.weapons.get(e);if(!t){console.warn(`Weapon ${e} not found`);return}if(t.currentLevel<=0){console.warn(`Weapon ${e} not leveled up (level ${t.currentLevel})`);return}switch(console.warn("WeaponSystem: Processing weapon..."),console.log(`🔫 Firing ${e} (level ${t.currentLevel})`),e){case"fireball":this.fireFireball(t);break;case"axe":this.fireAxe(t);break;case"knife":this.fireKnife(t);break;case"rune_tracer":this.fireRuneTracer(t);break;case"eye_beam":this.fireEyeBeam(t);break;case"lightning":case"whip":case"magic_wand":case"bible":case"garlic":case"holy_water":console.warn(`Weapon ${e} is disabled (no art assets)`);break}console.warn("WeaponSystem: Weapon processed successfully")}fireFireball(e){const t=this.findNearestEnemy();if(!t)return;const i=this.player.position,s=t.position,n=this.getWeaponDamage(e),a=this.getWeaponPierce(e),o=new mt(i.x,i.y,s.x,s.y,e.projectileSpeed,n,a,"fireball");this.setupProjectile(o),this.eventBus.emitEvent("weapon:fireball_launched",{weaponType:"fireball",position:{x:i.x,y:i.y}})}fireLightning(e){if(this.enemySpawner.getEnemies().length===0)return;const i=this.player.position,s=e.effects.chainCount||3,n=this.getWeaponDamage(e);let a=this.findNearestEnemy();if(!a)return;const o=new Set;let h=i;for(let l=0;l<s&&a;l++){o.add(a);const c=new mt(h.x,h.y,a.position.x,a.position.y,e.projectileSpeed,n,0);this.setupProjectile(c),h=a.position,a=this.findNearestEnemyNotInSet(o)}}fireWhip(e){const t=this.player.position,i=e.effects.areaRadius||80,s=this.getWeaponDamage(e),a=this.enemySpawner.getEnemies().filter(o=>Math.sqrt(Math.pow(o.position.x-t.x,2)+Math.pow(o.position.y-t.y,2))<=i);a.forEach(o=>{o.takeDamage&&o.takeDamage(s)}),console.log(`Whip attack hit ${a.length} enemies`)}fireAxe(e){const t=this.findNearestEnemy();if(!t)return;const i=this.player.position,s=t.position,n=this.getWeaponDamage(e),a=this.getWeaponPierce(e),o=new mt(i.x,i.y,s.x,s.y,e.projectileSpeed,n,a,"axe");this.setupProjectile(o)}fireKnife(e){const t=this.player.position,i=e.effects.projectileCount||4,s=this.getWeaponDamage(e),n=this.getWeaponPierce(e);for(let a=0;a<i;a++){const o=a/i*2*Math.PI,h=t.x+Math.cos(o)*100,l=t.y+Math.sin(o)*100,c=new mt(t.x,t.y,h,l,e.projectileSpeed,s,n,"knife");this.setupProjectile(c)}}fireMagicWand(e){const t=this.findNearestEnemy();if(!t)return;const i=this.player.position,s=t.position,n=this.getWeaponDamage(e),a=this.getWeaponPierce(e),o=new mt(i.x,i.y,s.x,s.y,e.projectileSpeed,n,a,"fireball");this.setupProjectile(o)}fireBible(e){const t=this.player.position,i=e.effects.projectileCount||3,s=e.effects.areaRadius||100,n=this.getWeaponDamage(e);for(let a=0;a<i;a++){const o=a/i*2*Math.PI,h=t.x+Math.cos(o)*s,l=t.y+Math.sin(o)*s,c=new mt(t.x,t.y,h,l,e.projectileSpeed,n,0,"fireball");this.setupProjectile(c)}}fireGarlic(e){const t=this.player.position,i=e.effects.areaRadius||120,s=this.getWeaponDamage(e),a=this.enemySpawner.getEnemies().filter(o=>Math.sqrt(Math.pow(o.position.x-t.x,2)+Math.pow(o.position.y-t.y,2))<=i);a.forEach(o=>{o.takeDamage&&o.takeDamage(s)}),console.log(`Heat Wave hit ${a.length} enemies`)}fireHolyWater(e){const t=this.findNearestEnemy();if(!t)return;const i=this.player.position,s=t.position,n=this.getWeaponDamage(e),a=e.effects.areaRadius||90,o=new mt(i.x,i.y,s.x,s.y,e.projectileSpeed,n,0,"fireball");o.onHitTarget=h=>{this.handleProjectileHit(o,h);const l=o.position,u=this.enemySpawner.getEnemies().filter(d=>Math.sqrt(Math.pow(d.position.x-l.x,2)+Math.pow(d.position.y-l.y,2))<=a);u.forEach(d=>{d.takeDamage&&d.takeDamage(n*.5)}),console.log(`Acid Spit pool hit ${u.length} enemies`)},this.setupProjectile(o)}fireRuneTracer(e){const t=this.findNearestEnemy();if(!t)return;const i=this.player.position,s=t.position,n=this.getWeaponDamage(e),a=this.getWeaponPierce(e),o=new mt(i.x,i.y,s.x,s.y,e.projectileSpeed,n,a,"rune_tracer");this.setupProjectile(o)}fireEyeBeam(e){if(this.beams.length>0)return;const t=this.player.position,i=this.getWeaponDamage(e),s=this.getWeaponPierce(e),n=(e.currentLevel-1)/(e.maxLevel-1),a=1+n*2,o=1+n*2,h=e.baseRange+(e.effects.rangeBonus||0),l=30,c=Math.floor(h*a),d=360/Math.floor(l*o),p=new og(t.x,t.y,i,s,c,d);this.setupBeam(p)}setupBeam(e){this.gameContainer.addChild(e.sprite),this.beams.push(e),e.onHitTarget=t=>{this.handleBeamHit(e,t)},e.onExpired=()=>{this.handleBeamExpired(e)},this.totalShotsFired++}handleBeamHit(e,t){t.collisionGroup===Oe.ENEMY&&(t.takeDamage(e.projectileDamage),this.totalHits++)}handleBeamExpired(e){const t=this.beams.indexOf(e);t>-1&&this.beams.splice(t,1),this.gameContainer.removeChild(e.sprite),e.destroy()}getWeaponDamage(e){const t=e.baseDamage,i=e.effects.damageMultiplier||1;return Math.floor(t*Math.pow(i,e.currentLevel))}getWeaponPierce(e){const t=e.basePierce,i=e.effects.pierceBonus||0;return t+i*e.currentLevel}findNearestEnemyNotInSet(e){const t=this.enemySpawner.getEnemies();if(t.length===0)return null;let i=null,s=1/0;const n=this.player.position;for(const a of t){if(e.has(a))continue;const o=a.position,h=Math.sqrt(Math.pow(o.x-n.x,2)+Math.pow(o.y-n.y,2));h<s&&(s=h,i=a)}return i}setupProjectile(e){e.onHitTarget=t=>{this.handleProjectileHit(e,t)},e.onExpired=()=>{this.handleProjectileExpired(e)},this.gameContainer.addChild(e.sprite),e.sprite.zIndex=75,this.collisionManager.addEntity(e),this.projectiles.push(e),this.totalShotsFired++}addWeapon(e){this.activeWeapons.includes(e)||(this.activeWeapons.push(e),console.log(`Added weapon: ${e}`))}removeWeapon(e){const t=this.activeWeapons.indexOf(e);t>-1&&(this.activeWeapons.splice(t,1),console.log(`Removed weapon: ${e}`))}getAvailableWeapons(){return Array.from(this.weapons.values())}getActiveWeapons(){return[...this.activeWeapons]}upgradeWeapon(e){const t=this.weapons.get(e);t&&t.currentLevel<t.maxLevel&&(t.currentLevel++,console.log(`Upgraded ${t.name} to level ${t.currentLevel}`))}findNearestEnemy(){const e=this.enemySpawner.getEnemies();if(e.length===0)return null;let t=null,i=1/0;const s=this.player.position;for(const n of e){const a=n.position,o=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2));o<i&&(i=o,t=n)}return t}updateProjectiles(e){for(const t of this.projectiles)t.active&&t.update(e)}cleanupInactiveProjectiles(){const e=[];for(const i of this.projectiles)i.active?e.push(i):(this.collisionManager.removeEntity(i),setTimeout(()=>{i.sprite.parent&&i.sprite.parent.removeChild(i.sprite)},100));const t=this.projectiles.length-e.length;t>0&&t>=5&&console.log(`Cleaned up ${t} projectiles`),this.projectiles=e}handleProjectileHit(e,t){t.takeDamage&&typeof t.takeDamage=="function"&&t.takeDamage(e.projectileDamage)&&this.totalHits%10===0&&console.log(`Enemy eliminated! Total kills: ${Math.floor(this.totalHits/1)}`),this.totalHits++,this.eventBus.emitEvent("weapon:fireball_hit",{weaponType:e.projectileType||"fireball",position:{x:e.sprite.x,y:e.sprite.y}})}handleProjectileExpired(e){}getStats(){const e=this.totalShotsFired>0?this.totalHits/this.totalShotsFired*100:0;return{shotsFired:this.totalShotsFired,hits:this.totalHits,accuracy:Math.round(e),activeProjectiles:this.projectiles.length}}upgrade(e,t){switch(e){case"attackSpeed":this.attackInterval=Math.max(.1,this.attackInterval-t);break;case"damage":this.projectileDamage=Math.floor(this.projectileDamage+t);break;case"speed":this.projectileSpeed+=t;break;case"range":this.range+=t;break}console.log(`Weapon upgraded: ${e} +${t}`)}applyUpgrades(e){this.projectileDamage=Math.floor(25*e.damageMultiplier),this.attackInterval=Math.max(.1,1/e.fireRateMultiplier),this.range=300+e.rangeBonus,this.pierceBonus=e.pierceBonus,e.pierceBonus>0&&console.log(`Piercing bonus applied: +${e.pierceBonus} pierce`)}getWeaponInfo(){return{attackSpeed:1/this.attackInterval,damage:this.projectileDamage,speed:this.projectileSpeed,range:this.range}}clear(){for(const e of this.projectiles)this.collisionManager.removeEntity(e),e.sprite.parent&&e.sprite.parent.removeChild(e.sprite),e.destroy();this.projectiles=[];for(const e of this.beams)try{e.sprite.parent&&e.sprite.parent.removeChild(e.sprite),e.destroy()}catch(t){console.error("Error clearing beam:",t)}this.beams=[],this.activeWeapons=["fireball"],this.recentBeamHits.clear(),this.totalShotsFired=0,this.totalHits=0}updateBeams(e){const t=this.player.position;for(const i of this.beams)i.active&&i.sprite&&i.sprite.transform&&(i.update(e),i.updatePosition(t.x,t.y),this.checkBeamEnemyCollisions(i))}checkBeamEnemyCollisions(e){if(!e||!e.sprite||!e.sprite.transform||!e.active)return;const t=this.enemySpawner.getEnemies(),i=Date.now();for(const s of t){if(!s||!s.position)continue;const n=this.recentBeamHits.get(s)||0;i-n<200||this.isEnemyInBeamPath(e,s)&&s.takeDamage&&typeof s.takeDamage=="function"&&(s.takeDamage(e.projectileDamage),this.totalHits++,this.recentBeamHits.set(s,i),console.log(`Beam hit enemy directly! Damage: ${e.projectileDamage}`))}for(const[s,n]of this.recentBeamHits.entries())i-n>1e3&&this.recentBeamHits.delete(s)}isEnemyInBeamPath(e,t){if(!e||!e.sprite||!t||!t.position||!e.sprite.transform||e.sprite.x===void 0||e.sprite.y===void 0)return!1;const i=t.position.x-e.sprite.x,s=t.position.y-e.sprite.y,n=Math.cos(-e.sprite.rotation),a=Math.sin(-e.sprite.rotation),o=i*n-s*a,h=i*a+s*n,l=16,c=l+e.range,u=16,d=t.collisionRadius||8,p=o+d>=l&&o-d<=c,f=Math.abs(h)<=u+d;return p&&f}cleanupInactiveBeams(){const e=[];for(const i of this.beams)if(i.active)e.push(i);else try{setTimeout(()=>{try{i.sprite.parent&&i.sprite.parent.removeChild(i.sprite)}catch(s){console.error("Error removing beam from display:",s)}},100)}catch(s){console.error("Error cleaning up inactive beam:",s)}const t=this.beams.length-e.length;t>0&&t>=5&&console.log(`Cleaned up ${t} beams`),this.beams=e}}class Wh{currentLevel=1;currentXP=0;xpToNextLevel=100;XP_BASE=100;XP_MULTIPLIER=1.2;allUpgrades=new Map;onLevelUp;onXPGained;totalXPGained=0;constructor(){this.initializeUpgrades()}initializeUpgrades(){[{id:"health_boost",name:"Health Boost",description:"+20 Max Health",icon:"❤️",maxLevel:5,currentLevel:0,effects:{healthBonus:20}},{id:"health_regen",name:"Health Regeneration",description:"+0.5 HP/sec regen",icon:"💚",maxLevel:3,currentLevel:0,effects:{regenBonus:.5}},{id:"speed_boost",name:"Speed Boost",description:"+15 Movement Speed",icon:"⚡",maxLevel:5,currentLevel:0,effects:{speedBonus:15}},{id:"magnet_range",name:"Magnet Range",description:"+30 XP Pickup Range",icon:"🧲",maxLevel:4,currentLevel:0,effects:{magnetRange:30}},{id:"weapon_damage",name:"Weapon Power",description:"+25% Weapon Damage",icon:"⚔️",maxLevel:8,currentLevel:0,effects:{damageMultiplier:1.25}},{id:"fire_rate",name:"Attack Speed",description:"-20% Attack Interval",icon:"🔥",maxLevel:6,currentLevel:0,effects:{fireRateMultiplier:1.2}},{id:"weapon_range",name:"Weapon Range",description:"+50 Attack Range",icon:"🎯",maxLevel:4,currentLevel:0,effects:{rangeBonus:50}},{id:"projectile_pierce",name:"Piercing Shot",description:"+1 Enemy Pierce",icon:"🏹",maxLevel:3,currentLevel:0,effects:{pierceBonus:1}},{id:"exp_bonus",name:"Experience Gain",description:"+15% Experience",icon:"📈",maxLevel:5,currentLevel:0,effects:{expMultiplier:1.15}},{id:"unlock_axe",name:"Axe Thrower",description:"Unlock Throwing Axe weapon",icon:"🪓",maxLevel:1,currentLevel:0,effects:{weaponUnlock:"axe"}},{id:"unlock_knife",name:"Knife Storm",description:"Unlock Multi-directional Knives",icon:"🗡️",maxLevel:1,currentLevel:0,effects:{weaponUnlock:"knife"}},{id:"unlock_rune_tracer",name:"Eye Beam Projectiles",description:"Unlock blue laser projectiles from eyes",icon:"🎯",maxLevel:1,currentLevel:0,effects:{weaponUnlock:"rune_tracer"}},{id:"unlock_eye_beam",name:"Rotating Eye Beam",description:"Unlock continuous rotating beam weapon",icon:"👁️",maxLevel:1,currentLevel:0,effects:{weaponUnlock:"eye_beam"}}].forEach(t=>{this.allUpgrades.set(t.id,t)})}addExperience(e){const t=this.getUpgradeEffect("expMultiplier",1),i=Math.floor(e*t);this.currentXP+=i,this.totalXPGained+=i,this.currentXP>=this.xpToNextLevel&&this.levelUp(),this.onXPGained&&this.onXPGained(this.currentXP,this.xpToNextLevel,this.totalXPGained)}levelUp(){this.currentLevel++,this.currentXP-=this.xpToNextLevel,this.xpToNextLevel=Math.floor(this.XP_BASE*Math.pow(this.XP_MULTIPLIER,this.currentLevel-1));const e=this.getAvailableUpgrades();this.onLevelUp&&this.onLevelUp({newLevel:this.currentLevel,availableUpgrades:e})}getAvailableUpgrades(){const e=[];for(const i of this.allUpgrades.values())i.currentLevel<i.maxLevel&&e.push({...i});const t=e.sort(()=>Math.random()-.5);return t.slice(0,Math.min(3,t.length))}selectUpgrade(e,t){const i=this.allUpgrades.get(e);if(i&&i.currentLevel<i.maxLevel&&(i.currentLevel++,i.effects.weaponUnlock&&t)){const s=i.effects.weaponUnlock;t.addWeapon(s),t.upgradeWeapon(s)}}getUpgradeEffect(e,t){let i=t;for(const s of this.allUpgrades.values())if(s.currentLevel>0&&s.effects[e]!==void 0){const n=s.effects[e];switch(e){case"damageMultiplier":case"fireRateMultiplier":case"expMultiplier":typeof n=="number"&&(i*=Math.pow(n,s.currentLevel));break;case"healthBonus":case"speedBonus":case"regenBonus":case"rangeBonus":case"pierceBonus":case"magnetRange":typeof n=="number"&&(i+=n*s.currentLevel);break;case"weaponUnlock":break;default:typeof n=="number"&&(i+=n*s.currentLevel);break}}return i}applyUpgrades(e,t){const i=this.getUpgradeEffect("healthBonus",0),s=this.getUpgradeEffect("regenBonus",0);e.applyHealthUpgrades(i,s);const n=this.getUpgradeEffect("speedBonus",0);e.applySpeedUpgrade(n);const a=this.getUpgradeEffect("damageMultiplier",1),o=this.getUpgradeEffect("fireRateMultiplier",1),h=this.getUpgradeEffect("rangeBonus",0),l=this.getUpgradeEffect("pierceBonus",0);t.applyUpgrades({damageMultiplier:a,fireRateMultiplier:o,rangeBonus:h,pierceBonus:l})}get level(){return this.currentLevel}get experience(){return this.currentXP}get experienceToNext(){return this.xpToNextLevel}get totalExperience(){return this.totalXPGained}get xpProgress(){return this.currentXP/this.xpToNextLevel}get magnetRange(){return this.getUpgradeEffect("magnetRange",80)}getAllUpgrades(){return Array.from(this.allUpgrades.values())}}class lg{sprite;collisionRadius=8;collisionGroup=Oe.PICKUP;gemSpriteManager;visualSprite=null;xpValue;magnetSpeed=400;getMagnetRange;floatTime=0;isBeingAttracted=!1;arcTime=0;arcRadius=0;arcAngle=0;arcDirection=1;initialDistance=0;attractionStartTime=0;originX=0;originY=0;easingTime=0;easingDuration=.8;onCollected;constructor(e,t,i=1,s,n){this.sprite=new ve,this.xpValue=i,this.gemSpriteManager=s,this.getMagnetRange=n,this.sprite.x=e,this.sprite.y=t,this.originX=e,this.originY=t,this.createSprite()}createSprite(){this.sprite.removeChildren();const e=this.gemSpriteManager.createGemSprite(this.xpValue);if(e)this.visualSprite=e,this.sprite.addChild(e);else{const t=new me;let i=65280,s=8978312,n=this.collisionRadius;this.xpValue>=5&&(i=35071,s=8965375,n=this.collisionRadius+2),this.xpValue>=10&&(i=16746496,s=16764040,n=this.collisionRadius+4),t.beginFill(i,.3),t.drawCircle(0,0,n+3),t.endFill(),t.beginFill(i,.8),t.drawCircle(0,0,n),t.endFill(),t.beginFill(s,.6),t.drawCircle(0,0,n-2),t.endFill(),t.beginFill(16777215,.8),t.drawCircle(0,0,2),t.endFill(),this.visualSprite=t,this.sprite.addChild(t)}}update(e,t){this.updateFloatingAnimation(e),this.updateMagneticAttraction(e,t)}updateFloatingAnimation(e){this.floatTime+=e/60;const t=Math.sin(this.floatTime*3)*2,i=1+Math.sin(this.floatTime*4)*.1;this.isBeingAttracted||(this.sprite.y+=t*.1),this.sprite.scale.set(i),this.sprite.rotation+=.02}updateMagneticAttraction(e,t){const i=t.position,s=i.x-this.sprite.x,n=i.y-this.sprite.y,a=Math.sqrt(s*s+n*n),o=this.getMagnetRange();if(a<=o?this.isBeingAttracted||(this.isBeingAttracted=!0,this.attractionStartTime=this.floatTime,this.initialDistance=a,this.arcTime=0,this.easingTime=0,this.arcRadius=Math.min(a*.15,30),this.arcAngle=Math.atan2(n,s),this.arcDirection=Math.random()>.5?1:-1):(this.isBeingAttracted=!1,this.arcTime=0,this.easingTime=0),this.isBeingAttracted&&a>0){if(a<20){this.sprite.x=i.x,this.sprite.y=i.y;return}this.arcTime+=e/60,this.easingTime+=e/60;const h=Math.min(this.easingTime/this.easingDuration,1),l=h*(2-h),c=Math.min(this.arcTime*2,1),u=Math.sin(c*Math.PI),d=s/a,p=n/a,f=-p*this.arcDirection,g=d*this.arcDirection,m=f*this.arcRadius*u,y=g*this.arcRadius*u,E=this.magnetSpeed*2.5*(e/60)*(.3+l*.7),w=Math.max(.6,1-a/o),B=d*E*w+m*.25,v=p*E*w+y*.25;this.sprite.x+=B,this.sprite.y+=v;const F=.8+Math.sin(this.floatTime*12)*.2;this.sprite.alpha=F,this.sprite.rotation+=this.arcDirection*.05;const U=i.x-this.sprite.x,G=i.y-this.sprite.y;Math.sqrt(U*U+G*G)>a+10&&(this.sprite.x=i.x-d*(a*.9),this.sprite.y=i.y-p*(a*.9))}}onCollision(e){e.collisionGroup===Oe.PLAYER&&(this.onCollected&&this.onCollected(this.xpValue),this.sprite.alpha=.5,this.sprite.scale.set(1.5),this.visualSprite&&(this.visualSprite.tint=16776960))}get experienceValue(){return this.xpValue}get position(){return{x:this.sprite.x,y:this.sprite.y}}get attracted(){return this.isBeingAttracted}}class cg{container;healthBar;healthBarBackground;healthText;statsBlockText;timeText;damageOverlay;xpBar;xpBarBackground;levelText;xpText;muteButton;muteButtonText;muteButtonBackground;statsBlockBackground;screenWidth;screenHeight;damageEffectTimer=0;damageEffectDuration=30;survivalTime=0;currentWeaponNotification;isMuted=!1;onMuteToggle;constructor(e,t){this.container=new ve,this.screenWidth=e,this.screenHeight=t,this.createHUD()}createHUD(){this.healthBarBackground=new me,this.healthBarBackground.beginFill(0,.5),this.healthBarBackground.drawRoundedRect(0,0,200,20,5),this.healthBarBackground.endFill(),this.healthBarBackground.x=20,this.healthBarBackground.y=20,this.container.addChild(this.healthBarBackground),this.healthBar=new me,this.container.addChild(this.healthBar);const e=new fe({fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold"});this.healthText=new he("100/100 HP",e),this.healthText.x=240,this.healthText.y=20,this.container.addChild(this.healthText),this.statsBlockBackground=new me,this.statsBlockBackground.beginFill(0,.5),this.statsBlockBackground.drawRoundedRect(15,45,320,60,8),this.statsBlockBackground.endFill(),this.container.addChild(this.statsBlockBackground),this.statsBlockBackground.zIndex=1;const t=new fe({fontFamily:"Arial",fontSize:14,fill:16777215});this.statsBlockText=new he("",t),this.statsBlockText.x=30,this.statsBlockText.y=55,this.statsBlockText.zIndex=2,this.container.addChild(this.statsBlockText);const i=new fe({fontFamily:"Arial",fontSize:16,fill:16776960,fontWeight:"bold"});this.timeText=new he("Time: 0:00",i),this.timeText.x=this.screenWidth-120,this.timeText.y=20,this.container.addChild(this.timeText),this.xpBarBackground=new me,this.xpBarBackground.beginFill(0,.5),this.xpBarBackground.drawRoundedRect(0,0,300,15,5),this.xpBarBackground.endFill(),this.xpBarBackground.x=this.screenWidth/2-150,this.xpBarBackground.y=this.screenHeight-50,this.container.addChild(this.xpBarBackground),this.xpBar=new me,this.container.addChild(this.xpBar);const s=new fe({fontFamily:"Arial",fontSize:16,fill:16766720,fontWeight:"bold"});this.levelText=new he("Level 1",s),this.levelText.x=this.screenWidth/2-170,this.levelText.y=this.screenHeight-50,this.container.addChild(this.levelText);const n=new fe({fontFamily:"Arial",fontSize:12,fill:16777215});this.xpText=new he("0/100 XP",n),this.xpText.x=this.screenWidth/2-25,this.xpText.y=this.screenHeight-47,this.container.addChild(this.xpText),this.damageOverlay=new me,this.damageOverlay.beginFill(16711680,.3),this.damageOverlay.drawRect(0,0,this.screenWidth,this.screenHeight),this.damageOverlay.endFill(),this.damageOverlay.visible=!1,this.container.addChild(this.damageOverlay),this.createMuteButton(),this.container.zIndex=1e3}createMuteButton(){this.muteButtonBackground=new me,this.muteButtonBackground.beginFill(0,.7),this.muteButtonBackground.drawRoundedRect(0,0,50,50,8),this.muteButtonBackground.endFill(),this.muteButtonBackground.x=this.screenWidth-70,this.muteButtonBackground.y=20,this.container.addChild(this.muteButtonBackground),this.muteButton=new me,this.muteButton.beginFill(3355443,.8),this.muteButton.drawRoundedRect(0,0,40,40,6),this.muteButton.endFill(),this.muteButton.lineStyle(2,6710886,.5),this.muteButton.drawRoundedRect(0,0,40,40,6),this.muteButton.x=this.screenWidth-65,this.muteButton.y=25,this.container.addChild(this.muteButton);const e=new fe({fontFamily:"Arial",fontSize:20,fill:16777215,fontWeight:"bold"});this.muteButtonText=new he("🔊",e),this.muteButtonText.x=this.screenWidth-55,this.muteButtonText.y=30,this.container.addChild(this.muteButtonText);const t=new he("Click to mute/unmute audio (or press M)",{fontFamily:"Arial",fontSize:12,fill:16777215,fontWeight:"bold"});t.x=this.screenWidth-200,t.y=75,t.visible=!1,this.container.addChild(t),this.muteButtonBackground.eventMode="static",this.muteButtonBackground.cursor="pointer",this.muteButtonBackground.on("pointerdown",()=>this.toggleMute()),this.muteButtonBackground.on("pointerover",()=>{this.muteButtonBackground.tint=6710886,t.visible=!0}),this.muteButtonBackground.on("pointerout",()=>{this.muteButtonBackground.tint=16777215,t.visible=!1}),this.muteButton.eventMode="static",this.muteButton.cursor="pointer",this.muteButton.on("pointerdown",()=>this.toggleMute()),this.muteButton.on("pointerover",()=>{this.muteButton.tint=6710886,t.visible=!0}),this.muteButton.on("pointerout",()=>{this.muteButton.tint=16777215,t.visible=!1})}update(e,t,i,s,n){this.updateSurvivalTime(e),this.updateHealthBar(t),this.updateStats(i,s),n&&this.updateXPBar(n),this.updateDamageEffect(e)}updateSurvivalTime(e){this.survivalTime+=e/60;const t=Math.floor(this.survivalTime/60),i=Math.floor(this.survivalTime%60);this.timeText.text=`Time: ${t}:${i.toString().padStart(2,"0")}`}updateHealthBar(e){const t=e.healthPercent,s=200*t;this.healthBar.clear();let n=65280;if(t<.3?n=16711680:t<.6&&(n=16776960),this.healthBar.beginFill(n,.8),this.healthBar.drawRoundedRect(22,22,s-4,16,3),this.healthBar.endFill(),this.healthText.text=`${e.currentHealth}/${e.maximumHealth} HP`,t<.2){const a=Math.sin(Date.now()/200)*.5+.5;this.healthBar.alpha=.5+a*.5}else this.healthBar.alpha=1}updateStats(e,t){const i=e.getWaveInfo(),s=e.getStats();let n="";if(t){const c=t.getStats();n=`Weapon: ${c.shotsFired} shots | ${c.hits} hits | ${c.accuracy}% accuracy`}const a=[`Wave ${i.currentWave}/${e.getTotalWaves()}: ${i.waveName} (${Math.round(i.waveProgress*100)}%)`,`Time: ${this.formatSurvivalTime(i.timeRemaining)} | Event: ${i.event}`,n,`Enemies: ${s.count}/${s.maxEnemies} | Spawn Rate: ${s.spawnRate.toFixed(1)}/s`];this.statsBlockText.text=a.filter(Boolean).join(`
`);const o=12,h=this.statsBlockText.width+o*2,l=this.statsBlockText.height+o*2;this.statsBlockBackground.clear(),this.statsBlockBackground.beginFill(0,.5),this.statsBlockBackground.drawRoundedRect(20,50,h,l,8),this.statsBlockBackground.endFill()}updateXPBar(e){const t=e.xpProgress,s=300*t;if(this.xpBar.clear(),this.xpBar.beginFill(52479,.8),this.xpBar.drawRoundedRect(this.screenWidth/2-148,this.screenHeight-48,s-4,11,3),this.xpBar.endFill(),this.levelText.text=`Level ${e.level}`,this.xpText.text=`${e.experience}/${e.experienceToNext} XP`,t>.8){const n=Math.sin(Date.now()/300)*.3+.7;this.xpBar.alpha=n,this.levelText.alpha=n}else this.xpBar.alpha=1,this.levelText.alpha=1}updateDamageEffect(e){if(this.damageEffectTimer>0){this.damageEffectTimer-=e;const t=this.damageEffectTimer/this.damageEffectDuration*.3;this.damageOverlay.alpha=t,this.damageOverlay.visible=t>0,this.damageEffectTimer<=0&&(this.damageOverlay.visible=!1)}}showDamageEffect(){this.damageEffectTimer=this.damageEffectDuration,this.damageOverlay.visible=!0,this.damageOverlay.alpha=.3}getContainer(){return this.container}getSurvivalTime(){return this.survivalTime}reset(){this.survivalTime=0,this.damageEffectTimer=0,this.damageOverlay.visible=!1}showDebugModeNotification(){const e=new he("🔧 DEBUG MODE ACTIVATED",{fontFamily:"Arial",fontSize:24,fill:16711680,fontWeight:"bold"});e.x=this.screenWidth/2-150,e.y=this.screenHeight/2-50,this.container.addChild(e),setTimeout(()=>{this.container.children.includes(e)&&this.container.removeChild(e)},3e3)}showWeaponNotification(e){this.currentWeaponNotification&&this.container.children.includes(this.currentWeaponNotification)&&(this.container.removeChild(this.currentWeaponNotification),this.currentWeaponNotification.destroy());const t=new he(`🔫 ${e.toUpperCase()}`,{fontFamily:"Arial",fontSize:20,fill:65280,fontWeight:"bold"});t.x=this.screenWidth/2-100,t.y=this.screenHeight/2-30,this.container.addChild(t),this.currentWeaponNotification=t,setTimeout(()=>{this.currentWeaponNotification===t&&this.container.children.includes(t)&&(this.container.removeChild(t),t.destroy(),this.currentWeaponNotification=void 0)},2e3)}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?(this.muteButtonText.text="🔇",this.muteButton.tint=16737894):(this.muteButtonText.text="🔊",this.muteButton.tint=16777215),this.onMuteToggle&&this.onMuteToggle(this.isMuted),this.showMuteNotification()}showMuteNotification(){const e=this.isMuted?"🔇 Audio Muted":"🔊 Audio Unmuted",t=this.isMuted?16737894:65280,i=new he(e,{fontFamily:"Arial",fontSize:18,fill:t,fontWeight:"bold"});i.x=this.screenWidth/2-80,i.y=this.screenHeight/2-100,this.container.addChild(i),setTimeout(()=>{this.container.children.includes(i)&&(this.container.removeChild(i),i.destroy())},2e3)}setMuteToggle(e){this.onMuteToggle=e}isAudioMuted(){return this.isMuted}formatSurvivalTime(e){const t=Math.floor(e/60),i=Math.floor(e%60);return`${t}:${i.toString().padStart(2,"0")}`}}class ug{container;background;titleText;statsText;instructionText;isVisible=!1;screenWidth;screenHeight;constructor(e,t){this.container=new ve,this.screenWidth=e,this.screenHeight=t,this.createGameOverScreen(),this.hide()}createGameOverScreen(){this.background=new me,this.background.beginFill(0,.8),this.background.drawRect(0,0,this.screenWidth,this.screenHeight),this.background.endFill(),this.container.addChild(this.background);const e=new fe({fontFamily:"Arial",fontSize:48,fill:16711680,fontWeight:"bold",align:"center"});this.titleText=new he("GAME OVER",e),this.titleText.anchor.set(.5),this.titleText.x=this.screenWidth/2,this.titleText.y=this.screenHeight/2-100,this.container.addChild(this.titleText);const t=new fe({fontFamily:"Arial",fontSize:20,fill:16777215,align:"center"});this.statsText=new he("",t),this.statsText.anchor.set(.5),this.statsText.x=this.screenWidth/2,this.statsText.y=this.screenHeight/2-20,this.container.addChild(this.statsText);const i=new fe({fontFamily:"Arial",fontSize:16,fill:16776960,align:"center"});this.instructionText=new he("Press SPACE to restart or ESC to quit",i),this.instructionText.anchor.set(.5),this.instructionText.x=this.screenWidth/2,this.instructionText.y=this.screenHeight/2+60,this.container.addChild(this.instructionText),this.container.zIndex=2e3}show(e,t,i){this.isVisible=!0,this.container.visible=!0;const s=Math.floor(e/60),n=Math.floor(e%60),a=`${s}:${n.toString().padStart(2,"0")}`;this.statsText.text=`You survived for ${a}
Enemies faced: ${i}
Peak enemy count: ${t}`,this.startTitleFlash()}hide(){this.isVisible=!1,this.container.visible=!1}update(e){if(!this.isVisible)return;const t=Math.sin(Date.now()/300)*.2+.8;this.titleText.alpha=t;const i=Math.sin(Date.now()/500)*.3+.7;this.instructionText.alpha=i}startTitleFlash(){this.titleText.alpha=1}getContainer(){return this.container}get visible(){return this.isVisible}}class dg{container;background;titleText;instructionText;upgradeButtons=[];selectedIndex=0;onUpgradeSelected;isVisible=!1;constructor(){this.container=new ve,this.container.visible=!1,this.createBackground(),this.createTitle(),this.createInstructions()}createBackground(){this.background=new me,this.background.beginFill(0,.8),this.background.drawRect(-512,-384,1024,768),this.background.endFill(),this.background.beginFill(1710638,.95),this.background.lineStyle(3,1450302,1),this.background.drawRoundedRect(-300,-200,600,400,10),this.background.endFill(),this.container.addChild(this.background)}createTitle(){const e=new fe({fontFamily:"Arial",fontSize:36,fontWeight:"bold",fill:16766720,align:"center",dropShadow:!0,dropShadowColor:0,dropShadowDistance:2});this.titleText=new he("LEVEL UP!",e),this.titleText.anchor.set(.5),this.titleText.x=0,this.titleText.y=-160,this.container.addChild(this.titleText)}createInstructions(){const e=new fe({fontFamily:"Arial",fontSize:16,fill:13421772,align:"center"});this.instructionText=new he("Use 1, 2, 3 keys to select an upgrade",e),this.instructionText.anchor.set(.5),this.instructionText.x=0,this.instructionText.y=160,this.container.addChild(this.instructionText)}show(e,t){this.isVisible=!0,this.container.visible=!0,this.titleText.text=`LEVEL ${e}!`,this.clearUpgradeButtons(),this.createUpgradeButtons(t),this.selectedIndex=0,this.updateButtonStates()}hide(){this.isVisible=!1,this.container.visible=!1,this.clearUpgradeButtons()}clearUpgradeButtons(){for(const e of this.upgradeButtons)this.container.removeChild(e.container);this.upgradeButtons=[]}createUpgradeButtons(e){for(let s=0;s<e.length&&s<3;s++){const n=e[s],a=new pg(n,s+1);a.container.x=0,a.container.y=-80+s*80,this.upgradeButtons.push(a),this.container.addChild(a.container)}}updateButtonStates(){for(let e=0;e<this.upgradeButtons.length;e++)this.upgradeButtons[e].setSelected(e===this.selectedIndex)}update(e){this.isVisible&&(e.isKeyJustPressed("Digit1")&&this.upgradeButtons[0]?this.selectUpgrade(0):e.isKeyJustPressed("Digit2")&&this.upgradeButtons[1]?this.selectUpgrade(1):e.isKeyJustPressed("Digit3")&&this.upgradeButtons[2]&&this.selectUpgrade(2))}selectUpgrade(e){if(e>=0&&e<this.upgradeButtons.length){const t=this.upgradeButtons[e].upgrade;this.onUpgradeSelected&&this.onUpgradeSelected(t.id),this.hide()}}get visible(){return this.isVisible}}class pg{container;upgrade;background;iconText;nameText;descriptionText;levelText;keyHintText;isSelected=!1;constructor(e,t){this.upgrade=e,this.container=new ve,this.createBackground(),this.createIcon(),this.createTexts(t)}createBackground(){this.background=new me,this.updateBackground(),this.container.addChild(this.background)}updateBackground(){this.background.clear();const e=this.isSelected?4868714:2763322,t=this.isSelected?6974090:4868698;this.background.beginFill(e,.9),this.background.lineStyle(2,t,1),this.background.drawRoundedRect(-280,-25,560,50,5),this.background.endFill()}createIcon(){const e=new fe({fontFamily:"Arial",fontSize:24,fontWeight:"bold",fill:16777215});this.iconText=new he(this.upgrade.icon,e),this.iconText.anchor.set(.5),this.iconText.x=-240,this.iconText.y=0,this.container.addChild(this.iconText)}createTexts(e){const t=new fe({fontFamily:"Arial",fontSize:18,fontWeight:"bold",fill:16777215});this.nameText=new he(this.upgrade.name,t),this.nameText.anchor.set(0,.5),this.nameText.x=-200,this.nameText.y=-8;const i=new fe({fontFamily:"Arial",fontSize:14,fill:13421772});this.descriptionText=new he(this.upgrade.description,i),this.descriptionText.anchor.set(0,.5),this.descriptionText.x=-200,this.descriptionText.y=8;const s=new fe({fontFamily:"Arial",fontSize:14,fill:11184810});this.levelText=new he(`Level ${this.upgrade.currentLevel}/${this.upgrade.maxLevel}`,s),this.levelText.anchor.set(1,.5),this.levelText.x=200,this.levelText.y=-8;const n=new fe({fontFamily:"Arial",fontSize:16,fontWeight:"bold",fill:16766720});this.keyHintText=new he(`[${e}]`,n),this.keyHintText.anchor.set(1,.5),this.keyHintText.x=200,this.keyHintText.y=8,this.container.addChild(this.nameText),this.container.addChild(this.descriptionText),this.container.addChild(this.levelText),this.container.addChild(this.keyHintText)}setSelected(e){this.isSelected=e,this.updateBackground();const t=e?16766720:16777215,i=e?16777130:13421772;this.nameText.style.fill=t,this.iconText.style.fill=t,this.descriptionText.style.fill=i}}class fg{container;background;titleText;subtitleText;gameplayText;controlsTitle;controlsText;startText;versionText;onStartGame;isVisible=!0;animationTime=0;constructor(e,t){console.warn("TitleScreen: Initializing..."),this.container=new ve,this.container.visible=!0,this.createBackground(e,t),this.createTitle(),this.createGameplayDescription(),this.createControls(),this.createStartInstructions(),this.createVersionInfo(),this.container.x=e/2,this.container.y=t/2,console.warn("TitleScreen: Initialized successfully")}createBackground(e,t){this.background=new me,this.background.beginFill(657946,1),this.background.drawRect(-e/2,-t/2,e,t),this.background.endFill(),this.background.beginFill(1710638,.3),this.background.drawCircle(-200,-150,100),this.background.drawCircle(250,100,80),this.background.drawCircle(-100,200,60),this.background.endFill(),this.container.addChild(this.background)}createTitle(){const e=new fe({fontFamily:"Arial",fontSize:48,fontWeight:"bold",fill:["#ff6b6b","#4ecdc4"],align:"center",dropShadow:!0,dropShadowColor:0,dropShadowDistance:4,dropShadowBlur:2});this.titleText=new he("SURVIVAL ARENA",e),this.titleText.anchor.set(.5),this.titleText.x=0,this.titleText.y=-180;const t=new fe({fontFamily:"Arial",fontSize:18,fontStyle:"italic",fill:11184810,align:"center"});this.subtitleText=new he("A Vampire Survivors-style Action Game",t),this.subtitleText.anchor.set(.5),this.subtitleText.x=0,this.subtitleText.y=-140,this.container.addChild(this.titleText),this.container.addChild(this.subtitleText)}createGameplayDescription(){const e=new fe({fontFamily:"Arial",fontSize:16,fill:16777215,align:"center",lineHeight:24}),t=`Survive waves of enemies in an endless arena!
Your weapons fire automatically - focus on positioning and upgrades.
Collect XP orbs to level up and choose powerful upgrades.
How long can you survive?`;this.gameplayText=new he(t,e),this.gameplayText.anchor.set(.5),this.gameplayText.x=0,this.gameplayText.y=-60,this.container.addChild(this.gameplayText)}createControls(){const e=new fe({fontFamily:"Arial",fontSize:20,fontWeight:"bold",fill:16766720,align:"center"});this.controlsTitle=new he("CONTROLS",e),this.controlsTitle.anchor.set(.5),this.controlsTitle.x=0,this.controlsTitle.y=20;const t=new fe({fontFamily:"Arial",fontSize:14,fill:13421772,align:"center",lineHeight:20}),i=`🎮 WASD / Arrow Keys - Move
🔫 Weapons fire automatically at nearest enemies
💎 Walk over XP orbs to collect them
⬆️ Level up to choose upgrades (Press 1, 2, or 3)
⏸️ ESC - Pause/Menu | SPACE - Restart (when dead)`;this.controlsText=new he(i,t),this.controlsText.anchor.set(.5),this.controlsText.x=0,this.controlsText.y=80,this.container.addChild(this.controlsTitle),this.container.addChild(this.controlsText)}createStartInstructions(){const e=new fe({fontFamily:"Arial",fontSize:24,fontWeight:"bold",fill:65280,align:"center",dropShadow:!0,dropShadowColor:34816,dropShadowDistance:2});this.startText=new he("Press SPACE to Start!",e),this.startText.anchor.set(.5),this.startText.x=0,this.startText.y=160,this.container.addChild(this.startText)}createVersionInfo(){const e=new fe({fontFamily:"Arial",fontSize:12,fill:6710886,align:"center"});this.versionText=new he("Built with PixiJS & TypeScript | v1.0.1",e),this.versionText.anchor.set(.5),this.versionText.x=0,this.versionText.y=200,this.container.addChild(this.versionText)}update(e,t){if(!this.isVisible){console.error("TitleScreen update called but screen is not visible!");return}this.updateAnimations(e),this.handleInput(t)}updateAnimations(e){this.animationTime+=e/60;const t=Math.sin(this.animationTime*3)*.2+.8;this.startText.alpha=t,this.startText.scale.set(t);const i=Math.sin(this.animationTime*1.5)*3;this.titleText.y=-180+i,this.titleText.rotation=Math.sin(this.animationTime*.5)*.05;const s=Math.sin(this.animationTime*2)*.3+.7;this.titleText.alpha=s}handleInput(e){const t=e.isKeyJustPressed("Space"),i=e.isKeyJustPressed("Enter"),s=e.isKeyJustPressed(" "),n=e.isKeyJustPressed("NumpadEnter");(t||i||s||n)&&(console.log("Title screen detected key press - Space:",t,"Enter:",i,"SpaceAlt:",s,"EnterAlt:",n),this.startGame())}startGame(){console.error("onStartGame callback is not set!"),this.onStartGame&&this.onStartGame(),this.hide()}show(){this.isVisible=!0,this.container.visible=!0,this.animationTime=0}hide(){this.isVisible=!1,this.container.visible=!1}get visible(){return this.isVisible}}function mg(r){return`entity_${r}`}class gg{components=new Map;componentType;constructor(e){this.componentType=e}set(e,t){if(t.type!==this.componentType)throw new Error(`Component type mismatch: expected ${this.componentType}, got ${t.type}`);this.components.set(e,t)}get(e){return this.components.get(e)||null}has(e){return this.components.has(e)}delete(e){return this.components.delete(e)}getAllComponents(){return new Map(this.components)}clear(){this.components.clear()}getSize(){return this.components.size}getComponentType(){return this.componentType}*[Symbol.iterator](){for(const[e,t]of this.components)yield[e,t]}getEntityIds(){return Array.from(this.components.keys())}getComponents(){return Array.from(this.components.values())}}class yg{entities=new Map;componentStores=new Map;entityComponents=new Map;nextEntityId=1;createEntity(){const e=mg(this.nextEntityId++),t={id:e};return this.entities.set(e,t),this.entityComponents.set(e,new Set),t}destroyEntity(e){if(!this.entities.has(e))return;const t=this.entityComponents.get(e);if(t)for(const i of t)this.removeComponent(e,i);this.entities.delete(e),this.entityComponents.delete(e)}hasEntity(e){return this.entities.has(e)}getEntity(e){return this.entities.get(e)||null}addComponent(e,t){if(!this.entities.has(e))throw new Error(`Entity ${e} does not exist`);let i=this.componentStores.get(t.type);i||(i=new gg(t.type),this.componentStores.set(t.type,i)),i.set(e,t);const s=this.entityComponents.get(e);s&&s.add(t.type)}removeComponent(e,t){if(!this.entities.has(e))return;const i=this.componentStores.get(t);i&&i.delete(e);const s=this.entityComponents.get(e);s&&s.delete(t)}getComponent(e,t){if(!this.entities.has(e))return null;const i=this.componentStores.get(t);return i?i.get(e):null}hasComponent(e,t){if(!this.entities.has(e))return!1;const i=this.entityComponents.get(e);return i?i.has(t):!1}query(e){const t=[];for(const[i,s]of this.entities)if(this.matchesQuery(i,e)&&(t.push(s),e.limit&&t.length>=e.limit))break;return t}matchesQuery(e,t){const i=this.entityComponents.get(e);if(!i)return!1;for(const s of t.with)if(!i.has(s))return!1;if(t.without){for(const s of t.without)if(i.has(s))return!1}return!0}getAllEntities(){return Array.from(this.entities.values())}getEntityCount(){return this.entities.size}getEntityComponents(e){const t=this.entityComponents.get(e);return t?Array.from(t):[]}getEntitiesWithComponent(e){const t=this.componentStores.get(e);if(!t)return[];const i=[];for(const s of t.getEntityIds()){const n=this.entities.get(s);n&&i.push(n)}return i}getComponentStore(e){return this.componentStores.get(e)||null}getComponentCount(){let e=0;for(const t of this.componentStores.values())e+=t.getSize();return e}clear(){this.entities.clear(),this.entityComponents.clear();for(const e of this.componentStores.values())e.clear();this.componentStores.clear(),this.nextEntityId=1}}class vg{systems=new Map;systemsArray=[];isInitialized=!1;isShutdown=!1;registerSystem(e){if(this.isShutdown)throw new Error("Cannot register system after shutdown");if(this.systems.has(e.type))throw new Error(`System ${e.type} is already registered`);this.systems.set(e.type,e),this.rebuildSystemsArray(),this.isInitialized&&e.initialize()}unregisterSystem(e){const t=this.systems.get(e);t&&(this.isInitialized&&!this.isShutdown&&t.shutdown(),this.systems.delete(e),this.rebuildSystemsArray())}getSystem(e){return this.systems.get(e)||null}updateSystems(e){if(!(!this.isInitialized||this.isShutdown))for(const t of this.systemsArray)try{t.update(e)}catch(i){console.error(`Error updating system ${t.type}:`,i)}}initializeSystems(){if(!this.isInitialized){for(const e of this.systemsArray)try{e.initialize()}catch(t){console.error(`Error initializing system ${e.type}:`,t)}this.isInitialized=!0}}shutdownSystems(){if(!(!this.isInitialized||this.isShutdown)){for(let e=this.systemsArray.length-1;e>=0;e--){const t=this.systemsArray[e];try{t.shutdown()}catch(i){console.error(`Error shutting down system ${t.type}:`,i)}}this.isShutdown=!0}}getSystemCount(){return this.systems.size}rebuildSystemsArray(){this.systemsArray=Array.from(this.systems.values()).sort((e,t)=>e.priority-t.priority)}getAllSystems(){return[...this.systemsArray]}getSystemTypes(){return Array.from(this.systems.keys())}hasSystem(e){return this.systems.has(e)}isSystemInitialized(){return this.isInitialized}isSystemShutdown(){return this.isShutdown}clear(){this.isInitialized&&!this.isShutdown&&this.shutdownSystems(),this.systems.clear(),this.systemsArray=[],this.isInitialized=!1,this.isShutdown=!1}getSystemsByPriority(e,t){return this.systemsArray.filter(i=>i.priority>=e&&i.priority<=t)}}class xg{entityManager;systemManager;isInitialized=!1;isShutdown=!1;constructor(){this.entityManager=new yg,this.systemManager=new vg}initialize(){if(!this.isInitialized)try{this.systemManager.initializeSystems(),this.isInitialized=!0,console.log("🌍 ECS World initialized successfully")}catch(e){throw console.error("❌ Failed to initialize ECS World:",e),e}}update(e){if(!(!this.isInitialized||this.isShutdown))try{this.systemManager.updateSystems(e)}catch(t){console.error("❌ Error updating ECS World:",t)}}shutdown(){if(!(!this.isInitialized||this.isShutdown))try{this.systemManager.shutdownSystems(),this.entityManager.clear(),this.isShutdown=!0,console.log("🌍 ECS World shutdown successfully")}catch(e){console.error("❌ Error shutting down ECS World:",e)}}getStats(){return{entities:this.entityManager.getEntityCount(),systems:this.systemManager.getSystemCount(),components:this.entityManager.getComponentCount()}}isWorldInitialized(){return this.isInitialized}isWorldShutdown(){return this.isShutdown}reset(){this.isInitialized&&!this.isShutdown&&this.shutdown(),this.entityManager.clear(),this.systemManager.clear(),this.isInitialized=!1,this.isShutdown=!1}getDetailedStats(){return{entities:this.entityManager.getEntityCount(),systems:this.systemManager.getSystemCount(),components:this.entityManager.getComponentCount(),systemTypes:this.systemManager.getSystemTypes(),isInitialized:this.isInitialized,isShutdown:this.isShutdown}}}var pa=(r=>(r[r.LOWEST=0]="LOWEST",r[r.LOW=25]="LOW",r[r.NORMAL=50]="NORMAL",r[r.HIGH=75]="HIGH",r[r.HIGHEST=100]="HIGHEST",r[r.CRITICAL=200]="CRITICAL",r))(pa||{});class _g{listeners=new Map;middleware=[];history;isEmitting=!1;deferredOperations=[];constructor(e=1e3){this.history=new bg(e)}on(e,t,i=pa.NORMAL){return this.addListener(e,t,i,!1)}once(e,t,i=pa.NORMAL){return this.addListener(e,t,i,!0)}off(e,t){const i=()=>{const s=this.listeners.get(e);if(!s)return;const n=s.findIndex(a=>a.listener===t);n!==-1&&(s.splice(n,1),s.length===0&&this.listeners.delete(e))};this.isEmitting?this.deferredOperations.push(i):i()}emit(e){this.history.add(e);let t=e;for(const s of this.middleware)if(s.beforeDispatch){const n=s.beforeDispatch(t);if(n===null)return;t=n}const i=this.listeners.get(t.type);if(!(!i||i.length===0)){this.isEmitting=!0;try{this.isListenersSorted(i)||i.sort((n,a)=>a.priority-n.priority);const s=[];for(const n of i)try{n.listener(t),n.once&&s.push(n)}catch(a){for(const o of this.middleware)o.onError&&o.onError(t,a,n.listener);(this.middleware.length===0||!this.middleware.some(o=>o.onError))&&console.error(`Error in event listener for ${t.type}:`,a)}for(const n of s){const a=i.indexOf(n);a!==-1&&i.splice(a,1)}i.length===0&&this.listeners.delete(t.type)}finally{this.isEmitting=!1;const s=[...this.deferredOperations];this.deferredOperations=[];for(const n of s)n()}for(const s of this.middleware)s.afterDispatch&&s.afterDispatch(t)}}emitEvent(e,t,i){const s={type:e,timestamp:Date.now(),entityId:i,data:t};this.emit(s)}clearListeners(e){const t=()=>{this.listeners.delete(e)};this.isEmitting?this.deferredOperations.push(t):t()}clearAllListeners(){const e=()=>{this.listeners.clear()};this.isEmitting?this.deferredOperations.push(e):e()}getListenerCount(e){if(e){const i=this.listeners.get(e);return i?i.length:0}let t=0;for(const i of this.listeners.values())t+=i.length;return t}hasListeners(e){const t=this.listeners.get(e);return t?t.length>0:!1}addMiddleware(e){this.middleware.push(e)}removeMiddleware(e){const t=this.middleware.indexOf(e);t!==-1&&this.middleware.splice(t,1)}getHistory(){return this.history}getStats(){return{totalListeners:this.getListenerCount(),eventTypes:this.listeners.size,historySize:this.history.events.length,isEmitting:this.isEmitting,deferredOperations:this.deferredOperations.length}}addListener(e,t,i,s){const n=()=>{this.listeners.has(e)||this.listeners.set(e,[]);const a=this.listeners.get(e),o={listener:t,priority:i,once:s};a.push(o),a.sort((h,l)=>l.priority-h.priority)};return this.isEmitting?this.deferredOperations.push(n):n(),{unsubscribe:()=>{this.off(e,t)}}}isListenersSorted(e){for(let t=1;t<e.length;t++)if(e[t-1].priority<e[t].priority)return!1;return!0}}class bg{events=[];maxSize;constructor(e=1e3){this.maxSize=e}add(e){this.events.push(e),this.events.length>this.maxSize&&this.events.shift()}clear(){this.events=[]}getEvents(e){return e?this.events.filter(t=>t.type===e):[...this.events]}getEventsInRange(e,t){return this.events.filter(i=>i.timestamp>=e&&i.timestamp<=t)}}class wg{type="enemy-system";priority=5;world;eventBus;spriteManager;gameContainer;enemyQuery={with:["enemy","position"],without:[]};enemyWithHealthQuery={with:["enemy","enemy-health","position"],without:[]};enemyWithMovementQuery={with:["enemy","enemy-movement","position","velocity"],without:[]};enemyWithAIQuery={with:["enemy","enemy-ai","position"],without:[]};enemyWithSpriteQuery={with:["enemy","enemy-sprite","position"],without:[]};enemyWithAnimationQuery={with:["enemy","enemy-animation","enemy-sprite"],without:[]};initialized=!1;enemyIdCounter=0;lastUpdate=0;performanceMetrics={entitiesProcessed:0,updateTime:0,averageUpdateTime:0};constructor(e,t,i,s){this.world=e,this.eventBus=t,this.spriteManager=i,this.gameContainer=s}initialize(){this.initialized||(console.warn("EnemySystem: Initializing..."),this.initialized=!0,this.lastUpdate=Date.now(),this.eventBus.on("enemy:create-request",this.handleCreateEnemyRequest.bind(this)),this.eventBus.on("enemy:destroy-request",this.handleDestroyEnemyRequest.bind(this)),this.eventBus.on("player:moved",this.handlePlayerMovement.bind(this)),this.eventBus.on("collision:enemy-player",this.handleEnemyPlayerCollision.bind(this)),this.eventBus.on("collision:enemy-projectile",this.handleEnemyProjectileCollision.bind(this)),console.warn("EnemySystem: Initialized successfully"))}update(e){if(!this.initialized)return;const t=performance.now(),i=Date.now();this.updateEnemyHealth(e),this.updateEnemyMovement(e),this.updateEnemyAI(e,i),this.updateEnemySprites(e),this.updateEnemyAnimations(e),this.updateEnemyCollision(e),this.cleanupDeadEnemies();const s=performance.now();this.performanceMetrics.updateTime=s-t,this.performanceMetrics.averageUpdateTime=this.performanceMetrics.averageUpdateTime*.9+this.performanceMetrics.updateTime*.1,this.lastUpdate=i}shutdown(){if(!this.initialized)return;console.log("EnemySystem: Shutting down...");const e=this.world.entityManager.query(this.enemyQuery);for(const t of e)this.destroyEnemy(t.id);this.eventBus.off("enemy:create-request",this.handleCreateEnemyRequest.bind(this)),this.eventBus.off("enemy:destroy-request",this.handleDestroyEnemyRequest.bind(this)),this.eventBus.off("player:moved",this.handlePlayerMovement.bind(this)),this.eventBus.off("collision:enemy-player",this.handleEnemyPlayerCollision.bind(this)),this.eventBus.off("collision:enemy-projectile",this.handleEnemyProjectileCollision.bind(this)),this.initialized=!1,console.log("EnemySystem: Shutdown complete")}createEnemy(e,t,i){const s=this.spriteManager.getEnemyConfig(e);if(!s)throw new Error(`Invalid enemy type: ${e}`);const n={...s,...i},a=this.world.entityManager.createEntity(),o=this.generateEnemyId(),h=createEnemyComponent(o,e,n),l=createEnemyHealthComponent(n.health),c=createEnemyMovementComponent(n.speed,this.getMovementTypeForEnemy(e)),u=createEnemyAIComponent(this.getBehaviorTypeForEnemy(e)),d=createEnemySpriteComponent(n),p=createEnemyCollisionComponent(n.collisionRadius,n.damage),f=createEnemyAnimationComponent(),g=createEnemyEventComponent(),m={type:"position",x:t.x,y:t.y},y={type:"velocity",vx:0,vy:0},S={type:"transform",position:{x:t.x,y:t.y},scale:{x:1,y:1},rotation:0};return this.world.entityManager.addComponent(a.id,h),this.world.entityManager.addComponent(a.id,l),this.world.entityManager.addComponent(a.id,c),this.world.entityManager.addComponent(a.id,u),this.world.entityManager.addComponent(a.id,d),this.world.entityManager.addComponent(a.id,p),this.world.entityManager.addComponent(a.id,f),this.world.entityManager.addComponent(a.id,g),this.world.entityManager.addComponent(a.id,m),this.world.entityManager.addComponent(a.id,y),this.world.entityManager.addComponent(a.id,S),this.initializeEnemySprite(a.id,d,n),d.displayObject&&this.gameContainer.addChild(d.displayObject),this.eventBus.emit({type:"enemy:created",timestamp:Date.now(),data:{enemyId:a.id,enemyType:e,position:t,config:n}}),console.log(`EnemySystem: Created enemy ${o} (type ${e}) at ${t.x}, ${t.y}`),a.id}destroyEnemy(e){if(!this.world.entityManager.getEntity(e))return;const i=this.world.entityManager.getComponent(e,"enemy-sprite");i&&i.displayObject.parent&&i.displayObject.parent.removeChild(i.displayObject),this.eventBus.emit({type:"enemy:destroyed",timestamp:Date.now(),data:{enemyId:e,position:this.world.entityManager.getComponent(e,"position")}}),this.world.entityManager.destroyEntity(e),console.log(`EnemySystem: Destroyed enemy ${e}`)}generateEnemyId(){return++this.enemyIdCounter}getMovementTypeForEnemy(e){switch(e){case 0:case 6:return"hopping";default:return"basic"}}getBehaviorTypeForEnemy(e){return"aggressive"}initializeEnemySprite(e,t,i){try{const s=this.spriteManager.getEnemySprite(i.spriteKey);s?(t.visualSprite=s,t.spriteLoaded=!0,t.displayObject.addChild(s),this.eventBus.emit({type:"enemy:sprite-loaded",timestamp:Date.now(),data:{enemyId:e,spriteKey:i.spriteKey,success:!0}})):this.createFallbackSprite(e,t,i)}catch(s){console.warn(`EnemySystem: Failed to load sprite for enemy ${e}:`,s),this.createFallbackSprite(e,t,i)}}createFallbackSprite(e,t,i){const s=new me,n=i.color||16711680,a=i.size||32;s.beginFill(n),s.drawRect(-a/2,-a/2,a,a),s.endFill(),t.visualSprite=s,t.fallbackCreated=!0,t.displayObject.addChild(s),this.eventBus.emit({type:"enemy:fallback-sprite-created",timestamp:Date.now(),data:{enemyId:e,config:i,fallbackType:"rectangle"}})}updateEnemyHealth(e){const t=this.world.entityManager.query(this.enemyWithHealthQuery);for(const i of t){const s=this.world.entityManager.getComponent(i.id,"enemy-health"),n=this.world.entityManager.getComponent(i.id,"enemy");!s||!n||(s.healthPercent=s.health/s.maxHealth,s.isInvulnerable&&(s.invulnerabilityDuration-=e,s.invulnerabilityDuration<=0&&(s.isInvulnerable=!1,s.invulnerabilityDuration=0)),s.health<=0&&n.isAlive&&this.handleEnemyDeath(i.id))}}updateEnemyMovement(e){const t=this.world.entityManager.query(this.enemyWithMovementQuery);for(const i of t){const s=this.world.entityManager.getComponent(i.id,"enemy-movement"),n=this.world.entityManager.getComponent(i.id,"position"),a=this.world.entityManager.getComponent(i.id,"velocity");if(!s||!n||!a)continue;const o=s.targetX-n.x,h=s.targetY-n.y,l=Math.sqrt(o*o+h*h);if(l>0){const c=s.speed*(e/1e3);a.vx=o/l*c,a.vy=h/l*c,n.x+=a.vx,n.y+=a.vy}}}updateEnemyAI(e,t){const i=this.world.entityManager.query(this.enemyWithAIQuery);for(const s of i){const n=this.world.entityManager.getComponent(s.id,"enemy-ai"),a=this.world.entityManager.getComponent(s.id,"position");!n||!a||(n.stateTimer+=e,t-n.lastDecisionTime>n.decisionCooldown*1e3&&(this.updateEnemyAIDecision(s.id,n,a),n.lastDecisionTime=t))}}updateEnemySprites(e){const t=this.world.entityManager.query(this.enemyWithSpriteQuery);this.performanceMetrics.entitiesProcessed=t.length;for(const i of t){const s=this.world.entityManager.getComponent(i.id,"enemy-sprite"),n=this.world.entityManager.getComponent(i.id,"position");!s||!n||(s.displayObject.x=n.x,s.displayObject.y=n.y,s.displayObject.alpha=s.alpha,s.displayObject.visible=s.visible,s.flashTimer>0&&(s.flashTimer-=e,s.flashTimer<=0&&(s.flashTimer=0,s.visualSprite&&(s.visualSprite.tint=16777215))))}}updateEnemyAnimations(e){const t=this.world.entityManager.query(this.enemyWithAnimationQuery);for(const i of t){const s=this.world.entityManager.getComponent(i.id,"enemy-animation");s&&s.animationDuration>0&&(s.animationTimer+=e,s.animationTimer>=s.animationDuration&&s.animationLoop&&(s.animationTimer=0))}}updateEnemyCollision(e){const t=this.world.entityManager.query({with:["enemy","enemy-collision"],without:[]});for(const i of t){const s=this.world.entityManager.getComponent(i.id,"enemy-collision");s&&s.damageCooldown>0&&(s.damageCooldown-=e)}}cleanupDeadEnemies(){const e=this.world.entityManager.query(this.enemyQuery),t=[];for(const i of e){const s=this.world.entityManager.getComponent(i.id,"enemy");if(!s||!s.isAlive){const n=this.world.entityManager.getComponent(i.id,"enemy-health");n&&n.deathTime&&Date.now()-n.deathTime>1e3&&t.push(i.id)}}for(const i of t)this.destroyEnemy(i)}updateEnemyAIDecision(e,t,i){const s=this.world.entityManager.query({with:["player","position"],without:[]});if(s.length>0){const n=s[0],a=this.world.entityManager.getComponent(n.id,"position");if(a){const o=this.world.entityManager.getComponent(e,"enemy-movement");o&&(o.targetX=a.x,o.targetY=a.y),t.state!=="chasing"&&(t.state="chasing",t.lastStateChange=Date.now(),t.stateTimer=0)}}}handleEnemyDeath(e){const t=this.world.entityManager.getComponent(e,"enemy"),i=this.world.entityManager.getComponent(e,"enemy-health"),s=this.world.entityManager.getComponent(e,"position");!t||!i||!s||(t.isAlive=!1,i.deathTime=Date.now(),this.eventBus.emit({type:"enemy:died",timestamp:Date.now(),enemyId:e,enemyType:t.enemyType,name:t.name,xpAwarded:t.xpValue,position:{x:s.x,y:s.y},finalDamage:i.lastDamageAmount,totalDamageDealt:0,survivalTime:Date.now()-t.createdAt}))}handleCreateEnemyRequest(e){this.createEnemy(e.enemyType,e.position,e.customConfig)}handleDestroyEnemyRequest(e){this.destroyEnemy(e.enemyId)}handlePlayerMovement(e){const t=this.world.entityManager.query(this.enemyWithAIQuery);for(const i of t){const s=this.world.entityManager.getComponent(i.id,"enemy-movement");s&&(s.targetX=e.newPosition.x,s.targetY=e.newPosition.y)}}handleEnemyPlayerCollision(e){const t=this.world.entityManager.getComponent(e.enemyId,"enemy"),i=this.world.entityManager.getComponent(e.enemyId,"enemy-collision");if(t&&i&&i.canDealDamage){const s=Date.now();s-i.lastDamageDealtTime>i.damageCooldown&&(i.lastDamageDealtTime=s,this.eventBus.emit({type:"enemy:player-collision",timestamp:s,enemyId:e.enemyId,enemyType:t.enemyType,playerId:e.playerId,damageDealt:i.damageDealt,position:e.position}))}}handleEnemyProjectileCollision(e){const t=this.world.entityManager.getComponent(e.enemyId,"enemy-health"),i=this.world.entityManager.getComponent(e.enemyId,"enemy");if(t&&i){const s=e.damage||10;t.health-=s,t.lastDamageTime=Date.now(),t.lastDamageAmount=s,t.damageHistory.push({amount:s,time:Date.now(),source:"projectile"}),this.eventBus.emit({type:"enemy:damaged",timestamp:Date.now(),enemyId:e.enemyId,enemyType:i.enemyType,damage:s,remainingHealth:t.health,healthPercent:t.health/t.maxHealth,damageSource:"projectile",position:e.position});const n=this.world.entityManager.getComponent(e.enemyId,"enemy-sprite");n&&(n.flashColor=16711680,n.flashDuration=200,n.flashTimer=n.flashDuration)}}getEnemyCount(){return this.world.entityManager.query(this.enemyQuery).length}getEnemiesInRange(e,t){const i=this.world.entityManager.query(this.enemyQuery),s=[];for(const n of i){const a=this.world.entityManager.getComponent(n.id,"position");a&&Math.sqrt(Math.pow(a.x-e.x,2)+Math.pow(a.y-e.y,2))<=t&&s.push(n.id)}return s}}class Tg{type="collision-system";priority=10;world;eventBus;LAYERS={PLAYER:"player",ENEMY:"enemy",PROJECTILE:"projectile",EXPERIENCE_ORB:"experience-orb",TERRAIN:"terrain"};COLLISION_MASKS={[this.LAYERS.PLAYER]:[this.LAYERS.ENEMY,this.LAYERS.EXPERIENCE_ORB,this.LAYERS.TERRAIN],[this.LAYERS.ENEMY]:[this.LAYERS.PLAYER,this.LAYERS.PROJECTILE,this.LAYERS.TERRAIN],[this.LAYERS.PROJECTILE]:[this.LAYERS.ENEMY,this.LAYERS.TERRAIN],[this.LAYERS.EXPERIENCE_ORB]:[this.LAYERS.PLAYER],[this.LAYERS.TERRAIN]:[this.LAYERS.PLAYER,this.LAYERS.ENEMY,this.LAYERS.PROJECTILE]};playerQuery={with:["player","position","collision"],without:[]};enemyQuery={with:["enemy","position","enemy-collision"],without:[]};projectileQuery={with:["projectile","position","collision"],without:[]};experienceOrbQuery={with:["experience-orb","position","collision"],without:[]};spatialGrid=new Map;gridSize=64;gridBounds={minX:-1e3,maxX:1e3,minY:-1e3,maxY:1e3};performanceMetrics={entitiesProcessed:0,collisionChecks:0,collisionsDetected:0,updateTime:0,averageUpdateTime:0};initialized=!1;lastUpdate=0;constructor(e,t){this.world=e,this.eventBus=t}initialize(){this.initialized||(console.warn("CollisionSystem: Initializing..."),this.initialized=!0,this.lastUpdate=Date.now(),this.eventBus.on("entity:created",this.handleEntityCreated.bind(this)),this.eventBus.on("entity:destroyed",this.handleEntityDestroyed.bind(this)),this.eventBus.on("entity:moved",this.handleEntityMoved.bind(this)),console.warn("CollisionSystem: Initialized successfully"))}update(e){if(!this.initialized)return;const t=performance.now();this.updateSpatialGrid();const i=this.detectCollisions();this.resolveCollisions(i),this.emitCollisionEvents(i);const s=performance.now();this.performanceMetrics.updateTime=s-t,this.performanceMetrics.averageUpdateTime=this.performanceMetrics.averageUpdateTime*.9+this.performanceMetrics.updateTime*.1,this.lastUpdate=Date.now(),console.warn("CollisionSystem: Collisions processed")}shutdown(){this.initialized&&(console.warn("CollisionSystem: Shutting down..."),this.spatialGrid.clear(),this.eventBus.off("entity:created",this.handleEntityCreated.bind(this)),this.eventBus.off("entity:destroyed",this.handleEntityDestroyed.bind(this)),this.eventBus.off("entity:moved",this.handleEntityMoved.bind(this)),this.initialized=!1,console.warn("CollisionSystem: Shutdown complete"))}checkCollision(e,t){const i=this.world.entityManager.getComponent(e,"position"),s=this.world.entityManager.getComponent(t,"position"),n=this.getCollisionComponent(e),a=this.getCollisionComponent(t);return!i||!s||!n||!a?!1:this.circleCircleCollision(i,n,s,a)}getCollisionComponent(e){const t=this.world.entityManager.getComponent(e,"collision");if(t)return t;const i=this.world.entityManager.getComponent(e,"enemy-collision");return i||null}updateSpatialGrid(){this.spatialGrid.clear();const e=[...this.world.entityManager.query(this.playerQuery),...this.world.entityManager.query(this.enemyQuery),...this.world.entityManager.query(this.projectileQuery),...this.world.entityManager.query(this.experienceOrbQuery)];for(const t of e){const i=this.world.entityManager.getComponent(t.id,"position"),s=this.getCollisionComponent(t.id);if(!i||!s)continue;const n=this.getCollisionRadius(s),a=Math.floor((i.x-n)/this.gridSize),o=Math.floor((i.x+n)/this.gridSize),h=Math.floor((i.y-n)/this.gridSize),l=Math.floor((i.y+n)/this.gridSize);for(let c=a;c<=o;c++)for(let u=h;u<=l;u++){const d=`${c},${u}`;this.spatialGrid.has(d)||this.spatialGrid.set(d,[]),this.spatialGrid.get(d).push(t.id)}}}detectCollisions(){const e={collided:!1,pairs:[],events:[]};this.performanceMetrics.collisionChecks=0,this.performanceMetrics.collisionsDetected=0;for(const t of this.spatialGrid.values())if(!(t.length<2))for(let i=0;i<t.length;i++)for(let s=i+1;s<t.length;s++){const n=t[i],a=t[s];if(this.performanceMetrics.collisionChecks++,this.shouldCheckCollision(n,a)){const o=this.checkEntityCollision(n,a);o&&(e.pairs.push(o),e.collided=!0,this.performanceMetrics.collisionsDetected++)}}return e}shouldCheckCollision(e,t){const i=this.getEntityLayer(e),s=this.getEntityLayer(t);if(!i||!s)return!1;const n=this.COLLISION_MASKS[i],a=this.COLLISION_MASKS[s];return n.includes(s)||a.includes(i)}getEntityLayer(e){return this.world.entityManager.hasComponent(e,"player")?this.LAYERS.PLAYER:this.world.entityManager.hasComponent(e,"enemy")?this.LAYERS.ENEMY:this.world.entityManager.hasComponent(e,"projectile")?this.LAYERS.PROJECTILE:this.world.entityManager.hasComponent(e,"experience-orb")?this.LAYERS.EXPERIENCE_ORB:null}checkEntityCollision(e,t){const i=this.world.entityManager.getComponent(e,"position"),s=this.world.entityManager.getComponent(t,"position"),n=this.getCollisionComponent(e),a=this.getCollisionComponent(t);if(!i||!s||!n||!a)return null;const o=this.getCollisionRadius(n),h=this.getCollisionRadius(a),l=s.x-i.x,c=s.y-i.y,u=Math.sqrt(l*l+c*c),d=o+h;if(u<d){const p=d-u,f=u>0?{x:l/u,y:c/u}:{x:1,y:0};return{entityA:e,entityB:t,distance:u,overlap:p,normal:f}}return null}getCollisionRadius(e){if("collisionRadius"in e)return e.collisionRadius;const t=e.bounds;return Math.max(t.width,t.height)/2}circleCircleCollision(e,t,i,s){const n=this.getCollisionRadius(t),a=this.getCollisionRadius(s),o=i.x-e.x,h=i.y-e.y;return Math.sqrt(o*o+h*h)<n+a}resolveCollisions(e){for(const t of e.pairs)this.resolveCollisionPair(t)}resolveCollisionPair(e){const t=this.world.entityManager.getComponent(e.entityA,"position"),i=this.world.entityManager.getComponent(e.entityB,"position");if(!t||!i)return;const s=e.overlap*.5;t.x-=e.normal.x*s,t.y-=e.normal.y*s,i.x+=e.normal.x*s,i.y+=e.normal.y*s}emitCollisionEvents(e){for(const t of e.pairs){const i=this.getEntityLayer(t.entityA),s=this.getEntityLayer(t.entityB);if(!i||!s)continue;const n=this.getCollisionEventType(i,s);this.eventBus.emit({type:n,timestamp:Date.now(),data:{entityA:t.entityA,entityB:t.entityB,layerA:i,layerB:s,distance:t.distance,overlap:t.overlap,normal:t.normal}})}}getCollisionEventType(e,t){const i=[e,t].sort();return i.includes(this.LAYERS.PLAYER)&&i.includes(this.LAYERS.ENEMY)?"collision:player-enemy":i.includes(this.LAYERS.PROJECTILE)&&i.includes(this.LAYERS.ENEMY)?"collision:projectile-enemy":i.includes(this.LAYERS.PLAYER)&&i.includes(this.LAYERS.EXPERIENCE_ORB)?"collision:player-experience-orb":"collision:generic"}handleEntityCreated(e){}handleEntityDestroyed(e){}handleEntityMoved(e){}getPerformanceMetrics(){return{...this.performanceMetrics}}getSpatialGridStats(){return{gridCells:this.spatialGrid.size,totalEntities:Array.from(this.spatialGrid.values()).flat().length,averageEntitiesPerCell:this.spatialGrid.size>0?Array.from(this.spatialGrid.values()).flat().length/this.spatialGrid.size:0}}debugCollision(e){const t=this.world.entityManager.getComponent(e,"position"),i=this.getCollisionComponent(e),s=this.getEntityLayer(e);return!t||!i?null:{entityId:e,position:{x:t.x,y:t.y},radius:this.getCollisionRadius(i),layer:s,gridCell:`${Math.floor(t.x/this.gridSize)},${Math.floor(t.y/this.gridSize)}`}}}class Sg{audioContext=null;masterGain=null;sfxGain=null;musicGain=null;eventBus;audioBuffers=new Map;activeSounds=new Map;config={masterVolume:.7,sfxVolume:.8,musicVolume:.6,spatialAudio:!0,maxConcurrentSounds:32};performanceMetrics={soundsPlayed:0,soundsCached:0,activeSounds:0,loadTime:0,lastUpdate:0};SOUND_EFFECTS={player_move:{id:"player_move",url:"/audio/sfx/player_move.wav",volume:.3,loop:!1,category:"sfx"},player_attack:{id:"player_attack",url:"/audio/sfx/player_attack.wav",volume:.5,loop:!1,category:"sfx"},player_hurt:{id:"player_hurt",url:"/audio/sfx/player_hurt.wav",volume:.6,loop:!1,category:"sfx"},player_death:{id:"player_death",url:"/audio/sfx/player_death.wav",volume:.7,loop:!1,category:"sfx"},fireball_launch:{id:"fireball_launch",url:"/audio/sfx/fireball_launch.wav",volume:.4,loop:!1,category:"sfx"},fireball_hit:{id:"fireball_hit",url:"/audio/sfx/fireball_hit.wav",volume:.5,loop:!1,category:"sfx"},beam_charge:{id:"beam_charge",url:"/audio/sfx/beam_charge.wav",volume:.3,loop:!0,category:"sfx"},beam_fire:{id:"beam_fire",url:"/audio/sfx/beam_fire.wav",volume:.6,loop:!1,category:"sfx"},enemy_spawn:{id:"enemy_spawn",url:"/audio/sfx/enemy_spawn.wav",volume:.4,loop:!1,category:"sfx"},enemy_hurt:{id:"enemy_hurt",url:"/audio/sfx/enemy_hurt.wav",volume:.4,loop:!1,category:"sfx"},enemy_death:{id:"enemy_death",url:"/audio/sfx/enemy_death.wav",volume:.5,loop:!1,category:"sfx"},ui_click:{id:"ui_click",url:"/audio/sfx/ui_click.wav",volume:.3,loop:!1,category:"ui"},ui_hover:{id:"ui_hover",url:"/audio/sfx/ui_hover.wav",volume:.2,loop:!1,category:"ui"},level_up:{id:"level_up",url:"/audio/sfx/level_up.wav",volume:.6,loop:!1,category:"ui"},xp_pickup:{id:"xp_pickup",url:"/audio/sfx/xp_pickup.wav",volume:.4,loop:!1,category:"ui"},music_title:{id:"music_title",url:"/audio/music/title_theme.mp3",volume:.4,loop:!0,category:"music"},music_game:{id:"music_game",url:"/audio/music/game_theme.mp3",volume:.3,loop:!0,category:"music"},music_boss:{id:"music_boss",url:"/audio/music/boss_theme.mp3",volume:.4,loop:!0,category:"music"}};constructor(e){this.eventBus=e,this.setupEventListeners()}async initialize(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioContext.createGain(),this.sfxGain=this.audioContext.createGain(),this.musicGain=this.audioContext.createGain(),this.sfxGain.connect(this.masterGain),this.musicGain.connect(this.masterGain),this.masterGain.connect(this.audioContext.destination),this.updateVolumes(),await this.preloadEssentialSounds()}catch(e){throw console.error("❌ AudioManager: Failed to initialize:",e),e}}setupEventListeners(){this.eventBus.on("player:moved",()=>this.playSound("player_move")),this.eventBus.on("player:attacked",()=>this.playSound("player_attack")),this.eventBus.on("player:hurt",()=>this.playSound("player_hurt")),this.eventBus.on("player:died",()=>this.playSound("player_death")),this.eventBus.on("weapon:fireball_launched",()=>this.playSound("fireball_launch")),this.eventBus.on("weapon:fireball_hit",()=>this.playSound("fireball_hit")),this.eventBus.on("weapon:beam_charging",()=>this.playSound("beam_charge")),this.eventBus.on("weapon:beam_fired",()=>this.playSound("beam_fire")),this.eventBus.on("enemy:created",()=>this.playSound("enemy_spawn")),this.eventBus.on("enemy:hurt",()=>this.playSound("enemy_hurt")),this.eventBus.on("enemy:died",()=>this.playSound("enemy_death")),this.eventBus.on("ui:click",()=>this.playSound("ui_click")),this.eventBus.on("ui:hover",()=>this.playSound("ui_hover")),this.eventBus.on("player:level_up",()=>this.playSound("level_up")),this.eventBus.on("player:xp_gained",()=>this.playSound("xp_pickup")),this.eventBus.on("game:title_screen",()=>this.playMusic("music_title")),this.eventBus.on("game:started",()=>this.playMusic("music_game")),this.eventBus.on("game:boss_fight",()=>this.playMusic("music_boss"))}async preloadEssentialSounds(){const t=["ui_click","ui_hover","player_move","player_attack","enemy_death","xp_pickup"].map(i=>this.loadSound(i));await Promise.all(t)}async loadSound(e){const t=this.SOUND_EFFECTS[e];if(!t){console.warn(`🎵 AudioManager: Unknown sound ID: ${e}`);return}if(!this.audioBuffers.has(e))try{const i=await fetch(t.url);if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const s=await i.arrayBuffer(),n=await this.audioContext.decodeAudioData(s);this.audioBuffers.set(e,n),this.performanceMetrics.soundsCached++}catch(i){console.warn(`🎵 AudioManager: Failed to load sound ${e}, generating fallback:`,i),await this.generateFallbackSound(e,t)}}async generateFallbackSound(e,t){if(this.audioContext)try{const i=this.getFallbackFrequency(e),s=this.getFallbackDuration(e),n=this.audioContext.sampleRate,a=n*s,o=this.audioContext.createBuffer(1,a,n),h=o.getChannelData(0);for(let l=0;l<a;l++){const c=Math.min(1,l/(n*.01)),u=Math.min(1,(a-l)/(n*.01)),d=Math.min(c,u);h[l]=Math.sin(2*Math.PI*i*l/n)*.3*d}this.audioBuffers.set(e,o),this.performanceMetrics.soundsCached++,console.warn(`🎵 AudioManager: Generated fallback sound: ${e} (${i}Hz, ${s}s)`)}catch(i){console.error(`🎵 AudioManager: Failed to generate fallback sound ${e}:`,i)}}getFallbackFrequency(e){return{ui_click:800,ui_hover:600,level_up:1200,xp_pickup:1e3,player_move:400,player_attack:500,player_hurt:300,player_death:200,fireball_launch:600,fireball_hit:400,beam_charge:800,beam_fire:700,enemy_spawn:500,enemy_hurt:400,enemy_death:300}[e]||440}getFallbackDuration(e){return{ui_click:.1,ui_hover:.1,level_up:.3,xp_pickup:.2,player_move:.1,player_attack:.2,player_hurt:.3,player_death:.5,fireball_launch:.2,fireball_hit:.3,beam_charge:.4,beam_fire:.3,enemy_spawn:.2,enemy_hurt:.2,enemy_death:.3}[e]||.2}playSound(e,t){if(!this.audioContext||!this.masterGain){console.warn("🎵 AudioManager: Audio context not initialized");return}const i=this.SOUND_EFFECTS[e];if(!i){console.warn(`🎵 AudioManager: Unknown sound ID: ${e}`);return}const s=this.audioBuffers.get(e);if(!s){this.loadSound(e).then(()=>this.playSound(e,t));return}this.activeSounds.size>=this.config.maxConcurrentSounds&&this.stopOldestSound();try{const n=this.audioContext.createBufferSource();n.buffer=s,n.loop=t?.loop??i.loop;const a=this.audioContext.createGain(),o=(t?.volume??i.volume)*this.getCategoryVolume(i.category);if(a.gain.value=o,this.config.spatialAudio&&t?.position&&i.spatial){const l=this.audioContext.createPanner();l.setPosition(t.position.x,t.position.y,0),n.connect(l),l.connect(a)}else n.connect(a);const h=i.category==="music"?this.musicGain:this.sfxGain;a.connect(h),this.activeSounds.set(e,n),this.performanceMetrics.soundsPlayed++,n.onended=()=>{this.activeSounds.delete(e)},n.start(),console.log(`🎵 AudioManager: Playing sound: ${e}`)}catch(n){console.error(`🎵 AudioManager: Failed to play sound ${e}:`,n)}}playMusic(e){this.stopMusic(),this.playSound(e,{loop:!0})}stopMusic(){for(const[e,t]of this.activeSounds.entries())this.SOUND_EFFECTS[e]?.category==="music"&&(t.stop(),this.activeSounds.delete(e))}stopSound(e){const t=this.activeSounds.get(e);t&&(t.stop(),this.activeSounds.delete(e))}stopAllSounds(){for(const e of this.activeSounds.values())e.stop();this.activeSounds.clear()}stopOldestSound(){const e=this.activeSounds.keys().next().value;e&&this.stopSound(e)}getCategoryVolume(e){switch(e){case"sfx":return this.config.sfxVolume;case"music":return this.config.musicVolume;case"ui":return this.config.sfxVolume;default:return 1}}updateVolumes(){!this.masterGain||!this.sfxGain||!this.musicGain||(this.masterGain.gain.value=this.config.masterVolume,this.sfxGain.gain.value=this.config.sfxVolume,this.musicGain.gain.value=this.config.musicVolume)}setMasterVolume(e){this.config.masterVolume=Math.max(0,Math.min(1,e)),this.updateVolumes()}setSFXVolume(e){this.config.sfxVolume=Math.max(0,Math.min(1,e)),this.updateVolumes()}setMusicVolume(e){this.config.musicVolume=Math.max(0,Math.min(1,e)),this.updateVolumes()}setSpatialAudio(e){this.config.spatialAudio=e}getPerformanceMetrics(){return{...this.performanceMetrics}}getConfig(){return{...this.config}}destroy(){this.stopAllSounds(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.audioBuffers.clear(),this.activeSounds.clear(),console.log("🎵 AudioManager: Destroyed")}}class Eg{eventBus;options={autoSave:!0,maxAutoSaves:5,compression:!0,encryption:!1,cloudSync:!1};SAVE_VERSION="1.0.0";SAVE_KEY_PREFIX="momsters_save_";AUTO_SAVE_KEY="momsters_autosave";SETTINGS_KEY="momsters_settings";performanceMetrics={savesPerformed:0,loadsPerformed:0,lastSaveTime:0,lastLoadTime:0,totalSaveSize:0};constructor(e){this.eventBus=e,this.setupEventListeners()}setupEventListeners(){this.eventBus.on("player:level_up",()=>this.autoSave()),this.eventBus.on("player:xp_gained",()=>this.autoSave()),this.eventBus.on("game:wave_completed",()=>this.autoSave()),this.eventBus.on("game:paused",()=>this.autoSave()),this.eventBus.on("save:request",()=>this.saveGame()),this.eventBus.on("load:request",()=>this.loadGame())}async saveGame(e){try{const t=await this.collectGameData(),i=await this.createSaveMetadata(e);if(!this.validateSaveData(t))throw new Error("Invalid save data");const s=this.options.compression?await this.compressData(t):JSON.stringify(t),n=e?`${this.SAVE_KEY_PREFIX}${e}`:this.AUTO_SAVE_KEY;return localStorage.setItem(n,s),localStorage.setItem(`${n}_meta`,JSON.stringify(i)),this.performanceMetrics.savesPerformed++,this.performanceMetrics.lastSaveTime=Date.now(),this.performanceMetrics.totalSaveSize+=s.length,this.eventBus.emitEvent("save:completed"),i}catch{console.warn("Failed to save game data:")}}async loadGame(e){try{const t=e?`${this.SAVE_KEY_PREFIX}${e}`:this.AUTO_SAVE_KEY,i=localStorage.getItem(t);if(!i)throw new Error("No save data found");const s=this.options.compression?await this.decompressData(i):i,n=JSON.parse(s);if(!this.validateSaveData(n))throw new Error("Invalid save data format");const a=await this.migrateSaveData(n);return this.performanceMetrics.loadsPerformed++,this.performanceMetrics.lastLoadTime=Date.now(),this.eventBus.emitEvent("load:completed"),a}catch{console.warn("Failed to load game data:")}}async collectGameData(){return{version:this.SAVE_VERSION,timestamp:Date.now(),player:{level:1,experience:0,health:100,maxHealth:100,position:{x:0,y:0},weapons:[{type:"fireball",level:1,damage:10},{type:"beam",level:1,damage:15}]},gameState:{currentWave:1,enemiesKilled:0,timePlayed:0,score:0},settings:{masterVolume:.7,sfxVolume:.8,musicVolume:.6,spatialAudio:!0,graphicsQuality:"medium"},achievements:[]}}async createSaveMetadata(e){const t=e||`autosave_${Date.now()}`,i=e||`Auto Save ${new Date().toLocaleString()}`;return{id:t,name:i,timestamp:Date.now(),version:this.SAVE_VERSION,size:0,checksum:""}}validateSaveData(e){return!1}async compressData(e){return`COMPRESSED:${JSON.stringify(e).replace(/\s+/g,"")}`}async decompressData(e){return e.startsWith("COMPRESSED:")?e.substring(11):e}async migrateSaveData(e){return e.version!==this.SAVE_VERSION&&(e.version=this.SAVE_VERSION),e}async autoSave(){!this.options.autoSave||Date.now()-this.performanceMetrics.lastSaveTime<3e4||await this.saveGame()}async listSaves(){const e=[];for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);if(i?.startsWith(this.SAVE_KEY_PREFIX)&&i.endsWith("_meta"))try{const s=JSON.parse(localStorage.getItem(i));e.push(s)}catch{console.warn(`SaveManager: Invalid metadata for key ${i}`)}}return e.sort((t,i)=>i.timestamp-t.timestamp)}async deleteSave(e){try{const t=`${this.SAVE_KEY_PREFIX}${e}`;return localStorage.removeItem(t),localStorage.removeItem(`${t}_meta`),this.eventBus.emitEvent("save:deleted"),!0}catch{return console.warn("Failed to delete save data:"),!1}}async exportSave(e){try{const t=`${this.SAVE_KEY_PREFIX}${e}`,i=localStorage.getItem(t),s=localStorage.getItem(`${t}_meta`);if(!i||!s)throw new Error("Save not found");const n={saveData:i,metadata:JSON.parse(s),exportTimestamp:Date.now()};return JSON.stringify(n)}catch{return console.error("❌ SaveManager: Failed to export save:"),null}}async importSave(e){try{const t=JSON.parse(e),{saveData:i,metadata:s}=t;if(!i||!s)throw new Error("Invalid export data");const n=`${this.SAVE_KEY_PREFIX}${s.name}`;return localStorage.setItem(n,i),localStorage.setItem(`${n}_meta`,JSON.stringify(s)),this.eventBus.emitEvent("save:imported"),!0}catch{return console.error("❌ SaveManager: Failed to import save:"),!1}}saveSettings(e){try{localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(e))}catch{console.error("❌ SaveManager: Failed to save settings:")}}loadSettings(){try{const e=localStorage.getItem(this.SETTINGS_KEY);return e?JSON.parse(e):null}catch{return console.error("❌ SaveManager: Failed to load settings:"),null}}getPerformanceMetrics(){return{saveCount:this.performanceMetrics.savesPerformed,loadCount:this.performanceMetrics.loadsPerformed,lastSaveTime:this.performanceMetrics.lastSaveTime,lastLoadTime:this.performanceMetrics.lastLoadTime,totalSaveTime:this.performanceMetrics.lastSaveTime-this.performanceMetrics.lastSaveTime,totalLoadTime:this.performanceMetrics.lastLoadTime-this.performanceMetrics.lastLoadTime,averageSaveTime:this.performanceMetrics.lastSaveTime/this.performanceMetrics.savesPerformed,averageLoadTime:this.performanceMetrics.lastLoadTime/this.performanceMetrics.loadsPerformed}}getOptions(){return{...this.options}}setOptions(e){this.options={...this.options,...e}}clearAllSaves(){const e=[];for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);i?.startsWith(this.SAVE_KEY_PREFIX)&&e.push(i)}e.forEach(t=>localStorage.removeItem(t))}}class Ag{eventBus;config;frameCount=0;lastFrameTime=0;frameTimes=[];fpsHistory=[];memoryHistory=[];renderStartTime=0;updateStartTime=0;renderTime=0;updateTime=0;minFps=1/0;maxFps=0;avgFps=0;minFrameTime=1/0;maxFrameTime=0;avgFrameTime=0;issues=[];recommendations=[];animationId=null;isMonitoring=!1;constructor(e){this.eventBus=e,this.config={enabled:!0,sampleSize:60,updateInterval:1e3,autoOptimize:!1,thresholds:{fps:{warning:45,critical:30},frameTime:{warning:22,critical:33},memoryUsage:{warning:100,critical:200},cpuUsage:{warning:80,critical:95}}},this.setupEventListeners()}setupEventListeners(){this.eventBus.on("performance:start_monitoring",()=>this.start()),this.eventBus.on("performance:stop_monitoring",()=>this.stop()),this.eventBus.on("performance:get_report",()=>this.generateReport()),this.eventBus.on("game:entity_created",()=>this.onEntityCountChanged()),this.eventBus.on("game:entity_destroyed",()=>this.onEntityCountChanged()),this.eventBus.on("render:draw_call",()=>this.onDrawCall())}start(){this.isMonitoring||!this.config.enabled||(this.isMonitoring=!0,this.lastFrameTime=performance.now(),this.animationId=requestAnimationFrame(this.update.bind(this)))}stop(){this.isMonitoring&&(this.isMonitoring=!1,this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null))}update(e){if(!this.isMonitoring)return;const t=e-this.lastFrameTime;this.lastFrameTime=e,this.frameTimes.push(t),this.frameTimes.length>this.config.sampleSize&&this.frameTimes.shift();const i=1e3/t;this.fpsHistory.push(i),this.fpsHistory.length>this.config.sampleSize&&this.fpsHistory.shift(),this.updateStatistics(),this.checkPerformanceIssues(),this.config.autoOptimize&&this.autoOptimize(),this.animationId=requestAnimationFrame(this.update.bind(this))}updateStatistics(){this.fpsHistory.length!==0&&(this.minFps=Math.min(this.minFps,...this.fpsHistory),this.maxFps=Math.max(this.maxFps,...this.fpsHistory),this.avgFps=this.fpsHistory.reduce((e,t)=>e+t,0)/this.fpsHistory.length,this.frameTimes.length>0&&(this.minFrameTime=Math.min(this.minFrameTime,...this.frameTimes),this.maxFrameTime=Math.max(this.maxFrameTime,...this.frameTimes),this.avgFrameTime=this.frameTimes.reduce((e,t)=>e+t,0)/this.frameTimes.length))}checkPerformanceIssues(){this.issues=[],this.recommendations=[],this.avgFps<this.config.thresholds.fps.critical?(this.issues.push(`Critical: FPS is ${this.avgFps.toFixed(1)} (below ${this.config.thresholds.fps.critical})`),this.recommendations.push("Reduce graphics quality or entity count")):this.avgFps<this.config.thresholds.fps.warning&&(this.issues.push(`Warning: FPS is ${this.avgFps.toFixed(1)} (below ${this.config.thresholds.fps.warning})`),this.recommendations.push("Consider reducing graphics settings")),this.avgFrameTime>this.config.thresholds.frameTime.critical?(this.issues.push(`Critical: Frame time is ${this.avgFrameTime.toFixed(1)}ms (above ${this.config.thresholds.frameTime.critical}ms)`),this.recommendations.push("Optimize rendering pipeline")):this.avgFrameTime>this.config.thresholds.frameTime.warning&&(this.issues.push(`Warning: Frame time is ${this.avgFrameTime.toFixed(1)}ms (above ${this.config.thresholds.frameTime.warning}ms)`),this.recommendations.push("Check for expensive operations in render loop"));const e=this.getMemoryUsage();e>this.config.thresholds.memoryUsage.critical?(this.issues.push(`Critical: Memory usage is ${e.toFixed(1)}MB (above ${this.config.thresholds.memoryUsage.critical}MB)`),this.recommendations.push("Clear unused assets and textures")):e>this.config.thresholds.memoryUsage.warning&&(this.issues.push(`Warning: Memory usage is ${e.toFixed(1)}MB (above ${this.config.thresholds.memoryUsage.warning}MB)`),this.recommendations.push("Monitor memory usage and clean up resources")),this.issues.length>0&&this.eventBus.emitEvent("performance:issues_detected",{issues:this.issues})}autoOptimize(){this.avgFps<this.config.thresholds.fps.critical&&(this.eventBus.emitEvent("performance:reduce_graphics_quality"),this.eventBus.emitEvent("performance:reduce_entity_count"),this.eventBus.emitEvent("performance:reduce_draw_distance"))}startRenderTimer(){this.renderStartTime=performance.now()}endRenderTimer(){this.renderTime=performance.now()-this.renderStartTime}startUpdateTimer(){this.updateStartTime=performance.now()}endUpdateTimer(){this.updateTime=performance.now()-this.updateStartTime}onEntityCountChanged(){}onDrawCall(){}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize/(1024*1024):0}getCpuUsage(){return Math.min(100,this.avgFrameTime/16.666666666666668*100)}getCurrentMetrics(){return{fps:this.avgFps,frameTime:this.avgFrameTime,memoryUsage:this.getMemoryUsage(),cpuUsage:this.getCpuUsage(),renderTime:this.renderTime,updateTime:this.updateTime,entities:0,drawCalls:0,triangles:0,textures:0}}generateReport(){const e=this.getCurrentMetrics(),t=this.calculatePerformanceScore(e),i={timestamp:Date.now(),metrics:e,issues:[...this.issues],recommendations:[...this.recommendations],score:t};return this.eventBus.emitEvent("performance:report_generated",{report:i}),i}calculatePerformanceScore(e){let t=100;const i=Math.min(100,e.fps/60*100);t-=(100-i)*.4;const s=Math.max(0,100-e.frameTime/16.67*100);t-=(100-s)*.3;const n=Math.max(0,100-e.memoryUsage/100*100);t-=(100-n)*.2;const a=Math.max(0,100-e.cpuUsage);return t-=(100-a)*.1,Math.max(0,Math.min(100,t))}getConfig(){return{...this.config}}setConfig(e){this.config={...this.config,...e}}getStatistics(){return{minFps:this.minFps,maxFps:this.maxFps,avgFps:this.avgFps,minFrameTime:this.minFrameTime,maxFrameTime:this.maxFrameTime,avgFrameTime:this.avgFrameTime,frameCount:this.frameCount,sampleSize:this.config.sampleSize}}resetStatistics(){this.frameCount=0,this.frameTimes=[],this.fpsHistory=[],this.memoryHistory=[],this.minFps=1/0,this.maxFps=0,this.avgFps=0,this.minFrameTime=1/0,this.maxFrameTime=0,this.avgFrameTime=0,this.issues=[],this.recommendations=[]}destroy(){this.stop(),this.resetStatistics()}}class Cg{container;background;title;tabs=[];currentTab="audio";settingsData;onSettingsChange;onClose;screenWidth;screenHeight;constructor(e,t,i){this.container=new ve,this.screenWidth=e,this.screenHeight=t,this.settingsData={...i},this.createMenu()}createMenu(){this.background=new me,this.background.beginFill(0,.8),this.background.drawRect(0,0,this.screenWidth,this.screenHeight),this.background.endFill(),this.container.addChild(this.background);const e=new fe({fontFamily:"Arial",fontSize:32,fill:16777215,fontWeight:"bold"});this.title=new he("Settings",e),this.title.x=this.screenWidth/2-this.title.width/2,this.title.y=50,this.container.addChild(this.title),this.createTabs(),this.createAudioTab(),this.createGraphicsTab(),this.createControlsTab(),this.createGameplayTab(),this.createButtons(),this.showTab("audio")}createTabs(){const e=["Audio","Graphics","Controls","Gameplay"],t=new fe({fontFamily:"Arial",fontSize:18,fill:13421772,fontWeight:"bold"});e.forEach((i,s)=>{const n=new he(i,t);n.x=100+s*150,n.y=120,n.eventMode="static",n.cursor="pointer",n.on("pointerdown",()=>{this.showTab(i.toLowerCase())}),n.on("pointerover",()=>{n.tint=16777215}),n.on("pointerout",()=>{this.currentTab!==i.toLowerCase()&&(n.tint=13421772)}),this.tabs.push(n),this.container.addChild(n)})}createAudioTab(){const e=new ve;e.name="audio-tab",e.x=100,e.y=160;const t=new fe({fontFamily:"Arial",fontSize:16,fill:16777215}),i=new he("Master Volume",t);i.y=0,e.addChild(i);const s=this.createSlider(200,30,this.settingsData.audio.masterVolume,c=>{this.settingsData.audio.masterVolume=c,this.onSettingsChange?.(this.settingsData)});s.y=25,e.addChild(s);const n=new he("SFX Volume",t);n.y=70,e.addChild(n);const a=this.createSlider(200,30,this.settingsData.audio.sfxVolume,c=>{this.settingsData.audio.sfxVolume=c,this.onSettingsChange?.(this.settingsData)});a.y=95,e.addChild(a);const o=new he("Music Volume",t);o.y=140,e.addChild(o);const h=this.createSlider(200,30,this.settingsData.audio.musicVolume,c=>{this.settingsData.audio.musicVolume=c,this.onSettingsChange?.(this.settingsData)});h.y=165,e.addChild(h);const l=this.createToggle("Mute Audio",this.settingsData.audio.muted,c=>{this.settingsData.audio.muted=c,this.onSettingsChange?.(this.settingsData)});l.y=220,e.addChild(l),this.container.addChild(e)}createGraphicsTab(){const e=new ve;e.name="graphics-tab",e.x=100,e.y=160,e.visible=!1;const t=new fe({fontFamily:"Arial",fontSize:16,fill:16777215}),i=new he("Particle Quality",t);i.y=0,e.addChild(i);const s=this.createDropdown(["Low","Medium","High"],this.settingsData.graphics.particleQuality,h=>{this.settingsData.graphics.particleQuality=h,this.onSettingsChange?.(this.settingsData)});s.y=25,e.addChild(s);const n=this.createToggle("Screen Shake",this.settingsData.graphics.screenShake,h=>{this.settingsData.graphics.screenShake=h,this.onSettingsChange?.(this.settingsData)});n.y=70,e.addChild(n);const a=this.createToggle("Show FPS",this.settingsData.graphics.showFPS,h=>{this.settingsData.graphics.showFPS=h,this.onSettingsChange?.(this.settingsData)});a.y=120,e.addChild(a);const o=this.createToggle("V-Sync",this.settingsData.graphics.vsync,h=>{this.settingsData.graphics.vsync=h,this.onSettingsChange?.(this.settingsData)});o.y=170,e.addChild(o),this.container.addChild(e)}createControlsTab(){const e=new ve;e.name="controls-tab",e.x=100,e.y=160,e.visible=!1;const t=new fe({fontFamily:"Arial",fontSize:16,fill:16777215}),i=new he("Mouse Sensitivity",t);i.y=0,e.addChild(i);const s=this.createSlider(200,30,this.settingsData.controls.mouseSensitivity,h=>{this.settingsData.controls.mouseSensitivity=h,this.onSettingsChange?.(this.settingsData)});s.y=25,e.addChild(s);const n=new he("Keyboard Layout",t);n.y=70,e.addChild(n);const a=this.createDropdown(["QWERTY","AZERTY","Custom"],this.settingsData.controls.keyboardLayout,h=>{this.settingsData.controls.keyboardLayout=h,this.onSettingsChange?.(this.settingsData)});a.y=95,e.addChild(a);const o=this.createToggle("Invert Y-Axis",this.settingsData.controls.invertY,h=>{this.settingsData.controls.invertY=h,this.onSettingsChange?.(this.settingsData)});o.y=140,e.addChild(o),this.container.addChild(e)}createGameplayTab(){const e=new ve;e.name="gameplay-tab",e.x=100,e.y=160,e.visible=!1;const t=new fe({fontFamily:"Arial",fontSize:16,fill:16777215}),i=this.createToggle("Auto Save",this.settingsData.gameplay.autoSave,o=>{this.settingsData.gameplay.autoSave=o,this.onSettingsChange?.(this.settingsData)});i.y=0,e.addChild(i);const s=new he("Difficulty",t);s.y=50,e.addChild(s);const n=this.createDropdown(["Easy","Normal","Hard"],this.settingsData.gameplay.difficulty,o=>{this.settingsData.gameplay.difficulty=o,this.onSettingsChange?.(this.settingsData)});n.y=75,e.addChild(n);const a=this.createToggle("Tutorial Enabled",this.settingsData.gameplay.tutorialEnabled,o=>{this.settingsData.gameplay.tutorialEnabled=o,this.onSettingsChange?.(this.settingsData)});a.y=120,e.addChild(a),this.container.addChild(e)}createSlider(e,t,i,s){const n=new ve,a=new me;a.beginFill(3355443),a.drawRoundedRect(0,0,e,t,5),a.endFill(),n.addChild(a);const o=new me;o.beginFill(31436),o.drawRoundedRect(0,0,e*i,t,5),o.endFill(),n.addChild(o);const h=new me;h.beginFill(16777215),h.drawCircle(0,t/2,8),h.endFill(),h.x=e*i,n.addChild(h);const l=new he(`${Math.round(i*100)}%`,{fontFamily:"Arial",fontSize:12,fill:16777215});l.x=e+10,l.y=t/2-l.height/2,n.addChild(l),a.eventMode="static",a.cursor="pointer";const c=u=>{const d=u.data.getLocalPosition(n).x,p=Math.max(0,Math.min(1,d/e));o.clear(),o.beginFill(31436),o.drawRoundedRect(0,0,e*p,t,5),o.endFill(),h.x=e*p,l.text=`${Math.round(p*100)}%`,s(p)};return a.on("pointerdown",c),a.on("pointermove",u=>{u.buttons===1&&c(u)}),n}createToggle(e,t,i){const s=new ve,n=new he(e,{fontFamily:"Arial",fontSize:16,fill:16777215});s.addChild(n);const a=new me;a.beginFill(t?65280:6710886),a.drawRoundedRect(0,0,40,20,10),a.endFill(),a.x=n.width+20,a.y=n.height/2-10,s.addChild(a);const o=new me;return o.beginFill(16777215),o.drawCircle(0,0,8),o.endFill(),o.x=t?30:10,o.y=a.y+10,s.addChild(o),a.eventMode="static",a.cursor="pointer",a.on("pointerdown",()=>{const h=!t;a.clear(),a.beginFill(h?65280:6710886),a.drawRoundedRect(0,0,40,20,10),a.endFill(),o.x=h?30:10,i(h)}),s}createDropdown(e,t,i){const s=new ve,n=new me;n.beginFill(3355443),n.drawRoundedRect(0,0,150,30,5),n.endFill(),n.lineStyle(1,6710886),n.drawRoundedRect(0,0,150,30,5),s.addChild(n);const a=new he(t,{fontFamily:"Arial",fontSize:14,fill:16777215});a.x=10,a.y=15-a.height/2,s.addChild(a);const o=new he("▼",{fontFamily:"Arial",fontSize:12,fill:16777215});o.x=130,o.y=15-o.height/2,s.addChild(o);let h=!1,l=null;return n.eventMode="static",n.cursor="pointer",n.on("pointerdown",()=>{h?(l&&(s.removeChild(l),l.destroy(),l=null),h=!1,o.text="▼"):(l=new ve,l.x=0,l.y=35,e.forEach((c,u)=>{const d=new me;d.beginFill(2236962),d.drawRoundedRect(0,0,150,25,3),d.endFill(),d.y=u*25,l.addChild(d);const p=new he(c,{fontFamily:"Arial",fontSize:12,fill:16777215});p.x=10,p.y=u*25+12-p.height/2,l.addChild(p),d.eventMode="static",d.cursor="pointer",d.on("pointerdown",()=>{a.text=c,i(c),s.removeChild(l),l.destroy(),l=null,h=!1,o.text="▼"}),d.on("pointerover",()=>{d.clear(),d.beginFill(4473924),d.drawRoundedRect(0,0,150,25,3),d.endFill()}),d.on("pointerout",()=>{d.clear(),d.beginFill(2236962),d.drawRoundedRect(0,0,150,25,3),d.endFill()})}),s.addChild(l),h=!0,o.text="▲")}),s}createButtons(){const e=new me;e.beginFill(43520),e.drawRoundedRect(0,0,100,40,8),e.endFill(),e.x=this.screenWidth/2-120,e.y=this.screenHeight-100,e.eventMode="static",e.cursor="pointer",e.on("pointerdown",()=>{this.onSettingsChange?.(this.settingsData)}),this.container.addChild(e);const t=new he("Save",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold"});t.x=e.x+50-t.width/2,t.y=e.y+20-t.height/2,this.container.addChild(t);const i=new me;i.beginFill(11141120),i.drawRoundedRect(0,0,100,40,8),i.endFill(),i.x=this.screenWidth/2+20,i.y=this.screenHeight-100,i.eventMode="static",i.cursor="pointer",i.on("pointerdown",()=>{this.onClose?.()}),this.container.addChild(i);const s=new he("Close",{fontFamily:"Arial",fontSize:16,fill:16777215,fontWeight:"bold"});s.x=i.x+50-s.width/2,s.y=i.y+20-s.height/2,this.container.addChild(s)}showTab(e){this.container.children.forEach(i=>{i.name&&i.name.endsWith("-tab")&&(i.visible=!1)});const t=this.container.getChildByName(`${e}-tab`);t&&(t.visible=!0),this.tabs.forEach((i,s)=>{["audio","graphics","controls","gameplay"][s]===e?i.tint=16777215:i.tint=13421772}),this.currentTab=e}setSettingsChangeCallback(e){this.onSettingsChange=e}setCloseCallback(e){this.onClose=e}show(){this.container.visible=!0}hide(){this.container.visible=!1}getContainer(){return this.container}getSettings(){return{...this.settingsData}}updateSettings(e){this.settingsData={...e}}handleKeyDown=e=>{}}class Mg{container;background;title;buttons=[];buttonTexts=[];onResume;onSettings;onQuit;screenWidth;screenHeight;constructor(e,t){this.container=new ve,this.screenWidth=e,this.screenHeight=t,this.createPauseScreen()}createPauseScreen(){this.background=new me,this.background.beginFill(0,.7),this.background.drawRect(0,0,this.screenWidth,this.screenHeight),this.background.endFill(),this.container.addChild(this.background);const e=new fe({fontFamily:"Arial",fontSize:48,fill:16777215,fontWeight:"bold"});this.title=new he("PAUSED",e),this.title.x=this.screenWidth/2-this.title.width/2,this.title.y=this.screenHeight/2-150,this.container.addChild(this.title),this.createButton("Resume",this.screenHeight/2-50,()=>this.onResume?.()),this.createButton("Settings",this.screenHeight/2+20,()=>this.onSettings?.()),this.createButton("Quit to Menu",this.screenHeight/2+90,()=>this.onQuit?.()),this.container.visible=!1}createButton(e,t,i){const s=new me;s.beginFill(3355443,.8),s.drawRoundedRect(0,0,200,50,10),s.endFill(),s.lineStyle(2,6710886),s.drawRoundedRect(0,0,200,50,10),s.x=this.screenWidth/2-100,s.y=t,s.eventMode="static",s.cursor="pointer",s.on("pointerdown",i),s.on("pointerover",()=>{s.clear(),s.beginFill(5592405,.8),s.drawRoundedRect(0,0,200,50,10),s.endFill(),s.lineStyle(2,8947848),s.drawRoundedRect(0,0,200,50,10)}),s.on("pointerout",()=>{s.clear(),s.beginFill(3355443,.8),s.drawRoundedRect(0,0,200,50,10),s.endFill(),s.lineStyle(2,6710886),s.drawRoundedRect(0,0,200,50,10)}),this.container.addChild(s),this.buttons.push(s);const n=new he(e,{fontFamily:"Arial",fontSize:18,fill:16777215,fontWeight:"bold"});n.x=this.screenWidth/2-n.width/2,n.y=t+25-n.height/2,this.container.addChild(n),this.buttonTexts.push(n)}setResumeCallback(e){this.onResume=e}setSettingsCallback(e){this.onSettings=e}setQuitCallback(e){this.onQuit=e}show(){this.container.visible=!0}hide(){this.container.visible=!1}getContainer(){return this.container}}class Rg{sprite;x;y;velocityX;velocityY;life;maxLife;size;color;alpha;gravity;friction;rotation;rotationSpeed;scale;scaleSpeed;active=!1;constructor(){this.sprite=new me,this.x=0,this.y=0,this.velocityX=0,this.velocityY=0,this.life=0,this.maxLife=0,this.size=1,this.color=16777215,this.alpha=1,this.gravity=0,this.friction=1,this.rotation=0,this.rotationSpeed=0,this.scale=1,this.scaleSpeed=0}init(e){this.x=e.x,this.y=e.y,this.velocityX=e.velocityX,this.velocityY=e.velocityY,this.life=e.life,this.maxLife=e.maxLife,this.size=e.size,this.color=e.color,this.alpha=e.alpha,this.gravity=e.gravity||0,this.friction=e.friction||1,this.rotation=e.rotation||0,this.rotationSpeed=e.rotationSpeed||0,this.scale=e.scale||1,this.scaleSpeed=e.scaleSpeed||0,this.active=!0,this.updateSprite()}update(e){if(this.active){if(this.life-=e,this.life<=0){this.active=!1;return}this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.velocityY+=this.gravity*e,this.velocityX*=this.friction,this.velocityY*=this.friction,this.rotation+=this.rotationSpeed*e,this.scale+=this.scaleSpeed*e,this.updateSprite()}}updateSprite(){if(this.sprite instanceof me){const e=this.sprite;e.clear();const t=this.life/this.maxLife,i=this.alpha*t;e.beginFill(this.color,i),e.drawCircle(0,0,this.size*this.scale),e.endFill(),e.x=this.x,e.y=this.y,e.rotation=this.rotation}else{const e=this.sprite,t=this.life/this.maxLife;e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.scale.set(this.scale),e.alpha=this.alpha*t}}reset(){this.active=!1,this.sprite.visible=!1}}class Pg{x;y;particleCount;particleConfig;duration;burst;spread;speed;size;color;alpha;gravity;friction;texture;timer=0;active=!0;particlesEmitted=0;constructor(e){this.x=e.x,this.y=e.y,this.particleCount=e.particleCount,this.particleConfig=e.particleConfig,this.duration=e.duration||1,this.burst=e.burst||!1,this.spread=e.spread||Math.PI*2,this.speed=e.speed||100,this.size=e.size||5,this.color=e.color||16777215,this.alpha=e.alpha||1,this.gravity=e.gravity||0,this.friction=e.friction||.98,this.texture=e.texture}update(e,t){if(this.active)if(this.timer+=e,this.burst){for(let i=0;i<this.particleCount;i++)this.emitParticle(t);this.active=!1}else{const s=this.particleCount/this.duration*e;for(let n=0;n<s;n++)this.particlesEmitted<this.particleCount&&(this.emitParticle(t),this.particlesEmitted++);this.timer>=this.duration&&(this.active=!1)}}emitParticle(e){const t=Math.random()*this.spread,i=this.speed*(.5+Math.random()*.5),s={x:this.x+(Math.random()-.5)*10,y:this.y+(Math.random()-.5)*10,velocityX:Math.cos(t)*i,velocityY:Math.sin(t)*i,life:1+Math.random()*2,maxLife:1+Math.random()*2,size:this.size*(.5+Math.random()*.5),color:this.color,alpha:this.alpha,gravity:this.gravity,friction:this.friction,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*10,scale:1,scaleSpeed:-.5,texture:this.texture,...this.particleConfig};e.emitParticle(s)}isActive(){return this.active}}class Ig{container;particles=[];emitters=[];particlePool=[];maxParticles;quality;constructor(e,t=1e3,i="medium"){this.container=new ve,this.maxParticles=t,this.quality=i,e.stage.addChild(this.container),this.initializeParticlePool()}initializeParticlePool(){for(let e=0;e<this.maxParticles;e++){const t=new Rg;this.particlePool.push(t),this.container.addChild(t.sprite)}}getParticleFromPool(){for(const e of this.particlePool)if(!e.active)return e;return null}emitParticle(e){const t=this.getParticleFromPool();t&&(t.init(e),t.sprite.visible=!0)}createEmitter(e){const t=new Pg(e);return this.emitters.push(t),t}createExplosion(e,t,i=1){const s={x:e,y:t,particleCount:Math.floor(20*i),burst:!0,spread:Math.PI*2,speed:150*i,size:3*i,color:16737792,alpha:.8,gravity:200,friction:.95,particleConfig:{life:.5+Math.random()*1,scaleSpeed:-1,rotationSpeed:(Math.random()-.5)*20}};this.createEmitter(s)}createSparkle(e,t,i=16776960){const s={x:e,y:t,particleCount:5,burst:!0,spread:Math.PI*2,speed:50,size:2,color:i,alpha:1,gravity:-50,friction:.9,particleConfig:{life:1+Math.random()*1,scaleSpeed:-.5,rotationSpeed:(Math.random()-.5)*10}};this.createEmitter(s)}createTrail(e,t,i=65535){const s={x:e,y:t,particleCount:1,burst:!0,speed:0,size:2,color:i,alpha:.6,gravity:0,friction:.9,particleConfig:{life:.3,scaleSpeed:-2,alpha:.6}};this.createEmitter(s)}createMagicEffect(e,t){const i={x:e,y:t,particleCount:15,burst:!0,spread:Math.PI*2,speed:80,size:3,color:10040319,alpha:.8,gravity:0,friction:.95,particleConfig:{life:1.5+Math.random()*1,scaleSpeed:-.3,rotationSpeed:(Math.random()-.5)*15}};this.createEmitter(i)}update(e){for(const t of this.particlePool)t.active&&t.update(e);this.emitters=this.emitters.filter(t=>(t.update(e,this),t.isActive()));for(const t of this.particlePool)!t.active&&t.sprite.visible&&t.reset()}setQuality(e){switch(this.quality=e,e){case"low":this.maxParticles=500;break;case"medium":this.maxParticles=1e3;break;case"high":this.maxParticles=2e3;break}}clear(){for(const e of this.particlePool)e.reset();this.emitters=[]}getParticleCount(){return this.particlePool.filter(e=>e.active).length}getEmitterCount(){return this.emitters.length}getContainer(){return this.container}}class Tt{}class Gt extends Tt{children;constructor(e){super(),this.children=e}execute(e,t){for(const i of this.children){const s=i.execute(e,t);if(s!==0)return s}return 0}}class gs extends Tt{children;constructor(e){super(),this.children=e}execute(e,t){for(const i of this.children){const s=i.execute(e,t);if(s!==1)return s}return 1}}class zh extends Tt{speed;tolerance;constructor(e=100,t=10){super(),this.speed=e,this.tolerance=t}execute(e,t){if(!e.target)return 1;const i=e.target.x-e.sprite.x,s=e.target.y-e.sprite.y;if(Math.sqrt(i*i+s*s)<=this.tolerance)return 0;const a=Math.atan2(s,i),o=Math.cos(a)*this.speed*t,h=Math.sin(a)*this.speed*t;return e.sprite.x+=o,e.sprite.y+=h,2}}class ys extends Tt{attackRange;attackCooldown;lastAttackTime=0;constructor(e=50,t=1){super(),this.attackRange=e,this.attackCooldown=t}execute(e,t){if(!e.target)return 1;const i=e.target.x-e.sprite.x,s=e.target.y-e.sprite.y;if(Math.sqrt(i*i+s*s)>this.attackRange)return 1;const a=Date.now()/1e3;return a-this.lastAttackTime<this.attackCooldown?2:(this.lastAttackTime=a,e.attack(),0)}}class Rn extends Tt{speed;fleeDistance;constructor(e=120,t=200){super(),this.speed=e,this.fleeDistance=t}execute(e,t){if(!e.target)return 1;const i=e.target.x-e.sprite.x,s=e.target.y-e.sprite.y;if(Math.sqrt(i*i+s*s)>=this.fleeDistance)return 0;const a=Math.atan2(s,i)+Math.PI,o=Math.cos(a)*this.speed*t,h=Math.sin(a)*this.speed*t;return e.sprite.x+=o,e.sprite.y+=h,2}}class Bg extends Tt{patrolPoints;currentPoint=0;speed;tolerance;constructor(e,t=80,i=10){super(),this.patrolPoints=e,this.speed=t,this.tolerance=i}execute(e,t){if(this.patrolPoints.length===0)return 1;const i=this.patrolPoints[this.currentPoint],s=i.x-e.sprite.x,n=i.y-e.sprite.y;if(Math.sqrt(s*s+n*n)<=this.tolerance)return this.currentPoint=(this.currentPoint+1)%this.patrolPoints.length,0;const o=Math.atan2(n,s),h=Math.cos(o)*this.speed*t,l=Math.sin(o)*this.speed*t;return e.sprite.x+=h,e.sprite.y+=l,2}}class $h extends Tt{threshold;constructor(e=.3){super(),this.threshold=e}execute(e,t){return e.currentHealth/e.maximumHealth<=this.threshold?0:1}}class Pi extends Tt{maxDistance;constructor(e=300){super(),this.maxDistance=e}execute(e,t){if(!e.target)return 1;const i=e.target.x-e.sprite.x,s=e.target.y-e.sprite.y;return Math.sqrt(i*i+s*s)<=this.maxDistance?0:1}}class Dg extends Tt{formationType;radius;speed;constructor(e="circle",t=100,i=80){super(),this.formationType=e,this.radius=t,this.speed=i}execute(e,t){if(!e.target)return 1;const i=this.getFormationPosition(e),s=i.x-e.sprite.x,n=i.y-e.sprite.y;if(Math.sqrt(s*s+n*n)<5)return 0;const o=Math.atan2(n,s),h=Math.cos(o)*this.speed*t,l=Math.sin(o)*this.speed*t;return e.sprite.x+=h,e.sprite.y+=l,2}getFormationPosition(e){if(!e.target)return{x:e.sprite.x,y:e.sprite.y};const t=e.target.x,i=e.target.y,s=e.formationIndex||0;switch(this.formationType){case"circle":const n=s/(e.formationSize||1)*Math.PI*2;return{x:t+Math.cos(n)*this.radius,y:i+Math.sin(n)*this.radius};case"line":const a=this.radius/(e.formationSize||1),o=(s-(e.formationSize||1)/2)*a;return{x:t+o,y:i};case"triangle":const h=s/3*Math.PI*2;return{x:t+Math.cos(h)*this.radius,y:i+Math.sin(h)*this.radius};default:return{x:t,y:i}}}}class vs{behaviorTree;enemy;constructor(e,t){this.enemy=e,this.behaviorTree=t}update(e){this.behaviorTree.execute(this.enemy,e)}}class Ii{static createAggressiveBehavior(e){const t=new gs([new Gt([new $h(.3),new Rn(120,200)]),new Gt([new Pi(50),new ys(50,1)]),new zh(100,10)]);return new vs(e,t)}static createDefensiveBehavior(e){const t=new gs([new Gt([new $h(.5),new Rn(100,300)]),new Gt([new Pi(30),new ys(30,1.5)]),new Gt([new Pi(100),new Rn(80,150)]),new zh(60,10)]);return new vs(e,t)}static createPatrolBehavior(e,t){const i=new gs([new Gt([new Pi(50),new ys(50,1)]),new Bg(t,60,10)]);return new vs(e,i)}static createFormationBehavior(e,t="circle"){const i=new gs([new Gt([new Pi(50),new ys(50,1)]),new Dg(t,100,80)]);return new vs(e,i)}}class Fg{enemies=new Map;difficulty=1;addEnemy(e,t,i){let s;switch(t){case"aggressive":s=Ii.createAggressiveBehavior(e);break;case"defensive":s=Ii.createDefensiveBehavior(e);break;case"patrol":const n=i?.patrolPoints||[];s=Ii.createPatrolBehavior(e,n);break;case"formation":const a=i?.formationType||"circle";s=Ii.createFormationBehavior(e,a);break;default:s=Ii.createAggressiveBehavior(e)}this.enemies.set(e,s)}removeEnemy(e){this.enemies.delete(e)}update(e){for(const[t,i]of this.enemies)t.isActive()&&i.update(e*this.difficulty)}setDifficulty(e){this.difficulty=Math.max(.5,Math.min(2,e))}getEnemyCount(){return this.enemies.size}clear(){this.enemies.clear()}}class Lg{constructor(){}init(){}update(){}shutdown(){}}class Og{items=[];gold=0;constructor(){}addItem(e,t){this.items.push(e)}removeItem(e){const t=this.items.indexOf(e);t>-1&&this.items.splice(t,1)}getItems(){return[...this.items]}getAllItems(){return[...this.items]}addGold(e){this.gold+=e}getGold(){return this.gold}clear(){this.items=[],this.gold=0}}class kg{player;constructor(e){this.player=e}equipItem(e){}unequipItem(e){}getEquippedItems(){return[]}}class Ng{player;activePowerUps=[];constructor(e){this.player=e}addPowerUp(e){this.activePowerUps.push(e)}applyPowerUp(e){console.log(`Applying power-up: ${e}`)}removePowerUp(e){const t=this.activePowerUps.indexOf(e);t>-1&&this.activePowerUps.splice(t,1)}update(e){}getActivePowerUps(){return[...this.activePowerUps]}}class Ug{app;gameContainer;state;inputManager;player;camera;collisionManager;enemySpriteManager;gemSpriteManager;enemySpawner;weaponSystem;levelingSystem;terrainManager;terrainTiles=[];decorationTiles=[];hud;gameOverScreen;levelUpScreen;titleScreen;experienceOrbs=[];isRunning=!1;isGameOver=!1;isPaused=!1;showingTitleScreen=!0;ecsWorld;eventBus;enemySystem;collisionSystem;audioManager;saveManager;performanceMonitor;settingsMenu;pauseScreen;particleSystem;enemyAIManager;itemManager;inventory;equipment;powerUpManager;isPausedForMenu=!1;debugMode=!1;debugWeaponIndex=0;debugWeapons=[];constructor(e){this.app=e,this.gameContainer=new ve,this.state=new jm,this.inputManager=new Ym,this.player=new Jm,this.camera=new Zm(this.gameContainer,e.view.width,e.view.height),this.collisionManager=new Qm,this.enemySpriteManager=new tg,this.gemSpriteManager=new ig(this.app),this.enemySpawner=new ag(this.gameContainer,this.camera,this.collisionManager,this.player,this.enemySpriteManager),this.ecsWorld=new xg,this.eventBus=new _g,this.weaponSystem=new hg(this.gameContainer,this.collisionManager,this.player,this.enemySpawner,this.eventBus),this.levelingSystem=new Wh,this.terrainManager=new eg,this.hud=new cg(e.view.width,e.view.height),this.gameOverScreen=new ug(e.view.width,e.view.height),this.levelUpScreen=new dg,this.titleScreen=new fg(e.view.width,e.view.height),this.enemySystem=new wg(this.ecsWorld,this.eventBus,this.enemySpriteManager,this.gameContainer),this.collisionSystem=new Tg(this.ecsWorld,this.eventBus),this.ecsWorld.systemManager.registerSystem(this.collisionSystem),this.ecsWorld.systemManager.registerSystem(this.enemySystem),this.audioManager=new Sg(this.eventBus),this.saveManager=new Eg(this.eventBus),this.performanceMonitor=new Ag(this.eventBus);const t={audio:{masterVolume:1,sfxVolume:.8,musicVolume:.6,muted:!0},graphics:{particleQuality:"medium",screenShake:!0,showFPS:!1,vsync:!0},controls:{mouseSensitivity:1,keyboardLayout:"qwerty",invertY:!1},gameplay:{autoSave:!0,difficulty:"normal",tutorialEnabled:!0}};this.settingsMenu=new Cg(e.view.width,e.view.height,t),this.pauseScreen=new Mg(e.view.width,e.view.height),this.particleSystem=new Ig(e),this.enemyAIManager=new Fg,this.itemManager=new Lg,this.inventory=new Og,this.equipment=new kg(this.player),this.powerUpManager=new Ng(this.player),this.app.stage.addChild(this.gameContainer),this.levelUpScreen.container.x=e.view.width/2,this.levelUpScreen.container.y=e.view.height/2,this.app.stage.addChild(this.hud.getContainer()),this.app.stage.addChild(this.gameOverScreen.getContainer()),this.app.stage.addChild(this.levelUpScreen.container),this.app.stage.addChild(this.titleScreen.container),this.app.stage.addChild(this.settingsMenu.getContainer()),this.app.stage.addChild(this.pauseScreen.getContainer()),this.setupPhase4Callbacks(),console.warn("Game: Initialized successfully")}async init(){console.warn("Game: Initializing..."),this.ecsWorld.initialize(),console.log("ECS World initialized"),await this.audioManager.initialize(),console.log("AudioManager initialized");const e=this.saveManager.loadSettings();e&&console.log("Loaded saved settings:",e),this.performanceMonitor.start(),console.log("PerformanceMonitor started"),this.setupECSEventListeners(),await this.enemySpriteManager.loadEnemyAtlas(),await this.gemSpriteManager.loadGemAtlas(),this.inputManager.init(),this.initializeDebugSystem(),this.player.init(),this.gameContainer.addChild(this.player.sprite),this.player.sprite.zIndex=1500,this.player.sprite.x=0,this.player.sprite.y=0,this.collisionManager.addEntity(this.player),this.player.onDamageTaken=t=>{this.hud.showDamageEffect()},this.player.onPlayerDied=()=>{this.handleGameOver()},this.setupLevelingCallbacks(),this.hud.setMuteToggle(t=>{t?this.audioManager.setMasterVolume(0):this.audioManager.setMasterVolume(1)}),this.enemySpawner.onEnemyKilled=(t,i)=>{this.dropExperienceOrb(i.x,i.y,t.experienceValue||1)},this.enemySpawner.onWaveChanged=(t,i)=>{console.log(`🌊 Wave ${t+1} Started: ${i.enemies.join(", ")} (${i.event})`)},this.enemySpawner.onGameComplete=()=>{console.log("🎉 Game Complete! You survived all 30 minutes!")},console.log("Setting up title screen callback..."),this.titleScreen.onStartGame=()=>{console.log("Title screen callback triggered"),this.startGameFromTitle()},console.log("Title screen callback set. Current state - showingTitleScreen:",this.showingTitleScreen,"titleScreen.visible:",this.titleScreen.visible),this.createTestTerrain(),this.camera.setTarget(this.player.sprite.x,this.player.sprite.y),console.log(`Player positioned at world coordinates: ${this.player.sprite.x}, ${this.player.sprite.y}`),console.log("Camera system initialized"),this.hud.getContainer().visible=!1,console.log("Game initialized - title screen ready!")}initializeDebugSystem(){this.debugWeapons=this.weaponSystem.getAvailableWeapons().map(e=>e.type),console.log("Debug system initialized with weapons:",this.debugWeapons)}setupECSEventListeners(){this.eventBus.on("collision:player-enemy",e=>{console.log("ECS Collision: Player-Enemy",e.data)}),this.eventBus.on("collision:projectile-enemy",e=>{console.log("ECS Collision: Projectile-Enemy",e.data)}),this.eventBus.on("collision:player-experience-orb",e=>{console.log("ECS Collision: Player-ExperienceOrb",e.data)}),this.eventBus.on("enemy:created",e=>{console.log("ECS Enemy Created:",e.data)}),this.eventBus.on("enemy:died",e=>{console.log("ECS Enemy Died:",e.data)}),console.log("ECS Event listeners set up")}getECSStats(){return{world:this.ecsWorld.getDetailedStats(),collision:this.collisionSystem.getPerformanceMetrics(),enemy:this.enemySystem.getEnemyCount()}}start(){console.log("Starting game ticker..."),this.app.ticker.add(this.update,this),console.log("Game ticker started, main loop should be running"),console.log("Application started - showing title screen")}startGameFromTitle(){console.log("startGameFromTitle() called"),console.log("Current state - showingTitleScreen:",this.showingTitleScreen,"isRunning:",this.isRunning),this.showingTitleScreen=!1,this.isRunning=!0,this.titleScreen.hide(),this.hud.getContainer().visible=!0,this.eventBus.emitEvent("game:started"),console.log("Game started from title screen! New state - showingTitleScreen:",this.showingTitleScreen,"isRunning:",this.isRunning)}stop(){this.isRunning=!1,this.app.ticker.remove(this.update,this)}handleGameOver(){this.isGameOver=!0,this.isRunning=!1;const e=this.hud.getSurvivalTime(),t=this.enemySpawner.getStats();this.gameOverScreen.show(e,t.count,t.maxEnemies),console.log("Game Over! Survival time:",e.toFixed(1),"seconds")}updateGameOverState(){if(this.gameOverScreen.update(0),this.inputManager.isKeyJustPressed("Space")){console.log("Space key detected - restarting!"),this.restart();return}if(this.inputManager.isKeyJustPressed(" ")||this.inputManager.isKeyJustPressed("Spacebar")){console.log("Alternative space key detected - restarting!"),this.restart();return}if(this.inputManager.isKeyJustPressed("Escape")){console.log("Escape key detected - quitting!"),location.reload();return}}restart(){this.isGameOver=!1,this.isRunning=!1,this.player.heal(this.player.maximumHealth),this.player.sprite.x=0,this.player.sprite.y=0,this.enemySpawner.clear(),this.weaponSystem.clear();for(const e of this.experienceOrbs)this.collisionManager.removeEntity(e),e.sprite.parent&&e.sprite.parent.removeChild(e.sprite);this.experienceOrbs=[],this.levelingSystem=new Wh,this.setupLevelingCallbacks(),this.hud.reset(),this.gameOverScreen.hide(),this.showingTitleScreen=!0,this.titleScreen.show(),this.hud.getContainer().visible=!1,console.log("Game reset - showing title screen")}setupLevelingCallbacks(){this.levelingSystem.onLevelUp=e=>{console.log(`Level up! Now level ${e.newLevel}`),this.isPaused=!0,this.levelUpScreen.show(e.newLevel,e.availableUpgrades),this.eventBus.emitEvent("player:level_up")},this.levelingSystem.onXPGained=(e,t,i)=>{this.eventBus.emitEvent("player:xp_gained")},this.levelUpScreen.onUpgradeSelected=e=>{this.levelingSystem.selectUpgrade(e,this.weaponSystem),this.isPaused=!1,this.levelingSystem.applyUpgrades(this.player,this.weaponSystem),this.eventBus.emitEvent("ui:click"),console.log(`Selected upgrade: ${e}`)}}dropExperienceOrb(e,t,i=1){const s=new lg(e,t,i,this.gemSpriteManager,()=>this.levelingSystem.magnetRange);s.onCollected=n=>{this.levelingSystem.addExperience(n),this.eventBus.emitEvent("player:xp_gained"),this.removeExperienceOrb(s)},this.gameContainer.addChild(s.sprite),s.sprite.zIndex=80,this.collisionManager.addEntity(s),this.experienceOrbs.push(s)}removeExperienceOrb(e){this.collisionManager.removeEntity(e),setTimeout(()=>{e.sprite.parent&&e.sprite.parent.removeChild(e.sprite)},100);const t=this.experienceOrbs.indexOf(e);t>-1&&this.experienceOrbs.splice(t,1)}createTestTerrain(){setTimeout(()=>{if(console.log("🔍 Checking if terrain manager is loaded..."),console.log("Terrain manager loaded status:",this.terrainManager.isLoaded()),this.terrainManager.isLoaded()){console.log("✅ Terrain manager is loaded, generating procedural terrain...");const e=2e3,t=this.terrainManager.generateProceduralTerrain({worldWidth:e,worldHeight:e,tileSize:this.terrainManager.getTerrainInfo().tileSize,biomeSeed:Math.floor(Math.random()*1e6),terrainDensity:.5});console.log(`📊 Generated ${t.length} terrain tiles, adding to game container...`);for(const n of t)this.gameContainer.addChild(n.sprite),this.terrainTiles.push(n),console.log(`📍 Added terrain tile ${n.tileType} (${n.biome}) at (${n.x}, ${n.y})`);console.log(`✅ Successfully added ${t.length} terrain tiles to game`);const i=this.terrainManager.generateSparseDecorations({worldWidth:e,worldHeight:e,tileSize:this.terrainManager.getTerrainInfo().tileSize,biomeSeed:Math.floor(Math.random()*1e6)});console.log(`🌿 Generated ${i.length} decoration tiles, adding to game container...`);for(const n of i)this.gameContainer.addChild(n.sprite),this.decorationTiles.push(n),console.log(`🌿 Added decoration tile ${n.tileType} at (${n.x}, ${n.y})`);console.log(`✅ Successfully added ${i.length} decoration tiles to game`),console.log("🎮 Game container children count:",this.gameContainer.children.length);const s=new Map;for(const n of t)n.biome&&s.set(n.biome,(s.get(n.biome)||0)+1);console.log("🌍 Biome distribution:",Object.fromEntries(s))}else console.log("⏳ Terrain manager not loaded yet, retrying in 1 second..."),this.createTestTerrain()},1e3)}handleDebugInput(){this.inputManager.isKeyJustPressed("Backquote")&&(this.debugMode=!this.debugMode,console.log(`Debug mode ${this.debugMode?"ENABLED":"DISABLED"}`),this.debugMode?this.hud.showDebugModeNotification():(this.weaponSystem.clear(),console.log("Debug mode disabled - reset to starting fireball weapon"))),this.inputManager.isKeyJustPressed("F3")&&(this.testPhase3Systems(),this.inputManager.clearJustPressedKey("F3")),this.inputManager.isKeyJustPressed("KeyM")&&(this.hud.toggleMute(),this.inputManager.clearJustPressedKey("KeyM")),this.inputManager.isKeyJustPressed("Escape")&&(this.isPausedForMenu?(this.settingsMenu.hide(),this.pauseScreen.hide(),this.isPausedForMenu=!1):this.isRunning&&!this.showingTitleScreen&&!this.isGameOver&&(this.pauseScreen.show(),this.isPausedForMenu=!0),this.inputManager.clearJustPressedKey("Escape")),this.inputManager.isKeyJustPressed("KeyS")&&(this.isPausedForMenu&&this.settingsMenu.show(),this.inputManager.clearJustPressedKey("KeyS")),this.inputManager.isKeyJustPressed("F4")&&(this.testPhase4Systems(),this.inputManager.clearJustPressedKey("F4")),this.debugMode&&(this.inputManager.isKeyJustPressed("BracketRight")&&(this.debugWeaponIndex=(this.debugWeaponIndex+1)%this.debugWeapons.length,this.cycleToWeapon(this.debugWeapons[this.debugWeaponIndex]),console.log(`Debug: Switched to weapon ${this.debugWeapons[this.debugWeaponIndex]}`),this.inputManager.clearJustPressedKey("BracketRight")),this.inputManager.isKeyJustPressed("BracketLeft")&&(this.debugWeaponIndex=(this.debugWeaponIndex-1+this.debugWeapons.length)%this.debugWeapons.length,this.cycleToWeapon(this.debugWeapons[this.debugWeaponIndex]),console.log(`Debug: Switched to weapon ${this.debugWeapons[this.debugWeaponIndex]}`),this.inputManager.clearJustPressedKey("BracketLeft")))}cycleToWeapon(e){this.weaponSystem.clear(),this.weaponSystem.addWeapon(e),this.hud.showWeaponNotification(e)}update(e){if(this.performanceMonitor.startUpdateTimer(),this.inputManager.update(),this.handleDebugInput(),this.showingTitleScreen){this.titleScreen.update(e,this.inputManager),this.inputManager.clearJustPressed(),this.performanceMonitor.endUpdateTimer();return}if(this.isGameOver){this.updateGameOverState(),this.inputManager.clearJustPressed(),this.performanceMonitor.endUpdateTimer();return}if(this.isPaused){this.levelUpScreen.update(this.inputManager),this.inputManager.clearJustPressed(),this.performanceMonitor.endUpdateTimer();return}if(!this.isRunning){this.performanceMonitor.endUpdateTimer();return}this.performanceMonitor.startRenderTimer();const t=2e3;this.player.update(e,this.inputManager,t,t),this.camera.setTarget(this.player.sprite.x,this.player.sprite.y),this.camera.update(e),this.updateExperienceOrbs(e),this.enemySpawner.update(e),this.weaponSystem.update(e),this.collisionManager.update(),this.ecsWorld.update(e),this.particleSystem.update(e),this.enemyAIManager.update(e),this.powerUpManager.update(),this.hud.update(e,this.player,this.enemySpawner,this.weaponSystem,this.levelingSystem),this.state.update(e),this.performanceMonitor.endUpdateTimer(),this.performanceMonitor.endRenderTimer()}updateExperienceOrbs(e){const t=[];for(const i of this.experienceOrbs)i.update(e,this.player),t.push(i);this.experienceOrbs=t}get application(){return this.app}get gameState(){return this.state}get gameCamera(){return this.camera}get collisions(){return this.collisionManager}get enemies(){return this.enemySpawner}get weapons(){return this.weaponSystem}get audio(){return this.audioManager}get save(){return this.saveManager}get performance(){return this.performanceMonitor}testPhase3Systems(){console.log("🧪 Testing Phase 3 Systems..."),console.log("🎵 Testing Audio System..."),this.audioManager.playSound("ui_click"),this.audioManager.playSound("player_attack"),this.audioManager.playSound("enemy_death"),this.audioManager.playSound("xp_pickup"),this.audioManager.playSound("level_up"),console.log("💾 Testing Save System..."),console.log("Save/load test completed"),console.log("📊 Testing Performance Monitor...");const e=this.performanceMonitor.getStatistics();console.log("Performance stats:",e),console.log("✅ Phase 3 Systems test complete!")}setupPhase4Callbacks(){this.settingsMenu.setSettingsChangeCallback(e=>{this.audioManager.setMasterVolume(e.audio.masterVolume),this.audioManager.setSFXVolume(e.audio.sfxVolume),this.audioManager.setMusicVolume(e.audio.musicVolume),this.particleSystem.setQuality(e.graphics.particleQuality),this.saveManager.saveSettings(e)}),this.settingsMenu.setCloseCallback(()=>{this.settingsMenu.hide(),this.isPausedForMenu=!1}),this.pauseScreen.setResumeCallback(()=>{this.pauseScreen.hide(),this.isPausedForMenu=!1}),this.pauseScreen.setSettingsCallback(()=>{this.pauseScreen.hide(),this.settingsMenu.show()}),this.pauseScreen.setQuitCallback(()=>{this.pauseScreen.hide(),this.showingTitleScreen=!0,this.isPausedForMenu=!1,this.titleScreen.show()}),this.settingsMenu.hide(),this.pauseScreen.hide()}testPhase4Systems(){console.log("🚀 Testing Phase 4 Systems..."),console.log("✨ Testing Particle System..."),this.particleSystem.createExplosion(this.player.sprite.x,this.player.sprite.y,2),this.particleSystem.createSparkle(this.player.sprite.x+50,this.player.sprite.y,65280),this.particleSystem.createMagicEffect(this.player.sprite.x-50,this.player.sprite.y),console.log("⚡ Testing Power-up System..."),this.powerUpManager.applyPowerUp("speed_boost"),this.powerUpManager.applyPowerUp("damage_boost"),console.log("🎒 Testing Item System..."),this.inventory.addItem("health_potion",3),this.inventory.addItem("iron_ingot",5),this.inventory.addGold(100),console.log("Inventory:",this.inventory.getAllItems()),console.log("Gold:",this.inventory.getGold()),console.log("⚙️ Testing Settings Menu..."),this.settingsMenu.show(),this.isPausedForMenu=!0,console.log("✅ Phase 4 Systems test complete!")}}async function Gg(){const r=new Jl({width:1024,height:768,backgroundColor:1710618,antialias:!0}),e=document.getElementById("gameContainer");if(e){const s=r.view;e.appendChild(s),s.tabIndex=0,s.focus(),s.addEventListener("click",()=>s.focus())}const t=new Ug(r);await t.init(),t.start();const i=document.getElementById("loadingText");i&&(i.style.display="none")}Gg().catch(console.error);export{Dt as $,Lu as A,ze as B,Uu as C,It as D,$i as E,zg as F,Hu as G,Kt as H,ps as I,Ih as J,wn as K,cm as L,wa as M,Mh as N,Ph as O,eh as P,Ta as Q,et as R,lm as S,Ne as T,hm as U,Us as V,sc as W,mm as X,Dh as Y,Fh as Z,K as _,Qo as a,ll as a$,ve as a0,oe as a1,_e as a2,Ie as a3,We as a4,Jt as a5,va as a6,Tl as a7,le as a8,ye as a9,mf as aA,qs as aB,Jp as aC,vf as aD,af as aE,Rf as aF,If as aG,qt as aH,Kf as aI,Fe as aJ,Ns as aK,Ah as aL,Jf as aM,Pf as aN,im as aO,sm as aP,Yf as aQ,Zf as aR,nm as aS,$l as aT,ip as aU,Rs as aV,Is as aW,wt as aX,gl as aY,ce as aZ,Nn as a_,mh as aa,ql as ab,Lp as ac,Jl as ad,Zl as ae,_t as af,_f as ag,jt as ah,it as ai,bf as aj,Ti as ak,Lt as al,Qe as am,ra as an,zp as ao,Xi as ap,wf as aq,Sf as ar,Cf as as,Mf as at,Af as au,Tf as av,sf as aw,ks as ax,df as ay,Yp as az,al as b,ep as b$,Vt as b0,pd as b1,ml as b2,Wn as b3,Ce as b4,$s as b5,Wl as b6,sp as b7,Bs as b8,rp as b9,vl as bA,Il as bB,_a as bC,zi as bD,Yn as bE,Md as bF,ct as bG,Dl as bH,Ad as bI,Ds as bJ,dt as bK,jd as bL,Cl as bM,Yd as bN,Xt as bO,Ll as bP,xa as bQ,Ol as bR,tt as bS,Xl as bT,Fs as bU,Ln as bV,Jd as bW,hl as bX,Vu as bY,Od as bZ,Gl as b_,ke as ba,bd as bb,_l as bc,$n as bd,bl as be,wd as bf,Pd as bg,yn as bh,Pl as bi,Ft as bj,wl as bk,qg as bl,On as bm,mi as bn,yl as bo,Cd as bp,Sl as bq,Hl as br,Ys as bs,zl as bt,Ml as bu,xt as bv,Rl as bw,_d as bx,xl as by,ei as bz,Yg as c,Bt as c$,Dd as c0,Nd as c1,ad as c2,kd as c3,vi as c4,cd as c5,Ue as c6,Pn as c7,lt as c8,ot as c9,Se as cA,Rc as cB,j as cC,Nl as cD,Ls as cE,Ee as cF,ap as cG,Ip as cH,ia as cI,Fp as cJ,Vi as cK,Os as cL,Ze as cM,xi as cN,om as cO,dp as cP,vp as cQ,Zn as cR,Qn as cS,wp as cT,Ep as cU,Cp as cV,Ks as cW,Jg as cX,me as cY,Gs as cZ,pm as c_,Mc as ca,ht as cb,Qt as cc,W as cd,fa as ce,Pe as cf,ut as cg,Me as ch,Ve as ci,Vh as cj,X as ck,gt as cl,gi as cm,ae as cn,V as co,Z as cp,Vs as cq,Qu as cr,Xs as cs,Te as ct,vt as cu,Ps as cv,Yt as cw,Zu as cx,js as cy,Le as cz,de as d,$e as d0,Sa as d1,Zt as d2,fm as d3,hc as d4,la as d5,Tm as d6,fc as d7,mc as d8,kh as d9,Nm as da,Js as db,he as dc,Rt as dd,fe as de,Mt as df,Hs as dg,Zg as dh,Es as di,ca as dj,ua as dk,Um as dl,Xm as dm,Qg as dn,Mn as dp,ku as e,jg as f,ol as g,Tu as h,Wu as i,kc as j,Gu as k,bt as l,Wg as m,Fu as n,yt as o,Jo as p,Su as q,Zo as r,Ms as s,De as t,Hg as u,nl as v,$g as w,Vg as x,Xg as y,yi as z};
